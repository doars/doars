var I=Symbol("ATTRIBUTES"),S=Symbol("COMPONENT"),K=Symbol("FOR"),P=Symbol("INITIALIZED"),x=Symbol("ON"),L=Symbol("REFERENCES"),B=Symbol("REFERENCES_CACHE"),q=Symbol("SYNC");var ue=class{constructor(){let e={};this.addEventListener=(r,t,i=null)=>{r in e||(e[r]=[]),e[r].push({callback:t,options:i})},this.removeEventListener=(r,t)=>{if(!Object.keys(e).includes(r))return;let i=e[r],n=-1;for(let l=0;l<i.length;l++)if(i[l].callback===t){n=l;break}n<0||(i.splice(n,1),Object.keys(i).length===0&&delete e[r])},this.removeEventListeners=r=>{!r||delete e[r]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(r,t,i=null)=>{if(!e[r])return;let n=e[r];for(let l=0;l<n.length;l++){let s=i&&i.reverse?n[n.length-(l+1)]:n[l];s.options&&s.options.once&&n.splice(l,1),s.callback(...t)}}}},W=ue;var X=o=>o.replace(/\\/g,"\\\\").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\n/g,"\\n"),rt=o=>o.replace(/-(\w)/g,(e,r)=>r.toUpperCase()),ye=o=>{let e={};for(let r of o){let t=r.indexOf("-");if(t<0){e[r]=!0;continue}if(t===0){e[r.substring(1)]=!1;continue}let i=r.substring(0,t),n=r.substring(t+1),l=n,s;if(n.endsWith("ms")?l=n.substring(-2):n.endsWith("s")?(s="s",l=n.substring(-1)):n.endsWith("m")?(s="m",l=n.substring(-1)):n.endsWith("h")&&(s="h",l=n.substring(-1)),l=Number.parseInt(l),!isNaN(l))switch(n=l,s){case"h":n*=60;case"m":n*=60;case"s":n*=1e3;break}e[i]=n}return e},xe=(o,e)=>{if(e=e.match(new RegExp("^"+o+"-([a-z][0-9a-z-]{1,}):?([a-z][0-9a-z-]*)?(\\..*]*)?$","i")),!e)return;let[r,t,i,n]=e;i=i!==""?i:null;let l=i?rt(i):null;return n=n?n.substring(1).split("."):[],[t,i,l,n]},be=o=>{let e=o.match(/^([$_a-z0-9,(){}\s]{1,}?)\s+(?:in|of)\s+([\s\S]{1,})$/i);if(!e)return;let r=e[1].replace(/^[\s({]*|[)}\s]*$/g,"");if(r=r.match(/^([$_a-z0-9]{1,})?(?:,\s+?)?([$_a-z0-9]{1,})?(?:,\s+)?([$_a-z0-9]{1,})?$/i),!!r)return r.shift(),{iterable:e[2].trim(),variables:[...r]}},G=o=>{if(typeof o=="string"&&(o=o.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(o)){console.error("Doars: parseSelector expects Array of string or a single string.");return}let e={};for(let r of o)switch(r=r.trim(),r[0]){case"#":e.id=r.substring(1);break;case".":r=r.substring(1),e.class||(e.class=[]),e.class.includes(r)||e.class.push(r);break;case"[":let[t,i,n]=r.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);e[i]=n;break}return e};var F=class extends W{constructor(e,r,t,i,n=!1){super();let l=Symbol("ID_ATTRIBUTE");n||(r[I]||(r[I]=[]),r[I].push(this));let s={},c=null,a,f,u,d,v;if(t){let[h,A,D,O]=xe(e.getLibrary().getOptions().prefix,t);a=h,f=D,u=A,d=O,O&&(v=ye(O))}this.getComponent=()=>e,this.getElement=()=>r,this.getId=()=>l,this.getDirective=()=>a,this.getKey=()=>f,this.getKeyRaw=()=>u,this.getModifiers=()=>Object.assign({},v),this.getModifiersRaw=()=>d,this.getName=()=>t,this.getValue=()=>i,this.setValue=h=>{i=h,this.dispatchEvent("changed",[this])},this.clearData=()=>{c=null},this.hasData=()=>c!==null,this.getData=()=>c,this.setData=h=>{c=h},this.destroy=()=>{this.setData(null),this.clearAccessed();let h=r[I].indexOf(this);h>=0&&r[I].splice(h,1),this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.accessed=(h,A)=>{if(!s[h])s[h]=[];else if(s[h].includes(A))return;s[h].push(A),this.dispatchEvent("accessed",[this,h,A])},this.clearAccessed=()=>{s={}},this.hasAccessed=(h,A)=>{if(!(h in s))return!1;let D=s[h];for(let O of A)if(D.includes(O))return!0;return!1},this.clone=()=>new F(e,r,t,i,!0)}};var st=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],J=(o,e)=>{let r=!1,t={};for(let i of st)t[i]=(...n)=>{if(r){console.error("illegal operation attempted on a revoked proxy");return}return i in e?e[i](...n):Reflect[i](...n)};return{proxy:new Proxy(o,t),revoke:()=>{r=!0}}};var de=class extends W{constructor(e={}){super(),e=Object.assign({delete:!0,get:!0,set:!0},e);let r=new WeakMap;this.add=(t,i=[])=>{if(r.has(t))return r.get(t);for(let s in t)t[s]&&typeof t[s]=="object"&&(t[s]=this.add(t[s],[...i,s]));let n={};e.delete&&(n.deleteProperty=(s,c)=>{if(!Reflect.has(s,c))return!0;this.remove(s,c);let a=Reflect.deleteProperty(s,c);return a&&this.dispatchEvent("delete",[s,Array.isArray(s)?[...i]:[...i,c]]),a}),e.get&&(n.get=(s,c,a)=>(c!==Symbol.unscopables&&this.dispatchEvent("get",[s,[...i,c],a]),Reflect.get(s,c,a))),e.set&&(n.set=(s,c,a,f)=>(s[c]===a||(a&&typeof a=="object"&&(a=this.add(a,[...i,c])),s[c]=a,this.dispatchEvent("set",[s,Array.isArray(s)?[...i]:[...i,c],a,f])),!0));let l=J(t,n);return r.set(l,t),l.proxy},this.remove=t=>{if(!r.has(t))return;let i=r.get(t);r.delete(i);for(let n in i.proxy)typeof i.proxy[n]=="object"&&this.remove(i.proxy[n]);i.revoke()}}},Ae=de;var _=o=>{if(!!o.parentElement)return o=o.parentElement,o[S]?o[S]:_(o)};var oe=(o,e)=>{for(let r in e){if(r==="class"){for(let t of e.class)o.classList.add(t);continue}o.setAttribute(r,e[r])}};var M=(o,e)=>{for(let r in e){if(r==="class"){for(let t of e.class)o.classList.remove(t);continue}e[r]&&o.attributes[r]!==e[r]||o.removeAttribute(r)}},pe=(o,e,r)=>{if(e==="value"&&o.tagName==="INPUT"){if(r||(r=""),o.getAttribute(e)===r)return;o.setAttribute(e,r);return}if(e==="checked"&&(o.type==="checkbox"||o.type==="radio")){o.checked=!!r;return}e==="class"&&(Array.isArray(r)?r=r.join(" "):typeof r=="object"&&(r=Object.entries(r).filter(([t,i])=>i).map(([t])=>t).join(" "))),e==="style"&&(Array.isArray(r)?r=r.join(" "):typeof r=="object"&&(r=Object.entries(r).map(([t,i])=>t+":"+i).join(";"))),r===!1||r===null||r===void 0?o.removeAttribute(e):o.setAttribute(e,r)},me=(o,e)=>{for(let r in e)pe(o,r,e[r])};var ot="-transition:",ne=(o,e,r,t=null)=>{if(r.nodeType!==1){t&&t();return}let{prefix:i}=e.getLibrary().getOptions(),n=i+ot+o,l=v=>{r.dispatchEvent(new CustomEvent("transition-"+v)),r.dispatchEvent(new CustomEvent("transition-"+o+"-"+v))},s,c,a,f,u=!1,d={};return s=n,c=r.getAttribute(s),c&&(d.during=G(c),oe(r,d.during)),s=n+".from",c=r.getAttribute(s),c&&(d.from=G(c),oe(r,d.from)),l("start"),f=requestAnimationFrame(()=>{if(f=null,u)return;if(d.from&&(M(r,d.from),d.from=void 0),s=n+".to",c=r.getAttribute(s),c)d.to=G(c),oe(r,d.to);else if(!d.during){l("end"),t&&t(),u=!0;return}let v=getComputedStyle(r),h=Number(v.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;h===0&&(h=Number(v.animationDuration.replace("s",""))*1e3),a=setTimeout(()=>{a=null,!u&&(d.during&&(M(r,d.during),d.during=void 0),d.to&&(M(r,d.to),d.to=void 0),l("end"),t&&t(),u=!0)},h)}),()=>{!u||(u=!0,d.during&&(M(r,d.during),d.during=void 0),d.from?(M(r,d.from),d.from=void 0):d.to&&(M(r,d.to),d.to=void 0),f?(cancelAnimationFrame(f),f=null):a&&(clearTimeout(a),a=null),l("end"),t&&t())}},ie=(o,e,r)=>ne("in",o,e,r),Q=(o,e,r)=>ne("out",o,e,r);var ee=(o,e)=>{o.nextSibling?o.parentNode.insertBefore(e,o.nextSibling):o.parentNode.appendChild(e)};var Y=(o,e)=>{let r=-1,t=null;return()=>{if(r>=0&&t){let n=t();if(n)return n}let i=null;do{if(r++,r>=o.childElementCount)return null;i=o.children[r]}while(!e(i));return i.childElementCount&&(t=Y(i,e)),i}};var te=class{constructor(e,r){let t=Symbol("ID_COMPONENT"),{prefix:i,processor:n}=e.getOptions(),l=typeof n,s;l==="function"?s=n:l==="string"&&e.constructor[n+"Expression"]?s=e.constructor[n+"Expression"]:(console.warn("Doars: Expression processor not found. Using fallback instead."),s=e.constructor.executeExpression??e.constructor.interpretExpression??e.constructor.callExpression),s||console.error("Doars: No expression processor available. Process option: ",process);let c=Object.freeze({processExpression:s,transition:ne,transitionIn:ie,transitionOut:Q}),a=[],f=!1,u=!1,d,v,h;if(!r.attributes[i+"-state"]){console.error("Doars: element given to component does not contain a state attribute!");return}r[S]=this;let A=[],D=_(r);D&&(D.getChildren().includes(this)||(D.getChildren().push(this),e.update([{id:D.getId(),path:"children"}]))),this.getAttributes=()=>a,this.getChildren=()=>A,this.getElement=()=>r,this.getId=()=>t,this.getLibrary=()=>e,this.getParent=()=>D,this.getProxy=()=>v,this.getState=()=>h,this.setParent=E=>{D=E},this.initialize=()=>{if(u)return;u=!0;let E=i+"-state",b=r.attributes[E].value;if(d=b?s(this,new F(this,r,null,b),b):{},d===null)d={};else if(typeof d!="object"||Array.isArray(d)){console.error("Doars: component tag must return an object!");return}v=new Ae,h=v.add(d),this.scanAttributes(r)},this.destroy=()=>{if(!u)return;if(a.length>0){let b=e.getDirectivesObject();for(let p in b)b[p].destroy||(b[p]=void 0);for(let p of a){let m=b[p.getKey()];m&&m.destroy(this,p,c),p.destroy()}}delete r[S],a=[],u=!1,v.remove(d),h=null,v=null,d=null;let E=[];if(A.length>0){for(let b of A)b.setParent(D),E.push({id:b.getId(),path:"parent"});E.push({id:t,path:"children"})}D&&(A.length>0&&(D.getChildren().push(...A),E.push({id:D.getId(),path:"children"})),E.push({id:t,path:"parent"})),E.length>0&&e.update(E),O("destroyed",{element:r,id:t})},this.addAttribute=(E,b,p)=>{let m=e.getDirectivesNames(),y=new F(this,E,b,p),g=y.length,w=m.indexOf(y.getDirective());for(let U=a.length-1;U>=0;U--)if(m.indexOf(a[U].getDirective())<=w){g=U+1;break}return a.splice(g,0,y),y},this.removeAttribute=E=>{let b=a.indexOf(E);if(b<0)return;let m=e.getDirectivesObject[E.getKey()];m&&m.destroy&&m.destroy(this,E,c),a.splice(b,1),E.destroy()},this.scanAttributes=E=>{let b=i+"-state",p=i+"-ignore",m=[],y=Y(E,g=>!g.hasAttribute(b)&&!g.hasAttribute(p));do for(let{name:g,value:w}of E.attributes)e.isDirectiveName(g)&&m.push(this.addAttribute(E,g,w));while(E=y());return m},this.updateAttribute=E=>{if(!E.getElement()||E.getValue()===null||E.getValue()===void 0){this.removeAttribute(E);return}let b=e.getDirectivesObject();E.clearAccessed();let p=b[E.getDirective()];p&&p.update(this,E,c)},this.updateAttributes=E=>{if(!u||E.length<=0){f||(f=!0,O("updated",{attributes:E,element:r,id:t}));return}for(let b of E)this.updateAttribute(b);f=!0,O("updated",{attributes:E,element:r,id:t})},this.update=E=>{if(!u)return;let b=Object.getOwnPropertySymbols(E),p=[];for(let m of a)for(let y of b)m.hasAccessed(y,E[y])&&(this.updateAttribute(m),p.push(m));(!f||p.length>0)&&(f=!0,O("updated",{attributes:p,element:r,id:t}))};let O=(E,b)=>{r.dispatchEvent(new CustomEvent(i+"-"+E,{detail:b,bubbles:!0}))}}};var De={name:"$children",create:(o,e,r,{createContextsProxy:t,RevocableProxy:i})=>{let n,l=i(o.getChildren(),{get:(s,c,a)=>{if(n||(n=s.map(u=>t(u,e,r)),e.accessed(o.getId(),"children")),isNaN(c))return Reflect.get(n,c,a);let f=Reflect.get(n,c,a);if(f)return f.contexts}});return{value:l.proxy,destroy:()=>{n&&n.forEach(s=>s.destroy()),l.revoke()}}}};var Ne={name:"$component",create:o=>({value:o.getElement()})};var Oe={name:"$element",create:(o,e)=>({value:e.getElement()})};var Ce={name:"$dispatch",create:o=>({value:(e,r={})=>{o.getElement().dispatchEvent(new CustomEvent(e,{detail:r,bubbles:!0}))}})};var we={deconstruct:!0,name:"$for",create:(o,e,r,{RevocableProxy:t})=>{if(o!==e.getComponent())return;let i=e.getElement(),n=o.getElement(),l=[],s={};for(;i&&!i.isSameNode(n);){let a=i[K];if(a){l.push(a);for(let f in a.variables)s[f]=a.variables[f]}i=i.parentNode}if(l.length===0)return;let c=t(s,{get:(a,f)=>{for(let u of l)if(f in u.variables)return e.accessed(u.id,"$for"),u.variables[f]}});return{value:c.proxy,destroy:()=>{c.revoke()}}}};var Te={name:"$inContext",create:(o,e,r,{createContexts:t})=>({value:i=>{let n=[],l=(f,u)=>{n.push({id:f,path:u})},{contexts:s,destroy:c}=t(o,e,l,{}),a=i(s);return c(),n.length>0&&o.getLibrary().update(n),a}})};var Se={name:"$nextTick",create:(o,e,r,{createContexts:t})=>{let i,n=!1,l=()=>{if(n)return;n=!0;let s=o.getLibrary();i=[];let c=()=>{a();let{contexts:f,destroy:u}=t(o,e,r,{});for(let d of i)d(f);u()},a=()=>{s.removeEventListener("updated",c),e.removeEventListener("changed",a),e.removeEventListener("destroyed",a)};s.addEventListener("updated",c),e.addEventListener("changed",a),e.addEventListener("destroyed",a)};return{value:s=>{l(),i.push(s)}}}};var ke={name:"$parent",create:(o,e,r,{createContextsProxy:t})=>{let i=o.getParent();if(!i)return{key:"$parent",value:null};let{contexts:n,destroy:l}=t(i,e,r);return{value:n,destroy:l}}};var Le={name:"$references",create:(o,e,r,{RevocableProxy:t})=>{if(!o[L])return{key:"$references",value:[]};let i=o[B];if(!i){let l=o[L],s=Object.getOwnPropertySymbols(l);i={};for(let c of s){let{element:a,name:f}=l[c];i[f]=a}o[B]=i}let n=t(i,{get:(l,s,c)=>(e.accessed(o.getId(),"$references."+s),Reflect.get(l,s,c))});return{value:n.proxy,destroy:()=>{n.revoke()}}}};var Ie={deconstruct:!0,name:"$state",create:(o,e,r,{RevocableProxy:t})=>{let i=o.getProxy(),n=o.getState();if(!i||!n)return;let l=(f,u)=>r(o.getId(),"$state."+u.join(".")),s=(f,u)=>e.accessed(o.getId(),"$state."+u.join(".")),c=(f,u)=>r(o.getId(),"$state."+u.join("."));i.addEventListener("delete",l),i.addEventListener("get",s),i.addEventListener("set",c);let a=t(n,{});return{value:a.proxy,destroy:()=>{i.removeEventListener("delete",l),i.removeEventListener("get",s),i.removeEventListener("set",c),a.revoke()}}}};var Wt=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var k=o=>o&&Object.prototype.toString.call(o)==="[object Promise]";var Re={name:"attribute",update:(o,e,{processExpression:r})=>{let t=e.getElement(),i=e.getModifiers(),n=s=>{if(i.selector){if(typeof s!="string"){console.error("Doars: Value returned to attribute directive must be a string if the selector modifier is set.");return}s=G(s),me(t,s);return}let c=e.getKeyRaw();if(!c){typeof s=="object"&&!Array.isArray(s)?me(t,s):console.error("Doars: Value returned to attribute directive of invalid type.");return}pe(t,c,s)},l=r(o,e,e.getValue());e.setData(l),k(l)?Promise.resolve(l).then(s=>{e.getData()===l&&n(s)}):n(l)}};var Pe={name:"cloak",update:function(o,e,{transitionIn:r}){let t=e.getElement();t.removeAttribute(o.getLibrary().getOptions().prefix+"-"+this.name),r(o,t)}};var ce=(o,...e)=>{let r={};for(let t=0;t<e.length&&!(t>=o.length);t++)r[o[t]]=e[t];return r},je=(o,e,r=-1)=>(r++,r>=o.length?-1:o[r][K].value===e?r:je(o,e,r)),le=(o,e,r,t,i,n,l)=>{let s=je(t,n,i);if(s>=0){if(s===i+1)return;let f=t[s];ee(t[i]?t[i]:r,f),e(f[K].id);return}let c=document.importNode(r.content,!0),a=i===-1?r:t[i];ee(a,c),c=a.nextElementSibling,ie(o,c),c[K]={id:Symbol("ID_FOR"),value:n,variables:l},t.splice(i+1,0,c)},he=(o,e,r)=>{if(!(e.length<r))for(let t=e.length-1;t>=r;t--){let i=e[t];e.splice(t,1),Q(o,i,()=>{i.remove()})}},$e={name:"for",update:(o,e,{processExpression:r})=>{let t=e.getElement();if(t.tagName!=="TEMPLATE"){console.warn("Doars: `for` directive must be placed on a `<template>` tag.");return}let i=be(e.getValue());if(!i){console.error("Doars: Error in `for` expression: ",e.getValue());return}let n={},l=f=>{n[f]||(n[f]=["$for"])},s=f=>{let u=e.getData(),d=u.elements?u.elements:[],v=typeof f;if(f!=null)if(v==="number"){for(let h=0;h<f;h++){let A=ce(i.variables,h);le(o,l,t,d,h-1,f,A)}he(o,d,f)}else if(v==="string"){for(let h=0;h<f.length;h++){let A=f[h],D=ce(i.variables,A,h);le(o,l,t,d,h-1,A,D)}he(o,d,f.length)}else{let h,A;try{let D=[...f];h=!0,A=D.length}catch{}if(h)for(let D=0;D<A;D++){let O=f[D],E=ce(i.variables,O,D);le(o,l,t,d,D-1,O,E)}else{let D=Object.keys(f);A=D.length;for(let O=0;O<A;O++){let E=D[O],b=f[E],p=ce(i.variables,E,b,O);le(o,l,t,d,O-1,b,p)}}he(o,d,A)}Object.getOwnPropertySymbols(n).length>0&&o.update(n),e.setData(Object.assign({},u,{elements:d}))},c;isNaN(i.iterable)?c=r(o,e,i.iterable):c=Number(i.iterable);let a=e.getData();e.setData(Object.assign({},a,{result:c})),k(c)?Promise.resolve(c).then(f=>{e.getData().result===c&&s(f)}):s(c)},destroy:(o,e)=>{let r=e.getData();if(r.elements)for(let t of r.elements)Q(o,t,()=>{t.remove()})}};var nt={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},it=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var Ve=o=>typeof o!="string"?o:o.replaceAll(it,e=>nt[e]);var Fe={name:"html",update:(o,e,{processExpression:r})=>{let t=e.getElement(),i=e.getModifiers(),n=s=>{if(i.decode&&typeof s=="string"&&(s=Ve(s)),s instanceof HTMLElement){for(let c of t.children)c.remove();t.appendChild(s.cloneNode(!0));return}if(typeof s=="string"){t.innerHTML!==s&&(t.innerHTML=s);return}console.error("Doars/directives/html: Unknown type returned to directive!")},l=r(o,e,e.getValue());e.setData(l),k(l)?Promise.resolve(l).then(s=>{e.getData()===l&&n(s)}):n(l)}};var Ue={name:"if",update:(o,e,{processExpression:r,transitionIn:t,transitionOut:i})=>{let n=e.getElement();if(n.tagName!=="TEMPLATE"){console.warn("Doars: `if` directive must be placed on a `<template>` tag.");return}if(n.childCount>1){console.warn("Doars: `if` directive must have a single child node.");return}let l=a=>{let f=e.getData(),u=f.element,d=f.transition;a?u||(d&&d(),u=document.importNode(n.content,!0),ee(n,u),u=n.nextElementSibling,d=t(o,u)):u&&(d&&d(),d=i(o,u,()=>{u.remove()})),e.setData(Object.assign({},f,{element:u,transition:d}))},s=r(o,e,e.getValue()),c=e.getData();e.setData(Object.assign({},c,{result:s})),k(s)?Promise.resolve(s).then(a=>{e.getData().result===a&&l(a)}):l(s)},destroy:(o,e,{transitionOut:r})=>{let t=e.getData();t.element&&r(o,t.element,()=>{t.element.remove()})}};var _e=(o,e)=>{if(!e[P])return;let r=o.getElement(),t=o.getLibrary().getOptions().prefix+"-updated";r.removeEventListener(t,e[P].handler),delete e[P]},Me={name:"initialized",update:(o,e,{processExpression:r})=>{let t=o.getElement(),i=e.getValue(),n=o.getLibrary().getOptions().prefix+"-updated";if(e[P]){if(e[P].value===i)return;t.removeEventListener(n,e[P].handler),delete e[P]}let l=({detail:s})=>{s.element===t&&(r(o,e.clone(),i,{},{return:!1}),_e(o,e))};t.addEventListener(n,l,{once:!0}),e[P]={handler:l,value:i}},destroy:_e};var re={keydown:"keyup",mousedown:"mouseup",pointerdown:"pointerup"},R={NONE:0,BUFFER:1,DEBOUNCE:2,HELD:3,HOLD:4,THROTTLE:5},ct=["alt","ctrl","meta","shift"],He={name:"on",update:(o,e,{processExpression:r})=>{let t=e.getKeyRaw();if(!t){console.warn("Doars: `on` directive must have a key.");return}let i;t.startsWith("keydown-")?(i=t.substring(8).toLowerCase(),t="keydown"):t.startsWith("keyup-")&&(i=t.substring(6).toLowerCase(),t="keyup");let n=e.getElement(),l=e.getValue();if(e[x]){if(e[x].value===l)return;e[x].target.removeEventListener(t,e[x].handler),e[x].timeout&&clearTimeout(e[x].timeout),delete e[x]}let s=e.getModifiers(),c={};s.capture&&(c.capture=!0),s.once&&(c.once=!0),s.passive&&(c.passive=!0);let a=R.NONE;s.buffer?(a=R.BUFFER,s.buffer===!0&&(s.buffer=5)):s.debounce?(a=R.DEBOUNCE,s.debounce===!0&&(s.debounce=500)):s.held?(a=R.HELD,s.held===!0&&(s.held=500)):s.hold?(a=R.HOLD,s.hold===!0&&(s.hold=500)):s.throttle&&(a=R.THROTTLE,s.throttle===!0&&(s.throttle=500));let f=[];if(i){s.meta=s.meta?!0:s.cmd||s.super;for(let v of ct)s[v]&&f.push(v)}let u=n;s.document||s.outside?u=document:s.window&&(u=window);let d=v=>{if(e[x].prevent||!s.repeat&&v.repeat||s.self&&v.target!==n||s.outside&&n.contains(v.target))return;if((t==="keydown"||t==="keyup")&&i){for(let D of f)if(!v[D+"Key"])return;let A=s.code?v.code:v.key;if(A===" "&&(A="space"),A=A.toLowerCase(),A!==i)return}s.prevent&&v.preventDefault(),s.stop&&v.stopPropagation();let h=()=>{r(o,e.clone(),l,{$event:v,$events:e[x].buffer},{return:!1}),e[x].buffer=[]};switch(e[x].buffer.push(v),a){case R.BUFFER:if(e[x].buffer.length<s.buffer)return;h();return;case R.DEBOUNCE:e[x].timeout&&(clearTimeout(e[x].timeout),e[x].timeout=null),e[x].timeout=setTimeout(h,s.debounce);return;case R.HELD:if(!(t in re)){console.warn('Doars: `on` directive, event of name "'+t+'" is not cancelable and can not have "held" modifier.');return}let A=re[t],D=window.performance.now();e[x].cancel=b=>{if(window.performance.now()-D<s.held){e[x].prevent=!1;return}if(A==="keyup"&&i){for(let m of f)if(!b[m+"Key"]){e[x].prevent=!1;return}let p=s.code?b.code:b.key;if(p===" "&&(p="space"),p=p.toLowerCase(),p!==i){e[x].prevent=!1;return}}if(s.self&&b.target!==n){e[x].prevent=!1;return}if(s.outside&&n.contains(b.target)){e[x].prevent=!1;return}h()},e[x].prevent=!0,u.addEventListener(A,e[x].cancel,{once:!0});return;case R.HOLD:if(!(t in re)){console.warn('Doars: `on` directive, event of name "'+t+'" is not cancelable and can not have "hold" modifier.');return}let O=re[t];e[x].cancel=b=>{if(O==="keyup"&&i){let p=!1;for(let y of f)b[y+"Key"]||(p=!0);let m=s.code?b.code:b.key;if(m===" "&&(m="space"),m=m.toLowerCase(),m===i&&(p=!0),!p){e[x].prevent=!1;return}}if(s.self&&b.target!==n){e[x].prevent=!1;return}if(s.outside&&n.contains(b.target)){e[x].prevent=!1;return}clearTimeout(e[x].timeout)},u.addEventListener(O,e[x].cancel,{once:!0}),e[x].prevent=!0,e[x].timeout=setTimeout(()=>{u.removeEventListener(O,e[x].cancel),e[x].prevent=!1,h()},s.hold);return;case R.THROTTLE:let E=window.performance.now();if(e[x].lastExecution&&E-e[x].lastExecution<s.throttle)return;h(),e[x].lastExecution=E;return}h()};u.addEventListener(t,d,c),e[x]={buffer:[],handler:d,target:u,timeout:e[x]?e[x].timeout:void 0,value:l,prevent:!1}},destroy:(o,e)=>{if(!e[x])return;let r=e.getKeyRaw();e[x].target.removeEventListener(r,e[x].handler),e[x].cancel&&e[x].target.removeEventListener(re[r],e[x].cancel),e[x].timeout&&clearTimeout(e[x].timeout),delete e[x]}};var ze=(o,e)=>{if(!o[L])return;let r=e.getId();if(!o[L][r])return;let t=o.getLibrary(),i=o.getId(),n=e.getValue().trim();delete o[L][r],delete o[B],Object.keys(o[L]).length===0&&delete o[L],t.update([{id:i,path:"$references."+n}])},Ke={name:"reference",update:(o,e)=>{let r=e.getValue().trim();if(!/^[_$a-z]{1}[_\-$a-z0-9]{0,}$/i.test(r)){ze(o,e),console.warn("Doars: `reference` directive's value not a valid variable name: \""+r+'".');return}let t=o.getLibrary(),i=o.getId(),n=e.getElement(),l=e.getId();o[L]||(o[L]={}),o[L][l]={element:n,name:r},delete o[B],t.update([{id:i,path:"$references."+r}])},destroy:ze};var Be="SELECT",ae="checked",qe="selected",We="checkbox",Xe={name:"select",update:(o,e,{processExpression:r})=>{let t=e.getElement(),i=t.getAttribute("type");if(t.tagName!==Be&&!(t.tagName==="INPUT"&&(i===We||i==="radio"))){console.warn("Doars: `select` directive must be placed on a `select` tag or `input` of type checkbox or radio.");return}let n=s=>{if(t.tagName===Be)for(let c of Array.from(t.options)){let a=Array.isArray(s)?s.includes(c.value):s===c.value;c.selected!==a&&(c.selected=a,a?c.setAttribute(qe,""):c.removeAttribute(qe))}else if(i===We){let c=s.includes(t.value);t.checked!==c&&(c?t.setAttribute(ae,""):t.removeAttribute(ae))}else{let c=s===t.value;t.checked!==c&&(c?t.setAttribute(ae,""):t.removeAttribute(ae))}},l=r(o,e,e.getValue());e.setData(l),k(l)?Promise.resolve(l).then(s=>{e.getData()===l&&n(s)}):n(l)}};var Ge={name:"show",update:(o,e,{processExpression:r,transitionIn:t,transitionOut:i})=>{let n=e.getElement(),l=()=>{let a=e.getData();a.transition&&a.transition();let f;a.result?(n.style.display=null,f=t(o,n)):f=i(o,n,()=>{n.style.display="none"}),e.setData(Object.assign({},a,{transition:f}))},s=r(o,e,e.getValue()),c=e.getData();k(s)?(e.setData(Object.assign({},c,{result:s})),Promise.resolve(s).then(a=>{e.getData().result===s&&l(a)})):(!c||c.result!==s)&&(e.setData(Object.assign({},c,{result:s})),l())}};var Ye=()=>({createContexts:ge,createContextsProxy:lt,RevocableProxy:J}),ge=(o,e,r,t=null)=>{let i=o.getLibrary(),n=i.getSimpleContexts(),l=[],s="",c="",a=i.getContexts(),f=[];for(let u of a){if(!u||!u.name)continue;let d=u.create(o,e,r,Ye());!d||!d.value||(d.destroy&&typeof d.destroy=="function"&&f.push(d.destroy),u.deconstruct&&typeof d.value=="object"&&(l.push(u.name),c+="with("+u.name+") { ",s+=" }"),n[u.name]=d.value)}if(typeof t=="object")for(let u in t)n[u]=t[u];return{contexts:n,destroy:()=>{for(let u of f)u(Ye())},after:s,before:c,deconstructed:l}},lt=(o,e,r,t=null)=>{let i=null,n=J({},{get:(l,s)=>{if(i||(i=ge(o,e,r,t)),s in i.contexts)return e.accessed(o.getId(),s),i.contexts[s];if(i.contexts.$state&&s in i.contexts.$state)return e.accessed(o.getId(),"$state"),i.contexts.$state[s]}});return{contexts:n.proxy,destroy:()=>{i&&i.destroy&&i.destroy(o,e),n.revoke()}}},H=(o,e,r=null)=>{let t=[],i=(s,c)=>{t.push({id:s,path:c})},{contexts:n,destroy:l}=ge(o,e,i,r);return[n,()=>{l(),t.length>0&&o.getLibrary().update(t)}]};var se=(o,e)=>{let r=o,t=0;for(;t<e.length-1;t++)r=r[e[t]];return r[e[t]]};var j=(o,e,r)=>{if(typeof o!="object")return;let t=0;for(;t<e.length-1;t++)if(o=o[e[t]],typeof o!="object")return;o[e[t]]=r};var Ze={name:"sync",update:(o,e,{processExpression:r})=>{let t=e.getElement(),i=!e[q];if(i&&!(t.tagName==="DIV"&&t.hasAttribute("contenteditable"))&&t.tagName!=="INPUT"&&t.tagName!=="SELECT"&&t.tagName!=="TEXTAREA"){console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.");return}let n=e.getValue().trim(),l=e.getKey();if(l&&(n="$"+l+"."+n),!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(n)){console.warn("Doars: `sync` directive's value not a valid variable name: \""+n+'".');return}if(n=n.split("."),i){let c;switch(t.tagName){case"DIV":c=()=>{let[a,f]=H(o,e.clone());j(a,n,X(t.innerText)),f()};break;case"INPUT":c=()=>{let a=e.clone(),f=X(t.value),[u,d]=H(o,a);if(t.type==="checkbox"){let v=se(u,n);if(t.checked)v||j(u,n,[f]),v.includes(t.value)||v.push(f);else if(v){let h=v.indexOf(t.value);h>=0&&v.splice(h,1)}}else if(t.type==="radio"){let v=se(u,n);t.checked?v!==t.value&&j(u,n,f):v===t.value&&j(u,n,null)}else j(u,n,f);d()};break;case"TEXTAREA":c=()=>{let[a,f]=H(o,e.clone());j(a,n,X(t.innerText)),f()};break;case"SELECT":c=()=>{let[a,f]=H(o,e.clone());if(t.multiple){let u=[];for(let d of t.selectedOptions)u.push(X(d.value));j(a,n,[u.join("','")])}else j(a,n,X(t.selectedOptions[0].value));f()};break}t.addEventListener("input",c),e[q]=c}let s=r(o,e,n);switch(t.tagName){case"DIV":case"TEXTAREA":s!==t.innerText&&(t.innerText=s);break;case"INPUT":if(t.type==="checkbox"){let c=s.includes(t.value);t.checked!==c&&(t.checked=c,c?t.setAttribute("checked",""):t.removeAttribute("checked"))}else if(t.type==="radio"){let c=s===t.value;t.checked!==c&&(t.checked=c,c?t.setAttribute("checked",""):t.removeAttribute("checked"))}else s!==t.value&&t.setAttribute("value",s);break;case"SELECT":for(let c of Array.from(t.options)){let a=Array.isArray(s)?s.includes(c.value):s===c.value;c.selected!==a&&(c.selected=a,a?c.setAttribute("selected",""):c.removeAttribute("selected"))}break}},destroy:(o,e)=>{if(!e[q])return;e.getElement().removeEventListener("input",e[q]),delete e[q]}};var Je={name:"text",update:(o,e,{processExpression:r})=>{let t=e.getElement(),i=e.getModifiers(),n=s=>{i.content?t.textContent!==s&&(t.textContent=s):t.innerText!==s&&(t.innerText=s)},l=r(o,e,e.getValue());e.setData(l),k(l)?Promise.resolve(l).then(s=>{e.getData()===l&&n(s)}):n(l)}};var Qe={name:"watch",update:(o,e,{processExpression:r})=>{let t=e.getValue();r(o,e,t,{},{return:!1})}};var Z=class extends W{constructor(e){super();let{prefix:r,root:t}=e=Object.assign({prefix:"d",processor:"execute",root:document.body},e);if(typeof t=="string"&&(e.root=t=document.querySelector(t)),!r){console.error("Doars: `prefix` option not set.");return}if(typeof r!="string"){console.error("Doars: `prefix` option must be of type string.");return}if(!t){console.error("Doars: `root` option not set.");return}if(typeof t!="object"){console.error("Doars: `root` option must be a string or HTMLElement.");return}let i=Symbol("ID_DOARS"),n=!1,l=!1,s,c,a,f=[],u={},d=[De,Ne,Oe,Ce,Te,Se,ke,Le,Ie,we],v=[Ke,Re,$e,Fe,Ue,Je,Pe,Me,He,Xe,Ge,Ze,Qe],h,A,D;this.getId=()=>i,this.getOptions=()=>Object.assign({},e),this.getEnabled=()=>n,this.enable=()=>{if(n)return this;l=!1,s=[],a={},this.dispatchEvent("enabling",[this]),n=!0,h=v.map(g=>g.name),A={};for(let g of v)A[g.name]=g;D=new RegExp("^"+r+"-("+h.join("|")+")(?:[$-_.a-z0-9]{0,})?$","i"),c=new MutationObserver(b.bind(this)),c.observe(t,{attributes:!0,childList:!0,subtree:!0});let p=r+"-state",m=r+"-ignore",y=[...t.querySelectorAll("["+p+"]")];for(let g=y.length-1;g>=0;g--)y[g].closest("["+m+"]")&&y.splice(g,1);return O(t.hasAttribute(p)&&!t.hasAttribute(m)?t:null,...y),this.dispatchEvent("enabled",[this]),this.dispatchEvent("updated",[this]),this},this.disable=()=>n?(c.disconnect(),c=null,l=s=a=null,this.dispatchEvent("disabling",[this],{reverse:!0}),E(...f),h=A=D=null,n=!1,this.dispatchEvent("disabled",[this],{reverse:!0}),this):this;let O=(...p)=>{let m=[],y=[];for(let g of p){if(!g||g[S])continue;let w=new te(this,g);f.push(w),m.push(w),y.push(g)}y.length>0&&this.dispatchEvent("components-added",[this,y]);for(let g of m)g.initialize();for(let g of m)g.updateAttributes(g.getAttributes());return m},E=(...p)=>{let m=[];for(let y of p){let g=f.indexOf(y);g<0||(m.push(y.getElement()),y.destroy(),f.splice(g,1))}return m.length>0&&this.dispatchEvent("components-removed",[this,m]),m};this.getSimpleContexts=()=>Object.assign({},u),this.setSimpleContext=(p,m=null)=>m===null?(delete u[p],this.dispatchEvent("simple-context-removed",[this,p]),!0):p.match("^([a-zA-Z_$][a-zA-Z\\d_$]*)$")?(u[p]=m,this.dispatchEvent("simple-context-added",[this,p,m]),!0):(console.warn('Doars: name of a bind can not start with a "$".'),!1),this.getContexts=()=>[...d],this.addContexts=(p,...m)=>{if(n){console.warn("Doars: Unable to add contexts after being enabled!");return}p<0?p=d.length+p%d.length:p>d.length&&(p=d.length);let y=[];for(let g=0;g<m.length;g++){let w=m[g];d.includes(w)||(d.splice(p+g,0,w),y.push(w))}return y.length>0&&this.dispatchEvent("contexts-added",[this,y]),y},this.removeContexts=(...p)=>{if(n){console.warn("Doars: Unable to remove contexts after being enabled!");return}let m=[];for(let y of p){let g=d.indexOf(y);g<0||(d.slice(g,1),m.push(y))}return m.length>0&&this.dispatchEvent("contexts-removed",[this,m]),m},this.getDirectives=()=>[...v],this.getDirectivesNames=()=>[...h],this.getDirectivesObject=()=>Object.assign({},A),this.isDirectiveName=p=>D.test(p),this.addDirectives=(p,...m)=>{if(n){console.warn("Doars: Unable to add directives after being enabled!");return}p<0?p=v.length+p%v.length:p>v.length&&(p=v.length);let y=[];for(let g=0;g<m.length;g++){let w=m[g];v.includes(w)||(v.splice(p+g,0,w),y.push(w))}return y.length>0&&(h=A=D=null,this.dispatchEvent("directives-added",[this,y])),y},this.removeDirectives=(...p)=>{if(n){console.warn("Doars: Unable to remove directives after being enabled!");return}let m=[];for(let y of p){let g=v.indexOf(y);g<0||(v.slice(g,1),m.push(y))}return m.length>0&&(h=A=D=null,this.dispatchEvent("directives-removed",[this,m])),m},this.update=p=>{if(!!n){if(p)for(let m of p){let{id:y,path:g}=m;if(!(y in a)){a[y]=[g];continue}a[y].includes(g)||a[y].push(g)}if(!l&&Object.getOwnPropertySymbols(a).length!==0){this.dispatchEvent("updating",[this]),l=!0,p=a,a={};for(let m of f)m.update(p);if(l=!1,Object.getOwnPropertySymbols(a).length>0){console.warn("Doars: during an update another update has been triggered. Normally this should not happen unless an expression in one of the directives is modifying a state which could cause a infinite loop!"),window.requestAnimationFrame(()=>this.update());return}if(s.length>0){b();return}this.dispatchEvent("updated",[this])}}};let b=p=>{if(s.push(...p),l||s.length===0)return;l=!0,p=[...s],s=[];let m=r+"-state",y=r+"-ignore",g=[],w=[],U=N=>{if(N.nodeType===1)if(N[S]){w.unshift(N[S]);let C=N.querySelectorAll(m);for(let T of C)T[S]&&w.unshift(T)}else{let C=Y(N,T=>T[S]?(w.unshift(T[S]),!1):!0);do if(!!N[I])for(let T of N[I])T.getComponent().removeAttribute(T);while(N=C())}},ve=N=>{if(N.nodeType!==1||N.closest("["+y+"]"))return;let T=N.querySelectorAll("["+m+"]");for(let V of T)V.closest("["+y+"]")||g.push(V);if(N.hasAttribute(m)){g.push(N);return}let $=_(N);if($){let V=$.scanAttributes(N);$.updateAttributes(V)}};for(let N of p)if(N.type==="childList"){for(let C of N.removedNodes)U(C);for(let C of N.addedNodes)ve(C)}else if(N.type==="attributes"){let C=N.target;if(N.attributeName===m){if(C[S])continue;let z=_(C);if(z){let Ee=C,tt=Y(C,fe=>fe.hasAttribute(m));do for(let fe of Ee[I])z.removeAttribute(fe);while(Ee=tt())}O(C);continue}else if(N.attributeName===y){if(C.hasAttribute(y)){U(C);continue}ve(C);continue}if(!D.test(N.attributeName))continue;let T=_(C);if(!T)continue;let $=null;for(let z of C[I])if(z.getName()===N.attributeName){$=z;break}let V=C.getAttribute(N.attributeName);if(!$){V&&T.addAttribute(C,N.attributeName,V);continue}$.setValue(V),T.updateAttribute($)}if(w.length>0&&E(...w),g.length>0&&O(...g),l=!1,s.length>0){b();return}Object.getOwnPropertySymbols(a).length>0&&this.update()}}};var at=/^[a-z$_]+[0-9a-z$_]*(?:\.[a-z$_]+[0-9a-z$_]*)*$/is,et=(o,e,r,t=null,i=null)=>{let[n,l]=H(o,e,t);r=r.trim();let s;if(!at.test(r))console.error("Error encountered when executing an expression. Expression is not a valid dot separated path: ",r),s=null;else if(s=se(n,r.split(".")),typeof s=="function")try{s=s(n)}catch(c){console.error("ExpressionError in:",r,`
`+c.name+": "+c.message),s=null}return l(),s};Z.callExpression=et;var ms=Z;export{ms as default};
//# sourceMappingURL=doars-call.esm.min.js.map
