(()=>{var P=Symbol("ATTRIBUTES"),S=Symbol("COMPONENT"),Q=Symbol("FOR"),_=Symbol("INITIALIZED"),y=Symbol("ON"),k=Symbol("REFERENCES"),J=Symbol("REFERENCES_CACHE"),W=Symbol("SYNC");var ke=class{constructor(){let e={};this.addEventListener=(o,r,n=null)=>{o in e||(e[o]=[]),e[o].push({callback:r,options:n})},this.removeEventListener=(o,r)=>{if(!Object.keys(e).includes(o))return;let n=e[o],i=-1;for(let f=0;f<n.length;f++)if(n[f].callback===r){i=f;break}i<0||(n.splice(i,1),Object.keys(n).length===0&&delete e[o])},this.removeEventListeners=o=>{!o||delete e[o]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(o,r,n=null)=>{if(!e[o])return;let i=e[o];for(let f=0;f<i.length;f++){let s=n&&n.reverse?i[i.length-(f+1)]:i[f];s.options&&s.options.once&&i.splice(f,1),s.callback(...r)}}}},X=ke;var Z=t=>t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"').replace(/\n/g,"\\n"),Kt=t=>t.replace(/-(\w)/g,(e,o)=>o.toUpperCase()),Qe=t=>{let e={};for(let o of t){let r=o.indexOf("-");if(r<0){e[o]=!0;continue}if(r===0){e[o.substring(1)]=!1;continue}let n=o.substring(0,r),i=o.substring(r+1),f=i,s;if(i.endsWith("ms")?f=i.substring(-2):i.endsWith("s")?(s="s",f=i.substring(-1)):i.endsWith("m")?(s="m",f=i.substring(-1)):i.endsWith("h")&&(s="h",f=i.substring(-1)),f=Number.parseInt(f),!isNaN(f))switch(i=f,s){case"h":i*=60;case"m":i*=60;case"s":i*=1e3;break}e[n]=i}return e},Je=(t,e)=>{if(e=e.match(new RegExp("^"+t+"-([a-z][0-9a-z-]{1,}):?([a-z][0-9a-z-]*)?(\\..*]*)?$","i")),!e)return;let[o,r,n,i]=e;n=n!==""?n:null;let f=n?Kt(n):null;return i=i?i.substring(1).split("."):[],[r,n,f,i]},We=t=>{let e=t.match(/^([$_a-z0-9,(){}\s]{1,}?)\s+(?:in|of)\s+([\s\S]{1,})$/i);if(!e)return;let o=e[1].replace(/^[\s({]*|[)}\s]*$/g,"");if(o=o.match(/^([$_a-z0-9]{1,})?(?:,\s+?)?([$_a-z0-9]{1,})?(?:,\s+)?([$_a-z0-9]{1,})?$/i),!!o)return o.shift(),{iterable:e[2].trim(),variables:[...o]}},ee=t=>{if(typeof t=="string"&&(t=t.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(t)){console.error("Doars: parseSelector expects Array of string or a single string.");return}let e={};for(let o of t)switch(o=o.trim(),o[0]){case"#":e.id=o.substring(1);break;case".":o=o.substring(1),e.class||(e.class=[]),e.class.includes(o)||e.class.push(o);break;case"[":let[r,n,i]=o.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);e[n]=i;break}return e};var F=class extends X{constructor(e,o,r,n,i=!1){super();let f=Symbol("ID_ATTRIBUTE");i||(o[P]||(o[P]=[]),o[P].push(this));let s={},a=null,u,p,E,d,g;if(r){let[v,C,x,I]=Je(e.getLibrary().getOptions().prefix,r);u=v,p=x,E=C,d=I,I&&(g=Qe(I))}this.getComponent=()=>e,this.getElement=()=>o,this.getId=()=>f,this.getDirective=()=>u,this.getKey=()=>p,this.getKeyRaw=()=>E,this.getModifiers=()=>Object.assign({},g),this.getModifiersRaw=()=>d,this.getName=()=>r,this.getValue=()=>n,this.setValue=v=>{n=v,this.dispatchEvent("changed",[this])},this.clearData=()=>{a=null},this.hasData=()=>a!==null,this.getData=()=>a,this.setData=v=>{a=v},this.destroy=()=>{this.setData(null),this.clearAccessed();let v=o[P].indexOf(this);v>=0&&o[P].splice(v,1),this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.accessed=(v,C)=>{if(!s[v])s[v]=[];else if(s[v].includes(C))return;s[v].push(C),this.dispatchEvent("accessed",[this,v,C])},this.clearAccessed=()=>{s={}},this.hasAccessed=(v,C)=>{if(!(v in s))return!1;let x=s[v];for(let I of C)if(x.includes(I))return!0;return!1},this.clone=()=>new F(e,o,r,n,!0)}};var zt=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],ie=(t,e)=>{let o=!1,r={};for(let n of zt)r[n]=(...i)=>{if(o){console.error("illegal operation attempted on a revoked proxy");return}return n in e?e[n](...i):Reflect[n](...i)};return{proxy:new Proxy(t,r),revoke:()=>{o=!0}}};var Pe=class extends X{constructor(e={}){super(),e=Object.assign({delete:!0,get:!0,set:!0},e);let o=new WeakMap;this.add=(r,n=[])=>{if(o.has(r))return o.get(r);for(let s in r)r[s]&&typeof r[s]=="object"&&(r[s]=this.add(r[s],[...n,s]));let i={};e.delete&&(i.deleteProperty=(s,a)=>{if(!Reflect.has(s,a))return!0;this.remove(s,a);let u=Reflect.deleteProperty(s,a);return u&&this.dispatchEvent("delete",[s,Array.isArray(s)?[...n]:[...n,a]]),u}),e.get&&(i.get=(s,a,u)=>(a!==Symbol.unscopables&&this.dispatchEvent("get",[s,[...n,a],u]),Reflect.get(s,a,u))),e.set&&(i.set=(s,a,u,p)=>(s[a]===u||(typeof u=="object"&&(u=this.add(u,[...n,a])),s[a]=u,this.dispatchEvent("set",[s,Array.isArray(s)?[...n]:[...n,a],u,p])),!0));let f=ie(r,i);return o.set(f,r),f.proxy},this.remove=r=>{if(!o.has(r))return;let n=o.get(r);o.delete(n);for(let i in n.proxy)typeof n.proxy[i]=="object"&&this.remove(n.proxy[i]);n.revoke()}}},Xe=Pe;var ge=(t,e)=>{for(let o in e){if(o==="class"){for(let r of e.class)t.classList.add(r);continue}t.setAttribute(o,e[o])}},Ze=(t,e)=>{let o=t.attributes,r=e.attributes,n=null,i=null,f=null,s=null,a=null;for(let u=r.length-1;u>=0;--u)a=r[u],s=a.name,n=a.namespaceURI,i=a.value,n?(s=a.localName||s,f=t.getAttributeNS(n,s),f!==i&&t.setAttributeNS(n,s,i)):t.hasAttribute(s)?(f=t.getAttribute(s),f!==i&&(i==="null"||i==="undefined"?t.removeAttribute(s):t.setAttribute(s,i))):t.setAttribute(s,i);for(let u=o.length-1;u>=0;--u)a=o[u],a.specified!==!1&&(s=a.name,n=a.namespaceURI,n?(s=a.localName||s,e.hasAttributeNS(n,s)||t.removeAttributeNS(n,s)):e.hasAttributeNS(null,s)||t.removeAttribute(s))},Y=(t,e)=>{for(let o in e){if(o==="class"){for(let r of e.class)t.classList.remove(r);continue}e[o]&&t.attributes[o]!==e[o]||t.removeAttribute(o)}},Ue=(t,e,o)=>{if(e==="value"&&t.tagName==="INPUT"){if(o||(o=""),t.getAttribute(e)===o)return;t.setAttribute(e,o);return}if(e==="checked"&&(t.type==="checkbox"||t.type==="radio")){t.checked=!!o;return}e==="class"&&(Array.isArray(o)?o=o.join(" "):typeof o=="object"&&(o=Object.entries(o).filter(([r,n])=>n).map(([r])=>r).join(" "))),e==="style"&&(Array.isArray(o)?o=o.join(" "):typeof o=="object"&&(o=Object.entries(o).map(([r,n])=>r+":"+n).join(";"))),o===!1||o===null||o===void 0?t.removeAttribute(e):t.setAttribute(e,o)},je=(t,e)=>{for(let o in e)Ue(t,o,e[o])};var et=t=>{let e=document.createElement("template");return e.innerHTML=t,e.content.childNodes[0]},ce=(t,e)=>{t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)},_e=(t,e)=>t.isSameNode?t.isSameNode(e):t.tagName!==e.tagName?!1:t.type===3?t.nodeValue===e.nodeValue:!1,te=(t,e)=>{let o=-1,r=null;return()=>{if(o>=0&&r){let i=r();if(i)return i}let n=null;do{if(o++,o>=t.childElementCount)return null;n=t.children[o]}while(!e(n));return n.childElementCount&&(r=te(n,e)),n}};var Gt=(t,e)=>{let o=e.nodeType,r=e.nodeName;o===1&&Ze(t,e),(o===3||o===8)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),r==="INPUT"?qt(t,e):r==="OPTION"?Me(t,e,"selected"):r==="TEXTAREA"&&Qt(t,e)},tt=(t,e,o)=>{if(typeof t!="object")throw new Error("Existing tree should be an object.");if(typeof e=="string")e=et(e);else if(typeof e!="object")throw new Error("New tree should be an object.");return o&&o.childrenOnly||e.nodeType===11?(rt(t,e),t):ve(t,e)},qt=(t,e)=>{let o=e.value,r=t.value;Me(t,e,"checked"),Me(t,e,"disabled"),t.indeterminate!==e.indeterminate&&(t.indeterminate=e.indeterminate),t.type!=="file"&&(r!==o&&(t.setAttribute("value",o),t.value=o),o==="null"&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?t.type==="range"&&(t.value=o):t.removeAttribute("value"))},Qt=(t,e)=>{let o=e.value;if(t.value!==o&&(t.value=o),t.firstChild&&t.firstChild.nodeValue!==o){if(t.firstChild.nodeValue===t.placeholder&&o==="")return;t.firstChild.nodeValue=o}},Me=(t,e,o)=>{t[o]!==e[o]&&(t[o]=e[o],e[o]?t.setAttribute(o,""):t.removeAttribute(o))},ve=(t,e)=>t?e?t.isSameNode&&t.isSameNode(e)?t:t.tagName!==e.tagName?e:(Gt(t,e),rt(t,e),t):null:e,rt=(t,e)=>{let o,r,n,i,f=0;for(let s=0;o=t.childNodes[s],r=e.childNodes[s-f],!(!o&&!r);s++)if(!r)t.removeChild(o),s--;else if(!o)t.appendChild(r),f++;else if(_e(o,r))n=ve(o,r),n!==o&&(t.replaceChild(n,o),f++);else{i=null;for(let a=s;a<t.childNodes.length;a++)if(_e(t.childNodes[a],r)){i=t.childNodes[a];break}i?(n=ve(i,r),n!==i&&f++,t.insertBefore(n,o)):!r.id&&!o.id?(n=ve(o,r),n!==o&&(t.replaceChild(n,o),f++)):(t.insertBefore(r,o),f++)}};var H=t=>{if(!!t.parentElement)return t=t.parentElement,t[S]?t[S]:H(t)};var Jt="-transition:",Ae=(t,e,o,r=null)=>{if(o.nodeType!==1){r&&r();return}let{prefix:n}=e.getLibrary().getOptions(),i=n+Jt+t,f=g=>{o.dispatchEvent(new CustomEvent("transition-"+g)),o.dispatchEvent(new CustomEvent("transition-"+t+"-"+g))},s,a,u,p,E=!1,d={};return s=i,a=o.getAttribute(s),a&&(d.during=ee(a),ge(o,d.during)),s=i+".from",a=o.getAttribute(s),a&&(d.from=ee(a),ge(o,d.from)),f("start"),p=requestAnimationFrame(()=>{if(p=null,E)return;if(d.from&&(Y(o,d.from),d.from=void 0),s=i+".to",a=o.getAttribute(s),a)d.to=ee(a),ge(o,d.to);else if(!d.during){f("end"),r&&r(),E=!0;return}let g=getComputedStyle(o),v=Number(g.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;v===0&&(v=Number(g.animationDuration.replace("s",""))*1e3),u=setTimeout(()=>{u=null,!E&&(d.during&&(Y(o,d.during),d.during=void 0),d.to&&(Y(o,d.to),d.to=void 0),f("end"),r&&r(),E=!0)},v)}),()=>{!E||(E=!0,d.during&&(Y(o,d.during),d.during=void 0),d.from?(Y(o,d.from),d.from=void 0):d.to&&(Y(o,d.to),d.to=void 0),p?(cancelAnimationFrame(p),p=null):u&&(clearTimeout(u),u=null),f("end"),r&&r())}},ye=(t,e,o)=>Ae("in",t,e,o),ae=(t,e,o)=>Ae("out",t,e,o);var le=class{constructor(e,o){let r=Symbol("ID_COMPONENT"),{prefix:n,processor:i}=e.getOptions(),f=typeof i,s;f==="function"?s=i:f==="string"&&e.constructor[i+"Expression"]?s=e.constructor[i+"Expression"]:(console.warn("Doars: Expression processor not found. Using fallback instead."),s=e.constructor.executeExpression??e.constructor.interpretExpression??e.constructor.callExpression),s||console.error("Doars: No expression processor available. Process option: ",process);let a=Object.freeze({morphTree:tt,processExpression:s,transition:Ae,transitionIn:ye,transitionOut:ae}),u=[],p=!1,E=!1,d,g,v;if(!o.attributes[n+"-state"]){console.error("Doars: element given to component does not contain a state attribute!");return}o[S]=this;let C=[],x=H(o);x&&(x.getChildren().includes(this)||(x.getChildren().push(this),e.update([{id:x.getId(),path:"children"}]))),this.getAttributes=()=>u,this.getChildren=()=>C,this.getElement=()=>o,this.getId=()=>r,this.getLibrary=()=>e,this.getParent=()=>x,this.getProxy=()=>g,this.getState=()=>v,this.setParent=A=>{x=A},this.initialize=()=>{if(E)return;E=!0;let A=n+"-state",b=o.attributes[A].value;if(d=s(this,new F(this,o,null,b),b),d===null)d={};else if(typeof d!="object"||Array.isArray(d)){console.error("Doars: component tag must return an object!");return}g=new Xe,v=g.add(d),this.scanAttributes(o)},this.destroy=()=>{if(!E)return;if(u.length>0){let b=e.getDirectivesObject();for(let c in b)b[c].destroy||(b[c]=void 0);for(let c of u){let l=b[c.getKey()];l&&l.destroy(this,c,a),c.destroy()}}delete o[S],u=[],E=!1,g.remove(d),v=null,g=null,d=null;let A=[];if(C.length>0){for(let b of C)b.setParent(x),A.push({id:b.getId(),path:"parent"});A.push({id:r,path:"children"})}x&&(C.length>0&&(x.getChildren().push(...C),A.push({id:x.getId(),path:"children"})),A.push({id:r,path:"parent"})),A.length>0&&e.update(A),I("destroyed",{element:o,id:r})},this.addAttribute=(A,b,c)=>{let l=e.getDirectivesNames(),h=new F(this,A,b,c),m=h.length,O=l.indexOf(h.getDirective());for(let N=u.length-1;N>=0;N--)if(l.indexOf(u[N].getDirective())<=O){m=N+1;break}return u.splice(m,0,h),h},this.removeAttribute=A=>{let b=u.indexOf(A);if(b<0)return;let l=e.getDirectivesObject[A.getKey()];l&&l.destroy&&l.destroy(this,A,a),u.splice(b,1),A.destroy()},this.scanAttributes=A=>{let b=n+"-state",c=n+"-ignore",l=[],h=te(A,m=>!m.hasAttribute(b)&&!m.hasAttribute(c));do for(let{name:m,value:O}of A.attributes)e.isDirectiveName(m)&&l.push(this.addAttribute(A,m,O));while(A=h());return l},this.updateAttribute=A=>{if(!A.getElement()||A.getValue()===null||A.getValue()===void 0){this.removeAttribute(A);return}let b=e.getDirectivesObject();A.clearAccessed();let c=b[A.getDirective()];c&&c.update(this,A,a)},this.updateAttributes=A=>{if(!E||A.length<=0){p||(p=!0,I("updated",{attributes:A,element:o,id:r}));return}for(let b of A)this.updateAttribute(b);p=!0,I("updated",{attributes:A,element:o,id:r})},this.update=A=>{if(!E)return;let b=Object.getOwnPropertySymbols(A),c=[];for(let l of u)for(let h of b)l.hasAccessed(h,A[h])&&(this.updateAttribute(l),c.push(l));(!p||c.length>0)&&(p=!0,I("updated",{attributes:c,element:o,id:r}))};let I=(A,b)=>{o.dispatchEvent(new CustomEvent(n+"-"+A,{detail:b,bubbles:!0}))}}};var ot={name:"$children",create:(t,e,o,{createContextsProxy:r,RevocableProxy:n})=>{let i,f=n(t.getChildren(),{get:(s,a,u)=>{if(i||(i=s.map(E=>r(E,e,o)),e.accessed(t.getId(),"children")),isNaN(a))return Reflect.get(i,a,u);let p=Reflect.get(i,a,u);if(p)return p.contexts}});return{value:f.proxy,destroy:()=>{i&&i.forEach(s=>s.destroy()),f.revoke()}}}};var st={name:"$component",create:t=>({value:t.getElement()})};var nt={name:"$element",create:(t,e)=>({value:e.getElement()})};var it={name:"$dispatch",create:t=>({value:(e,o={})=>{t.getElement().dispatchEvent(new CustomEvent(e,{detail:o,bubbles:!0}))}})};var ct={deconstruct:!0,name:"$for",create:(t,e,o,{RevocableProxy:r})=>{if(t!==e.getComponent())return;let n=e.getElement(),i=t.getElement(),f=[],s={};for(;n&&!n.isSameNode(i);){let u=n[Q];if(u){f.push(u);for(let p in u.variables)s[p]=u.variables[p]}n=n.parentNode}if(f.length===0)return;let a=r(s,{get:(u,p)=>{for(let E of f)if(p in E.variables)return e.accessed(E.id,"$for"),E.variables[p]}});return{value:a.proxy,destroy:()=>{a.revoke()}}}};var at={name:"$inContext",create:(t,e,o,{createContexts:r})=>({value:n=>{let i=[],f=(p,E)=>{i.push({id:p,path:E})},{contexts:s,destroy:a}=r(t,e,f,{}),u=n(s);return a(),i.length>0&&t.getLibrary().update(i),u}})};var lt={name:"$nextTick",create:(t,e,o,{createContexts:r})=>{let n,i=!1,f=()=>{if(i)return;i=!0;let s=t.getLibrary();n=[];let a=()=>{u();let{contexts:p,destroy:E}=r(t,e,o,{});for(let d of n)d(p);E()},u=()=>{s.removeEventListener("updated",a),e.removeEventListener("changed",u),e.removeEventListener("destroyed",u)};s.addEventListener("updated",a),e.addEventListener("changed",u),e.addEventListener("destroyed",u)};return{value:s=>{f(),n.push(s)}}}};var ft={name:"$parent",create:(t,e,o,{createContextsProxy:r})=>{let n=t.getParent();if(!n)return{key:"$parent",value:null};let{contexts:i,destroy:f}=r(n,e,o);return{value:i,destroy:f}}};var ut={name:"$references",create:(t,e,o,{RevocableProxy:r})=>{if(!t[k])return{key:"$references",value:[]};let n=t[J];if(!n){let f=t[k],s=Object.getOwnPropertySymbols(f);n={};for(let a of s){let{element:u,name:p}=f[a];n[p]=u}t[J]=n}let i=r(n,{get:(f,s,a)=>(e.accessed(t.getId(),"$references."+s),Reflect.get(f,s,a))});return{value:i.proxy,destroy:()=>{i.revoke()}}}};var dt={deconstruct:!0,name:"$state",create:(t,e,o,{RevocableProxy:r})=>{let n=t.getProxy(),i=t.getState();if(!n||!i)return;let f=(p,E)=>o(t.getId(),"$state."+E.join(".")),s=(p,E)=>e.accessed(t.getId(),"$state."+E.join(".")),a=(p,E)=>o(t.getId(),"$state."+E.join("."));n.addEventListener("delete",f),n.addEventListener("get",s),n.addEventListener("set",a);let u=r(i,{});return{value:u.proxy,destroy:()=>{n.removeEventListener("delete",f),n.removeEventListener("get",s),n.removeEventListener("set",a),u.revoke()}}}};var Hr=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var L=t=>t&&Object.prototype.toString.call(t)==="[object Promise]";var pt={name:"attribute",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{if(n.selector){if(typeof s!="string"){console.error("Doars: Value returned to attribute directive must be a string if the selector modifier is set.");return}s=ee(s),je(r,s);return}let a=e.getKeyRaw();if(!a){typeof s=="object"&&!Array.isArray(s)?je(r,s):console.error("Doars: Value returned to attribute directive of invalid type.");return}Ue(r,a,s)},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var ht={name:"cloak",update:function(t,e,{transitionIn:o}){let r=e.getElement();r.removeAttribute(t.getLibrary().getOptions().prefix+"-"+this.name),o(t,r)}};var be=(t,...e)=>{let o={};for(let r=0;r<e.length&&!(r>=t.length);r++)o[t[r]]=e[r];return o},mt=(t,e,o=-1)=>(o++,o>=t.length?-1:t[o][Q].value===e?o:mt(t,e,o)),Ce=(t,e,o,r,n,i,f)=>{let s=mt(r,i,n);if(s>=0){if(s===n+1)return;let p=r[s];ce(r[n]?r[n]:o,p),e(p[Q].id);return}let a=document.importNode(o.content,!0),u=n===-1?o:r[n];ce(u,a),a=u.nextElementSibling,ye(t,a),a[Q]={id:Symbol("ID_FOR"),value:i,variables:f},r.splice(n+1,0,a)},Be=(t,e,o)=>{if(!(e.length<o))for(let r=e.length-1;r>=o;r--){let n=e[r];e.splice(r,1),ae(t,n,()=>{n.remove()})}},Et={name:"for",update:(t,e,{processExpression:o})=>{let r=e.getElement();if(r.tagName!=="TEMPLATE"){console.warn("Doars: `for` directive must be placed on a `<template>` tag.");return}let n=We(e.getValue());if(!n){console.error("Doars: Error in `for` expression: ",e.getValue());return}let i={},f=p=>{i[p]||(i[p]=["$for"])},s=p=>{let E=e.getData(),d=E.elements?E.elements:[],g=typeof p;if(g==="number"){for(let v=0;v<p;v++){let C=be(n.variables,v);Ce(t,f,r,d,v-1,p,C)}Be(t,d,p)}else if(g==="string"){for(let v=0;v<p.length;v++){let C=p[v],x=be(n.variables,C,v);Ce(t,f,r,d,v-1,C,x)}Be(t,d,p.length)}else{let v,C;try{let x=[...p];v=!0,C=x.length}catch{}if(v)for(let x=0;x<C;x++){let I=p[x],A=be(n.variables,I,x);Ce(t,f,r,d,x-1,I,A)}else{let x=Object.keys(p);C=x.length;for(let I=0;I<C;I++){let A=x[I],b=p[A],c=be(n.variables,A,b,I);Ce(t,f,r,d,I-1,b,c)}}Be(t,d,C)}Object.getOwnPropertySymbols(i).length>0&&t.update(i),e.setData(Object.assign({},E,{elements:d}))},a;isNaN(n.iterable)?a=o(t,e,n.iterable):a=Number(n.iterable);let u=e.getData();e.setData(Object.assign({},u,{result:a})),L(a)?Promise.resolve(a).then(p=>{e.getData().result===a&&s(p)}):s(a)},destroy:(t,e)=>{let o=e.getData();if(o.elements)for(let r of o.elements)ae(t,r,()=>{r.remove()})}};var Wt={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},Xt=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var gt=t=>typeof t!="string"?t:t.replaceAll(Xt,e=>Wt[e]);var vt={name:"html",update:(t,e,{processExpression:o,morphTree:r})=>{let n=e.getElement(),i=e.getModifiers(),f=a=>{if(i.decode&&typeof a=="string"&&(a=gt(a)),i.morph){if(n.children.length===0)n.appendChild(document.createElement("div"));else if(n.children.length>1)for(let p=n.children.length-1;p>=1;p--)n.children[p].remove();let u=r(n.children[0],a);n.children[0].isSameNode(u)||(n.children[0].remove(),n.appendChild(u));return}if(a instanceof HTMLElement){for(let u of n.children)u.remove();n.appendChild(a.cloneNode(!0));return}if(typeof a=="string"){n.innerHTML!==a&&(n.innerHTML=a);return}console.error("Doars/directives/html: Unknown type returned to directive!")},s=o(t,e,e.getValue());e.setData(s),L(s)?Promise.resolve(s).then(a=>{e.getData()===s&&f(a)}):f(s)}};var At={name:"if",update:(t,e,{processExpression:o,transitionIn:r,transitionOut:n})=>{let i=e.getElement();if(i.tagName!=="TEMPLATE"){console.warn("Doars: `if` directive must be placed on a `<template>` tag.");return}if(i.childCount>1){console.warn("Doars: `if` directive must have a single child node.");return}let f=u=>{let p=e.getData(),E=p.element,d=p.transition;u?E||(d&&d(),E=document.importNode(i.content,!0),ce(i,E),E=i.nextElementSibling,d=r(t,E)):E&&(d&&d(),d=n(t,E,()=>{E.remove()})),e.setData(Object.assign({},p,{element:E,transition:d}))},s=o(t,e,e.getValue()),a=e.getData();e.setData(Object.assign({},a,{result:s})),L(s)?Promise.resolve(s).then(u=>{e.getData().result===u&&f(u)}):f(s)},destroy:(t,e,{transitionOut:o})=>{let r=e.getData();r.element&&o(t,r.element,()=>{r.element.remove()})}};var yt=(t,e)=>{if(!e[_])return;let o=t.getElement(),r=t.getLibrary().getOptions().prefix+"-updated";o.removeEventListener(r,e[_].handler),delete e[_]},bt={name:"initialized",update:(t,e,{processExpression:o})=>{let r=t.getElement(),n=e.getValue(),i=t.getLibrary().getOptions().prefix+"-updated";if(e[_]){if(e[_].value===n)return;r.removeEventListener(i,e[_].handler),delete e[_]}let f=({detail:s})=>{s.element===r&&(o(t,e.clone(),n,{},{return:!1}),yt(t,e))};r.addEventListener(i,f,{once:!0}),e[_]={handler:f,value:n}},destroy:yt};var fe={keydown:"keyup",mousedown:"mouseup",pointerdown:"pointerup"},U={NONE:0,BUFFER:1,DEBOUNCE:2,HELD:3,HOLD:4,THROTTLE:5},Zt=["alt","ctrl","meta","shift"],Ct={name:"on",update:(t,e,{processExpression:o})=>{let r=e.getKeyRaw();if(!r){console.warn("Doars: `on` directive must have a key.");return}let n;r.startsWith("keydown-")?(n=r.substring(8).toLowerCase(),r="keydown"):r.startsWith("keyup-")&&(n=r.substring(6).toLowerCase(),r="keyup");let i=e.getElement(),f=e.getValue();if(e[y]){if(e[y].value===f)return;e[y].target.removeEventListener(r,e[y].handler),e[y].timeout&&clearTimeout(e[y].timeout),delete e[y]}let s=e.getModifiers(),a={};s.capture&&(a.capture=!0),s.once&&(a.once=!0),s.passive&&(a.passive=!0);let u=U.NONE;s.buffer?(u=U.BUFFER,s.buffer===!0&&(s.buffer=5)):s.debounce?(u=U.DEBOUNCE,s.debounce===!0&&(s.debounce=500)):s.held?(u=U.HELD,s.held===!0&&(s.held=500)):s.hold?(u=U.HOLD,s.hold===!0&&(s.hold=500)):s.throttle&&(u=U.THROTTLE,s.throttle===!0&&(s.throttle=500));let p=[];if(n){s.meta=s.meta?!0:s.cmd||s.super;for(let g of Zt)s[g]&&p.push(g)}let E=i;s.document||s.outside?E=document:s.window&&(E=window);let d=g=>{if(e[y].prevent||!s.repeat&&g.repeat||s.self&&g.target!==i||s.outside&&i.contains(g.target))return;if((r==="keydown"||r==="keyup")&&n){for(let x of p)if(!g[x+"Key"])return;let C=s.code?g.code:g.key;if(C===" "&&(C="space"),C=C.toLowerCase(),C!==n)return}s.prevent&&g.preventDefault(),s.stop&&g.stopPropagation();let v=()=>{o(t,e.clone(),f,{$event:g,$events:e[y].buffer},{return:!1}),e[y].buffer=[]};switch(e[y].buffer.push(g),u){case U.BUFFER:if(e[y].buffer.length<s.buffer)return;v();return;case U.DEBOUNCE:e[y].timeout&&(clearTimeout(e[y].timeout),e[y].timeout=null),e[y].timeout=setTimeout(v,s.debounce);return;case U.HELD:if(!(r in fe)){console.warn('Doars: `on` directive, event of name "'+r+'" is not cancelable and can not have "held" modifier.');return}let C=fe[r],x=window.performance.now();e[y].cancel=b=>{if(window.performance.now()-x<s.held){e[y].prevent=!1;return}if(C==="keyup"&&n){for(let l of p)if(!b[l+"Key"]){e[y].prevent=!1;return}let c=s.code?b.code:b.key;if(c===" "&&(c="space"),c=c.toLowerCase(),c!==n){e[y].prevent=!1;return}}if(s.self&&b.target!==i){e[y].prevent=!1;return}if(s.outside&&i.contains(b.target)){e[y].prevent=!1;return}v()},e[y].prevent=!0,E.addEventListener(C,e[y].cancel,{once:!0});return;case U.HOLD:if(!(r in fe)){console.warn('Doars: `on` directive, event of name "'+r+'" is not cancelable and can not have "hold" modifier.');return}let I=fe[r];e[y].cancel=b=>{if(I==="keyup"&&n){let c=!1;for(let h of p)b[h+"Key"]||(c=!0);let l=s.code?b.code:b.key;if(l===" "&&(l="space"),l=l.toLowerCase(),l===n&&(c=!0),!c){e[y].prevent=!1;return}}if(s.self&&b.target!==i){e[y].prevent=!1;return}if(s.outside&&i.contains(b.target)){e[y].prevent=!1;return}clearTimeout(e[y].timeout)},E.addEventListener(I,e[y].cancel,{once:!0}),e[y].prevent=!0,e[y].timeout=setTimeout(()=>{E.removeEventListener(I,e[y].cancel),e[y].prevent=!1,v()},s.hold);return;case U.THROTTLE:let A=window.performance.now();if(e[y].lastExecution&&A-e[y].lastExecution<s.throttle)return;v(),e[y].lastExecution=A;return}v()};E.addEventListener(r,d,a),e[y]={buffer:[],handler:d,target:E,timeout:e[y]?e[y].timeout:void 0,value:f,prevent:!1}},destroy:(t,e)=>{if(!e[y])return;let o=e.getKeyRaw();e[y].target.removeEventListener(o,e[y].handler),e[y].cancel&&e[y].target.removeEventListener(fe[o],e[y].cancel),e[y].timeout&&clearTimeout(e[y].timeout),delete e[y]}};var Ot=(t,e)=>{if(!t[k])return;let o=e.getId();if(!t[k][o])return;let r=t.getLibrary(),n=t.getId(),i=e.getValue().trim();delete t[k][o],delete t[J],Object.keys(t[k]).length===0&&delete t[k],r.update([{id:n,path:"$references."+i}])},xt={name:"reference",update:(t,e)=>{let o=e.getValue().trim();if(!/^[_$a-z]{1}[_\-$a-z0-9]{0,}$/i.test(o)){Ot(t,e),console.warn("Doars: `reference` directive's value not a valid variable name: \""+o+'".');return}let r=t.getLibrary(),n=t.getId(),i=e.getElement(),f=e.getId();t[k]||(t[k]={}),t[k][f]={element:i,name:o},delete t[J],r.update([{id:n,path:"$references."+o}])},destroy:Ot};var Rt="SELECT",Oe="checked",It="selected",Nt="checkbox",Dt={name:"select",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=r.getAttribute("type");if(r.tagName!==Rt&&!(r.tagName==="INPUT"&&(n===Nt||n==="radio"))){console.warn("Doars: `select` directive must be placed on a `select` tag or `input` of type checkbox or radio.");return}let i=s=>{if(r.tagName===Rt)for(let a of Array.from(r.options)){let u=Array.isArray(s)?s.includes(a.value):s===a.value;a.selected!==u&&(a.selected=u,u?a.setAttribute(It,""):a.removeAttribute(It))}else if(n===Nt){let a=s.includes(r.value);r.checked!==a&&(a?r.setAttribute(Oe,""):r.removeAttribute(Oe))}else{let a=s===r.value;r.checked!==a&&(a?r.setAttribute(Oe,""):r.removeAttribute(Oe))}},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var wt={name:"show",update:(t,e,{processExpression:o,transitionIn:r,transitionOut:n})=>{let i=e.getElement(),f=()=>{let u=e.getData();u.transition&&u.transition();let p;u.result?(i.style.display=null,p=r(t,i)):p=n(t,i,()=>{i.style.display="none"}),e.setData(Object.assign({},u,{transition:p}))},s=o(t,e,e.getValue()),a=e.getData();L(s)?(e.setData(Object.assign({},a,{result:s})),Promise.resolve(s).then(u=>{e.getData().result===s&&f(u)})):(!a||a.result!==s)&&(e.setData(Object.assign({},a,{result:s})),f())}};var Tt=()=>({createContexts:$e,createContextsProxy:er,RevocableProxy:ie}),$e=(t,e,o,r=null)=>{let n=t.getLibrary(),i=n.getSimpleContexts(),f="",s="",a=[],u=n.getContexts(),p=[];for(let E of u){if(!E||!E.name)continue;let d=E.create(t,e,o,Tt());!d||!d.value||(d.destroy&&typeof d.destroy=="function"&&p.push(d.destroy),E.deconstruct&&typeof d.value=="object"&&(a.push(E.name),s+="with("+E.name+") { ",f+=" }"),i[E.name]=d.value)}if(typeof r=="object")for(let E in r)i[E]=r[E];return{contexts:i,destroy:()=>{for(let E of p)E(Tt())},after:f,before:s,deconstructed:a}},er=(t,e,o,r=null)=>{let n=null,i=ie({},{get:(f,s)=>{if(n||(n=$e(t,e,o,r)),s in n.contexts)return e.accessed(t.getId(),s),n.contexts[s];if(n.contexts.$state&&s in n.contexts.$state)return e.accessed(t.getId(),"$state"),n.contexts.$state[s]}});return{contexts:i.proxy,destroy:()=>{n&&n.destroy&&n.destroy(t,e),i.revoke()}}},K=(t,e,o=null)=>{let r=[],n=(s,a)=>{r.push({id:s,path:a})},{contexts:i,destroy:f}=$e(t,e,n,o);return[i,()=>{f(),r.length>0&&t.getLibrary().update(r)}]};var Ve=(t,e)=>{let o=t,r=0;for(;r<e.length-1;r++)o=o[e[r]];return o[e[r]]};var M=(t,e,o)=>{if(typeof t!="object")return;let r=0;for(;r<e.length-1;r++)if(t=t[e[r]],typeof t!="object")return;t[e[r]]=o};var St={name:"sync",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=!e[W];if(n&&!(r.tagName==="DIV"&&r.hasAttribute("contenteditable"))&&r.tagName!=="INPUT"&&r.tagName!=="SELECT"&&r.tagName!=="TEXTAREA"){console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.");return}let i=e.getValue().trim(),f=e.getKey();if(f&&(i="$"+f+"."+i),!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(i)){console.warn("Doars: `sync` directive's value not a valid variable name: \""+i+'".');return}if(i=i.split("."),n){let a;switch(r.tagName){case"DIV":a=()=>{let[u,p]=K(t,e.clone());M(u,i,Z(r.innerText)),p()};break;case"INPUT":a=()=>{let u=e.clone(),p=Z(r.value),[E,d]=K(t,u);if(r.type==="checkbox"){let g=Ve(E,i);if(r.checked)g||M(E,i,[p]),g.includes(r.value)||g.push(p);else if(g){let v=g.indexOf(r.value);v>=0&&g.splice(v,1)}}else if(r.type==="radio"){let g=Ve(E,i);r.checked?g!==r.value&&M(E,i,p):g===r.value&&M(E,i,null)}else M(E,i,p);d()};break;case"TEXTAREA":a=()=>{let[u,p]=K(t,e.clone());M(u,i,Z(r.innerText)),p()};break;case"SELECT":a=()=>{let[u,p]=K(t,e.clone());if(r.multiple){let E=[];for(let d of r.selectedOptions)E.push(Z(d.value));M(u,i,[E.join("','")])}else M(u,i,Z(r.selectedOptions[0].value));p()};break}r.addEventListener("input",a),e[W]=a}let s=o(t,e,i);switch(r.tagName){case"DIV":case"TEXTAREA":s!==r.innerText&&(r.innerText=s);break;case"INPUT":if(r.type==="checkbox"){let a=s.includes(r.value);r.checked!==a&&(r.checked=a,a?r.setAttribute("checked",""):r.removeAttribute("checked"))}else if(r.type==="radio"){let a=s===r.value;r.checked!==a&&(r.checked=a,a?r.setAttribute("checked",""):r.removeAttribute("checked"))}else s!==r.value&&r.setAttribute("value",s);break;case"SELECT":for(let a of Array.from(r.options)){let u=Array.isArray(s)?s.includes(a.value):s===a.value;a.selected!==u&&(a.selected=u,u?a.setAttribute("selected",""):a.removeAttribute("selected"))}break}},destroy:(t,e)=>{if(!e[W])return;e.getElement().removeEventListener("input",e[W]),delete e[W]}};var Lt={name:"text",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{n.content?r.textContent!==s&&(r.textContent=s):r.innerText!==s&&(r.innerText=s)},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var kt={name:"watch",update:(t,e,{processExpression:o})=>{let r=e.getValue();o(t,e,r,{},{return:!1})}};var re=class extends X{constructor(e){super();let{prefix:o,root:r}=e=Object.assign({prefix:"d",processor:"execute",root:document.body.firstElementChild},e);if(typeof r=="string"&&(e.root=r=document.querySelector(r)),!o){console.error("Doars: `prefix` option not set.");return}if(typeof o!="string"){console.error("Doars: `prefix` option must be of type string.");return}if(!r){console.error("Doars: `root` option not set.");return}if(typeof r!="object"){console.error("Doars: `root` option must be a string or HTMLElement.");return}let n=Symbol("ID_DOARS"),i=!1,f=!1,s,a,u,p=[],E={},d=[ot,st,nt,it,at,lt,ft,ut,dt,ct],g=[xt,pt,Et,vt,At,Lt,ht,bt,Ct,Dt,wt,St,kt],v,C,x;this.getId=()=>n,this.getOptions=()=>Object.assign({},e),this.getEnabled=()=>i,this.enable=()=>{if(i)return this;f=!1,s=[],u={},this.dispatchEvent("enabling",[this]),i=!0,v=g.map(m=>m.name),C={};for(let m of g)C[m.name]=m;x=new RegExp("^"+o+"-("+v.join("|")+")(?:[$-_.a-z0-9]{0,})?$","i"),a=new MutationObserver(b.bind(this)),a.observe(r,{attributes:!0,childList:!0,subtree:!0});let c=o+"-state",l=o+"-ignore",h=[...r.querySelectorAll("["+c+"]")];for(let m=h.length-1;m>=0;m--)h[m].closest("["+l+"]")&&h.splice(m,1);return I(r.hasAttribute(c)&&!r.hasAttribute(l)?r:null,...h),this.dispatchEvent("enabled",[this]),this.dispatchEvent("updated",[this]),this},this.disable=()=>i?(a.disconnect(),a=null,f=s=u=null,this.dispatchEvent("disabling",[this],{reverse:!0}),A(...p),v=C=x=null,i=!1,this.dispatchEvent("disabled",[this],{reverse:!0}),this):this;let I=(...c)=>{let l=[],h=[];for(let m of c){if(!m||m[S])continue;let O=new le(this,m);p.push(O),l.push(O),h.push(m)}h.length>0&&this.dispatchEvent("components-added",[this,h]);for(let m of l)m.initialize();for(let m of l)m.updateAttributes(m.getAttributes());return l},A=(...c)=>{let l=[];for(let h of c){let m=p.indexOf(h);m<0||(l.push(h.getElement()),h.destroy(),p.splice(m,1))}return l.length>0&&this.dispatchEvent("components-removed",[this,l]),l};this.getSimpleContexts=()=>Object.assign({},E),this.setSimpleContext=(c,l=null)=>l===null?(delete E[c],this.dispatchEvent("simple-context-removed",[this,c]),!0):c.match("^([a-zA-Z_$][a-zA-Zd_$]*)$")?(E[c]=l,this.dispatchEvent("simple-context-added",[this,c,l]),!0):(console.warn('Doars: name of a bind can not start with a "$".'),!1),this.getContexts=()=>[...d],this.addContexts=(c,...l)=>{if(i){console.warn("Doars: Unable to add contexts after being enabled!");return}c<0?c=d.length+c%d.length:c>d.length&&(c=d.length);let h=[];for(let m=0;m<l.length;m++){let O=l[m];d.includes(O)||(d.splice(c+m,0,O),h.push(O))}return h.length>0&&this.dispatchEvent("contexts-added",[this,h]),h},this.removeContexts=(...c)=>{if(i){console.warn("Doars: Unable to remove contexts after being enabled!");return}let l=[];for(let h of c){let m=d.indexOf(h);m<0||(d.slice(m,1),l.push(h))}return l.length>0&&this.dispatchEvent("contexts-removed",[this,l]),l},this.getDirectives=()=>[...g],this.getDirectivesNames=()=>[...v],this.getDirectivesObject=()=>Object.assign({},C),this.isDirectiveName=c=>x.test(c),this.addDirectives=(c,...l)=>{if(i){console.warn("Doars: Unable to add directives after being enabled!");return}c<0?c=g.length+c%g.length:c>g.length&&(c=g.length);let h=[];for(let m=0;m<l.length;m++){let O=l[m];g.includes(O)||(g.splice(c+m,0,O),h.push(O))}return h.length>0&&(v=C=x=null,this.dispatchEvent("directives-added",[this,h])),h},this.removeDirectives=(...c)=>{if(i){console.warn("Doars: Unable to remove directives after being enabled!");return}let l=[];for(let h of c){let m=g.indexOf(h);m<0||(g.slice(m,1),l.push(h))}return l.length>0&&(v=C=x=null,this.dispatchEvent("directives-removed",[this,l])),l},this.update=c=>{if(!!i){if(c)for(let l of c){let{id:h,path:m}=l;if(!(h in u)){u[h]=[m];continue}u[h].includes(m)||u[h].push(m)}if(!f&&Object.getOwnPropertySymbols(u).length!==0){f=!0,c=u,u={};for(let l of p)l.update(c);if(f=!1,Object.getOwnPropertySymbols(u).length>0){console.warn("Doars: during an update another update has been triggered. Normally this should not happen unless an expression in one of the directives is modifying a state which could cause a infinite loop!"),window.requestAnimationFrame(()=>this.update());return}if(s.length>0){b();return}this.dispatchEvent("updated",[this])}}};let b=c=>{if(s.push(...c),f||s.length===0)return;f=!0,c=[...s],s=[];let l=o+"-state",h=o+"-ignore",m=[],O=[],N=R=>{if(R.nodeType===1)if(R[S]){O.unshift(R[S]);let D=R.querySelectorAll(l);for(let T of D)T[S]&&O.unshift(T)}else{let D=te(R,T=>T[S]?(O.unshift(T[S]),!1):!0);do if(!!R[P])for(let T of R[P])T.getComponent().removeAttribute(T);while(R=D())}},B=R=>{if(R.nodeType!==1||R.closest("["+h+"]"))return;let T=R.querySelectorAll("["+l+"]");for(let V of T)V.closest("["+h+"]")||m.push(V);if(R.hasAttribute(l)){m.push(R);return}let $=H(R);if($){let V=$.scanAttributes(R);$.updateAttributes(V)}};for(let R of c)if(R.type==="childList"){for(let D of R.removedNodes)N(D);for(let D of R.addedNodes)B(D)}else if(R.type==="attributes"){let D=R.target;if(R.attributeName===l){if(D[S])continue;let q=H(D);if(q){let qe=D,Ht=te(D,Le=>Le.hasAttribute(l));do for(let Le of qe[P])q.removeAttribute(Le);while(qe=Ht())}I(D);continue}else if(R.attributeName===h){if(D.hasAttribute(h)){N(D);continue}B(D);continue}if(!x.test(R.attributeName))continue;let T=H(D);if(!T)continue;let $=null;for(let q of D[P])if(q.getName()===R.attributeName){$=q;break}let V=D.getAttribute(R.attributeName);if(!$){V&&T.addAttribute(D,R.attributeName,V);continue}$.setValue(V),T.updateAttribute($)}if(O.length>0&&A(...O),m.length>0&&I(...m),f=!1,s.length>0){b();return}Object.getOwnPropertySymbols(u).length>0&&this.update()}}};var tr=[9,10,13,32],Fe=40,ue=41,xe=44,z=46,Pt=58,Ye=63,He=91,Ke=93,Ut=125,jt=["=","||=","&&=","??=","*=","**=","/=","%=","+=","-="],de={"=":1,"||=":1,"&&=":1,"??=":1,"*=":1,"**=":1,"/=":1,"%=":1,"+=":1,"-=":1,"||":2,"&&":3,"??":4,"==":8,"!=":8,"===":8,"!==":8,"<":9,">":9,"<=":9,">=":9,"*":11,"/":11,"%":11,"+":11,"-":11},rr=["-","!","+"],Re="--",Ie="++",_t={true:!0,false:!1,null:null,undefined:void 0},oe=t=>t>=48&&t<=57,ze=t=>se(t)||oe(t),se=t=>t===36||t>=48&&t<=57||t===95||t>=65&&t<=90||t>=97&&t<=122,Mt=t=>{let e=0,o=()=>(e++,{type:5,elements:r(Ke)}),r=c=>{let l=[],h=!1,m=0;for(;e<t.length;){d();let O=t.charCodeAt(e);if(O===c){if(h=!0,e++,c===ue&&m&&m>=l.length)throw new Error("Unexpected token "+String.fromCharCode(c));break}else if(O===xe){if(e++,m++,m!==l.length){if(c===ue)throw new Error("Unexpected token ,");if(c===Ke)for(let N=l.length;N<m;N++)l.push(null)}}else{if(l.length!==m&&m!==0)throw new Error("Expected comma");{let N=f();if(!N)throw new Error("Expected comma");l.push(N)}}}if(!h)throw new Error("Expected "+String.fromCharCode(c));return l},n=()=>{let c=C();if(!c)return c;let l=i();if(!l)return c;let h={value:l,precedence:de[l]||0},m=C();if(!m)throw new Error("Expected expression after "+l);let O=[c,h,m],N;for(;l=i();){let R=de[l]||0;if(R===0){e-=l.length;break}h={value:l,precedence:R};let D=l;for(;O.length>2&&O[O.length-2]>R;)m=O.pop(),l=O.pop().value,c=O.pop(),N={type:jt.indexOf(l)>=0?6:7,operator:l,left:c,right:m},O.push(N);if(N=C(),!N)throw new Error("Expected expression after "+D);O.push(h,N)}let B=O.length-1;for(N=O[B];B>1;)l=O[B-1].value,N={type:jt.indexOf(l)>=0?6:7,operator:l,left:O[B-2],right:N},B-=2;return N},i=()=>{d();let c=t.substring(e,e+3),l=c.length;for(;l>0;){if(de.hasOwnProperty(c)&&(!se(t.charCodeAt(e))||e+c.length<t.length&&!ze(t.charCodeAt(e+c.length))))return e+=l,c;c=c.substring(0,--l)}return!1},f=()=>{let c=n();return d(),c=v(c),c},s=c=>{let l=[];for(;e<t.length;){let h=t.charCodeAt(e);if(h===59||h===xe)e++;else{let m=f();if(m)l.push(m);else if(e<t.length){if(h===c)break;throw new Error('Unexpected "'+t.charAt(e)+'"')}}}return l},a=()=>{let c=t.charCodeAt(e),l=e;if(se(c))e++;else throw new Error("Unexpected "+t.charAt(e));for(;e<t.length&&(c=t.charCodeAt(e),ze(c));)e++;return{type:2,name:t.slice(l,e)}},u=()=>{let c="";for(;oe(t.charCodeAt(e));)c+=t.charAt(e++);if(t.charCodeAt(e)===z)for(c+=t.charAt(e++);oe(t.charCodeAt(e));)c+=t.charAt(e++);let l=t.charAt(e);if(l==="e"||l==="E"){for(c+=t.charAt(e++),l=t.charAt(e),(l==="+"||l==="-")&&(c+=t.charAt(e++));oe(t.charCodeAt(e));)c+=t.charAt(e++);if(!oe(t.charCodeAt(e-1)))throw new Error("Expected exponent ("+c+t.charAt(e)+")")}let h=t.charCodeAt(e);if(se(h))throw new Error("Variable names cannot start with a number ("+c+t.charAt(e)+")");if(h===z||c.length===1&&c.charCodeAt(0)===z)throw new Error("Unexpected period");return{type:3,value:parseFloat(c)}},p=()=>{if(t.charCodeAt(e)!==123)return;e++;let c=[];for(;!isNaN(t.charCodeAt(e));){if(d(),t.charCodeAt(e)===Ut)return e++,x({type:11,properties:c});let l=C();if(!l)throw new Error("missing }");if(d(),l.type===2&&(t.charCodeAt(e)===xe||t.charCodeAt(e)===Ut))c.push({type:4,computed:!1,key:l,value:l,shorthand:!0});else if(t.charCodeAt(e)===Pt){e++;let h=f();if(!h)throw new Error("unexpected object property");let m=l.type===5;c.push({computed:m,key:m?l.elements[0]:l,shorthand:!1,type:4,value:h}),d()}else l&&c.push(l);t.charCodeAt(e)===xe&&e++}throw new Error("missing }")},E=()=>{e++;let c=s(ue);if(t.charCodeAt(e)===ue)return e++,c.length===1?c[0]:c.length?{type:12,expressions:c}:!1;throw new Error("Unclosed (")},d=()=>{for(;tr.indexOf(t.charCodeAt(e))>=0;)e++},g=()=>{let c="",l=t.charAt(e++),h=!1;for(;e<t.length;){let m=t.charAt(e++);if(m===l){h=!0;break}if(m==="\\")switch(m=t.charAt(e++),m){case"n":c+=`
`;break;case"r":c+="\r";break;case"t":c+="	";break;case"b":c+="\b";break;case"f":c+="\f";break;case"v":c+="\v";break;default:c+=m}else c+=m}if(!h)throw new Error('Unclosed quote after "'+c+'"');return{type:3,value:c}},v=c=>{if(!c||t.charCodeAt(e)!==Ye)return c;e++;let l=f();if(!l)throw new Error("Expected expression");if(d(),!t.charCodeAt(e)===Pt)throw new Error("Expected :");e++;let h=f();if(!h)throw new Error("Expected expression");let m={type:9,condition:c,consequent:l,alternate:h};if(c.operator&&de[c.operator]<=1){let O=c;for(;O.right.operator&&de[O.right.operator]<=1;)O=O.right;m.condition=O.right,O.right=m,m=c}return m},C=()=>{let c=p()||I();if(c)return A(c);d();let l=t.charCodeAt(e);if(oe(l)||l===z)return u();if(l===34||l===39)c=g();else if(l===He)c=o();else{let h=t.substring(e,e+1),m=h.length;for(;m>0;){if(rr.indexOf(h)>=0&&(!se(t.charCodeAt(e))||e+h.length<t.length&&!ze(t.charCodeAt(e+h.length)))){e+=m;let O=C();if(!O)throw new Error("Missing unary operation parameter");return A({type:13,operator:h,parameter:O})}h=h.substr(0,--m)}se(l)?(c=a(),_t.hasOwnProperty(c.name)&&(c={type:3,value:_t[c.name]})):l===Fe&&(c=E())}return A(x(c))},x=c=>{d();let l=t.charCodeAt(e);for(;l===z||l===He||l===Fe||l===Ye;){let h;if(l===Ye){if(t.charCodeAt(e+1)!==z)break;h=!0,e+=2,d(),l=t.charCodeAt(e)}if(e++,l===He){if(c={type:10,computed:!0,object:c,property:f()},d(),l=t.charCodeAt(e),l!==Ke)throw new Error("Unclosed [");e++}else l===Fe?c={type:8,parameters:r(ue),callee:c}:(l===z||h)&&(h&&e--,d(),c={type:10,computed:!1,object:c,property:a()});h&&(c.optional=!0),d(),l=t.charCodeAt(e)}return c},I=()=>{if(e+1>=t.length)return;let c=t.substring(e,e+2),l=null;if(c===Re)l=Re;else if(c===Ie)l=Ie;else return;e+=2;let h={type:14,operator:l,parameter:x(a()),prefix:!0};if(!h.parameter||h.parameter.type!==2&&h.parameter.type!==10)throw new Error(`Unexpected ${env.node.operator}`);return h},A=c=>{if(!c||e+1>=t.length)return c;let l=t.substring(e,e+2),h=null;if(l===Re)h=Re;else if(l===Ie)h=Ie;else return c;return e+=2,c={type:14,operator:h,parameter:c,prefix:!1},c},b=s();return b.length===0?void 0:b};var Bt=(t,e,o={})=>{switch(t.type){case 2:return o[t.name]=e;case 10:let r=w(t.object,o),n=t.computed||t.property.type!==2?w(t.property,o):t.property.name;return typeof e=="function"?e.bind(r):r[n]=e}throw new Error("Unsupported assignment method.")},w=(t,e={})=>{if(!!t){if(Array.isArray(t))return t.map(o=>w(o,e));switch(t.type){case 2:return e[t.name];case 3:return t.value;case 5:let o=[];for(let g of t.elements)o.push(w(g,e));return o;case 6:let r=w(t.right,e);if(t.operator!=="="){let g=w(t.left,e);switch(t.operator){case"||=":if(g)return g;break;case"&&=":if(!g)return g;break;case"??=":if(g!=null)return g;break;case"*=":r=g*r;break;case"**=":r=g**r;break;case"/=":r=g/r;break;case"%=":r=g%r;break;case"+=":r=g+r;break;case"-=":r=g-r;break}}return Bt(t.left,r,e);case 7:let n=w(t.left,e),i=w(t.right,e);switch(t.operator){case"||":return n||i;case"&&":return n&&i;case"??":return n??i;case"==":return n==i;case"!=":return n!=i;case"===":return n===i;case"!==":return n!==i;case"<":return n<i;case">":return n>i;case"<=":return n<=i;case">=":return n>=i;case"-":return n-i;case"+":return n+i;case"*":return n*i;case"/":return n/i;case"%":return n%i}throw new Error("Unsupported operator: "+t.operator);case 8:let f=[];for(let g of t.parameters)f.push(w(g,e));return w(t.callee,e)(...f);case 9:return w(t.condition,e)?w(t.consequent,e):w(t.alternate,e);case 10:let s=w(t.object,e),a=t.computed||t.property.type!==2?w(t.property,e):t.property.name;return typeof s[a]=="function"?s[a].bind(s):s[a];case 11:let u={};for(let g of t.properties)u[g.computed||g.key.type!==2?w(g.key,e):g.key.name]=w(g.value,e);return u;case 12:return t.expressions.map(g=>w(g,e));case 13:let p=w(t.parameter,e);switch(t.operator){case"!":return!p;case"-":return-p;case"+":return+p}throw new Error("Unsupported operator: "+t.operator);case 14:let E=w(t.parameter,e),d=t.operator==="--"?-1:1;return Bt(t.parameter,E+d,e),t.prefix?E+d:E}throw new Error('Unexpected node type "'+t.type+'".')}},$t=w;var Vt=Mt,Ft=$t;var Yt=(t,e,o,r=null,n=null)=>{n=Object.assign({return:!0},n);let[i,f]=K(t,e,update,r),s;try{let a=Vt(o);if(n.return&&a&&a.length>1)throw new Error('Unable to return a single value from a compound expression of: "'+o+'".');s=Ft(a,i)}catch(a){console.error(a,"Error encountered when executing the following expression: ",o),s=null}if(f(),n.return&&s)return s=s[0],s};re.interpretExpression=Yt;var bs=re;})();
//# sourceMappingURL=doars-interpret.iife.min.js.map
