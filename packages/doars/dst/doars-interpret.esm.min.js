var P=Symbol("ATTRIBUTES"),S=Symbol("COMPONENT"),Q=Symbol("FOR"),_=Symbol("INITIALIZED"),v=Symbol("ON"),k=Symbol("REFERENCES"),J=Symbol("REFERENCES_CACHE"),W=Symbol("SYNC");var Le=class{constructor(){let e={};this.addEventListener=(o,r,n=null)=>{o in e||(e[o]=[]),e[o].push({callback:r,options:n})},this.removeEventListener=(o,r)=>{if(!Object.keys(e).includes(o))return;let n=e[o],i=-1;for(let f=0;f<n.length;f++)if(n[f].callback===r){i=f;break}i<0||(n.splice(i,1),Object.keys(n).length===0&&delete e[o])},this.removeEventListeners=o=>{!o||delete e[o]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(o,r,n=null)=>{if(!e[o])return;let i=e[o];for(let f=0;f<i.length;f++){let s=n&&n.reverse?i[i.length-(f+1)]:i[f];s.options&&s.options.once&&i.splice(f,1),s.callback(...r)}}}},X=Le;var Z=t=>t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"').replace(/\n/g,"\\n"),Mt=t=>t.replace(/-(\w)/g,(e,o)=>o.toUpperCase()),ze=t=>{let e={};for(let o of t){let r=o.indexOf("-");if(r<0){e[o]=!0;continue}if(r===0){e[o.substring(1)]=!1;continue}let n=o.substring(0,r),i=o.substring(r+1),f=i,s;if(i.endsWith("ms")?f=i.substring(-2):i.endsWith("s")?(s="s",f=i.substring(-1)):i.endsWith("m")?(s="m",f=i.substring(-1)):i.endsWith("h")&&(s="h",f=i.substring(-1)),f=Number.parseInt(f),!isNaN(f))switch(i=f,s){case"h":i*=60;case"m":i*=60;case"s":i*=1e3;break}e[n]=i}return e},Ge=(t,e)=>{if(e=e.match(new RegExp("^"+t+"-([a-z][0-9a-z-]{1,}):?([a-z][0-9a-z-]*)?(\\..*]*)?$","i")),!e)return;let[o,r,n,i]=e;n=n!==""?n:null;let f=n?Mt(n):null;return i=i?i.substring(1).split("."):[],[r,n,f,i]},qe=t=>{let e=t.match(/^([$_a-z0-9,(){}\s]{1,}?)\s+(?:in|of)\s+([\s\S]{1,})$/i);if(!e)return;let o=e[1].replace(/^[\s({]*|[)}\s]*$/g,"");if(o=o.match(/^([$_a-z0-9]{1,})?(?:,\s+?)?([$_a-z0-9]{1,})?(?:,\s+)?([$_a-z0-9]{1,})?$/i),!!o)return o.shift(),{iterable:e[2].trim(),variables:[...o]}},ee=t=>{if(typeof t=="string"&&(t=t.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(t)){console.error("Doars: parseSelector expects Array of string or a single string.");return}let e={};for(let o of t)switch(o=o.trim(),o[0]){case"#":e.id=o.substring(1);break;case".":o=o.substring(1),e.class||(e.class=[]),e.class.includes(o)||e.class.push(o);break;case"[":let[r,n,i]=o.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);e[n]=i;break}return e};var Y=class extends X{constructor(e,o,r,n,i=!1){super();let f=Symbol("ID_ATTRIBUTE");i||(o[P]||(o[P]=[]),o[P].push(this));let s={},l=null,u,p,g,d,E;if(r){let[A,x,N,w]=Ge(e.getLibrary().getOptions().prefix,r);u=A,p=N,g=x,d=w,w&&(E=ze(w))}this.getComponent=()=>e,this.getElement=()=>o,this.getId=()=>f,this.getDirective=()=>u,this.getKey=()=>p,this.getKeyRaw=()=>g,this.getModifiers=()=>Object.assign({},E),this.getModifiersRaw=()=>d,this.getName=()=>r,this.getValue=()=>n,this.setValue=A=>{n=A,this.dispatchEvent("changed",[this])},this.clearData=()=>{l=null},this.hasData=()=>l!==null,this.getData=()=>l,this.setData=A=>{l=A},this.destroy=()=>{this.setData(null),this.clearAccessed();let A=o[P].indexOf(this);A>=0&&o[P].splice(A,1),this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.accessed=(A,x)=>{if(!s[A])s[A]=[];else if(s[A].includes(x))return;s[A].push(x),this.dispatchEvent("accessed",[this,A,x])},this.clearAccessed=()=>{s={}},this.hasAccessed=(A,x)=>{if(!(A in s))return!1;let N=s[A];for(let w of x)if(N.includes(w))return!0;return!1},this.clone=()=>new Y(e,o,r,n,!0)}};var $t=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],ie=(t,e)=>{let o=!1,r={};for(let n of $t)r[n]=(...i)=>{if(o){console.error("illegal operation attempted on a revoked proxy");return}return n in e?e[n](...i):Reflect[n](...i)};return{proxy:new Proxy(t,r),revoke:()=>{o=!0}}};var ke=class extends X{constructor(e={}){super(),e=Object.assign({delete:!0,get:!0,set:!0},e);let o=new WeakMap;this.add=(r,n=[])=>{if(o.has(r))return o.get(r);for(let s in r)r[s]&&typeof r[s]=="object"&&(r[s]=this.add(r[s],[...n,s]));let i={};e.delete&&(i.deleteProperty=(s,l)=>{if(!Reflect.has(s,l))return!0;this.remove(s,l);let u=Reflect.deleteProperty(s,l);return u&&this.dispatchEvent("delete",[s,Array.isArray(s)?[...n]:[...n,l]]),u}),e.get&&(i.get=(s,l,u)=>(l!==Symbol.unscopables&&this.dispatchEvent("get",[s,[...n,l],u]),Reflect.get(s,l,u))),e.set&&(i.set=(s,l,u,p)=>(s[l]===u||(typeof u=="object"&&(u=this.add(u,[...n,l])),s[l]=u,this.dispatchEvent("set",[s,Array.isArray(s)?[...n]:[...n,l],u,p])),!0));let f=ie(r,i);return o.set(f,r),f.proxy},this.remove=r=>{if(!o.has(r))return;let n=o.get(r);o.delete(n);for(let i in n.proxy)typeof n.proxy[i]=="object"&&this.remove(n.proxy[i]);n.revoke()}}},Qe=ke;var V=t=>{if(!!t.parentElement)return t=t.parentElement,t[S]?t[S]:V(t)};var Ee=(t,e)=>{for(let o in e){if(o==="class"){for(let r of e.class)t.classList.add(r);continue}t.setAttribute(o,e[o])}};var H=(t,e)=>{for(let o in e){if(o==="class"){for(let r of e.class)t.classList.remove(r);continue}e[o]&&t.attributes[o]!==e[o]||t.removeAttribute(o)}},Pe=(t,e,o)=>{if(e==="value"&&t.tagName==="INPUT"){if(o||(o=""),t.getAttribute(e)===o)return;t.setAttribute(e,o);return}if(e==="checked"&&(t.type==="checkbox"||t.type==="radio")){t.checked=!!o;return}e==="class"&&(Array.isArray(o)?o=o.join(" "):typeof o=="object"&&(o=Object.entries(o).filter(([r,n])=>n).map(([r])=>r).join(" "))),e==="style"&&(Array.isArray(o)?o=o.join(" "):typeof o=="object"&&(o=Object.entries(o).map(([r,n])=>r+":"+n).join(";"))),o===!1||o===null||o===void 0?t.removeAttribute(e):t.setAttribute(e,o)},Ue=(t,e)=>{for(let o in e)Pe(t,o,e[o])};var Bt="-transition:",Ae=(t,e,o,r=null)=>{if(o.nodeType!==1){r&&r();return}let{prefix:n}=e.getLibrary().getOptions(),i=n+Bt+t,f=E=>{o.dispatchEvent(new CustomEvent("transition-"+E)),o.dispatchEvent(new CustomEvent("transition-"+t+"-"+E))},s,l,u,p,g=!1,d={};return s=i,l=o.getAttribute(s),l&&(d.during=ee(l),Ee(o,d.during)),s=i+".from",l=o.getAttribute(s),l&&(d.from=ee(l),Ee(o,d.from)),f("start"),p=requestAnimationFrame(()=>{if(p=null,g)return;if(d.from&&(H(o,d.from),d.from=void 0),s=i+".to",l=o.getAttribute(s),l)d.to=ee(l),Ee(o,d.to);else if(!d.during){f("end"),r&&r(),g=!0;return}let E=getComputedStyle(o),A=Number(E.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;A===0&&(A=Number(E.animationDuration.replace("s",""))*1e3),u=setTimeout(()=>{u=null,!g&&(d.during&&(H(o,d.during),d.during=void 0),d.to&&(H(o,d.to),d.to=void 0),f("end"),r&&r(),g=!0)},A)}),()=>{!g||(g=!0,d.during&&(H(o,d.during),d.during=void 0),d.from?(H(o,d.from),d.from=void 0):d.to&&(H(o,d.to),d.to=void 0),p?(cancelAnimationFrame(p),p=null):u&&(clearTimeout(u),u=null),f("end"),r&&r())}},ye=(t,e,o)=>Ae("in",t,e,o),ce=(t,e,o)=>Ae("out",t,e,o);var ae=(t,e)=>{t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)};var te=(t,e)=>{let o=-1,r=null;return()=>{if(o>=0&&r){let i=r();if(i)return i}let n=null;do{if(o++,o>=t.childElementCount)return null;n=t.children[o]}while(!e(n));return n.childElementCount&&(r=te(n,e)),n}};var le=class{constructor(e,o){let r=Symbol("ID_COMPONENT"),{prefix:n,processor:i}=e.getOptions(),f=typeof i,s;f==="function"?s=i:f==="string"&&e.constructor[i+"Expression"]?s=e.constructor[i+"Expression"]:(console.warn("Doars: Expression processor not found. Using fallback instead."),s=e.constructor.executeExpression??e.constructor.interpretExpression??e.constructor.callExpression),s||console.error("Doars: No expression processor available. Process option: ",process);let l=Object.freeze({processExpression:s,transition:Ae,transitionIn:ye,transitionOut:ce}),u=[],p=!1,g=!1,d,E,A;if(!o.attributes[n+"-state"]){console.error("Doars: element given to component does not contain a state attribute!");return}o[S]=this;let x=[],N=V(o);N&&(N.getChildren().includes(this)||(N.getChildren().push(this),e.update([{id:N.getId(),path:"children"}]))),this.getAttributes=()=>u,this.getChildren=()=>x,this.getElement=()=>o,this.getId=()=>r,this.getLibrary=()=>e,this.getParent=()=>N,this.getProxy=()=>E,this.getState=()=>A,this.setParent=y=>{N=y},this.initialize=()=>{if(g)return;g=!0;let y=n+"-state",b=o.attributes[y].value;if(d=b?s(this,new Y(this,o,null,b),b):{},d===null)d={};else if(typeof d!="object"||Array.isArray(d)){console.error("Doars: component tag must return an object!");return}E=new Qe,A=E.add(d),this.scanAttributes(o)},this.destroy=()=>{if(!g)return;if(u.length>0){let b=e.getDirectivesObject();for(let c in b)b[c].destroy||(b[c]=void 0);for(let c of u){let a=b[c.getKey()];a&&a.destroy(this,c,l),c.destroy()}}delete o[S],u=[],g=!1,E.remove(d),A=null,E=null,d=null;let y=[];if(x.length>0){for(let b of x)b.setParent(N),y.push({id:b.getId(),path:"parent"});y.push({id:r,path:"children"})}N&&(x.length>0&&(N.getChildren().push(...x),y.push({id:N.getId(),path:"children"})),y.push({id:r,path:"parent"})),y.length>0&&e.update(y),w("destroyed",{element:o,id:r})},this.addAttribute=(y,b,c)=>{let a=e.getDirectivesNames(),h=new Y(this,y,b,c),m=h.length,C=a.indexOf(h.getDirective());for(let R=u.length-1;R>=0;R--)if(a.indexOf(u[R].getDirective())<=C){m=R+1;break}return u.splice(m,0,h),h},this.removeAttribute=y=>{let b=u.indexOf(y);if(b<0)return;let a=e.getDirectivesObject[y.getKey()];a&&a.destroy&&a.destroy(this,y,l),u.splice(b,1),y.destroy()},this.scanAttributes=y=>{let b=n+"-state",c=n+"-ignore",a=[],h=te(y,m=>!m.hasAttribute(b)&&!m.hasAttribute(c));do for(let{name:m,value:C}of y.attributes)e.isDirectiveName(m)&&a.push(this.addAttribute(y,m,C));while(y=h());return a},this.updateAttribute=y=>{if(!y.getElement()||y.getValue()===null||y.getValue()===void 0){this.removeAttribute(y);return}let b=e.getDirectivesObject();y.clearAccessed();let c=b[y.getDirective()];c&&c.update(this,y,l)},this.updateAttributes=y=>{if(!g||y.length<=0){p||(p=!0,w("updated",{attributes:y,element:o,id:r}));return}for(let b of y)this.updateAttribute(b);p=!0,w("updated",{attributes:y,element:o,id:r})},this.update=y=>{if(!g)return;let b=Object.getOwnPropertySymbols(y),c=[];for(let a of u)for(let h of b)a.hasAccessed(h,y[h])&&(this.updateAttribute(a),c.push(a));(!p||c.length>0)&&(p=!0,w("updated",{attributes:c,element:o,id:r}))};let w=(y,b)=>{o.dispatchEvent(new CustomEvent(n+"-"+y,{detail:b,bubbles:!0}))}}};var Je={name:"$children",create:(t,e,o,{createContextsProxy:r,RevocableProxy:n})=>{let i,f=n(t.getChildren(),{get:(s,l,u)=>{if(i||(i=s.map(g=>r(g,e,o)),e.accessed(t.getId(),"children")),isNaN(l))return Reflect.get(i,l,u);let p=Reflect.get(i,l,u);if(p)return p.contexts}});return{value:f.proxy,destroy:()=>{i&&i.forEach(s=>s.destroy()),f.revoke()}}}};var We={name:"$component",create:t=>({value:t.getElement()})};var Xe={name:"$element",create:(t,e)=>({value:e.getElement()})};var Ze={name:"$dispatch",create:t=>({value:(e,o={})=>{t.getElement().dispatchEvent(new CustomEvent(e,{detail:o,bubbles:!0}))}})};var et={deconstruct:!0,name:"$for",create:(t,e,o,{RevocableProxy:r})=>{if(t!==e.getComponent())return;let n=e.getElement(),i=t.getElement(),f=[],s={};for(;n&&!n.isSameNode(i);){let u=n[Q];if(u){f.push(u);for(let p in u.variables)s[p]=u.variables[p]}n=n.parentNode}if(f.length===0)return;let l=r(s,{get:(u,p)=>{for(let g of f)if(p in g.variables)return e.accessed(g.id,"$for"),g.variables[p]}});return{value:l.proxy,destroy:()=>{l.revoke()}}}};var tt={name:"$inContext",create:(t,e,o,{createContexts:r})=>({value:n=>{let i=[],f=(p,g)=>{i.push({id:p,path:g})},{contexts:s,destroy:l}=r(t,e,f,{}),u=n(s);return l(),i.length>0&&t.getLibrary().update(i),u}})};var rt={name:"$nextTick",create:(t,e,o,{createContexts:r})=>{let n,i=!1,f=()=>{if(i)return;i=!0;let s=t.getLibrary();n=[];let l=()=>{u();let{contexts:p,destroy:g}=r(t,e,o,{});for(let d of n)d(p);g()},u=()=>{s.removeEventListener("updated",l),e.removeEventListener("changed",u),e.removeEventListener("destroyed",u)};s.addEventListener("updated",l),e.addEventListener("changed",u),e.addEventListener("destroyed",u)};return{value:s=>{f(),n.push(s)}}}};var ot={name:"$parent",create:(t,e,o,{createContextsProxy:r})=>{let n=t.getParent();if(!n)return{key:"$parent",value:null};let{contexts:i,destroy:f}=r(n,e,o);return{value:i,destroy:f}}};var st={name:"$references",create:(t,e,o,{RevocableProxy:r})=>{if(!t[k])return{key:"$references",value:[]};let n=t[J];if(!n){let f=t[k],s=Object.getOwnPropertySymbols(f);n={};for(let l of s){let{element:u,name:p}=f[l];n[p]=u}t[J]=n}let i=r(n,{get:(f,s,l)=>(e.accessed(t.getId(),"$references."+s),Reflect.get(f,s,l))});return{value:i.proxy,destroy:()=>{i.revoke()}}}};var nt={deconstruct:!0,name:"$state",create:(t,e,o,{RevocableProxy:r})=>{let n=t.getProxy(),i=t.getState();if(!n||!i)return;let f=(p,g)=>o(t.getId(),"$state."+g.join(".")),s=(p,g)=>e.accessed(t.getId(),"$state."+g.join(".")),l=(p,g)=>o(t.getId(),"$state."+g.join("."));n.addEventListener("delete",f),n.addEventListener("get",s),n.addEventListener("set",l);let u=r(i,{});return{value:u.proxy,destroy:()=>{n.removeEventListener("delete",f),n.removeEventListener("get",s),n.removeEventListener("set",l),u.revoke()}}}};var Dr=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var L=t=>t&&Object.prototype.toString.call(t)==="[object Promise]";var it={name:"attribute",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{if(n.selector){if(typeof s!="string"){console.error("Doars: Value returned to attribute directive must be a string if the selector modifier is set.");return}s=ee(s),Ue(r,s);return}let l=e.getKeyRaw();if(!l){typeof s=="object"&&!Array.isArray(s)?Ue(r,s):console.error("Doars: Value returned to attribute directive of invalid type.");return}Pe(r,l,s)},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var ct={name:"cloak",update:function(t,e,{transitionIn:o}){let r=e.getElement();r.removeAttribute(t.getLibrary().getOptions().prefix+"-"+this.name),o(t,r)}};var ve=(t,...e)=>{let o={};for(let r=0;r<e.length&&!(r>=t.length);r++)o[t[r]]=e[r];return o},at=(t,e,o=-1)=>(o++,o>=t.length?-1:t[o][Q].value===e?o:at(t,e,o)),be=(t,e,o,r,n,i,f)=>{let s=at(r,i,n);if(s>=0){if(s===n+1)return;let p=r[s];ae(r[n]?r[n]:o,p),e(p[Q].id);return}let l=document.importNode(o.content,!0),u=n===-1?o:r[n];ae(u,l),l=u.nextElementSibling,ye(t,l),l[Q]={id:Symbol("ID_FOR"),value:i,variables:f},r.splice(n+1,0,l)},je=(t,e,o)=>{if(!(e.length<o))for(let r=e.length-1;r>=o;r--){let n=e[r];e.splice(r,1),ce(t,n,()=>{n.remove()})}},lt={name:"for",update:(t,e,{processExpression:o})=>{let r=e.getElement();if(r.tagName!=="TEMPLATE"){console.warn("Doars: `for` directive must be placed on a `<template>` tag.");return}let n=qe(e.getValue());if(!n){console.error("Doars: Error in `for` expression: ",e.getValue());return}let i={},f=p=>{i[p]||(i[p]=["$for"])},s=p=>{let g=e.getData(),d=g.elements?g.elements:[],E=typeof p;if(p==null)length=0;else if(E==="number"){for(let A=0;A<p;A++){let x=ve(n.variables,A);be(t,f,r,d,A-1,p,x)}je(t,d,p)}else if(E==="string"){for(let A=0;A<p.length;A++){let x=p[A],N=ve(n.variables,x,A);be(t,f,r,d,A-1,x,N)}je(t,d,p.length)}else{let A,x;try{let N=[...p];A=!0,x=N.length}catch{}if(A)for(let N=0;N<x;N++){let w=p[N],y=ve(n.variables,w,N);be(t,f,r,d,N-1,w,y)}else{let N=Object.keys(p);x=N.length;for(let w=0;w<x;w++){let y=N[w],b=p[y],c=ve(n.variables,y,b,w);be(t,f,r,d,w-1,b,c)}}je(t,d,x)}Object.getOwnPropertySymbols(i).length>0&&t.update(i),e.setData(Object.assign({},g,{elements:d}))},l;isNaN(n.iterable)?l=o(t,e,n.iterable):l=Number(n.iterable);let u=e.getData();e.setData(Object.assign({},u,{result:l})),L(l)?Promise.resolve(l).then(p=>{e.getData().result===l&&s(p)}):s(l)},destroy:(t,e)=>{let o=e.getData();if(o.elements)for(let r of o.elements)ce(t,r,()=>{r.remove()})}};var Ft={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},Yt=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var ft=t=>typeof t!="string"?t:t.replaceAll(Yt,e=>Ft[e]);var ut={name:"html",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{if(n.decode&&typeof s=="string"&&(s=ft(s)),s instanceof HTMLElement){for(let l of r.children)l.remove();r.appendChild(s.cloneNode(!0));return}if(typeof s=="string"){r.innerHTML!==s&&(r.innerHTML=s);return}console.error("Doars/directives/html: Unknown type returned to directive!")},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var dt={name:"if",update:(t,e,{processExpression:o,transitionIn:r,transitionOut:n})=>{let i=e.getElement();if(i.tagName!=="TEMPLATE"){console.warn("Doars: `if` directive must be placed on a `<template>` tag.");return}if(i.childCount>1){console.warn("Doars: `if` directive must have a single child node.");return}let f=u=>{let p=e.getData(),g=p.element,d=p.transition;u?g||(d&&d(),g=document.importNode(i.content,!0),ae(i,g),g=i.nextElementSibling,d=r(t,g)):g&&(d&&d(),d=n(t,g,()=>{g.remove()})),e.setData(Object.assign({},p,{element:g,transition:d}))},s=o(t,e,e.getValue()),l=e.getData();e.setData(Object.assign({},l,{result:s})),L(s)?Promise.resolve(s).then(u=>{e.getData().result===u&&f(u)}):f(s)},destroy:(t,e,{transitionOut:o})=>{let r=e.getData();r.element&&o(t,r.element,()=>{r.element.remove()})}};var pt=(t,e)=>{if(!e[_])return;let o=t.getElement(),r=t.getLibrary().getOptions().prefix+"-updated";o.removeEventListener(r,e[_].handler),delete e[_]},ht={name:"initialized",update:(t,e,{processExpression:o})=>{let r=t.getElement(),n=e.getValue(),i=t.getLibrary().getOptions().prefix+"-updated";if(e[_]){if(e[_].value===n)return;r.removeEventListener(i,e[_].handler),delete e[_]}let f=({detail:s})=>{s.element===r&&(o(t,e.clone(),n,{},{return:!1}),pt(t,e))};r.addEventListener(i,f,{once:!0}),e[_]={handler:f,value:n}},destroy:pt};var fe={keydown:"keyup",mousedown:"mouseup",pointerdown:"pointerup"},U={NONE:0,BUFFER:1,DEBOUNCE:2,HELD:3,HOLD:4,THROTTLE:5},Vt=["alt","ctrl","meta","shift"],mt={name:"on",update:(t,e,{processExpression:o})=>{let r=e.getKeyRaw();if(!r){console.warn("Doars: `on` directive must have a key.");return}let n;r.startsWith("keydown-")?(n=r.substring(8).toLowerCase(),r="keydown"):r.startsWith("keyup-")&&(n=r.substring(6).toLowerCase(),r="keyup");let i=e.getElement(),f=e.getValue();if(e[v]){if(e[v].value===f)return;e[v].target.removeEventListener(r,e[v].handler),e[v].timeout&&clearTimeout(e[v].timeout),delete e[v]}let s=e.getModifiers(),l={};s.capture&&(l.capture=!0),s.once&&(l.once=!0),s.passive&&(l.passive=!0);let u=U.NONE;s.buffer?(u=U.BUFFER,s.buffer===!0&&(s.buffer=5)):s.debounce?(u=U.DEBOUNCE,s.debounce===!0&&(s.debounce=500)):s.held?(u=U.HELD,s.held===!0&&(s.held=500)):s.hold?(u=U.HOLD,s.hold===!0&&(s.hold=500)):s.throttle&&(u=U.THROTTLE,s.throttle===!0&&(s.throttle=500));let p=[];if(n){s.meta=s.meta?!0:s.cmd||s.super;for(let E of Vt)s[E]&&p.push(E)}let g=i;s.document||s.outside?g=document:s.window&&(g=window);let d=E=>{if(e[v].prevent||!s.repeat&&E.repeat||s.self&&E.target!==i||s.outside&&i.contains(E.target))return;if((r==="keydown"||r==="keyup")&&n){for(let N of p)if(!E[N+"Key"])return;let x=s.code?E.code:E.key;if(x===" "&&(x="space"),x=x.toLowerCase(),x!==n)return}s.prevent&&E.preventDefault(),s.stop&&E.stopPropagation();let A=()=>{o(t,e.clone(),f,{$event:E,$events:e[v].buffer},{return:!1}),e[v].buffer=[]};switch(e[v].buffer.push(E),u){case U.BUFFER:if(e[v].buffer.length<s.buffer)return;A();return;case U.DEBOUNCE:e[v].timeout&&(clearTimeout(e[v].timeout),e[v].timeout=null),e[v].timeout=setTimeout(A,s.debounce);return;case U.HELD:if(!(r in fe)){console.warn('Doars: `on` directive, event of name "'+r+'" is not cancelable and can not have "held" modifier.');return}let x=fe[r],N=window.performance.now();e[v].cancel=b=>{if(window.performance.now()-N<s.held){e[v].prevent=!1;return}if(x==="keyup"&&n){for(let a of p)if(!b[a+"Key"]){e[v].prevent=!1;return}let c=s.code?b.code:b.key;if(c===" "&&(c="space"),c=c.toLowerCase(),c!==n){e[v].prevent=!1;return}}if(s.self&&b.target!==i){e[v].prevent=!1;return}if(s.outside&&i.contains(b.target)){e[v].prevent=!1;return}A()},e[v].prevent=!0,g.addEventListener(x,e[v].cancel,{once:!0});return;case U.HOLD:if(!(r in fe)){console.warn('Doars: `on` directive, event of name "'+r+'" is not cancelable and can not have "hold" modifier.');return}let w=fe[r];e[v].cancel=b=>{if(w==="keyup"&&n){let c=!1;for(let h of p)b[h+"Key"]||(c=!0);let a=s.code?b.code:b.key;if(a===" "&&(a="space"),a=a.toLowerCase(),a===n&&(c=!0),!c){e[v].prevent=!1;return}}if(s.self&&b.target!==i){e[v].prevent=!1;return}if(s.outside&&i.contains(b.target)){e[v].prevent=!1;return}clearTimeout(e[v].timeout)},g.addEventListener(w,e[v].cancel,{once:!0}),e[v].prevent=!0,e[v].timeout=setTimeout(()=>{g.removeEventListener(w,e[v].cancel),e[v].prevent=!1,A()},s.hold);return;case U.THROTTLE:let y=window.performance.now();if(e[v].lastExecution&&y-e[v].lastExecution<s.throttle)return;A(),e[v].lastExecution=y;return}A()};g.addEventListener(r,d,l),e[v]={buffer:[],handler:d,target:g,timeout:e[v]?e[v].timeout:void 0,value:f,prevent:!1}},destroy:(t,e)=>{if(!e[v])return;let o=e.getKeyRaw();e[v].target.removeEventListener(o,e[v].handler),e[v].cancel&&e[v].target.removeEventListener(fe[o],e[v].cancel),e[v].timeout&&clearTimeout(e[v].timeout),delete e[v]}};var gt=(t,e)=>{if(!t[k])return;let o=e.getId();if(!t[k][o])return;let r=t.getLibrary(),n=t.getId(),i=e.getValue().trim();delete t[k][o],delete t[J],Object.keys(t[k]).length===0&&delete t[k],r.update([{id:n,path:"$references."+i}])},Et={name:"reference",update:(t,e)=>{let o=e.getValue().trim();if(!/^[_$a-z]{1}[_\-$a-z0-9]{0,}$/i.test(o)){gt(t,e),console.warn("Doars: `reference` directive's value not a valid variable name: \""+o+'".');return}let r=t.getLibrary(),n=t.getId(),i=e.getElement(),f=e.getId();t[k]||(t[k]={}),t[k][f]={element:i,name:o},delete t[J],r.update([{id:n,path:"$references."+o}])},destroy:gt};var At="SELECT",xe="checked",yt="selected",vt="checkbox",bt={name:"select",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=r.getAttribute("type");if(r.tagName!==At&&!(r.tagName==="INPUT"&&(n===vt||n==="radio"))){console.warn("Doars: `select` directive must be placed on a `select` tag or `input` of type checkbox or radio.");return}let i=s=>{if(r.tagName===At)for(let l of Array.from(r.options)){let u=Array.isArray(s)?s.includes(l.value):s===l.value;l.selected!==u&&(l.selected=u,u?l.setAttribute(yt,""):l.removeAttribute(yt))}else if(n===vt){let l=s.includes(r.value);r.checked!==l&&(l?r.setAttribute(xe,""):r.removeAttribute(xe))}else{let l=s===r.value;r.checked!==l&&(l?r.setAttribute(xe,""):r.removeAttribute(xe))}},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var xt={name:"show",update:(t,e,{processExpression:o,transitionIn:r,transitionOut:n})=>{let i=e.getElement(),f=()=>{let u=e.getData();u.transition&&u.transition();let p;u.result?(i.style.display=null,p=r(t,i)):p=n(t,i,()=>{i.style.display="none"}),e.setData(Object.assign({},u,{transition:p}))},s=o(t,e,e.getValue()),l=e.getData();L(s)?(e.setData(Object.assign({},l,{result:s})),Promise.resolve(s).then(u=>{e.getData().result===s&&f(u)})):(!l||l.result!==s)&&(e.setData(Object.assign({},l,{result:s})),f())}};var Ct=()=>({createContexts:_e,createContextsProxy:Ht,RevocableProxy:ie}),_e=(t,e,o,r=null)=>{let n=t.getLibrary(),i=n.getSimpleContexts(),f="",s="",l=[],u=n.getContexts(),p=[];for(let g of u){if(!g||!g.name)continue;let d=g.create(t,e,o,Ct());!d||!d.value||(d.destroy&&typeof d.destroy=="function"&&p.push(d.destroy),g.deconstruct&&typeof d.value=="object"&&(l.push(g.name),s+="with("+g.name+") { ",f+=" }"),i[g.name]=d.value)}if(typeof r=="object")for(let g in r)i[g]=r[g];return{contexts:i,destroy:()=>{for(let g of p)g(Ct())},after:f,before:s,deconstructed:l}},Ht=(t,e,o,r=null)=>{let n=null,i=ie({},{get:(f,s)=>{if(n||(n=_e(t,e,o,r)),s in n.contexts)return e.accessed(t.getId(),s),n.contexts[s];if(n.contexts.$state&&s in n.contexts.$state)return e.accessed(t.getId(),"$state"),n.contexts.$state[s]}});return{contexts:i.proxy,destroy:()=>{n&&n.destroy&&n.destroy(t,e),i.revoke()}}},K=(t,e,o=null)=>{let r=[],n=(s,l)=>{r.push({id:s,path:l})},{contexts:i,destroy:f}=_e(t,e,n,o);return[i,()=>{f(),r.length>0&&t.getLibrary().update(r)}]};var Me=(t,e)=>{let o=t,r=0;for(;r<e.length-1;r++)o=o[e[r]];return o[e[r]]};var M=(t,e,o)=>{if(typeof t!="object")return;let r=0;for(;r<e.length-1;r++)if(t=t[e[r]],typeof t!="object")return;t[e[r]]=o};var Nt={name:"sync",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=!e[W];if(n&&!(r.tagName==="DIV"&&r.hasAttribute("contenteditable"))&&r.tagName!=="INPUT"&&r.tagName!=="SELECT"&&r.tagName!=="TEXTAREA"){console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.");return}let i=e.getValue().trim(),f=e.getKey();if(f&&(i="$"+f+"."+i),!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(i)){console.warn("Doars: `sync` directive's value not a valid variable name: \""+i+'".');return}if(i=i.split("."),n){let l;switch(r.tagName){case"DIV":l=()=>{let[u,p]=K(t,e.clone());M(u,i,Z(r.innerText)),p()};break;case"INPUT":l=()=>{let u=e.clone(),p=Z(r.value),[g,d]=K(t,u);if(r.type==="checkbox"){let E=Me(g,i);if(r.checked)E||M(g,i,[p]),E.includes(r.value)||E.push(p);else if(E){let A=E.indexOf(r.value);A>=0&&E.splice(A,1)}}else if(r.type==="radio"){let E=Me(g,i);r.checked?E!==r.value&&M(g,i,p):E===r.value&&M(g,i,null)}else M(g,i,p);d()};break;case"TEXTAREA":l=()=>{let[u,p]=K(t,e.clone());M(u,i,Z(r.innerText)),p()};break;case"SELECT":l=()=>{let[u,p]=K(t,e.clone());if(r.multiple){let g=[];for(let d of r.selectedOptions)g.push(Z(d.value));M(u,i,[g.join("','")])}else M(u,i,Z(r.selectedOptions[0].value));p()};break}r.addEventListener("input",l),e[W]=l}let s=o(t,e,i);switch(r.tagName){case"DIV":case"TEXTAREA":s!==r.innerText&&(r.innerText=s);break;case"INPUT":if(r.type==="checkbox"){let l=s.includes(r.value);r.checked!==l&&(r.checked=l,l?r.setAttribute("checked",""):r.removeAttribute("checked"))}else if(r.type==="radio"){let l=s===r.value;r.checked!==l&&(r.checked=l,l?r.setAttribute("checked",""):r.removeAttribute("checked"))}else s!==r.value&&r.setAttribute("value",s);break;case"SELECT":for(let l of Array.from(r.options)){let u=Array.isArray(s)?s.includes(l.value):s===l.value;l.selected!==u&&(l.selected=u,u?l.setAttribute("selected",""):l.removeAttribute("selected"))}break}},destroy:(t,e)=>{if(!e[W])return;e.getElement().removeEventListener("input",e[W]),delete e[W]}};var Ot={name:"text",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{n.content?r.textContent!==s&&(r.textContent=s):r.innerText!==s&&(r.innerText=s)},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var wt={name:"watch",update:(t,e,{processExpression:o})=>{let r=e.getValue();o(t,e,r,{},{return:!1})}};var re=class extends X{constructor(e){super();let{prefix:o,root:r}=e=Object.assign({prefix:"d",processor:"execute",root:document.body},e);if(typeof r=="string"&&(e.root=r=document.querySelector(r)),!o){console.error("Doars: `prefix` option not set.");return}if(typeof o!="string"){console.error("Doars: `prefix` option must be of type string.");return}if(!r){console.error("Doars: `root` option not set.");return}if(typeof r!="object"){console.error("Doars: `root` option must be a string or HTMLElement.");return}let n=Symbol("ID_DOARS"),i=!1,f=!1,s,l,u,p=[],g={},d=[Je,We,Xe,Ze,tt,rt,ot,st,nt,et],E=[Et,it,lt,ut,dt,Ot,ct,ht,mt,bt,xt,Nt,wt],A,x,N;this.getId=()=>n,this.getOptions=()=>Object.assign({},e),this.getEnabled=()=>i,this.enable=()=>{if(i)return this;f=!1,s=[],u={},this.dispatchEvent("enabling",[this]),i=!0,A=E.map(m=>m.name),x={};for(let m of E)x[m.name]=m;N=new RegExp("^"+o+"-("+A.join("|")+")(?:[$-_.a-z0-9]{0,})?$","i"),l=new MutationObserver(b.bind(this)),l.observe(r,{attributes:!0,childList:!0,subtree:!0});let c=o+"-state",a=o+"-ignore",h=[...r.querySelectorAll("["+c+"]")];for(let m=h.length-1;m>=0;m--)h[m].closest("["+a+"]")&&h.splice(m,1);return w(r.hasAttribute(c)&&!r.hasAttribute(a)?r:null,...h),this.dispatchEvent("enabled",[this]),this.dispatchEvent("updated",[this]),this},this.disable=()=>i?(l.disconnect(),l=null,f=s=u=null,this.dispatchEvent("disabling",[this],{reverse:!0}),y(...p),A=x=N=null,i=!1,this.dispatchEvent("disabled",[this],{reverse:!0}),this):this;let w=(...c)=>{let a=[],h=[];for(let m of c){if(!m||m[S])continue;let C=new le(this,m);p.push(C),a.push(C),h.push(m)}h.length>0&&this.dispatchEvent("components-added",[this,h]);for(let m of a)m.initialize();for(let m of a)m.updateAttributes(m.getAttributes());return a},y=(...c)=>{let a=[];for(let h of c){let m=p.indexOf(h);m<0||(a.push(h.getElement()),h.destroy(),p.splice(m,1))}return a.length>0&&this.dispatchEvent("components-removed",[this,a]),a};this.getSimpleContexts=()=>Object.assign({},g),this.setSimpleContext=(c,a=null)=>a===null?(delete g[c],this.dispatchEvent("simple-context-removed",[this,c]),!0):c.match("^([a-zA-Z_$][a-zA-Zd_$]*)$")?(g[c]=a,this.dispatchEvent("simple-context-added",[this,c,a]),!0):(console.warn('Doars: name of a bind can not start with a "$".'),!1),this.getContexts=()=>[...d],this.addContexts=(c,...a)=>{if(i){console.warn("Doars: Unable to add contexts after being enabled!");return}c<0?c=d.length+c%d.length:c>d.length&&(c=d.length);let h=[];for(let m=0;m<a.length;m++){let C=a[m];d.includes(C)||(d.splice(c+m,0,C),h.push(C))}return h.length>0&&this.dispatchEvent("contexts-added",[this,h]),h},this.removeContexts=(...c)=>{if(i){console.warn("Doars: Unable to remove contexts after being enabled!");return}let a=[];for(let h of c){let m=d.indexOf(h);m<0||(d.slice(m,1),a.push(h))}return a.length>0&&this.dispatchEvent("contexts-removed",[this,a]),a},this.getDirectives=()=>[...E],this.getDirectivesNames=()=>[...A],this.getDirectivesObject=()=>Object.assign({},x),this.isDirectiveName=c=>N.test(c),this.addDirectives=(c,...a)=>{if(i){console.warn("Doars: Unable to add directives after being enabled!");return}c<0?c=E.length+c%E.length:c>E.length&&(c=E.length);let h=[];for(let m=0;m<a.length;m++){let C=a[m];E.includes(C)||(E.splice(c+m,0,C),h.push(C))}return h.length>0&&(A=x=N=null,this.dispatchEvent("directives-added",[this,h])),h},this.removeDirectives=(...c)=>{if(i){console.warn("Doars: Unable to remove directives after being enabled!");return}let a=[];for(let h of c){let m=E.indexOf(h);m<0||(E.slice(m,1),a.push(h))}return a.length>0&&(A=x=N=null,this.dispatchEvent("directives-removed",[this,a])),a},this.update=c=>{if(!!i){if(c)for(let a of c){let{id:h,path:m}=a;if(!(h in u)){u[h]=[m];continue}u[h].includes(m)||u[h].push(m)}if(!f&&Object.getOwnPropertySymbols(u).length!==0){this.dispatchEvent("updating",[this]),f=!0,c=u,u={};for(let a of p)a.update(c);if(f=!1,Object.getOwnPropertySymbols(u).length>0){console.warn("Doars: during an update another update has been triggered. Normally this should not happen unless an expression in one of the directives is modifying a state which could cause a infinite loop!"),window.requestAnimationFrame(()=>this.update());return}if(s.length>0){b();return}this.dispatchEvent("updated",[this])}}};let b=c=>{if(s.push(...c),f||s.length===0)return;f=!0,c=[...s],s=[];let a=o+"-state",h=o+"-ignore",m=[],C=[],R=O=>{if(O.nodeType===1)if(O[S]){C.unshift(O[S]);let I=O.querySelectorAll(a);for(let D of I)D[S]&&C.unshift(D)}else{let I=te(O,D=>D[S]?(C.unshift(D[S]),!1):!0);do if(!!O[P])for(let D of O[P])D.getComponent().removeAttribute(D);while(O=I())}},$=O=>{if(O.nodeType!==1||O.closest("["+h+"]"))return;let D=O.querySelectorAll("["+a+"]");for(let F of D)F.closest("["+h+"]")||m.push(F);if(O.hasAttribute(a)){m.push(O);return}let B=V(O);if(B){let F=B.scanAttributes(O);B.updateAttributes(F)}};for(let O of c)if(O.type==="childList"){for(let I of O.removedNodes)R(I);for(let I of O.addedNodes)$(I)}else if(O.type==="attributes"){let I=O.target;if(O.attributeName===a){if(I[S])continue;let q=V(I);if(q){let Ke=I,_t=te(I,Se=>Se.hasAttribute(a));do for(let Se of Ke[P])q.removeAttribute(Se);while(Ke=_t())}w(I);continue}else if(O.attributeName===h){if(I.hasAttribute(h)){R(I);continue}$(I);continue}if(!N.test(O.attributeName))continue;let D=V(I);if(!D)continue;let B=null;for(let q of I[P])if(q.getName()===O.attributeName){B=q;break}let F=I.getAttribute(O.attributeName);if(!B){F&&D.addAttribute(I,O.attributeName,F);continue}B.setValue(F),D.updateAttribute(B)}if(C.length>0&&y(...C),m.length>0&&w(...m),f=!1,s.length>0){b();return}Object.getOwnPropertySymbols(u).length>0&&this.update()}}};var Kt=[9,10,13,32],$e=40,ue=41,Ce=44,z=46,Rt=58,Be=63,Fe=91,Ye=93,It=125,Tt=["=","||=","&&=","??=","*=","**=","/=","%=","+=","-="],de={"=":1,"||=":1,"&&=":1,"??=":1,"*=":1,"**=":1,"/=":1,"%=":1,"+=":1,"-=":1,"||":2,"&&":3,"??":4,"==":8,"!=":8,"===":8,"!==":8,"<":9,">":9,"<=":9,">=":9,"*":11,"/":11,"%":11,"+":11,"-":11},zt=["-","!","+"],Ne="--",Oe="++",Dt={true:!0,false:!1,null:null,undefined:void 0},oe=t=>t>=48&&t<=57,Ve=t=>se(t)||oe(t),se=t=>t===36||t>=48&&t<=57||t===95||t>=65&&t<=90||t>=97&&t<=122,St=t=>{let e=0,o=()=>(e++,{type:5,elements:r(Ye)}),r=c=>{let a=[],h=!1,m=0;for(;e<t.length;){d();let C=t.charCodeAt(e);if(C===c){if(h=!0,e++,c===ue&&m&&m>=a.length)throw new Error("Unexpected token "+String.fromCharCode(c));break}else if(C===Ce){if(e++,m++,m!==a.length){if(c===ue)throw new Error("Unexpected token ,");if(c===Ye)for(let R=a.length;R<m;R++)a.push(null)}}else{if(a.length!==m&&m!==0)throw new Error("Expected comma");{let R=f();if(!R)throw new Error("Expected comma");a.push(R)}}}if(!h)throw new Error("Expected "+String.fromCharCode(c));return a},n=()=>{let c=x();if(!c)return c;let a=i();if(!a)return c;let h={value:a,precedence:de[a]||0},m=x();if(!m)throw new Error("Expected expression after "+a);let C=[c,h,m],R;for(;a=i();){let O=de[a]||0;if(O===0){e-=a.length;break}h={value:a,precedence:O};let I=a;for(;C.length>2&&C[C.length-2]>O;)m=C.pop(),a=C.pop().value,c=C.pop(),R={type:Tt.indexOf(a)>=0?6:7,operator:a,left:c,right:m},C.push(R);if(R=x(),!R)throw new Error("Expected expression after "+I);C.push(h,R)}let $=C.length-1;for(R=C[$];$>1;)a=C[$-1].value,R={type:Tt.indexOf(a)>=0?6:7,operator:a,left:C[$-2],right:R},$-=2;return R},i=()=>{d();let c=t.substring(e,e+3),a=c.length;for(;a>0;){if(de.hasOwnProperty(c)&&(!se(t.charCodeAt(e))||e+c.length<t.length&&!Ve(t.charCodeAt(e+c.length))))return e+=a,c;c=c.substring(0,--a)}return!1},f=()=>{let c=n();return d(),c=A(c),c},s=c=>{let a=[];for(;e<t.length;){let h=t.charCodeAt(e);if(h===59||h===Ce)e++;else{let m=f();if(m)a.push(m);else if(e<t.length){if(h===c)break;throw new Error('Unexpected "'+t.charAt(e)+'"')}}}return a},l=()=>{let c=t.charCodeAt(e),a=e;if(se(c))e++;else throw new Error("Unexpected "+t.charAt(e));for(;e<t.length&&(c=t.charCodeAt(e),Ve(c));)e++;return{type:2,name:t.slice(a,e)}},u=()=>{let c="";for(;oe(t.charCodeAt(e));)c+=t.charAt(e++);if(t.charCodeAt(e)===z)for(c+=t.charAt(e++);oe(t.charCodeAt(e));)c+=t.charAt(e++);let a=t.charAt(e);if(a==="e"||a==="E"){for(c+=t.charAt(e++),a=t.charAt(e),(a==="+"||a==="-")&&(c+=t.charAt(e++));oe(t.charCodeAt(e));)c+=t.charAt(e++);if(!oe(t.charCodeAt(e-1)))throw new Error("Expected exponent ("+c+t.charAt(e)+")")}let h=t.charCodeAt(e);if(se(h))throw new Error("Variable names cannot start with a number ("+c+t.charAt(e)+")");if(h===z||c.length===1&&c.charCodeAt(0)===z)throw new Error("Unexpected period");return{type:3,value:parseFloat(c)}},p=()=>{if(t.charCodeAt(e)!==123)return;e++;let c=[];for(;!isNaN(t.charCodeAt(e));){if(d(),t.charCodeAt(e)===It)return e++,N({type:11,properties:c});let a=x();if(!a)throw new Error("Missing }");if(d(),a.type===2&&(t.charCodeAt(e)===Ce||t.charCodeAt(e)===It))c.push({type:4,computed:!1,key:a,value:a,shorthand:!0});else if(t.charCodeAt(e)===Rt){e++,d();let h=f();if(!h)throw new Error("Unexpected object property");let m=a.type===5;c.push({computed:m,key:m?a.elements[0]:a,shorthand:!1,type:4,value:h}),d()}else a&&c.push(a);t.charCodeAt(e)===Ce&&e++}throw new Error("Missing }")},g=()=>{e++;let c=s(ue);if(t.charCodeAt(e)===ue)return e++,c.length===1?c[0]:c.length?{type:12,expressions:c}:!1;throw new Error("Unclosed (")},d=()=>{for(;Kt.indexOf(t.charCodeAt(e))>=0;)e++},E=()=>{let c="",a=t.charAt(e++),h=!1;for(;e<t.length;){let m=t.charAt(e++);if(m===a){h=!0;break}if(m==="\\")switch(m=t.charAt(e++),m){case"n":c+=`
`;break;case"r":c+="\r";break;case"t":c+="	";break;case"b":c+="\b";break;case"f":c+="\f";break;case"v":c+="\v";break;default:c+=m}else c+=m}if(!h)throw new Error('Unclosed quote after "'+c+'"');return{type:3,value:c}},A=c=>{if(!c||t.charCodeAt(e)!==Be)return c;e++;let a=f();if(!a)throw new Error("Expected expression");if(d(),!t.charCodeAt(e)===Rt)throw new Error("Expected :");e++;let h=f();if(!h)throw new Error("Expected expression");let m={type:9,condition:c,consequent:a,alternate:h};if(c.operator&&de[c.operator]<=1){let C=c;for(;C.right.operator&&de[C.right.operator]<=1;)C=C.right;m.condition=C.right,C.right=m,m=c}return m},x=()=>{let c=p()||w();if(c)return y(c);d();let a=t.charCodeAt(e);if(oe(a)||a===z)return u();if(a===34||a===39)c=E();else if(a===Fe)c=o();else{let h=t.substring(e,e+1),m=h.length;for(;m>0;){if(zt.indexOf(h)>=0&&(!se(t.charCodeAt(e))||e+h.length<t.length&&!Ve(t.charCodeAt(e+h.length)))){e+=m;let C=x();if(!C)throw new Error("Missing unary operation parameter");return y({type:13,operator:h,parameter:C})}h=h.substr(0,--m)}se(a)?(c=l(),Dt.hasOwnProperty(c.name)&&(c={type:3,value:Dt[c.name]})):a===$e&&(c=g())}return y(N(c))},N=c=>{d();let a=t.charCodeAt(e);for(;a===z||a===Fe||a===$e||a===Be;){let h;if(a===Be){if(t.charCodeAt(e+1)!==z)break;h=!0,e+=2,d(),a=t.charCodeAt(e)}if(e++,a===Fe){if(c={type:10,computed:!0,object:c,property:f()},d(),a=t.charCodeAt(e),a!==Ye)throw new Error("Unclosed [");e++}else a===$e?c={type:8,parameters:r(ue),callee:c}:(a===z||h)&&(h&&e--,d(),c={type:10,computed:!1,object:c,property:l()});h&&(c.optional=!0),d(),a=t.charCodeAt(e)}return c},w=()=>{if(e+1>=t.length)return;let c=t.substring(e,e+2),a=null;if(c===Ne)a=Ne;else if(c===Oe)a=Oe;else return;e+=2;let h={type:14,operator:a,parameter:N(l()),prefix:!0};if(!h.parameter||h.parameter.type!==2&&h.parameter.type!==10)throw new Error("Unexpected "+env.node.operator);return h},y=c=>{if(!c||e+1>=t.length)return c;let a=t.substring(e,e+2),h=null;if(a===Ne)h=Ne;else if(a===Oe)h=Oe;else return c;return e+=2,c={type:14,operator:h,parameter:c,prefix:!1},c},b=s();return b.length===0?void 0:b};var Lt=(t,e,o={})=>{switch(t.type){case 2:return o[t.name]=e;case 10:let r=T(t.object,o),n=t.computed||t.property.type!==2?T(t.property,o):t.property.name;return typeof e=="function"?e.bind(r):r[n]=e}throw new Error("Unsupported assignment method.")},T=(t,e={})=>{if(!!t){if(Array.isArray(t))return t.map(o=>T(o,e));switch(t.type){case 2:return e[t.name];case 3:return t.value;case 5:let o=[];for(let E of t.elements)o.push(T(E,e));return o;case 6:let r=T(t.right,e);if(t.operator!=="="){let E=T(t.left,e);switch(t.operator){case"||=":if(E)return E;break;case"&&=":if(!E)return E;break;case"??=":if(E!=null)return E;break;case"*=":r=E*r;break;case"**=":r=E**r;break;case"/=":r=E/r;break;case"%=":r=E%r;break;case"+=":r=E+r;break;case"-=":r=E-r;break}}return Lt(t.left,r,e);case 7:let n=T(t.left,e),i=T(t.right,e);switch(t.operator){case"||":return n||i;case"&&":return n&&i;case"??":return n??i;case"==":return n==i;case"!=":return n!=i;case"===":return n===i;case"!==":return n!==i;case"<":return n<i;case">":return n>i;case"<=":return n<=i;case">=":return n>=i;case"-":return n-i;case"+":return n+i;case"*":return n*i;case"/":return n/i;case"%":return n%i}throw new Error("Unsupported operator: "+t.operator);case 8:let f=[];for(let E of t.parameters)f.push(T(E,e));return T(t.callee,e)(...f);case 9:return T(t.condition,e)?T(t.consequent,e):T(t.alternate,e);case 10:let s=T(t.object,e),l=t.computed||t.property.type!==2?T(t.property,e):t.property.name;return typeof s[l]=="function"?s[l].bind(s):s[l];case 11:let u={};for(let E of t.properties)u[E.computed||E.key.type!==2?T(E.key,e):E.key.name]=T(E.value,e);return u;case 12:return t.expressions.map(E=>T(E,e));case 13:let p=T(t.parameter,e);switch(t.operator){case"!":return!p;case"-":return-p;case"+":return+p}throw new Error("Unsupported operator: "+t.operator);case 14:let g=T(t.parameter,e),d=t.operator==="--"?-1:1;return Lt(t.parameter,g+d,e),t.prefix?g+d:g}throw new Error('Unexpected node type "'+t.type+'".')}},kt=T;var Pt=St,Ut=kt;var jt=(t,e,o,r=null,n=null)=>{n=Object.assign({return:!0},n);let[i,f]=K(t,e,r),s;try{let l=Pt(o);if(n.return&&l&&l.length>1)throw new Error('Unable to return a single value from a compound expression of: "'+o+'".');s=Ut(l,i)}catch(l){console.error("ExpressionError in:",o,`
`+l.name+": "+l.message),s=null}if(f(),n.return&&s)return s=s[0],s};re.interpretExpression=jt;var cs=re;export{cs as default};
//# sourceMappingURL=doars-interpret.esm.min.js.map
