var P=Symbol("ATTRIBUTES"),S=Symbol("COMPONENT"),Q=Symbol("FOR"),_=Symbol("INITIALIZED"),A=Symbol("ON"),k=Symbol("REFERENCES"),J=Symbol("REFERENCES_CACHE"),W=Symbol("SYNC");var Le=class{constructor(){let e={};this.addEventListener=(o,r,n=null)=>{o in e||(e[o]=[]),e[o].push({callback:r,options:n})},this.removeEventListener=(o,r)=>{if(!Object.keys(e).includes(o))return;let n=e[o],i=-1;for(let f=0;f<n.length;f++)if(n[f].callback===r){i=f;break}i<0||(n.splice(i,1),Object.keys(n).length===0&&delete e[o])},this.removeEventListeners=o=>{!o||delete e[o]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(o,r,n=null)=>{if(!e[o])return;let i=e[o];for(let f=0;f<i.length;f++){let s=n&&n.reverse?i[i.length-(f+1)]:i[f];s.options&&s.options.once&&i.splice(f,1),s.callback(...r)}}}},X=Le;var Z=t=>t.replace(/\\/g,"\\\\").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\n/g,"\\n"),Mt=t=>t.replace(/-(\w)/g,(e,o)=>o.toUpperCase()),ze=t=>{let e={};for(let o of t){let r=o.indexOf("-");if(r<0){e[o]=!0;continue}if(r===0){e[o.substring(1)]=!1;continue}let n=o.substring(0,r),i=o.substring(r+1),f=i,s;if(i.endsWith("ms")?f=i.substring(-2):i.endsWith("s")?(s="s",f=i.substring(-1)):i.endsWith("m")?(s="m",f=i.substring(-1)):i.endsWith("h")&&(s="h",f=i.substring(-1)),f=Number.parseInt(f),!isNaN(f))switch(i=f,s){case"h":i*=60;case"m":i*=60;case"s":i*=1e3;break}e[n]=i}return e},Ge=(t,e)=>{if(e=e.match(new RegExp("^"+t+"-([a-z][0-9a-z-]{1,}):?([a-z][0-9a-z-]*)?(\\..*]*)?$","i")),!e)return;let[o,r,n,i]=e;n=n!==""?n:null;let f=n?Mt(n):null;return i=i?i.substring(1).split("."):[],[r,n,f,i]},qe=t=>{let e=t.match(/^([$_a-z0-9,(){}\s]{1,}?)\s+(?:in|of)\s+([\s\S]{1,})$/i);if(!e)return;let o=e[1].replace(/^[\s({]*|[)}\s]*$/g,"");if(o=o.match(/^([$_a-z0-9]{1,})?(?:,\s+?)?([$_a-z0-9]{1,})?(?:,\s+)?([$_a-z0-9]{1,})?$/i),!!o)return o.shift(),{iterable:e[2].trim(),variables:[...o]}},ee=t=>{if(typeof t=="string"&&(t=t.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(t)){console.error("Doars: parseSelector expects Array of string or a single string.");return}let e={};for(let o of t)switch(o=o.trim(),o[0]){case"#":e.id=o.substring(1);break;case".":o=o.substring(1),e.class||(e.class=[]),e.class.includes(o)||e.class.push(o);break;case"[":let[r,n,i]=o.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);e[n]=i;break}return e};var V=class extends X{constructor(e,o,r,n,i=!1){super();let f=Symbol("ID_ATTRIBUTE");i||(o[P]||(o[P]=[]),o[P].push(this));let s={},l=null,u,h,g,d,E;if(r){let[y,x,N,w]=Ge(e.getLibrary().getOptions().prefix,r);u=y,h=N,g=x,d=w,w&&(E=ze(w))}this.getComponent=()=>e,this.getElement=()=>o,this.getId=()=>f,this.getDirective=()=>u,this.getKey=()=>h,this.getKeyRaw=()=>g,this.getModifiers=()=>Object.assign({},E),this.getModifiersRaw=()=>d,this.getName=()=>r,this.getValue=()=>n,this.setValue=y=>{n=y,this.dispatchEvent("changed",[this])},this.clearData=()=>{l=null},this.hasData=()=>l!==null,this.getData=()=>l,this.setData=y=>{l=y},this.destroy=()=>{this.setData(null),this.clearAccessed();let y=o[P].indexOf(this);y>=0&&o[P].splice(y,1),this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.accessed=(y,x)=>{if(!s[y])s[y]=[];else if(s[y].includes(x))return;s[y].push(x),this.dispatchEvent("accessed",[this,y,x])},this.clearAccessed=()=>{s={}},this.hasAccessed=(y,x)=>{if(!(y in s))return!1;let N=s[y];for(let w of x)if(N.includes(w))return!0;return!1},this.clone=()=>new V(e,o,r,n,!0)}};var $t=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],ie=(t,e)=>{let o=!1,r={};for(let n of $t)r[n]=(...i)=>{if(o){console.error("illegal operation attempted on a revoked proxy");return}return n in e?e[n](...i):Reflect[n](...i)};return{proxy:new Proxy(t,r),revoke:()=>{o=!0}}};var ke=class extends X{constructor(e={}){super(),e=Object.assign({delete:!0,get:!0,set:!0},e);let o=new WeakMap;this.add=(r,n=[])=>{if(o.has(r))return o.get(r);for(let s in r)r[s]&&typeof r[s]=="object"&&(r[s]=this.add(r[s],[...n,s]));let i={};e.delete&&(i.deleteProperty=(s,l)=>{if(!Reflect.has(s,l))return!0;this.remove(s,l);let u=Reflect.deleteProperty(s,l);return u&&this.dispatchEvent("delete",[s,Array.isArray(s)?[...n]:[...n,l]]),u}),e.get&&(i.get=(s,l,u)=>(l!==Symbol.unscopables&&this.dispatchEvent("get",[s,[...n,l],u]),Reflect.get(s,l,u))),e.set&&(i.set=(s,l,u,h)=>(s[l]===u||(typeof u=="object"&&(u=this.add(u,[...n,l])),s[l]=u,this.dispatchEvent("set",[s,Array.isArray(s)?[...n]:[...n,l],u,h])),!0));let f=ie(r,i);return o.set(f,r),f.proxy},this.remove=r=>{if(!o.has(r))return;let n=o.get(r);o.delete(n);for(let i in n.proxy)typeof n.proxy[i]=="object"&&this.remove(n.proxy[i]);n.revoke()}}},Qe=ke;var Y=t=>{if(!!t.parentElement)return t=t.parentElement,t[S]?t[S]:Y(t)};var Ee=(t,e)=>{for(let o in e){if(o==="class"){for(let r of e.class)t.classList.add(r);continue}t.setAttribute(o,e[o])}};var H=(t,e)=>{for(let o in e){if(o==="class"){for(let r of e.class)t.classList.remove(r);continue}e[o]&&t.attributes[o]!==e[o]||t.removeAttribute(o)}},Pe=(t,e,o)=>{if(e==="value"&&t.tagName==="INPUT"){if(o||(o=""),t.getAttribute(e)===o)return;t.setAttribute(e,o);return}if(e==="checked"&&(t.type==="checkbox"||t.type==="radio")){t.checked=!!o;return}e==="class"&&(Array.isArray(o)?o=o.join(" "):typeof o=="object"&&(o=Object.entries(o).filter(([r,n])=>n).map(([r])=>r).join(" "))),e==="style"&&(Array.isArray(o)?o=o.join(" "):typeof o=="object"&&(o=Object.entries(o).map(([r,n])=>r+":"+n).join(";"))),o===!1||o===null||o===void 0?t.removeAttribute(e):t.setAttribute(e,o)},Ue=(t,e)=>{for(let o in e)Pe(t,o,e[o])};var Bt="-transition:",ye=(t,e,o,r=null)=>{if(o.nodeType!==1){r&&r();return}let{prefix:n}=e.getLibrary().getOptions(),i=n+Bt+t,f=E=>{o.dispatchEvent(new CustomEvent("transition-"+E)),o.dispatchEvent(new CustomEvent("transition-"+t+"-"+E))},s,l,u,h,g=!1,d={};return s=i,l=o.getAttribute(s),l&&(d.during=ee(l),Ee(o,d.during)),s=i+".from",l=o.getAttribute(s),l&&(d.from=ee(l),Ee(o,d.from)),f("start"),h=requestAnimationFrame(()=>{if(h=null,g)return;if(d.from&&(H(o,d.from),d.from=void 0),s=i+".to",l=o.getAttribute(s),l)d.to=ee(l),Ee(o,d.to);else if(!d.during){f("end"),r&&r(),g=!0;return}let E=getComputedStyle(o),y=Number(E.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;y===0&&(y=Number(E.animationDuration.replace("s",""))*1e3),u=setTimeout(()=>{u=null,!g&&(d.during&&(H(o,d.during),d.during=void 0),d.to&&(H(o,d.to),d.to=void 0),f("end"),r&&r(),g=!0)},y)}),()=>{!g||(g=!0,d.during&&(H(o,d.during),d.during=void 0),d.from?(H(o,d.from),d.from=void 0):d.to&&(H(o,d.to),d.to=void 0),h?(cancelAnimationFrame(h),h=null):u&&(clearTimeout(u),u=null),f("end"),r&&r())}},ve=(t,e,o)=>ye("in",t,e,o),ce=(t,e,o)=>ye("out",t,e,o);var ae=(t,e)=>{t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)};var te=(t,e)=>{let o=-1,r=null;return()=>{if(o>=0&&r){let i=r();if(i)return i}let n=null;do{if(o++,o>=t.childElementCount)return null;n=t.children[o]}while(!e(n));return n.childElementCount&&(r=te(n,e)),n}};var le=class{constructor(e,o){let r=Symbol("ID_COMPONENT"),{prefix:n,processor:i}=e.getOptions(),f=typeof i,s;f==="function"?s=i:f==="string"&&e.constructor[i+"Expression"]?s=e.constructor[i+"Expression"]:(console.warn("Doars: Expression processor not found. Using fallback instead."),s=e.constructor.executeExpression??e.constructor.interpretExpression??e.constructor.callExpression),s||console.error("Doars: No expression processor available. Process option: ",process);let l=Object.freeze({processExpression:s,transition:ye,transitionIn:ve,transitionOut:ce}),u=[],h=!1,g=!1,d,E,y;if(!o.attributes[n+"-state"]){console.error("Doars: element given to component does not contain a state attribute!");return}o[S]=this;let x=[],N=Y(o);N&&(N.getChildren().includes(this)||(N.getChildren().push(this),e.update([{id:N.getId(),path:"children"}]))),this.getAttributes=()=>u,this.getChildren=()=>x,this.getElement=()=>o,this.getId=()=>r,this.getLibrary=()=>e,this.getParent=()=>N,this.getProxy=()=>E,this.getState=()=>y,this.setParent=v=>{N=v},this.initialize=()=>{if(g)return;g=!0;let v=n+"-state",b=o.attributes[v].value;if(d=b?s(this,new V(this,o,null,b),b):{},d===null)d={};else if(typeof d!="object"||Array.isArray(d)){console.error("Doars: component tag must return an object!");return}E=new Qe,y=E.add(d),this.scanAttributes(o)},this.destroy=()=>{if(!g)return;if(u.length>0){let b=e.getDirectivesObject();for(let c in b)b[c].destroy||(b[c]=void 0);for(let c of u){let a=b[c.getKey()];a&&a.destroy(this,c,l),c.destroy()}}delete o[S],u=[],g=!1,E.remove(d),y=null,E=null,d=null;let v=[];if(x.length>0){for(let b of x)b.setParent(N),v.push({id:b.getId(),path:"parent"});v.push({id:r,path:"children"})}N&&(x.length>0&&(N.getChildren().push(...x),v.push({id:N.getId(),path:"children"})),v.push({id:r,path:"parent"})),v.length>0&&e.update(v),w("destroyed",{element:o,id:r})},this.addAttribute=(v,b,c)=>{let a=e.getDirectivesNames(),p=new V(this,v,b,c),m=p.length,C=a.indexOf(p.getDirective());for(let R=u.length-1;R>=0;R--)if(a.indexOf(u[R].getDirective())<=C){m=R+1;break}return u.splice(m,0,p),p},this.removeAttribute=v=>{let b=u.indexOf(v);if(b<0)return;let a=e.getDirectivesObject[v.getKey()];a&&a.destroy&&a.destroy(this,v,l),u.splice(b,1),v.destroy()},this.scanAttributes=v=>{let b=n+"-state",c=n+"-ignore",a=[],p=te(v,m=>!m.hasAttribute(b)&&!m.hasAttribute(c));do for(let{name:m,value:C}of v.attributes)e.isDirectiveName(m)&&a.push(this.addAttribute(v,m,C));while(v=p());return a},this.updateAttribute=v=>{if(!v.getElement()||v.getValue()===null||v.getValue()===void 0){this.removeAttribute(v);return}let b=e.getDirectivesObject();v.clearAccessed();let c=b[v.getDirective()];c&&c.update(this,v,l)},this.updateAttributes=v=>{if(!g||v.length<=0){h||(h=!0,w("updated",{attributes:v,element:o,id:r}));return}for(let b of v)this.updateAttribute(b);h=!0,w("updated",{attributes:v,element:o,id:r})},this.update=v=>{if(!g)return;let b=Object.getOwnPropertySymbols(v),c=[];for(let a of u)for(let p of b)a.hasAccessed(p,v[p])&&(this.updateAttribute(a),c.push(a));(!h||c.length>0)&&(h=!0,w("updated",{attributes:c,element:o,id:r}))};let w=(v,b)=>{o.dispatchEvent(new CustomEvent(n+"-"+v,{detail:b,bubbles:!0}))}}};var Je={name:"$children",create:(t,e,o,{createContextsProxy:r,RevocableProxy:n})=>{let i,f=n(t.getChildren(),{get:(s,l,u)=>{if(i||(i=s.map(g=>r(g,e,o)),e.accessed(t.getId(),"children")),isNaN(l))return Reflect.get(i,l,u);let h=Reflect.get(i,l,u);if(h)return h.contexts}});return{value:f.proxy,destroy:()=>{i&&i.forEach(s=>s.destroy()),f.revoke()}}}};var We={name:"$component",create:t=>({value:t.getElement()})};var Xe={name:"$element",create:(t,e)=>({value:e.getElement()})};var Ze={name:"$dispatch",create:t=>({value:(e,o={})=>{t.getElement().dispatchEvent(new CustomEvent(e,{detail:o,bubbles:!0}))}})};var et={deconstruct:!0,name:"$for",create:(t,e,o,{RevocableProxy:r})=>{if(t!==e.getComponent())return;let n=e.getElement(),i=t.getElement(),f=[],s={};for(;n&&!n.isSameNode(i);){let u=n[Q];if(u){f.push(u);for(let h in u.variables)s[h]=u.variables[h]}n=n.parentNode}if(f.length===0)return;let l=r(s,{get:(u,h)=>{for(let g of f)if(h in g.variables)return e.accessed(g.id,"$for"),g.variables[h]}});return{value:l.proxy,destroy:()=>{l.revoke()}}}};var tt={name:"$inContext",create:(t,e,o,{createContexts:r})=>({value:n=>{let i=[],f=(h,g)=>{i.push({id:h,path:g})},{contexts:s,destroy:l}=r(t,e,f,{}),u=n(s);return l(),i.length>0&&t.getLibrary().update(i),u}})};var rt={name:"$nextTick",create:(t,e,o,{createContexts:r})=>{let n,i=!1,f=()=>{if(i)return;i=!0;let s=t.getLibrary();n=[];let l=()=>{u();let{contexts:h,destroy:g}=r(t,e,o,{});for(let d of n)d(h);g()},u=()=>{s.removeEventListener("updated",l),e.removeEventListener("changed",u),e.removeEventListener("destroyed",u)};s.addEventListener("updated",l),e.addEventListener("changed",u),e.addEventListener("destroyed",u)};return{value:s=>{f(),n.push(s)}}}};var ot={name:"$parent",create:(t,e,o,{createContextsProxy:r})=>{let n=t.getParent();if(!n)return{key:"$parent",value:null};let{contexts:i,destroy:f}=r(n,e,o);return{value:i,destroy:f}}};var st={name:"$references",create:(t,e,o,{RevocableProxy:r})=>{if(!t[k])return{key:"$references",value:[]};let n=t[J];if(!n){let f=t[k],s=Object.getOwnPropertySymbols(f);n={};for(let l of s){let{element:u,name:h}=f[l];n[h]=u}t[J]=n}let i=r(n,{get:(f,s,l)=>(e.accessed(t.getId(),"$references."+s),Reflect.get(f,s,l))});return{value:i.proxy,destroy:()=>{i.revoke()}}}};var nt={deconstruct:!0,name:"$state",create:(t,e,o,{RevocableProxy:r})=>{let n=t.getProxy(),i=t.getState();if(!n||!i)return;let f=(h,g)=>o(t.getId(),"$state."+g.join(".")),s=(h,g)=>e.accessed(t.getId(),"$state."+g.join(".")),l=(h,g)=>o(t.getId(),"$state."+g.join("."));n.addEventListener("delete",f),n.addEventListener("get",s),n.addEventListener("set",l);let u=r(i,{});return{value:u.proxy,destroy:()=>{n.removeEventListener("delete",f),n.removeEventListener("get",s),n.removeEventListener("set",l),u.revoke()}}}};var Tr=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var L=t=>t&&Object.prototype.toString.call(t)==="[object Promise]";var it={name:"attribute",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{if(n.selector){if(typeof s!="string"){console.error("Doars: Value returned to attribute directive must be a string if the selector modifier is set.");return}s=ee(s),Ue(r,s);return}let l=e.getKeyRaw();if(!l){typeof s=="object"&&!Array.isArray(s)?Ue(r,s):console.error("Doars: Value returned to attribute directive of invalid type.");return}Pe(r,l,s)},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var ct={name:"cloak",update:function(t,e,{transitionIn:o}){let r=e.getElement();r.removeAttribute(t.getLibrary().getOptions().prefix+"-"+this.name),o(t,r)}};var Ae=(t,...e)=>{let o={};for(let r=0;r<e.length&&!(r>=t.length);r++)o[t[r]]=e[r];return o},at=(t,e,o=-1)=>(o++,o>=t.length?-1:t[o][Q].value===e?o:at(t,e,o)),be=(t,e,o,r,n,i,f)=>{let s=at(r,i,n);if(s>=0){if(s===n+1)return;let h=r[s];ae(r[n]?r[n]:o,h),e(h[Q].id);return}let l=document.importNode(o.content,!0),u=n===-1?o:r[n];ae(u,l),l=u.nextElementSibling,ve(t,l),l[Q]={id:Symbol("ID_FOR"),value:i,variables:f},r.splice(n+1,0,l)},je=(t,e,o)=>{if(!(e.length<o))for(let r=e.length-1;r>=o;r--){let n=e[r];e.splice(r,1),ce(t,n,()=>{n.remove()})}},lt={name:"for",update:(t,e,{processExpression:o})=>{let r=e.getElement();if(r.tagName!=="TEMPLATE"){console.warn("Doars: `for` directive must be placed on a `<template>` tag.");return}let n=qe(e.getValue());if(!n){console.error("Doars: Error in `for` expression: ",e.getValue());return}let i={},f=h=>{i[h]||(i[h]=["$for"])},s=h=>{let g=e.getData(),d=g.elements?g.elements:[],E=typeof h;if(h!=null)if(E==="number"){for(let y=0;y<h;y++){let x=Ae(n.variables,y);be(t,f,r,d,y-1,h,x)}je(t,d,h)}else if(E==="string"){for(let y=0;y<h.length;y++){let x=h[y],N=Ae(n.variables,x,y);be(t,f,r,d,y-1,x,N)}je(t,d,h.length)}else{let y,x;try{let N=[...h];y=!0,x=N.length}catch{}if(y)for(let N=0;N<x;N++){let w=h[N],v=Ae(n.variables,w,N);be(t,f,r,d,N-1,w,v)}else{let N=Object.keys(h);x=N.length;for(let w=0;w<x;w++){let v=N[w],b=h[v],c=Ae(n.variables,v,b,w);be(t,f,r,d,w-1,b,c)}}je(t,d,x)}Object.getOwnPropertySymbols(i).length>0&&t.update(i),e.setData(Object.assign({},g,{elements:d}))},l;isNaN(n.iterable)?l=o(t,e,n.iterable):l=Number(n.iterable);let u=e.getData();e.setData(Object.assign({},u,{result:l})),L(l)?Promise.resolve(l).then(h=>{e.getData().result===l&&s(h)}):s(l)},destroy:(t,e)=>{let o=e.getData();if(o.elements)for(let r of o.elements)ce(t,r,()=>{r.remove()})}};var Ft={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},Vt=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var ft=t=>typeof t!="string"?t:t.replaceAll(Vt,e=>Ft[e]);var ut={name:"html",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{if(n.decode&&typeof s=="string"&&(s=ft(s)),s instanceof HTMLElement){for(let l of r.children)l.remove();r.appendChild(s.cloneNode(!0));return}if(typeof s=="string"){r.innerHTML!==s&&(r.innerHTML=s);return}console.error("Doars/directives/html: Unknown type returned to directive!")},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var dt={name:"if",update:(t,e,{processExpression:o,transitionIn:r,transitionOut:n})=>{let i=e.getElement();if(i.tagName!=="TEMPLATE"){console.warn("Doars: `if` directive must be placed on a `<template>` tag.");return}if(i.childCount>1){console.warn("Doars: `if` directive must have a single child node.");return}let f=u=>{let h=e.getData(),g=h.element,d=h.transition;u?g||(d&&d(),g=document.importNode(i.content,!0),ae(i,g),g=i.nextElementSibling,d=r(t,g)):g&&(d&&d(),d=n(t,g,()=>{g.remove()})),e.setData(Object.assign({},h,{element:g,transition:d}))},s=o(t,e,e.getValue()),l=e.getData();e.setData(Object.assign({},l,{result:s})),L(s)?Promise.resolve(s).then(u=>{e.getData().result===u&&f(u)}):f(s)},destroy:(t,e,{transitionOut:o})=>{let r=e.getData();r.element&&o(t,r.element,()=>{r.element.remove()})}};var pt=(t,e)=>{if(!e[_])return;let o=t.getElement(),r=t.getLibrary().getOptions().prefix+"-updated";o.removeEventListener(r,e[_].handler),delete e[_]},ht={name:"initialized",update:(t,e,{processExpression:o})=>{let r=t.getElement(),n=e.getValue(),i=t.getLibrary().getOptions().prefix+"-updated";if(e[_]){if(e[_].value===n)return;r.removeEventListener(i,e[_].handler),delete e[_]}let f=({detail:s})=>{s.element===r&&(o(t,e.clone(),n,{},{return:!1}),pt(t,e))};r.addEventListener(i,f,{once:!0}),e[_]={handler:f,value:n}},destroy:pt};var fe={keydown:"keyup",mousedown:"mouseup",pointerdown:"pointerup"},U={NONE:0,BUFFER:1,DEBOUNCE:2,HELD:3,HOLD:4,THROTTLE:5},Yt=["alt","ctrl","meta","shift"],mt={name:"on",update:(t,e,{processExpression:o})=>{let r=e.getKeyRaw();if(!r){console.warn("Doars: `on` directive must have a key.");return}let n;r.startsWith("keydown-")?(n=r.substring(8).toLowerCase(),r="keydown"):r.startsWith("keyup-")&&(n=r.substring(6).toLowerCase(),r="keyup");let i=e.getElement(),f=e.getValue();if(e[A]){if(e[A].value===f)return;e[A].target.removeEventListener(r,e[A].handler),e[A].timeout&&clearTimeout(e[A].timeout),delete e[A]}let s=e.getModifiers(),l={};s.capture&&(l.capture=!0),s.once&&(l.once=!0),s.passive&&(l.passive=!0);let u=U.NONE;s.buffer?(u=U.BUFFER,s.buffer===!0&&(s.buffer=5)):s.debounce?(u=U.DEBOUNCE,s.debounce===!0&&(s.debounce=500)):s.held?(u=U.HELD,s.held===!0&&(s.held=500)):s.hold?(u=U.HOLD,s.hold===!0&&(s.hold=500)):s.throttle&&(u=U.THROTTLE,s.throttle===!0&&(s.throttle=500));let h=[];if(n){s.meta=s.meta?!0:s.cmd||s.super;for(let E of Yt)s[E]&&h.push(E)}let g=i;s.document||s.outside?g=document:s.window&&(g=window);let d=E=>{if(e[A].prevent||!s.repeat&&E.repeat||s.self&&E.target!==i||s.outside&&i.contains(E.target))return;if((r==="keydown"||r==="keyup")&&n){for(let N of h)if(!E[N+"Key"])return;let x=s.code?E.code:E.key;if(x===" "&&(x="space"),x=x.toLowerCase(),x!==n)return}s.prevent&&E.preventDefault(),s.stop&&E.stopPropagation();let y=()=>{o(t,e.clone(),f,{$event:E,$events:e[A].buffer},{return:!1}),e[A].buffer=[]};switch(e[A].buffer.push(E),u){case U.BUFFER:if(e[A].buffer.length<s.buffer)return;y();return;case U.DEBOUNCE:e[A].timeout&&(clearTimeout(e[A].timeout),e[A].timeout=null),e[A].timeout=setTimeout(y,s.debounce);return;case U.HELD:if(!(r in fe)){console.warn('Doars: `on` directive, event of name "'+r+'" is not cancelable and can not have "held" modifier.');return}let x=fe[r],N=window.performance.now();e[A].cancel=b=>{if(window.performance.now()-N<s.held){e[A].prevent=!1;return}if(x==="keyup"&&n){for(let a of h)if(!b[a+"Key"]){e[A].prevent=!1;return}let c=s.code?b.code:b.key;if(c===" "&&(c="space"),c=c.toLowerCase(),c!==n){e[A].prevent=!1;return}}if(s.self&&b.target!==i){e[A].prevent=!1;return}if(s.outside&&i.contains(b.target)){e[A].prevent=!1;return}y()},e[A].prevent=!0,g.addEventListener(x,e[A].cancel,{once:!0});return;case U.HOLD:if(!(r in fe)){console.warn('Doars: `on` directive, event of name "'+r+'" is not cancelable and can not have "hold" modifier.');return}let w=fe[r];e[A].cancel=b=>{if(w==="keyup"&&n){let c=!1;for(let p of h)b[p+"Key"]||(c=!0);let a=s.code?b.code:b.key;if(a===" "&&(a="space"),a=a.toLowerCase(),a===n&&(c=!0),!c){e[A].prevent=!1;return}}if(s.self&&b.target!==i){e[A].prevent=!1;return}if(s.outside&&i.contains(b.target)){e[A].prevent=!1;return}clearTimeout(e[A].timeout)},g.addEventListener(w,e[A].cancel,{once:!0}),e[A].prevent=!0,e[A].timeout=setTimeout(()=>{g.removeEventListener(w,e[A].cancel),e[A].prevent=!1,y()},s.hold);return;case U.THROTTLE:let v=window.performance.now();if(e[A].lastExecution&&v-e[A].lastExecution<s.throttle)return;y(),e[A].lastExecution=v;return}y()};g.addEventListener(r,d,l),e[A]={buffer:[],handler:d,target:g,timeout:e[A]?e[A].timeout:void 0,value:f,prevent:!1}},destroy:(t,e)=>{if(!e[A])return;let o=e.getKeyRaw();e[A].target.removeEventListener(o,e[A].handler),e[A].cancel&&e[A].target.removeEventListener(fe[o],e[A].cancel),e[A].timeout&&clearTimeout(e[A].timeout),delete e[A]}};var gt=(t,e)=>{if(!t[k])return;let o=e.getId();if(!t[k][o])return;let r=t.getLibrary(),n=t.getId(),i=e.getValue().trim();delete t[k][o],delete t[J],Object.keys(t[k]).length===0&&delete t[k],r.update([{id:n,path:"$references."+i}])},Et={name:"reference",update:(t,e)=>{let o=e.getValue().trim();if(!/^[_$a-z]{1}[_\-$a-z0-9]{0,}$/i.test(o)){gt(t,e),console.warn("Doars: `reference` directive's value not a valid variable name: \""+o+'".');return}let r=t.getLibrary(),n=t.getId(),i=e.getElement(),f=e.getId();t[k]||(t[k]={}),t[k][f]={element:i,name:o},delete t[J],r.update([{id:n,path:"$references."+o}])},destroy:gt};var yt="SELECT",xe="checked",vt="selected",At="checkbox",bt={name:"select",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=r.getAttribute("type");if(r.tagName!==yt&&!(r.tagName==="INPUT"&&(n===At||n==="radio"))){console.warn("Doars: `select` directive must be placed on a `select` tag or `input` of type checkbox or radio.");return}let i=s=>{if(r.tagName===yt)for(let l of Array.from(r.options)){let u=Array.isArray(s)?s.includes(l.value):s===l.value;l.selected!==u&&(l.selected=u,u?l.setAttribute(vt,""):l.removeAttribute(vt))}else if(n===At){let l=s.includes(r.value);r.checked!==l&&(l?r.setAttribute(xe,""):r.removeAttribute(xe))}else{let l=s===r.value;r.checked!==l&&(l?r.setAttribute(xe,""):r.removeAttribute(xe))}},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var xt={name:"show",update:(t,e,{processExpression:o,transitionIn:r,transitionOut:n})=>{let i=e.getElement(),f=()=>{let u=e.getData();u.transition&&u.transition();let h;u.result?(i.style.display=null,h=r(t,i)):h=n(t,i,()=>{i.style.display="none"}),e.setData(Object.assign({},u,{transition:h}))},s=o(t,e,e.getValue()),l=e.getData();L(s)?(e.setData(Object.assign({},l,{result:s})),Promise.resolve(s).then(u=>{e.getData().result===s&&f(u)})):(!l||l.result!==s)&&(e.setData(Object.assign({},l,{result:s})),f())}};var Ct=()=>({createContexts:_e,createContextsProxy:Ht,RevocableProxy:ie}),_e=(t,e,o,r=null)=>{let n=t.getLibrary(),i=n.getSimpleContexts(),f=[],s="",l="",u=n.getContexts(),h=[];for(let g of u){if(!g||!g.name)continue;let d=g.create(t,e,o,Ct());!d||!d.value||(d.destroy&&typeof d.destroy=="function"&&h.push(d.destroy),g.deconstruct&&typeof d.value=="object"&&(f.push(g.name),l+="with("+g.name+") { ",s+=" }"),i[g.name]=d.value)}if(typeof r=="object")for(let g in r)i[g]=r[g];return{contexts:i,destroy:()=>{for(let g of h)g(Ct())},after:s,before:l,deconstructed:f}},Ht=(t,e,o,r=null)=>{let n=null,i=ie({},{get:(f,s)=>{if(n||(n=_e(t,e,o,r)),s in n.contexts)return e.accessed(t.getId(),s),n.contexts[s];if(n.contexts.$state&&s in n.contexts.$state)return e.accessed(t.getId(),"$state"),n.contexts.$state[s]}});return{contexts:i.proxy,destroy:()=>{n&&n.destroy&&n.destroy(t,e),i.revoke()}}},K=(t,e,o=null)=>{let r=[],n=(s,l)=>{r.push({id:s,path:l})},{contexts:i,destroy:f}=_e(t,e,n,o);return[i,()=>{f(),r.length>0&&t.getLibrary().update(r)}]};var Me=(t,e)=>{let o=t,r=0;for(;r<e.length-1;r++)o=o[e[r]];return o[e[r]]};var M=(t,e,o)=>{if(typeof t!="object")return;let r=0;for(;r<e.length-1;r++)if(t=t[e[r]],typeof t!="object")return;t[e[r]]=o};var Nt={name:"sync",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=!e[W];if(n&&!(r.tagName==="DIV"&&r.hasAttribute("contenteditable"))&&r.tagName!=="INPUT"&&r.tagName!=="SELECT"&&r.tagName!=="TEXTAREA"){console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.");return}let i=e.getValue().trim(),f=e.getKey();if(f&&(i="$"+f+"."+i),!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(i)){console.warn("Doars: `sync` directive's value not a valid variable name: \""+i+'".');return}if(i=i.split("."),n){let l;switch(r.tagName){case"DIV":l=()=>{let[u,h]=K(t,e.clone());M(u,i,Z(r.innerText)),h()};break;case"INPUT":l=()=>{let u=e.clone(),h=Z(r.value),[g,d]=K(t,u);if(r.type==="checkbox"){let E=Me(g,i);if(r.checked)E||M(g,i,[h]),E.includes(r.value)||E.push(h);else if(E){let y=E.indexOf(r.value);y>=0&&E.splice(y,1)}}else if(r.type==="radio"){let E=Me(g,i);r.checked?E!==r.value&&M(g,i,h):E===r.value&&M(g,i,null)}else M(g,i,h);d()};break;case"TEXTAREA":l=()=>{let[u,h]=K(t,e.clone());M(u,i,Z(r.innerText)),h()};break;case"SELECT":l=()=>{let[u,h]=K(t,e.clone());if(r.multiple){let g=[];for(let d of r.selectedOptions)g.push(Z(d.value));M(u,i,[g.join("','")])}else M(u,i,Z(r.selectedOptions[0].value));h()};break}r.addEventListener("input",l),e[W]=l}let s=o(t,e,i);switch(r.tagName){case"DIV":case"TEXTAREA":s!==r.innerText&&(r.innerText=s);break;case"INPUT":if(r.type==="checkbox"){let l=s.includes(r.value);r.checked!==l&&(r.checked=l,l?r.setAttribute("checked",""):r.removeAttribute("checked"))}else if(r.type==="radio"){let l=s===r.value;r.checked!==l&&(r.checked=l,l?r.setAttribute("checked",""):r.removeAttribute("checked"))}else s!==r.value&&r.setAttribute("value",s);break;case"SELECT":for(let l of Array.from(r.options)){let u=Array.isArray(s)?s.includes(l.value):s===l.value;l.selected!==u&&(l.selected=u,u?l.setAttribute("selected",""):l.removeAttribute("selected"))}break}},destroy:(t,e)=>{if(!e[W])return;e.getElement().removeEventListener("input",e[W]),delete e[W]}};var Ot={name:"text",update:(t,e,{processExpression:o})=>{let r=e.getElement(),n=e.getModifiers(),i=s=>{n.content?r.textContent!==s&&(r.textContent=s):r.innerText!==s&&(r.innerText=s)},f=o(t,e,e.getValue());e.setData(f),L(f)?Promise.resolve(f).then(s=>{e.getData()===f&&i(s)}):i(f)}};var wt={name:"watch",update:(t,e,{processExpression:o})=>{let r=e.getValue();o(t,e,r,{},{return:!1})}};var re=class extends X{constructor(e){super();let{prefix:o,root:r}=e=Object.assign({prefix:"d",processor:"execute",root:document.body},e);if(typeof r=="string"&&(e.root=r=document.querySelector(r)),!o){console.error("Doars: `prefix` option not set.");return}if(typeof o!="string"){console.error("Doars: `prefix` option must be of type string.");return}if(!r){console.error("Doars: `root` option not set.");return}if(typeof r!="object"){console.error("Doars: `root` option must be a string or HTMLElement.");return}let n=Symbol("ID_DOARS"),i=!1,f=!1,s,l,u,h=[],g={},d=[Je,We,Xe,Ze,tt,rt,ot,st,nt,et],E=[Et,it,lt,ut,dt,Ot,ct,ht,mt,bt,xt,Nt,wt],y,x,N;this.getId=()=>n,this.getOptions=()=>Object.assign({},e),this.getEnabled=()=>i,this.enable=()=>{if(i)return this;f=!1,s=[],u={},this.dispatchEvent("enabling",[this]),i=!0,y=E.map(m=>m.name),x={};for(let m of E)x[m.name]=m;N=new RegExp("^"+o+"-("+y.join("|")+")(?:[$-_.a-z0-9]{0,})?$","i"),l=new MutationObserver(b.bind(this)),l.observe(r,{attributes:!0,childList:!0,subtree:!0});let c=o+"-state",a=o+"-ignore",p=[...r.querySelectorAll("["+c+"]")];for(let m=p.length-1;m>=0;m--)p[m].closest("["+a+"]")&&p.splice(m,1);return w(r.hasAttribute(c)&&!r.hasAttribute(a)?r:null,...p),this.dispatchEvent("enabled",[this]),this.dispatchEvent("updated",[this]),this},this.disable=()=>i?(l.disconnect(),l=null,f=s=u=null,this.dispatchEvent("disabling",[this],{reverse:!0}),v(...h),y=x=N=null,i=!1,this.dispatchEvent("disabled",[this],{reverse:!0}),this):this;let w=(...c)=>{let a=[],p=[];for(let m of c){if(!m||m[S])continue;let C=new le(this,m);h.push(C),a.push(C),p.push(m)}p.length>0&&this.dispatchEvent("components-added",[this,p]);for(let m of a)m.initialize();for(let m of a)m.updateAttributes(m.getAttributes());return a},v=(...c)=>{let a=[];for(let p of c){let m=h.indexOf(p);m<0||(a.push(p.getElement()),p.destroy(),h.splice(m,1))}return a.length>0&&this.dispatchEvent("components-removed",[this,a]),a};this.getSimpleContexts=()=>Object.assign({},g),this.setSimpleContext=(c,a=null)=>a===null?(delete g[c],this.dispatchEvent("simple-context-removed",[this,c]),!0):c.match("^([a-zA-Z_$][a-zA-Z\\d_$]*)$")?(g[c]=a,this.dispatchEvent("simple-context-added",[this,c,a]),!0):(console.warn('Doars: name of a bind can not start with a "$".'),!1),this.getContexts=()=>[...d],this.addContexts=(c,...a)=>{if(i){console.warn("Doars: Unable to add contexts after being enabled!");return}c<0?c=d.length+c%d.length:c>d.length&&(c=d.length);let p=[];for(let m=0;m<a.length;m++){let C=a[m];d.includes(C)||(d.splice(c+m,0,C),p.push(C))}return p.length>0&&this.dispatchEvent("contexts-added",[this,p]),p},this.removeContexts=(...c)=>{if(i){console.warn("Doars: Unable to remove contexts after being enabled!");return}let a=[];for(let p of c){let m=d.indexOf(p);m<0||(d.slice(m,1),a.push(p))}return a.length>0&&this.dispatchEvent("contexts-removed",[this,a]),a},this.getDirectives=()=>[...E],this.getDirectivesNames=()=>[...y],this.getDirectivesObject=()=>Object.assign({},x),this.isDirectiveName=c=>N.test(c),this.addDirectives=(c,...a)=>{if(i){console.warn("Doars: Unable to add directives after being enabled!");return}c<0?c=E.length+c%E.length:c>E.length&&(c=E.length);let p=[];for(let m=0;m<a.length;m++){let C=a[m];E.includes(C)||(E.splice(c+m,0,C),p.push(C))}return p.length>0&&(y=x=N=null,this.dispatchEvent("directives-added",[this,p])),p},this.removeDirectives=(...c)=>{if(i){console.warn("Doars: Unable to remove directives after being enabled!");return}let a=[];for(let p of c){let m=E.indexOf(p);m<0||(E.slice(m,1),a.push(p))}return a.length>0&&(y=x=N=null,this.dispatchEvent("directives-removed",[this,a])),a},this.update=c=>{if(!!i){if(c)for(let a of c){let{id:p,path:m}=a;if(!(p in u)){u[p]=[m];continue}u[p].includes(m)||u[p].push(m)}if(!f&&Object.getOwnPropertySymbols(u).length!==0){this.dispatchEvent("updating",[this]),f=!0,c=u,u={};for(let a of h)a.update(c);if(f=!1,Object.getOwnPropertySymbols(u).length>0){console.warn("Doars: during an update another update has been triggered. Normally this should not happen unless an expression in one of the directives is modifying a state which could cause a infinite loop!"),window.requestAnimationFrame(()=>this.update());return}if(s.length>0){b();return}this.dispatchEvent("updated",[this])}}};let b=c=>{if(s.push(...c),f||s.length===0)return;f=!0,c=[...s],s=[];let a=o+"-state",p=o+"-ignore",m=[],C=[],R=O=>{if(O.nodeType===1)if(O[S]){C.unshift(O[S]);let I=O.querySelectorAll(a);for(let T of I)T[S]&&C.unshift(T)}else{let I=te(O,T=>T[S]?(C.unshift(T[S]),!1):!0);do if(!!O[P])for(let T of O[P])T.getComponent().removeAttribute(T);while(O=I())}},$=O=>{if(O.nodeType!==1||O.closest("["+p+"]"))return;let T=O.querySelectorAll("["+a+"]");for(let F of T)F.closest("["+p+"]")||m.push(F);if(O.hasAttribute(a)){m.push(O);return}let B=Y(O);if(B){let F=B.scanAttributes(O);B.updateAttributes(F)}};for(let O of c)if(O.type==="childList"){for(let I of O.removedNodes)R(I);for(let I of O.addedNodes)$(I)}else if(O.type==="attributes"){let I=O.target;if(O.attributeName===a){if(I[S])continue;let q=Y(I);if(q){let Ke=I,_t=te(I,Se=>Se.hasAttribute(a));do for(let Se of Ke[P])q.removeAttribute(Se);while(Ke=_t())}w(I);continue}else if(O.attributeName===p){if(I.hasAttribute(p)){R(I);continue}$(I);continue}if(!N.test(O.attributeName))continue;let T=Y(I);if(!T)continue;let B=null;for(let q of I[P])if(q.getName()===O.attributeName){B=q;break}let F=I.getAttribute(O.attributeName);if(!B){F&&T.addAttribute(I,O.attributeName,F);continue}B.setValue(F),T.updateAttribute(B)}if(C.length>0&&v(...C),m.length>0&&w(...m),f=!1,s.length>0){b();return}Object.getOwnPropertySymbols(u).length>0&&this.update()}}};var Kt=[9,10,13,32],$e=40,ue=41,Ce=44,z=46,Rt=58,Be=63,Fe=91,Ve=93,It=125,Dt=["=","||=","&&=","??=","*=","**=","/=","%=","+=","-="],de={"=":1,"||=":1,"&&=":1,"??=":1,"*=":1,"**=":1,"/=":1,"%=":1,"+=":1,"-=":1,"||":2,"&&":3,"??":4,"==":8,"!=":8,"===":8,"!==":8,"<":9,">":9,"<=":9,">=":9,"*":11,"/":11,"%":11,"+":11,"-":11},zt=["-","!","+"],Ne="--",Oe="++",Tt={true:!0,false:!1,null:null,undefined:void 0},oe=t=>t>=48&&t<=57,Ye=t=>se(t)||oe(t),se=t=>t===36||t>=48&&t<=57||t===95||t>=65&&t<=90||t>=97&&t<=122,St=t=>{let e=0,o=()=>(e++,{type:5,elements:r(Ve)}),r=c=>{let a=[],p=!1,m=0;for(;e<t.length;){d();let C=t.charCodeAt(e);if(C===c){if(p=!0,e++,c===ue&&m&&m>=a.length)throw new Error("Unexpected token "+String.fromCharCode(c));break}else if(C===Ce){if(e++,m++,m!==a.length){if(c===ue)throw new Error("Unexpected token ,");if(c===Ve)for(let R=a.length;R<m;R++)a.push(null)}}else{if(a.length!==m&&m!==0)throw new Error("Expected comma");{let R=f();if(!R)throw new Error("Expected comma");a.push(R)}}}if(!p)throw new Error("Expected "+String.fromCharCode(c));return a},n=()=>{let c=x();if(!c)return c;let a=i();if(!a)return c;let p={value:a,precedence:de[a]||0},m=x();if(!m)throw new Error("Expected expression after "+a);let C=[c,p,m],R;for(;a=i();){let O=de[a]||0;if(O===0){e-=a.length;break}p={value:a,precedence:O};let I=a;for(;C.length>2&&C[C.length-2]>O;)m=C.pop(),a=C.pop().value,c=C.pop(),R={type:Dt.indexOf(a)>=0?6:7,operator:a,left:c,right:m},C.push(R);if(R=x(),!R)throw new Error("Expected expression after "+I);C.push(p,R)}let $=C.length-1;for(R=C[$];$>1;)a=C[$-1].value,R={type:Dt.indexOf(a)>=0?6:7,operator:a,left:C[$-2],right:R},$-=2;return R},i=()=>{d();let c=t.substring(e,e+3),a=c.length;for(;a>0;){if(Object.prototype.hasOwnProperty.call(de,c)&&(!se(t.charCodeAt(e))||e+c.length<t.length&&!Ye(t.charCodeAt(e+c.length))))return e+=a,c;c=c.substring(0,--a)}return!1},f=()=>{let c=n();return d(),c=y(c),c},s=c=>{let a=[];for(;e<t.length;){let p=t.charCodeAt(e);if(p===59||p===Ce)e++;else{let m=f();if(m)a.push(m);else if(e<t.length){if(p===c)break;throw new Error('Unexpected "'+t.charAt(e)+'"')}}}return a},l=()=>{let c=t.charCodeAt(e),a=e;if(se(c))e++;else throw new Error("Unexpected "+t.charAt(e));for(;e<t.length&&(c=t.charCodeAt(e),Ye(c));)e++;return{type:2,name:t.slice(a,e)}},u=()=>{let c="";for(;oe(t.charCodeAt(e));)c+=t.charAt(e++);if(t.charCodeAt(e)===z)for(c+=t.charAt(e++);oe(t.charCodeAt(e));)c+=t.charAt(e++);let a=t.charAt(e);if(a==="e"||a==="E"){for(c+=t.charAt(e++),a=t.charAt(e),(a==="+"||a==="-")&&(c+=t.charAt(e++));oe(t.charCodeAt(e));)c+=t.charAt(e++);if(!oe(t.charCodeAt(e-1)))throw new Error("Expected exponent ("+c+t.charAt(e)+")")}let p=t.charCodeAt(e);if(se(p))throw new Error("Variable names cannot start with a number ("+c+t.charAt(e)+")");if(p===z||c.length===1&&c.charCodeAt(0)===z)throw new Error("Unexpected period");return{type:3,value:parseFloat(c)}},h=()=>{if(t.charCodeAt(e)!==123)return;e++;let c=[];for(;!isNaN(t.charCodeAt(e));){if(d(),t.charCodeAt(e)===It)return e++,N({type:11,properties:c});let a=x();if(!a)throw new Error("Missing }");if(d(),a.type===2&&(t.charCodeAt(e)===Ce||t.charCodeAt(e)===It))c.push({type:4,computed:!1,key:a,value:a,shorthand:!0});else if(t.charCodeAt(e)===Rt){e++,d();let p=f();if(!p)throw new Error("Unexpected object property");let m=a.type===5;c.push({computed:m,key:m?a.elements[0]:a,shorthand:!1,type:4,value:p}),d()}else a&&c.push(a);t.charCodeAt(e)===Ce&&e++}throw new Error("Missing }")},g=()=>{e++;let c=s(ue);if(t.charCodeAt(e)===ue)return e++,c.length===1?c[0]:c.length?{type:12,expressions:c}:!1;throw new Error("Unclosed (")},d=()=>{for(;Kt.indexOf(t.charCodeAt(e))>=0;)e++},E=()=>{let c="",a=t.charAt(e++),p=!1;for(;e<t.length;){let m=t.charAt(e++);if(m===a){p=!0;break}if(m==="\\")switch(m=t.charAt(e++),m){case"n":c+=`
`;break;case"r":c+="\r";break;case"t":c+="	";break;case"b":c+="\b";break;case"f":c+="\f";break;case"v":c+="\v";break;default:c+=m}else c+=m}if(!p)throw new Error('Unclosed quote after "'+c+'"');return{type:3,value:c}},y=c=>{if(!c||t.charCodeAt(e)!==Be)return c;e++;let a=f();if(!a)throw new Error("Expected expression");if(d(),!t.charCodeAt(e)===Rt)throw new Error("Expected :");e++;let p=f();if(!p)throw new Error("Expected expression");let m={type:9,condition:c,consequent:a,alternate:p};if(c.operator&&de[c.operator]<=1){let C=c;for(;C.right.operator&&de[C.right.operator]<=1;)C=C.right;m.condition=C.right,C.right=m,m=c}return m},x=()=>{let c=h()||w();if(c)return v(c);d();let a=t.charCodeAt(e);if(oe(a)||a===z)return u();if(a===34||a===39)c=E();else if(a===Fe)c=o();else{let p=t.substring(e,e+1),m=p.length;for(;m>0;){if(zt.indexOf(p)>=0&&(!se(t.charCodeAt(e))||e+p.length<t.length&&!Ye(t.charCodeAt(e+p.length)))){e+=m;let C=x();if(!C)throw new Error("Missing unary operation parameter");return v({type:13,operator:p,parameter:C})}p=p.substr(0,--m)}se(a)?(c=l(),Object.prototype.hasOwnProperty.call(Tt,c.name)&&(c={type:3,value:Tt[c.name]})):a===$e&&(c=g())}return v(N(c))},N=c=>{d();let a=t.charCodeAt(e);for(;a===z||a===Fe||a===$e||a===Be;){let p;if(a===Be){if(t.charCodeAt(e+1)!==z)break;p=!0,e+=2,d(),a=t.charCodeAt(e)}if(e++,a===Fe){if(c={type:10,computed:!0,object:c,property:f()},d(),a=t.charCodeAt(e),a!==Ve)throw new Error("Unclosed [");e++}else a===$e?c={type:8,parameters:r(ue),callee:c}:(a===z||p)&&(p&&e--,d(),c={type:10,computed:!1,object:c,property:l()});p&&(c.optional=!0),d(),a=t.charCodeAt(e)}return c},w=()=>{if(e+1>=t.length)return;let c=t.substring(e,e+2),a=null;if(c===Ne)a=Ne;else if(c===Oe)a=Oe;else return;e+=2;let p={type:14,operator:a,parameter:N(l()),prefix:!0};if(!p.parameter||p.parameter.type!==2&&p.parameter.type!==10)throw new Error("Unexpected "+p.operator);return p},v=c=>{if(!c||e+1>=t.length)return c;let a=t.substring(e,e+2),p=null;if(a===Ne)p=Ne;else if(a===Oe)p=Oe;else return c;return e+=2,c={type:14,operator:p,parameter:c,prefix:!1},c},b=s();return b.length===0?void 0:b};var Lt=(t,e,o={})=>{switch(t.type){case 2:return o[t.name]=e,e;case 10:let r=D(t.object,o),n=t.computed||t.property.type!==2?D(t.property,o):t.property.name;return typeof e=="function"?e.bind(r):(r[n]=e,e)}throw new Error("Unsupported assignment method.")},D=(t,e={})=>{if(!!t){if(Array.isArray(t))return t.map(o=>D(o,e));switch(t.type){case 2:return e[t.name];case 3:return t.value;case 5:let o=[];for(let E of t.elements)o.push(D(E,e));return o;case 6:let r=D(t.right,e);if(t.operator!=="="){let E=D(t.left,e);switch(t.operator){case"||=":if(E)return E;break;case"&&=":if(!E)return E;break;case"??=":if(E!=null)return E;break;case"*=":r=E*r;break;case"**=":r=E**r;break;case"/=":r=E/r;break;case"%=":r=E%r;break;case"+=":r=E+r;break;case"-=":r=E-r;break}}return Lt(t.left,r,e);case 7:let n=D(t.left,e),i=D(t.right,e);switch(t.operator){case"||":return n||i;case"&&":return n&&i;case"??":return n??i;case"==":return n==i;case"!=":return n!=i;case"===":return n===i;case"!==":return n!==i;case"<":return n<i;case">":return n>i;case"<=":return n<=i;case">=":return n>=i;case"-":return n-i;case"+":return n+i;case"*":return n*i;case"/":return n/i;case"%":return n%i}throw new Error("Unsupported operator: "+t.operator);case 8:let f=[];for(let E of t.parameters)f.push(D(E,e));return D(t.callee,e)(...f);case 9:return D(t.condition,e)?D(t.consequent,e):D(t.alternate,e);case 10:let s=D(t.object,e),l=t.computed||t.property.type!==2?D(t.property,e):t.property.name;return typeof s[l]=="function"?s[l].bind(s):s[l];case 11:let u={};for(let E of t.properties)u[E.computed||E.key.type!==2?D(E.key,e):E.key.name]=D(E.value,e);return u;case 12:return t.expressions.map(E=>D(E,e));case 13:let h=D(t.parameter,e);switch(t.operator){case"!":return!h;case"-":return-h;case"+":return+h}throw new Error("Unsupported operator: "+t.operator);case 14:let g=D(t.parameter,e),d=t.operator==="--"?-1:1;return Lt(t.parameter,g+d,e),t.prefix?g+d:g}throw new Error('Unexpected node type "'+t.type+'".')}},kt=D;var Pt=St,Ut=kt;var jt=(t,e,o,r=null,n=null)=>{n=Object.assign({return:!0},n);let[i,f]=K(t,e,r),s;try{let l=Pt(o);if(n.return&&l&&l.length>1)throw new Error('Unable to return a single value from a compound expression of: "'+o+'".');s=Ut(l,i)}catch(l){console.error("ExpressionError in:",o,`
`+l.name+": "+l.message),s=null}if(f(),n.return&&s)return s=s[0],s};re.interpretExpression=jt;var cs=re;export{cs as default};
//# sourceMappingURL=doars-interpret.esm.min.js.map
