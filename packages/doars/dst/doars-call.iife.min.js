(()=>{var L=Symbol("ATTRIBUTES"),N=Symbol("COMPONENT"),K=Symbol("FOR"),R=Symbol("INITIALIZED"),b=Symbol("ON"),w=Symbol("REFERENCES"),B=Symbol("REFERENCES_CACHE"),q=Symbol("SYNC");var de=class{constructor(){let e={};this.addEventListener=(r,s,n=null)=>{r in e||(e[r]=[]),e[r].push({callback:s,options:n})},this.removeEventListener=(r,s)=>{if(!Object.keys(e).includes(r))return;let n=e[r],i=-1;for(let l=0;l<n.length;l++)if(n[l].callback===s){i=l;break}i<0||(n.splice(i,1),Object.keys(n).length===0&&delete e[r])},this.removeEventListeners=r=>{!r||delete e[r]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(r,s,n=null)=>{if(!e[r])return;let i=e[r];for(let l=0;l<i.length;l++){let o=n&&n.reverse?i[i.length-(l+1)]:i[l];o.options&&o.options.once&&i.splice(l,1),o.callback(...s)}}}},W=de;var X=t=>t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"').replace(/\n/g,"\\n"),ft=t=>t.replace(/-(\w)/g,(e,r)=>r.toUpperCase()),Ae=t=>{let e={};for(let r of t){let s=r.indexOf("-");if(s<0){e[r]=!0;continue}if(s===0){e[r.substring(1)]=!1;continue}let n=r.substring(0,s),i=r.substring(s+1),l=i,o;if(i.endsWith("ms")?l=i.substring(-2):i.endsWith("s")?(o="s",l=i.substring(-1)):i.endsWith("m")?(o="m",l=i.substring(-1)):i.endsWith("h")&&(o="h",l=i.substring(-1)),l=Number.parseInt(l),!isNaN(l))switch(i=l,o){case"h":i*=60;case"m":i*=60;case"s":i*=1e3;break}e[n]=i}return e},De=(t,e)=>{if(e=e.match(new RegExp("^"+t+"-([a-z][0-9a-z-]{1,}):?([a-z][0-9a-z-]*)?(\\..*]*)?$","i")),!e)return;let[r,s,n,i]=e;n=n!==""?n:null;let l=n?ft(n):null;return i=i?i.substring(1).split("."):[],[s,n,l,i]},Ce=t=>{let e=t.match(/^([$_a-z0-9,(){}\s]{1,}?)\s+(?:in|of)\s+([\s\S]{1,})$/i);if(!e)return;let r=e[1].replace(/^[\s({]*|[)}\s]*$/g,"");if(r=r.match(/^([$_a-z0-9]{1,})?(?:,\s+?)?([$_a-z0-9]{1,})?(?:,\s+)?([$_a-z0-9]{1,})?$/i),!!r)return r.shift(),{iterable:e[2].trim(),variables:[...r]}},G=t=>{if(typeof t=="string"&&(t=t.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(t)){console.error("Doars: parseSelector expects Array of string or a single string.");return}let e={};for(let r of t)switch(r=r.trim(),r[0]){case"#":e.id=r.substring(1);break;case".":r=r.substring(1),e.class||(e.class=[]),e.class.includes(r)||e.class.push(r);break;case"[":let[s,n,i]=r.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);e[n]=i;break}return e};var F=class extends W{constructor(e,r,s,n,i=!1){super();let l=Symbol("ID_ATTRIBUTE");i||(r[L]||(r[L]=[]),r[L].push(this));let o={},c=null,a,f,u,d,v;if(s){let[h,A,D,O]=De(e.getLibrary().getOptions().prefix,s);a=h,f=D,u=A,d=O,O&&(v=Ae(O))}this.getComponent=()=>e,this.getElement=()=>r,this.getId=()=>l,this.getDirective=()=>a,this.getKey=()=>f,this.getKeyRaw=()=>u,this.getModifiers=()=>Object.assign({},v),this.getModifiersRaw=()=>d,this.getName=()=>s,this.getValue=()=>n,this.setValue=h=>{n=h,this.dispatchEvent("changed",[this])},this.clearData=()=>{c=null},this.hasData=()=>c!==null,this.getData=()=>c,this.setData=h=>{c=h},this.destroy=()=>{this.setData(null),this.clearAccessed();let h=r[L].indexOf(this);h>=0&&r[L].splice(h,1),this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.accessed=(h,A)=>{if(!o[h])o[h]=[];else if(o[h].includes(A))return;o[h].push(A),this.dispatchEvent("accessed",[this,h,A])},this.clearAccessed=()=>{o={}},this.hasAccessed=(h,A)=>{if(!(h in o))return!1;let D=o[h];for(let O of A)if(D.includes(O))return!0;return!1},this.clone=()=>new F(e,r,s,n,!0)}};var ut=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],J=(t,e)=>{let r=!1,s={};for(let n of ut)s[n]=(...i)=>{if(r){console.error("illegal operation attempted on a revoked proxy");return}return n in e?e[n](...i):Reflect[n](...i)};return{proxy:new Proxy(t,s),revoke:()=>{r=!0}}};var pe=class extends W{constructor(e={}){super(),e=Object.assign({delete:!0,get:!0,set:!0},e);let r=new WeakMap;this.add=(s,n=[])=>{if(r.has(s))return r.get(s);for(let o in s)s[o]&&typeof s[o]=="object"&&(s[o]=this.add(s[o],[...n,o]));let i={};e.delete&&(i.deleteProperty=(o,c)=>{if(!Reflect.has(o,c))return!0;this.remove(o,c);let a=Reflect.deleteProperty(o,c);return a&&this.dispatchEvent("delete",[o,Array.isArray(o)?[...n]:[...n,c]]),a}),e.get&&(i.get=(o,c,a)=>(c!==Symbol.unscopables&&this.dispatchEvent("get",[o,[...n,c],a]),Reflect.get(o,c,a))),e.set&&(i.set=(o,c,a,f)=>(o[c]===a||(typeof a=="object"&&(a=this.add(a,[...n,c])),o[c]=a,this.dispatchEvent("set",[o,Array.isArray(o)?[...n]:[...n,c],a,f])),!0));let l=J(s,i);return r.set(l,s),l.proxy},this.remove=s=>{if(!r.has(s))return;let n=r.get(s);r.delete(n);for(let i in n.proxy)typeof n.proxy[i]=="object"&&this.remove(n.proxy[i]);n.revoke()}}},Oe=pe;var oe=(t,e)=>{for(let r in e){if(r==="class"){for(let s of e.class)t.classList.add(s);continue}t.setAttribute(r,e[r])}},Se=(t,e)=>{let r=t.attributes,s=e.attributes,n=null,i=null,l=null,o=null,c=null;for(let a=s.length-1;a>=0;--a)c=s[a],o=c.name,n=c.namespaceURI,i=c.value,n?(o=c.localName||o,l=t.getAttributeNS(n,o),l!==i&&t.setAttributeNS(n,o,i)):t.hasAttribute(o)?(l=t.getAttribute(o),l!==i&&(i==="null"||i==="undefined"?t.removeAttribute(o):t.setAttribute(o,i))):t.setAttribute(o,i);for(let a=r.length-1;a>=0;--a)c=r[a],c.specified!==!1&&(o=c.name,n=c.namespaceURI,n?(o=c.localName||o,e.hasAttributeNS(n,o)||t.removeAttributeNS(n,o)):e.hasAttributeNS(null,o)||t.removeAttribute(o))},_=(t,e)=>{for(let r in e){if(r==="class"){for(let s of e.class)t.classList.remove(s);continue}e[r]&&t.attributes[r]!==e[r]||t.removeAttribute(r)}},me=(t,e,r)=>{if(e==="value"&&t.tagName==="INPUT"){if(r||(r=""),t.getAttribute(e)===r)return;t.setAttribute(e,r);return}if(e==="checked"&&(t.type==="checkbox"||t.type==="radio")){t.checked=!!r;return}e==="class"&&(Array.isArray(r)?r=r.join(" "):typeof r=="object"&&(r=Object.entries(r).filter(([s,n])=>n).map(([s])=>s).join(" "))),e==="style"&&(Array.isArray(r)?r=r.join(" "):typeof r=="object"&&(r=Object.entries(r).map(([s,n])=>s+":"+n).join(";"))),r===!1||r===null||r===void 0?t.removeAttribute(e):t.setAttribute(e,r)},he=(t,e)=>{for(let r in e)me(t,r,e[r])};var ke=t=>{let e=document.createElement("template");return e.innerHTML=t,e.content.childNodes[0]},Q=(t,e)=>{t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)},ge=(t,e)=>t.isSameNode?t.isSameNode(e):t.tagName!==e.tagName?!1:t.type===3?t.nodeValue===e.nodeValue:!1,Y=(t,e)=>{let r=-1,s=null;return()=>{if(r>=0&&s){let i=s();if(i)return i}let n=null;do{if(r++,r>=t.childElementCount)return null;n=t.children[r]}while(!e(n));return n.childElementCount&&(s=Y(n,e)),n}};var dt=(t,e)=>{let r=e.nodeType,s=e.nodeName;r===1&&Se(t,e),(r===3||r===8)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),s==="INPUT"?pt(t,e):s==="OPTION"?ve(t,e,"selected"):s==="TEXTAREA"&&mt(t,e)},Te=(t,e,r)=>{if(typeof t!="object")throw new Error("Existing tree should be an object.");if(typeof e=="string")e=ke(e);else if(typeof e!="object")throw new Error("New tree should be an object.");return r&&r.childrenOnly||e.nodeType===11?(Ne(t,e),t):ne(t,e)},pt=(t,e)=>{let r=e.value,s=t.value;ve(t,e,"checked"),ve(t,e,"disabled"),t.indeterminate!==e.indeterminate&&(t.indeterminate=e.indeterminate),t.type!=="file"&&(s!==r&&(t.setAttribute("value",r),t.value=r),r==="null"&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?t.type==="range"&&(t.value=r):t.removeAttribute("value"))},mt=(t,e)=>{let r=e.value;if(t.value!==r&&(t.value=r),t.firstChild&&t.firstChild.nodeValue!==r){if(t.firstChild.nodeValue===t.placeholder&&r==="")return;t.firstChild.nodeValue=r}},ve=(t,e,r)=>{t[r]!==e[r]&&(t[r]=e[r],e[r]?t.setAttribute(r,""):t.removeAttribute(r))},ne=(t,e)=>t?e?t.isSameNode&&t.isSameNode(e)?t:t.tagName!==e.tagName?e:(dt(t,e),Ne(t,e),t):null:e,Ne=(t,e)=>{let r,s,n,i,l=0;for(let o=0;r=t.childNodes[o],s=e.childNodes[o-l],!(!r&&!s);o++)if(!s)t.removeChild(r),o--;else if(!r)t.appendChild(s),l++;else if(ge(r,s))n=ne(r,s),n!==r&&(t.replaceChild(n,r),l++);else{i=null;for(let c=o;c<t.childNodes.length;c++)if(ge(t.childNodes[c],s)){i=t.childNodes[c];break}i?(n=ne(i,s),n!==i&&l++,t.insertBefore(n,r)):!s.id&&!r.id?(n=ne(r,s),n!==r&&(t.replaceChild(n,r),l++)):(t.insertBefore(s,r),l++)}};var M=t=>{if(!!t.parentElement)return t=t.parentElement,t[N]?t[N]:M(t)};var ht="-transition:",ie=(t,e,r,s=null)=>{if(r.nodeType!==1){s&&s();return}let{prefix:n}=e.getLibrary().getOptions(),i=n+ht+t,l=v=>{r.dispatchEvent(new CustomEvent("transition-"+v)),r.dispatchEvent(new CustomEvent("transition-"+t+"-"+v))},o,c,a,f,u=!1,d={};return o=i,c=r.getAttribute(o),c&&(d.during=G(c),oe(r,d.during)),o=i+".from",c=r.getAttribute(o),c&&(d.from=G(c),oe(r,d.from)),l("start"),f=requestAnimationFrame(()=>{if(f=null,u)return;if(d.from&&(_(r,d.from),d.from=void 0),o=i+".to",c=r.getAttribute(o),c)d.to=G(c),oe(r,d.to);else if(!d.during){l("end"),s&&s(),u=!0;return}let v=getComputedStyle(r),h=Number(v.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;h===0&&(h=Number(v.animationDuration.replace("s",""))*1e3),a=setTimeout(()=>{a=null,!u&&(d.during&&(_(r,d.during),d.during=void 0),d.to&&(_(r,d.to),d.to=void 0),l("end"),s&&s(),u=!0)},h)}),()=>{!u||(u=!0,d.during&&(_(r,d.during),d.during=void 0),d.from?(_(r,d.from),d.from=void 0):d.to&&(_(r,d.to),d.to=void 0),f?(cancelAnimationFrame(f),f=null):a&&(clearTimeout(a),a=null),l("end"),s&&s())}},ce=(t,e,r)=>ie("in",t,e,r),ee=(t,e,r)=>ie("out",t,e,r);var te=class{constructor(e,r){let s=Symbol("ID_COMPONENT"),{prefix:n,processor:i}=e.getOptions(),l=typeof i,o;l==="function"?o=i:l==="string"&&e.constructor[i+"Expression"]?o=e.constructor[i+"Expression"]:(console.warn("Doars: Expression processor not found. Using fallback instead."),o=e.constructor.executeExpression??e.constructor.interpretExpression??e.constructor.callExpression),o||console.error("Doars: No expression processor available. Process option: ",process);let c=Object.freeze({morphTree:Te,processExpression:o,transition:ie,transitionIn:ce,transitionOut:ee}),a=[],f=!1,u=!1,d,v,h;if(!r.attributes[n+"-state"]){console.error("Doars: element given to component does not contain a state attribute!");return}r[N]=this;let A=[],D=M(r);D&&(D.getChildren().includes(this)||(D.getChildren().push(this),e.update([{id:D.getId(),path:"children"}]))),this.getAttributes=()=>a,this.getChildren=()=>A,this.getElement=()=>r,this.getId=()=>s,this.getLibrary=()=>e,this.getParent=()=>D,this.getProxy=()=>v,this.getState=()=>h,this.setParent=y=>{D=y},this.initialize=()=>{if(u)return;u=!0;let y=n+"-state",x=r.attributes[y].value;if(d=x?o(this,new F(this,r,null,x),x):{},d===null)d={};else if(typeof d!="object"||Array.isArray(d)){console.error("Doars: component tag must return an object!");return}v=new Oe,h=v.add(d),this.scanAttributes(r)},this.destroy=()=>{if(!u)return;if(a.length>0){let x=e.getDirectivesObject();for(let p in x)x[p].destroy||(x[p]=void 0);for(let p of a){let m=x[p.getKey()];m&&m.destroy(this,p,c),p.destroy()}}delete r[N],a=[],u=!1,v.remove(d),h=null,v=null,d=null;let y=[];if(A.length>0){for(let x of A)x.setParent(D),y.push({id:x.getId(),path:"parent"});y.push({id:s,path:"children"})}D&&(A.length>0&&(D.getChildren().push(...A),y.push({id:D.getId(),path:"children"})),y.push({id:s,path:"parent"})),y.length>0&&e.update(y),O("destroyed",{element:r,id:s})},this.addAttribute=(y,x,p)=>{let m=e.getDirectivesNames(),E=new F(this,y,x,p),g=E.length,k=m.indexOf(E.getDirective());for(let U=a.length-1;U>=0;U--)if(m.indexOf(a[U].getDirective())<=k){g=U+1;break}return a.splice(g,0,E),E},this.removeAttribute=y=>{let x=a.indexOf(y);if(x<0)return;let m=e.getDirectivesObject[y.getKey()];m&&m.destroy&&m.destroy(this,y,c),a.splice(x,1),y.destroy()},this.scanAttributes=y=>{let x=n+"-state",p=n+"-ignore",m=[],E=Y(y,g=>!g.hasAttribute(x)&&!g.hasAttribute(p));do for(let{name:g,value:k}of y.attributes)e.isDirectiveName(g)&&m.push(this.addAttribute(y,g,k));while(y=E());return m},this.updateAttribute=y=>{if(!y.getElement()||y.getValue()===null||y.getValue()===void 0){this.removeAttribute(y);return}let x=e.getDirectivesObject();y.clearAccessed();let p=x[y.getDirective()];p&&p.update(this,y,c)},this.updateAttributes=y=>{if(!u||y.length<=0){f||(f=!0,O("updated",{attributes:y,element:r,id:s}));return}for(let x of y)this.updateAttribute(x);f=!0,O("updated",{attributes:y,element:r,id:s})},this.update=y=>{if(!u)return;let x=Object.getOwnPropertySymbols(y),p=[];for(let m of a)for(let E of x)m.hasAccessed(E,y[E])&&(this.updateAttribute(m),p.push(m));(!f||p.length>0)&&(f=!0,O("updated",{attributes:p,element:r,id:s}))};let O=(y,x)=>{r.dispatchEvent(new CustomEvent(n+"-"+y,{detail:x,bubbles:!0}))}}};var Ie={name:"$children",create:(t,e,r,{createContextsProxy:s,RevocableProxy:n})=>{let i,l=n(t.getChildren(),{get:(o,c,a)=>{if(i||(i=o.map(u=>s(u,e,r)),e.accessed(t.getId(),"children")),isNaN(c))return Reflect.get(i,c,a);let f=Reflect.get(i,c,a);if(f)return f.contexts}});return{value:l.proxy,destroy:()=>{i&&i.forEach(o=>o.destroy()),l.revoke()}}}};var we={name:"$component",create:t=>({value:t.getElement()})};var Le={name:"$element",create:(t,e)=>({value:e.getElement()})};var Pe={name:"$dispatch",create:t=>({value:(e,r={})=>{t.getElement().dispatchEvent(new CustomEvent(e,{detail:r,bubbles:!0}))}})};var Re={deconstruct:!0,name:"$for",create:(t,e,r,{RevocableProxy:s})=>{if(t!==e.getComponent())return;let n=e.getElement(),i=t.getElement(),l=[],o={};for(;n&&!n.isSameNode(i);){let a=n[K];if(a){l.push(a);for(let f in a.variables)o[f]=a.variables[f]}n=n.parentNode}if(l.length===0)return;let c=s(o,{get:(a,f)=>{for(let u of l)if(f in u.variables)return e.accessed(u.id,"$for"),u.variables[f]}});return{value:c.proxy,destroy:()=>{c.revoke()}}}};var je={name:"$inContext",create:(t,e,r,{createContexts:s})=>({value:n=>{let i=[],l=(f,u)=>{i.push({id:f,path:u})},{contexts:o,destroy:c}=s(t,e,l,{}),a=n(o);return c(),i.length>0&&t.getLibrary().update(i),a}})};var $e={name:"$nextTick",create:(t,e,r,{createContexts:s})=>{let n,i=!1,l=()=>{if(i)return;i=!0;let o=t.getLibrary();n=[];let c=()=>{a();let{contexts:f,destroy:u}=s(t,e,r,{});for(let d of n)d(f);u()},a=()=>{o.removeEventListener("updated",c),e.removeEventListener("changed",a),e.removeEventListener("destroyed",a)};o.addEventListener("updated",c),e.addEventListener("changed",a),e.addEventListener("destroyed",a)};return{value:o=>{l(),n.push(o)}}}};var Ve={name:"$parent",create:(t,e,r,{createContextsProxy:s})=>{let n=t.getParent();if(!n)return{key:"$parent",value:null};let{contexts:i,destroy:l}=s(n,e,r);return{value:i,destroy:l}}};var Fe={name:"$references",create:(t,e,r,{RevocableProxy:s})=>{if(!t[w])return{key:"$references",value:[]};let n=t[B];if(!n){let l=t[w],o=Object.getOwnPropertySymbols(l);n={};for(let c of o){let{element:a,name:f}=l[c];n[f]=a}t[B]=n}let i=s(n,{get:(l,o,c)=>(e.accessed(t.getId(),"$references."+o),Reflect.get(l,o,c))});return{value:i.proxy,destroy:()=>{i.revoke()}}}};var Ue={deconstruct:!0,name:"$state",create:(t,e,r,{RevocableProxy:s})=>{let n=t.getProxy(),i=t.getState();if(!n||!i)return;let l=(f,u)=>r(t.getId(),"$state."+u.join(".")),o=(f,u)=>e.accessed(t.getId(),"$state."+u.join(".")),c=(f,u)=>r(t.getId(),"$state."+u.join("."));n.addEventListener("delete",l),n.addEventListener("get",o),n.addEventListener("set",c);let a=s(i,{});return{value:a.proxy,destroy:()=>{n.removeEventListener("delete",l),n.removeEventListener("get",o),n.removeEventListener("set",c),a.revoke()}}}};var lr=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var I=t=>t&&Object.prototype.toString.call(t)==="[object Promise]";var _e={name:"attribute",update:(t,e,{processExpression:r})=>{let s=e.getElement(),n=e.getModifiers(),i=o=>{if(n.selector){if(typeof o!="string"){console.error("Doars: Value returned to attribute directive must be a string if the selector modifier is set.");return}o=G(o),he(s,o);return}let c=e.getKeyRaw();if(!c){typeof o=="object"&&!Array.isArray(o)?he(s,o):console.error("Doars: Value returned to attribute directive of invalid type.");return}me(s,c,o)},l=r(t,e,e.getValue());e.setData(l),I(l)?Promise.resolve(l).then(o=>{e.getData()===l&&i(o)}):i(l)}};var Me={name:"cloak",update:function(t,e,{transitionIn:r}){let s=e.getElement();s.removeAttribute(t.getLibrary().getOptions().prefix+"-"+this.name),r(t,s)}};var le=(t,...e)=>{let r={};for(let s=0;s<e.length&&!(s>=t.length);s++)r[t[s]]=e[s];return r},He=(t,e,r=-1)=>(r++,r>=t.length?-1:t[r][K].value===e?r:He(t,e,r)),ae=(t,e,r,s,n,i,l)=>{let o=He(s,i,n);if(o>=0){if(o===n+1)return;let f=s[o];Q(s[n]?s[n]:r,f),e(f[K].id);return}let c=document.importNode(r.content,!0),a=n===-1?r:s[n];Q(a,c),c=a.nextElementSibling,ce(t,c),c[K]={id:Symbol("ID_FOR"),value:i,variables:l},s.splice(n+1,0,c)},ye=(t,e,r)=>{if(!(e.length<r))for(let s=e.length-1;s>=r;s--){let n=e[s];e.splice(s,1),ee(t,n,()=>{n.remove()})}},ze={name:"for",update:(t,e,{processExpression:r})=>{let s=e.getElement();if(s.tagName!=="TEMPLATE"){console.warn("Doars: `for` directive must be placed on a `<template>` tag.");return}let n=Ce(e.getValue());if(!n){console.error("Doars: Error in `for` expression: ",e.getValue());return}let i={},l=f=>{i[f]||(i[f]=["$for"])},o=f=>{let u=e.getData(),d=u.elements?u.elements:[],v=typeof f;if(f==null)length=0;else if(v==="number"){for(let h=0;h<f;h++){let A=le(n.variables,h);ae(t,l,s,d,h-1,f,A)}ye(t,d,f)}else if(v==="string"){for(let h=0;h<f.length;h++){let A=f[h],D=le(n.variables,A,h);ae(t,l,s,d,h-1,A,D)}ye(t,d,f.length)}else{let h,A;try{let D=[...f];h=!0,A=D.length}catch{}if(h)for(let D=0;D<A;D++){let O=f[D],y=le(n.variables,O,D);ae(t,l,s,d,D-1,O,y)}else{let D=Object.keys(f);A=D.length;for(let O=0;O<A;O++){let y=D[O],x=f[y],p=le(n.variables,y,x,O);ae(t,l,s,d,O-1,x,p)}}ye(t,d,A)}Object.getOwnPropertySymbols(i).length>0&&t.update(i),e.setData(Object.assign({},u,{elements:d}))},c;isNaN(n.iterable)?c=r(t,e,n.iterable):c=Number(n.iterable);let a=e.getData();e.setData(Object.assign({},a,{result:c})),I(c)?Promise.resolve(c).then(f=>{e.getData().result===c&&o(f)}):o(c)},destroy:(t,e)=>{let r=e.getData();if(r.elements)for(let s of r.elements)ee(t,s,()=>{s.remove()})}};var gt={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},vt=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var Ke=t=>typeof t!="string"?t:t.replaceAll(vt,e=>gt[e]);var Be={name:"html",update:(t,e,{processExpression:r,morphTree:s})=>{let n=e.getElement(),i=e.getModifiers(),l=c=>{if(i.decode&&typeof c=="string"&&(c=Ke(c)),i.morph){if(n.children.length===0)n.appendChild(document.createElement("div"));else if(n.children.length>1)for(let f=n.children.length-1;f>=1;f--)n.children[f].remove();let a=s(n.children[0],c);n.children[0].isSameNode(a)||(n.children[0].remove(),n.appendChild(a));return}if(c instanceof HTMLElement){for(let a of n.children)a.remove();n.appendChild(c.cloneNode(!0));return}if(typeof c=="string"){n.innerHTML!==c&&(n.innerHTML=c);return}console.error("Doars/directives/html: Unknown type returned to directive!")},o=r(t,e,e.getValue());e.setData(o),I(o)?Promise.resolve(o).then(c=>{e.getData()===o&&l(c)}):l(o)}};var qe={name:"if",update:(t,e,{processExpression:r,transitionIn:s,transitionOut:n})=>{let i=e.getElement();if(i.tagName!=="TEMPLATE"){console.warn("Doars: `if` directive must be placed on a `<template>` tag.");return}if(i.childCount>1){console.warn("Doars: `if` directive must have a single child node.");return}let l=a=>{let f=e.getData(),u=f.element,d=f.transition;a?u||(d&&d(),u=document.importNode(i.content,!0),Q(i,u),u=i.nextElementSibling,d=s(t,u)):u&&(d&&d(),d=n(t,u,()=>{u.remove()})),e.setData(Object.assign({},f,{element:u,transition:d}))},o=r(t,e,e.getValue()),c=e.getData();e.setData(Object.assign({},c,{result:o})),I(o)?Promise.resolve(o).then(a=>{e.getData().result===a&&l(a)}):l(o)},destroy:(t,e,{transitionOut:r})=>{let s=e.getData();s.element&&r(t,s.element,()=>{s.element.remove()})}};var We=(t,e)=>{if(!e[R])return;let r=t.getElement(),s=t.getLibrary().getOptions().prefix+"-updated";r.removeEventListener(s,e[R].handler),delete e[R]},Xe={name:"initialized",update:(t,e,{processExpression:r})=>{let s=t.getElement(),n=e.getValue(),i=t.getLibrary().getOptions().prefix+"-updated";if(e[R]){if(e[R].value===n)return;s.removeEventListener(i,e[R].handler),delete e[R]}let l=({detail:o})=>{o.element===s&&(r(t,e.clone(),n,{},{return:!1}),We(t,e))};s.addEventListener(i,l,{once:!0}),e[R]={handler:l,value:n}},destroy:We};var re={keydown:"keyup",mousedown:"mouseup",pointerdown:"pointerup"},P={NONE:0,BUFFER:1,DEBOUNCE:2,HELD:3,HOLD:4,THROTTLE:5},yt=["alt","ctrl","meta","shift"],Ge={name:"on",update:(t,e,{processExpression:r})=>{let s=e.getKeyRaw();if(!s){console.warn("Doars: `on` directive must have a key.");return}let n;s.startsWith("keydown-")?(n=s.substring(8).toLowerCase(),s="keydown"):s.startsWith("keyup-")&&(n=s.substring(6).toLowerCase(),s="keyup");let i=e.getElement(),l=e.getValue();if(e[b]){if(e[b].value===l)return;e[b].target.removeEventListener(s,e[b].handler),e[b].timeout&&clearTimeout(e[b].timeout),delete e[b]}let o=e.getModifiers(),c={};o.capture&&(c.capture=!0),o.once&&(c.once=!0),o.passive&&(c.passive=!0);let a=P.NONE;o.buffer?(a=P.BUFFER,o.buffer===!0&&(o.buffer=5)):o.debounce?(a=P.DEBOUNCE,o.debounce===!0&&(o.debounce=500)):o.held?(a=P.HELD,o.held===!0&&(o.held=500)):o.hold?(a=P.HOLD,o.hold===!0&&(o.hold=500)):o.throttle&&(a=P.THROTTLE,o.throttle===!0&&(o.throttle=500));let f=[];if(n){o.meta=o.meta?!0:o.cmd||o.super;for(let v of yt)o[v]&&f.push(v)}let u=i;o.document||o.outside?u=document:o.window&&(u=window);let d=v=>{if(e[b].prevent||!o.repeat&&v.repeat||o.self&&v.target!==i||o.outside&&i.contains(v.target))return;if((s==="keydown"||s==="keyup")&&n){for(let D of f)if(!v[D+"Key"])return;let A=o.code?v.code:v.key;if(A===" "&&(A="space"),A=A.toLowerCase(),A!==n)return}o.prevent&&v.preventDefault(),o.stop&&v.stopPropagation();let h=()=>{r(t,e.clone(),l,{$event:v,$events:e[b].buffer},{return:!1}),e[b].buffer=[]};switch(e[b].buffer.push(v),a){case P.BUFFER:if(e[b].buffer.length<o.buffer)return;h();return;case P.DEBOUNCE:e[b].timeout&&(clearTimeout(e[b].timeout),e[b].timeout=null),e[b].timeout=setTimeout(h,o.debounce);return;case P.HELD:if(!(s in re)){console.warn('Doars: `on` directive, event of name "'+s+'" is not cancelable and can not have "held" modifier.');return}let A=re[s],D=window.performance.now();e[b].cancel=x=>{if(window.performance.now()-D<o.held){e[b].prevent=!1;return}if(A==="keyup"&&n){for(let m of f)if(!x[m+"Key"]){e[b].prevent=!1;return}let p=o.code?x.code:x.key;if(p===" "&&(p="space"),p=p.toLowerCase(),p!==n){e[b].prevent=!1;return}}if(o.self&&x.target!==i){e[b].prevent=!1;return}if(o.outside&&i.contains(x.target)){e[b].prevent=!1;return}h()},e[b].prevent=!0,u.addEventListener(A,e[b].cancel,{once:!0});return;case P.HOLD:if(!(s in re)){console.warn('Doars: `on` directive, event of name "'+s+'" is not cancelable and can not have "hold" modifier.');return}let O=re[s];e[b].cancel=x=>{if(O==="keyup"&&n){let p=!1;for(let E of f)x[E+"Key"]||(p=!0);let m=o.code?x.code:x.key;if(m===" "&&(m="space"),m=m.toLowerCase(),m===n&&(p=!0),!p){e[b].prevent=!1;return}}if(o.self&&x.target!==i){e[b].prevent=!1;return}if(o.outside&&i.contains(x.target)){e[b].prevent=!1;return}clearTimeout(e[b].timeout)},u.addEventListener(O,e[b].cancel,{once:!0}),e[b].prevent=!0,e[b].timeout=setTimeout(()=>{u.removeEventListener(O,e[b].cancel),e[b].prevent=!1,h()},o.hold);return;case P.THROTTLE:let y=window.performance.now();if(e[b].lastExecution&&y-e[b].lastExecution<o.throttle)return;h(),e[b].lastExecution=y;return}h()};u.addEventListener(s,d,c),e[b]={buffer:[],handler:d,target:u,timeout:e[b]?e[b].timeout:void 0,value:l,prevent:!1}},destroy:(t,e)=>{if(!e[b])return;let r=e.getKeyRaw();e[b].target.removeEventListener(r,e[b].handler),e[b].cancel&&e[b].target.removeEventListener(re[r],e[b].cancel),e[b].timeout&&clearTimeout(e[b].timeout),delete e[b]}};var Ye=(t,e)=>{if(!t[w])return;let r=e.getId();if(!t[w][r])return;let s=t.getLibrary(),n=t.getId(),i=e.getValue().trim();delete t[w][r],delete t[B],Object.keys(t[w]).length===0&&delete t[w],s.update([{id:n,path:"$references."+i}])},Ze={name:"reference",update:(t,e)=>{let r=e.getValue().trim();if(!/^[_$a-z]{1}[_\-$a-z0-9]{0,}$/i.test(r)){Ye(t,e),console.warn("Doars: `reference` directive's value not a valid variable name: \""+r+'".');return}let s=t.getLibrary(),n=t.getId(),i=e.getElement(),l=e.getId();t[w]||(t[w]={}),t[w][l]={element:i,name:r},delete t[B],s.update([{id:n,path:"$references."+r}])},destroy:Ye};var Je="SELECT",fe="checked",Qe="selected",et="checkbox",tt={name:"select",update:(t,e,{processExpression:r})=>{let s=e.getElement(),n=s.getAttribute("type");if(s.tagName!==Je&&!(s.tagName==="INPUT"&&(n===et||n==="radio"))){console.warn("Doars: `select` directive must be placed on a `select` tag or `input` of type checkbox or radio.");return}let i=o=>{if(s.tagName===Je)for(let c of Array.from(s.options)){let a=Array.isArray(o)?o.includes(c.value):o===c.value;c.selected!==a&&(c.selected=a,a?c.setAttribute(Qe,""):c.removeAttribute(Qe))}else if(n===et){let c=o.includes(s.value);s.checked!==c&&(c?s.setAttribute(fe,""):s.removeAttribute(fe))}else{let c=o===s.value;s.checked!==c&&(c?s.setAttribute(fe,""):s.removeAttribute(fe))}},l=r(t,e,e.getValue());e.setData(l),I(l)?Promise.resolve(l).then(o=>{e.getData()===l&&i(o)}):i(l)}};var rt={name:"show",update:(t,e,{processExpression:r,transitionIn:s,transitionOut:n})=>{let i=e.getElement(),l=()=>{let a=e.getData();a.transition&&a.transition();let f;a.result?(i.style.display=null,f=s(t,i)):f=n(t,i,()=>{i.style.display="none"}),e.setData(Object.assign({},a,{transition:f}))},o=r(t,e,e.getValue()),c=e.getData();I(o)?(e.setData(Object.assign({},c,{result:o})),Promise.resolve(o).then(a=>{e.getData().result===o&&l(a)})):(!c||c.result!==o)&&(e.setData(Object.assign({},c,{result:o})),l())}};var st=()=>({createContexts:Ee,createContextsProxy:Et,RevocableProxy:J}),Ee=(t,e,r,s=null)=>{let n=t.getLibrary(),i=n.getSimpleContexts(),l="",o="",c=[],a=n.getContexts(),f=[];for(let u of a){if(!u||!u.name)continue;let d=u.create(t,e,r,st());!d||!d.value||(d.destroy&&typeof d.destroy=="function"&&f.push(d.destroy),u.deconstruct&&typeof d.value=="object"&&(c.push(u.name),o+="with("+u.name+") { ",l+=" }"),i[u.name]=d.value)}if(typeof s=="object")for(let u in s)i[u]=s[u];return{contexts:i,destroy:()=>{for(let u of f)u(st())},after:l,before:o,deconstructed:c}},Et=(t,e,r,s=null)=>{let n=null,i=J({},{get:(l,o)=>{if(n||(n=Ee(t,e,r,s)),o in n.contexts)return e.accessed(t.getId(),o),n.contexts[o];if(n.contexts.$state&&o in n.contexts.$state)return e.accessed(t.getId(),"$state"),n.contexts.$state[o]}});return{contexts:i.proxy,destroy:()=>{n&&n.destroy&&n.destroy(t,e),i.revoke()}}},H=(t,e,r=null)=>{let s=[],n=(o,c)=>{s.push({id:o,path:c})},{contexts:i,destroy:l}=Ee(t,e,n,r);return[i,()=>{l(),s.length>0&&t.getLibrary().update(s)}]};var se=(t,e)=>{let r=t,s=0;for(;s<e.length-1;s++)r=r[e[s]];return r[e[s]]};var j=(t,e,r)=>{if(typeof t!="object")return;let s=0;for(;s<e.length-1;s++)if(t=t[e[s]],typeof t!="object")return;t[e[s]]=r};var ot={name:"sync",update:(t,e,{processExpression:r})=>{let s=e.getElement(),n=!e[q];if(n&&!(s.tagName==="DIV"&&s.hasAttribute("contenteditable"))&&s.tagName!=="INPUT"&&s.tagName!=="SELECT"&&s.tagName!=="TEXTAREA"){console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.");return}let i=e.getValue().trim(),l=e.getKey();if(l&&(i="$"+l+"."+i),!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(i)){console.warn("Doars: `sync` directive's value not a valid variable name: \""+i+'".');return}if(i=i.split("."),n){let c;switch(s.tagName){case"DIV":c=()=>{let[a,f]=H(t,e.clone());j(a,i,X(s.innerText)),f()};break;case"INPUT":c=()=>{let a=e.clone(),f=X(s.value),[u,d]=H(t,a);if(s.type==="checkbox"){let v=se(u,i);if(s.checked)v||j(u,i,[f]),v.includes(s.value)||v.push(f);else if(v){let h=v.indexOf(s.value);h>=0&&v.splice(h,1)}}else if(s.type==="radio"){let v=se(u,i);s.checked?v!==s.value&&j(u,i,f):v===s.value&&j(u,i,null)}else j(u,i,f);d()};break;case"TEXTAREA":c=()=>{let[a,f]=H(t,e.clone());j(a,i,X(s.innerText)),f()};break;case"SELECT":c=()=>{let[a,f]=H(t,e.clone());if(s.multiple){let u=[];for(let d of s.selectedOptions)u.push(X(d.value));j(a,i,[u.join("','")])}else j(a,i,X(s.selectedOptions[0].value));f()};break}s.addEventListener("input",c),e[q]=c}let o=r(t,e,i);switch(s.tagName){case"DIV":case"TEXTAREA":o!==s.innerText&&(s.innerText=o);break;case"INPUT":if(s.type==="checkbox"){let c=o.includes(s.value);s.checked!==c&&(s.checked=c,c?s.setAttribute("checked",""):s.removeAttribute("checked"))}else if(s.type==="radio"){let c=o===s.value;s.checked!==c&&(s.checked=c,c?s.setAttribute("checked",""):s.removeAttribute("checked"))}else o!==s.value&&s.setAttribute("value",o);break;case"SELECT":for(let c of Array.from(s.options)){let a=Array.isArray(o)?o.includes(c.value):o===c.value;c.selected!==a&&(c.selected=a,a?c.setAttribute("selected",""):c.removeAttribute("selected"))}break}},destroy:(t,e)=>{if(!e[q])return;e.getElement().removeEventListener("input",e[q]),delete e[q]}};var nt={name:"text",update:(t,e,{processExpression:r})=>{let s=e.getElement(),n=e.getModifiers(),i=o=>{n.content?s.textContent!==o&&(s.textContent=o):s.innerText!==o&&(s.innerText=o)},l=r(t,e,e.getValue());e.setData(l),I(l)?Promise.resolve(l).then(o=>{e.getData()===l&&i(o)}):i(l)}};var it={name:"watch",update:(t,e,{processExpression:r})=>{let s=e.getValue();r(t,e,s,{},{return:!1})}};var Z=class extends W{constructor(e){super();let{prefix:r,root:s}=e=Object.assign({prefix:"d",processor:"execute",root:document.body},e);if(typeof s=="string"&&(e.root=s=document.querySelector(s)),!r){console.error("Doars: `prefix` option not set.");return}if(typeof r!="string"){console.error("Doars: `prefix` option must be of type string.");return}if(!s){console.error("Doars: `root` option not set.");return}if(typeof s!="object"){console.error("Doars: `root` option must be a string or HTMLElement.");return}let n=Symbol("ID_DOARS"),i=!1,l=!1,o,c,a,f=[],u={},d=[Ie,we,Le,Pe,je,$e,Ve,Fe,Ue,Re],v=[Ze,_e,ze,Be,qe,nt,Me,Xe,Ge,tt,rt,ot,it],h,A,D;this.getId=()=>n,this.getOptions=()=>Object.assign({},e),this.getEnabled=()=>i,this.enable=()=>{if(i)return this;l=!1,o=[],a={},this.dispatchEvent("enabling",[this]),i=!0,h=v.map(g=>g.name),A={};for(let g of v)A[g.name]=g;D=new RegExp("^"+r+"-("+h.join("|")+")(?:[$-_.a-z0-9]{0,})?$","i"),c=new MutationObserver(x.bind(this)),c.observe(s,{attributes:!0,childList:!0,subtree:!0});let p=r+"-state",m=r+"-ignore",E=[...s.querySelectorAll("["+p+"]")];for(let g=E.length-1;g>=0;g--)E[g].closest("["+m+"]")&&E.splice(g,1);return O(s.hasAttribute(p)&&!s.hasAttribute(m)?s:null,...E),this.dispatchEvent("enabled",[this]),this.dispatchEvent("updated",[this]),this},this.disable=()=>i?(c.disconnect(),c=null,l=o=a=null,this.dispatchEvent("disabling",[this],{reverse:!0}),y(...f),h=A=D=null,i=!1,this.dispatchEvent("disabled",[this],{reverse:!0}),this):this;let O=(...p)=>{let m=[],E=[];for(let g of p){if(!g||g[N])continue;let k=new te(this,g);f.push(k),m.push(k),E.push(g)}E.length>0&&this.dispatchEvent("components-added",[this,E]);for(let g of m)g.initialize();for(let g of m)g.updateAttributes(g.getAttributes());return m},y=(...p)=>{let m=[];for(let E of p){let g=f.indexOf(E);g<0||(m.push(E.getElement()),E.destroy(),f.splice(g,1))}return m.length>0&&this.dispatchEvent("components-removed",[this,m]),m};this.getSimpleContexts=()=>Object.assign({},u),this.setSimpleContext=(p,m=null)=>m===null?(delete u[p],this.dispatchEvent("simple-context-removed",[this,p]),!0):p.match("^([a-zA-Z_$][a-zA-Zd_$]*)$")?(u[p]=m,this.dispatchEvent("simple-context-added",[this,p,m]),!0):(console.warn('Doars: name of a bind can not start with a "$".'),!1),this.getContexts=()=>[...d],this.addContexts=(p,...m)=>{if(i){console.warn("Doars: Unable to add contexts after being enabled!");return}p<0?p=d.length+p%d.length:p>d.length&&(p=d.length);let E=[];for(let g=0;g<m.length;g++){let k=m[g];d.includes(k)||(d.splice(p+g,0,k),E.push(k))}return E.length>0&&this.dispatchEvent("contexts-added",[this,E]),E},this.removeContexts=(...p)=>{if(i){console.warn("Doars: Unable to remove contexts after being enabled!");return}let m=[];for(let E of p){let g=d.indexOf(E);g<0||(d.slice(g,1),m.push(E))}return m.length>0&&this.dispatchEvent("contexts-removed",[this,m]),m},this.getDirectives=()=>[...v],this.getDirectivesNames=()=>[...h],this.getDirectivesObject=()=>Object.assign({},A),this.isDirectiveName=p=>D.test(p),this.addDirectives=(p,...m)=>{if(i){console.warn("Doars: Unable to add directives after being enabled!");return}p<0?p=v.length+p%v.length:p>v.length&&(p=v.length);let E=[];for(let g=0;g<m.length;g++){let k=m[g];v.includes(k)||(v.splice(p+g,0,k),E.push(k))}return E.length>0&&(h=A=D=null,this.dispatchEvent("directives-added",[this,E])),E},this.removeDirectives=(...p)=>{if(i){console.warn("Doars: Unable to remove directives after being enabled!");return}let m=[];for(let E of p){let g=v.indexOf(E);g<0||(v.slice(g,1),m.push(E))}return m.length>0&&(h=A=D=null,this.dispatchEvent("directives-removed",[this,m])),m},this.update=p=>{if(!!i){if(p)for(let m of p){let{id:E,path:g}=m;if(!(E in a)){a[E]=[g];continue}a[E].includes(g)||a[E].push(g)}if(!l&&Object.getOwnPropertySymbols(a).length!==0){this.dispatchEvent("updating",[this]),l=!0,p=a,a={};for(let m of f)m.update(p);if(l=!1,Object.getOwnPropertySymbols(a).length>0){console.warn("Doars: during an update another update has been triggered. Normally this should not happen unless an expression in one of the directives is modifying a state which could cause a infinite loop!"),window.requestAnimationFrame(()=>this.update());return}if(o.length>0){x();return}this.dispatchEvent("updated",[this])}}};let x=p=>{if(o.push(...p),l||o.length===0)return;l=!0,p=[...o],o=[];let m=r+"-state",E=r+"-ignore",g=[],k=[],U=C=>{if(C.nodeType===1)if(C[N]){k.unshift(C[N]);let S=C.querySelectorAll(m);for(let T of S)T[N]&&k.unshift(T)}else{let S=Y(C,T=>T[N]?(k.unshift(T[N]),!1):!0);do if(!!C[L])for(let T of C[L])T.getComponent().removeAttribute(T);while(C=S())}},be=C=>{if(C.nodeType!==1||C.closest("["+E+"]"))return;let T=C.querySelectorAll("["+m+"]");for(let V of T)V.closest("["+E+"]")||g.push(V);if(C.hasAttribute(m)){g.push(C);return}let $=M(C);if($){let V=$.scanAttributes(C);$.updateAttributes(V)}};for(let C of p)if(C.type==="childList"){for(let S of C.removedNodes)U(S);for(let S of C.addedNodes)be(S)}else if(C.type==="attributes"){let S=C.target;if(C.attributeName===m){if(S[N])continue;let z=M(S);if(z){let xe=S,at=Y(S,ue=>ue.hasAttribute(m));do for(let ue of xe[L])z.removeAttribute(ue);while(xe=at())}O(S);continue}else if(C.attributeName===E){if(S.hasAttribute(E)){U(S);continue}be(S);continue}if(!D.test(C.attributeName))continue;let T=M(S);if(!T)continue;let $=null;for(let z of S[L])if(z.getName()===C.attributeName){$=z;break}let V=S.getAttribute(C.attributeName);if(!$){V&&T.addAttribute(S,C.attributeName,V);continue}$.setValue(V),T.updateAttribute($)}if(k.length>0&&y(...k),g.length>0&&O(...g),l=!1,o.length>0){x();return}Object.getOwnPropertySymbols(a).length>0&&this.update()}}};var bt=/^[a-z$_]+[0-9a-z$_]*(?:\.[a-z$_]+[0-9a-z$_]*)*$/is,ct=(t,e,r,s=null,n=null)=>{let[i,l]=H(t,e,s);r=r.trim();let o;if(!bt.test(r))console.error("Error encountered when executing an expression. Expression is not a valid dot separated path: ",r),o=null;else if(o=se(i,r.split(".")),typeof o=="function")try{o=o(i)}catch(c){console.error("ExpressionError in:",r,`
`+c.name+": "+c.message),o=null}return l(),o};Z.callExpression=ct;var lt=Z;window.Doars=lt;})();
//# sourceMappingURL=doars-call.iife.min.js.map
