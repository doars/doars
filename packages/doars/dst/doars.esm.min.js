const e=Symbol(),t=Symbol(),n=Symbol(),s=Symbol(),r=Symbol(),i=Symbol(),o=Symbol(),c=Symbol(),a=Symbol();class l{constructor(){let e={};this.addEventListener=(t,n,s=null)=>{t in e||(e[t]=[]),e[t].push({callback:n,options:s})},this.removeEventListener=(t,n)=>{if(!Object.keys(e).includes(t))return;const s=e[t];let r=-1;for(let e=0;e<s.length;e++)if(s[e].callback===n){r=e;break}r<0||(s.splice(r,1),0===Object.keys(s).length&&delete e[t])},this.removeEventListeners=t=>{t&&delete e[t]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(t,n,s=null)=>{if(!e[t])return;const r=e[t];for(let e=0;e<r.length;e++){const t=s&&s.reverse?r[r.length-(e+1)]:r[e];t.options&&t.options.once&&r.splice(e,1),t.callback(...n)}}}}const u=e=>{if("string"==typeof e&&(e=e.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(e))return;const t={};for(let n of e)switch(n=n.trim(),n[0]){case"#":t.id=n.substring(1);break;case".":n=n.substring(1),t.class||(t.class=[]),t.class.includes(n)||t.class.push(n);break;case"[":const[e,s,r]=n.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);t[s]=r}return t};class d extends l{constructor(t,n,s,r,i=!1){super();const o=Symbol();i||(n[e]||(n[e]=[]),n[e].push(this));let c,a,l,u,f,h={};if(s){const[e,n,r,i]=((e,t)=>{if(!(t=t.match(new RegExp("^"+e+"-([a-z][0-9a-z-]{1,}):?([a-z][0-9a-z-]*)?(\\..*]*)?$","i"))))return;let[n,s,r,i]=t;r=""!==r?r:null;const o=r?r.replace(/-(\w)/g,((e,t)=>t.toUpperCase())):null;return i=i?i.substring(1).split("."):[],[s,r,o,i]})(t.getLibrary().getOptions().prefix,s);c=e,a=r,l=n,u=i,i&&(f=(e=>{const t={};for(const n of e){const e=n.indexOf("-");if(e<0){t[n]=!0;continue}if(0===e){t[n.substring(1)]=!1;continue}const s=n.substring(0,e);let r=n.substring(e+1);const i=Number.parseInt(r);isNaN(i)||(r=i),t[s]=r}return t})(i))}this.getComponent=()=>t,this.getElement=()=>n,this.getId=()=>o,this.getDirective=()=>c,this.getKey=()=>a,this.getKeyRaw=()=>l,this.getModifiers=()=>Object.assign({},f),this.getModifiersRaw=()=>u,this.getName=()=>s,this.getValue=()=>r,this.setValue=e=>{r=e,this.dispatchEvent("changed",[this])},this.destroy=()=>{this.clearAccessed();const t=n[e].indexOf(this);t>=0&&n[e].splice(t,1),this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.accessed=(e,t)=>{if(h[e]){if(h[e].includes(t))return}else h[e]=[];h[e].push(t),this.dispatchEvent("accessed",[this,e,t])},this.clearAccessed=()=>{h={}},this.hasAccessed=(e,t)=>{if(!(e in h))return!1;const n=h[e];for(const e of t)if(n.includes(e))return!0;return!1},this.clone=()=>new d(t,n,s,r,!0)}}const f=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"];function h(e,t){let n=!1;const s={};for(const e of f)s[e]=(...s)=>{if(!n)return e in t?t[e](...s):Reflect[e](...s)};return{proxy:new Proxy(e,s),revoke:()=>{n=!0}}}class g extends l{constructor(e={}){super(),e=Object.assign({delete:!0,get:!0,set:!0},e);const t=new WeakMap;this.add=(n,s=[])=>{if(t.has(n))return t.get(n);for(const e in n)n[e]&&"object"==typeof n[e]&&(n[e]=this.add(n[e],[...s,e]));const r={};e.delete&&(r.deleteProperty=(e,t)=>{if(!Reflect.has(e,t))return!0;this.remove(e,t);const n=Reflect.deleteProperty(e,t);return n&&this.dispatchEvent("delete",[e,Array.isArray(e)?[...s]:[...s,t]]),n}),e.get&&(r.get=(e,t,n)=>(t!==Symbol.unscopables&&this.dispatchEvent("get",[e,[...s,t],n]),Reflect.get(e,t,n))),e.set&&(r.set=(e,t,n,r)=>(e[t]===n||("object"==typeof n&&(n=this.add(n,[...s,t])),e[t]=n,this.dispatchEvent("set",[e,Array.isArray(e)?[...s]:[...s,t],n,r])),!0));const i=h(n,r);return t.set(i,n),i.proxy},this.remove=e=>{if(!t.has(e))return;const n=t.get(e);t.delete(n);for(const e in n.proxy)"object"==typeof n.proxy[e]&&this.remove(n.proxy[e]);n.revoke()}}}const p=e=>{if(e.parentElement)return(e=e.parentElement)[t]?e[t]:p(e)},m=()=>({createContexts:b,createContextsProxy:v,RevocableProxy:h}),b=(e,t,n,s=null)=>{const r={},i=[];let o="",c="";const a=e.getLibrary().getContexts();for(const s of a){if(!s||!s.name)continue;const a=s.create(e,t,n,m());a&&a.value&&(a.destroy&&"function"==typeof a.destroy&&i.push(a.destroy),s.deconstruct&&"object"==typeof a.value&&(c+="with("+s.name+") { ",o+=" }"),r[s.name]=a.value)}if("object"==typeof s)for(const e in s)r[e]=s[e];return{after:o,before:c,destroy:()=>{i.forEach((e=>e(m())))},contexts:r}},v=(e,t,n,s=null)=>{let r=null;const i=h({},{get:(i,o)=>(r||(r=b(e,t,n,s)),o in r.contexts?(t.accessed(e.getId(),o),r.contexts[o]):r.contexts.$state&&o in r.contexts.$state?(t.accessed(e.getId(),"$state"),r.contexts.$state[o]):void 0)});return{contexts:i.proxy,destroy:()=>{r&&r.destroy&&r.destroy(e,t),i.revoke()}}},y=(e,t,n,s=null,r=null)=>{r=Object.assign({return:!0},r);const i=[];let o,{after:c,before:a,contexts:l,destroy:u}=b(e,t,((e,t)=>{i.push({id:e,path:t})}),s);r.return&&(a+="return ");try{o=new Function(...Object.keys(l),a+n+c)(...Object.values(l))}catch(e){throw Error(e)}return u(),i.length>0&&e.getLibrary().update(i),o},E=(e,t)=>{for(const n in t)if("class"!==n)e.setAttribute(n,t[n]);else for(const n of t.class)e.classList.add(n)},x=(e,t)=>{for(const n in t)if("class"!==n)t[n]&&e.attributes[n]!==t[n]||e.removeAttribute(n);else for(const n of t.class)e.classList.remove(n)},A=(e,t,n)=>{if("value"!==t||"INPUT"!==e.tagName)"checked"!==t||"checkbox"!==e.type&&"radio"!==e.type?("class"===t&&(Array.isArray(n)?n=n.join(" "):"object"==typeof n&&(n=Object.entries(n).filter((([e,t])=>t)).map((([e])=>e)).join(" "))),"style"===t&&(Array.isArray(n)?n=n.join(" "):"object"==typeof n&&(n=Object.entries(n).map((([e,t])=>e+":"+t)).join(";"))),!1===n||null==n?e.removeAttribute(t):e.setAttribute(t,n)):e.checked=!!n;else{if(n||(n=""),e.getAttribute(t)===n)return;e.setAttribute(t,n)}},k=(e,t)=>{for(const n in t)A(e,n,t[n])},O=(e,t,n,s=null)=>{if(1!==n.nodeType)return void(s&&s());const{prefix:r}=t.getLibrary().getOptions(),i=r+"-transition:"+e,o=t=>{n.dispatchEvent(new CustomEvent("transition-"+t)),n.dispatchEvent(new CustomEvent("transition-"+e+"-"+t))};let c,a,l,d,f=!1;const h={};return c=i,a=n.getAttribute(c),a&&(h.during=u(a),E(n,h.during)),c=i+".from",a=n.getAttribute(c),a&&(h.from=u(a),E(n,h.from)),o("start"),d=requestAnimationFrame((()=>{if(d=null,f)return;if(h.from&&(x(n,h.from),h.from=void 0),c=i+".to",a=n.getAttribute(c),a)h.to=u(a),E(n,h.to);else if(!h.during)return o("end"),s&&s(),void(f=!0);const e=getComputedStyle(n);let t=1e3*Number(e.transitionDuration.replace(/,.*/,"").replace("s",""));0===t&&(t=1e3*Number(e.animationDuration.replace("s",""))),l=setTimeout((()=>{l=null,f||(h.during&&(x(n,h.during),h.during=void 0),h.to&&(x(n,h.to),h.to=void 0),o("end"),s&&s(),f=!0)}),t)})),()=>{f&&(f=!0,h.during&&(x(n,h.during),h.during=void 0),h.from?(x(n,h.from),h.from=void 0):h.to&&(x(n,h.to),h.to=void 0),d?(cancelAnimationFrame(d),d=null):l&&(clearTimeout(l),l=null),o("end"),s&&s())}},L=(e,t,n)=>O("in",e,t,n),w=(e,t,n)=>O("out",e,t,n),$=(e,t)=>{e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},N=(e,t)=>{let n=-1,s=null;return()=>{if(n>=0&&s){const e=s();if(e)return e}let r=null;do{if(n++,n>=e.childElementCount)return null;r=e.children[n]}while(!t(r));return r.childElementCount&&(s=N(r,t)),r}},j=()=>({executeExpression:y,transition:O,transitionIn:L,transitionOut:w});class C{constructor(e,n){const s=Symbol(),{prefix:r}=e.getOptions();let i,o,c,a=[],l=!1,u=!1;if(!n.attributes[r+"-state"])return;n[t]=this;const f=[];let h=p(n);h&&(h.getChildren().includes(this)||(h.getChildren().push(this),e.update([{id:h.getId(),path:"children"}]))),this.getAttributes=()=>a,this.getChildren=()=>f,this.getElement=()=>n,this.getId=()=>s,this.getLibrary=()=>e,this.getParent=()=>h,this.getProxy=()=>o,this.getState=()=>c,this.setParent=e=>{h=e},this.initialize=()=>{if(u)return;u=!0;const e=r+"-state",t=n.attributes[e].value;i=y(this,new d(this,n,null,t),t)??{},Array.isArray(i)||"object"!=typeof i||(o=new g,c=o.add(i),this.scanAttributes(n))},this.destroy=()=>{if(!u)return;if(a.length>0){const t=e.getDirectivesObject();for(const e in t)t[e].destroy||(t[e]=void 0);for(const e of a){const n=t[e.getKey()];n&&n.destroy(this,e,j()),e.destroy()}}delete n[t],a=[],u=!1,o.remove(i),c=null,o=null,i=null;const r=[];if(f.length>0){for(const e of f)e.setParent(h),r.push({id:e.getId(),path:"parent"});r.push({id:s,path:"children"})}h&&(f.length>0&&(h.getChildren().push(...f),r.push({id:h.getId(),path:"children"})),r.push({id:s,path:"parent"})),r.length>0&&e.update(r),m("destroyed",{element:n,id:s})},this.addAttribute=(t,n,s)=>{const r=e.getDirectivesNames(),i=new d(this,t,n,s);let o=i.length;const c=r.indexOf(i.getDirective());for(let e=a.length-1;e>=0;e--)if(r.indexOf(a[e].getDirective())<=c){o=e+1;break}return a.splice(o,0,i),i},this.removeAttribute=t=>{const n=a.indexOf(t);if(n<0)return;const s=e.getDirectivesObject[t.getKey()];s&&s.destroy&&s.destroy(this,t,j()),a.splice(n,1),t.destroy()},this.scanAttributes=t=>{const n=r+"-state",s=[],i=N(t,(e=>!e.hasAttribute(n)));do{for(const{name:n,value:r}of t.attributes)e.isDirectiveName(n)&&s.push(this.addAttribute(t,n,r))}while(t=i());return s},this.updateAttribute=t=>{if(!t.getElement()||null===t.getValue()||void 0===t.getValue())return void this.removeAttribute(t);const n=e.getDirectivesObject();t.clearAccessed();const s=n[t.getDirective()];s&&s.update(this,t,j())},this.updateAttributes=e=>{if(!u||e.length<=0)l||(l=!0,m("updated",{attributes:e,element:n,id:s}));else{for(const t of e)this.updateAttribute(t);l=!0,m("updated",{attributes:e,element:n,id:s})}},this.update=e=>{if(!u)return;const t=Object.getOwnPropertySymbols(e),r=[];for(const n of a)for(const s of t)n.hasAccessed(s,e[s])&&(this.updateAttribute(n),r.push(n));(!l||r.length>0)&&(l=!0,m("updated",{attributes:r,element:n,id:s}))};const m=(e,t)=>{n.dispatchEvent(new CustomEvent(r+"-"+e,{detail:t,bubbles:!0}))}}}var S={name:"$children",create:(e,t,n,{createContextsProxy:s,RevocableProxy:r})=>{let i;const o=r(e.getChildren(),{get:(r,o,c)=>{if(i||(i=r.map((e=>s(e,t,n))),t.accessed(e.getId(),"children")),isNaN(o))return Reflect.get(i,o,c);const a=Reflect.get(i,o,c);return a?a.contexts:void 0}});return{value:o.proxy,destroy:()=>{i&&i.forEach((e=>e.destroy())),o.revoke()}}}},T={name:"$component",create:e=>({value:e.getElement()})},P={name:"$element",create:(e,t)=>({value:t.getElement()})},I={name:"$dispatch",create:e=>({value:(t,n={})=>{e.getElement().dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0}))}})},D={deconstruct:!0,name:"$for",create:(e,t,s,{RevocableProxy:r})=>{if(e!==t.getComponent())return;let i=t.getElement();const o=e.getElement(),c=[],a={};for(;i&&!i.isSameNode(o);){const e=i[n];if(e){c.push(e);for(const t in e.variables)a[t]=e.variables[t]}i=i.parentNode}if(0===c.length)return;const l=r(a,{get:(e,n)=>{for(const e of c)if(n in e.variables)return t.accessed(e.id,"$for"),e.variables[n]}});return{value:l.proxy,destroy:()=>{l.revoke()}}}},V={name:"$inContext",create:(e,t,n,{createContexts:s})=>({value:r=>{const{contexts:i,destroy:o}=s(e,t,n,{}),c=r(i);return o(),c}})},R={name:"$nextTick",create:(e,t,n,{createContexts:s})=>{let r,i=!1;return{value:o=>{(()=>{if(i)return;i=!0;const o=e.getLibrary();r=[];const c=()=>{a();const{contexts:i,destroy:o}=s(e,t,n,{});for(const e of r)e(i);o()},a=()=>{o.removeEventListener("updated",c),t.removeEventListener("changed",a),t.removeEventListener("destroyed",a)};o.addEventListener("updated",c),t.addEventListener("changed",a),t.addEventListener("destroyed",a)})(),r.push(o)}}}},z={name:"$parent",create:(e,t,n,{createContextsProxy:s})=>{const r=e.getParent();if(!r)return{key:"$parent",value:null};const{contexts:i,destroy:o}=s(r,t,n);return{value:i,destroy:o}}},M={name:"$references",create:(e,t,n,{RevocableProxy:s})=>{if(!e[c])return{key:"$references",value:[]};let r=e[a];if(!r){const t=e[c],n=Object.getOwnPropertySymbols(t);r={};for(const e of n){const{element:n,name:s}=t[e];r[s]=n}e[a]=r}const i=s(r,{get:(n,s,r)=>(t.accessed(e.getId(),"$references."+s),Reflect.get(n,s,r))});return{value:i.proxy,destroy:()=>{i.revoke()}}}},_={deconstruct:!0,name:"$state",create:(e,t,n,{RevocableProxy:s})=>{const r=e.getProxy(),i=e.getState();if(!r||!i)return;const o=(t,s)=>n(e.getId(),"$state."+s.join(".")),c=(n,s)=>t.accessed(e.getId(),"$state."+s.join(".")),a=(t,s)=>n(e.getId(),"$state."+s.join("."));r.addEventListener("delete",o),r.addEventListener("get",c),r.addEventListener("set",a);const l=s(i,{});return{value:l.proxy,destroy:()=>{r.removeEventListener("delete",o),r.removeEventListener("get",c),r.removeEventListener("set",a),l.revoke()}}}},K={name:"attribute",update:(e,t,{executeExpression:n})=>{const s=t.getElement(),r=t.getModifiers();let i=n(e,t,t.getValue());if(r.selector){if("string"!=typeof i)return;return i=u(i),void k(s,i)}if(Array.isArray(i))return;if("object"==typeof i)return void k(s,i);const o=t.getKey();A(s,o,i)}},q={name:"cloak",update:function(e,t,{transitionIn:n}){const s=t.getElement();s.removeAttribute(e.getLibrary().getOptions().prefix+"-"+this.name),n(e,s)}};const U=(e,...t)=>{const n={};for(let s=0;s<t.length&&!(s>=e.length);s++)n[e[s]]=t[s];return n},W=(e,t,s=-1)=>++s>=e.length?-1:e[s][n].value===t?s:W(e,t,s),F=(e,t,s,r,i,o,c)=>{const a=W(r,o,i);if(a>=0){if(a===i+1)return;const e=r[a];return $(r[i]??s,e),void t(e[n].id)}let l=document.importNode(s.content,!0);const u=-1===i?s:r[i];$(u,l),l=u.nextElementSibling,L(e,l),l[n]={id:Symbol(),value:o,variables:c},r.splice(i+1,0,l)},X=(e,t,n)=>{if(!(t.length<n))for(let s=t.length-1;s>=n;s--){const n=t[s];t.splice(s,1),w(e,n,(()=>{n.remove()}))}};var H={name:"for",update:(e,t,{executeExpression:s})=>{const r=t.getElement();if("TEMPLATE"!==r.tagName)return;const i=(e=>{const t=e.match(/^([$_a-z0-9,(){}\s]{1,}?)\s+(?:in|of)\s+([\s\S]{1,})$/i);if(!t)return;let n=t[1].replace(/^[\s({]*|[)}\s]*$/g,"");return n=n.match(/^([$_a-z0-9]{1,})?(?:,\s+?)?([$_a-z0-9]{1,})?(?:,\s+)?([$_a-z0-9]{1,})?$/i),n?(n.shift(),{iterable:t[2].trim(),variables:[...n]}):void 0})(t.getValue());if(!i)return;t[n]||(t[n]=[]);const o=t[n],c={},a=e=>{c[e]||(c[e]=["$for"])};let l;l=isNaN(i.iterable)?s(e,t,i.iterable):Number(i.iterable);const u=typeof l;if("number"===u){for(let t=0;t<l;t++){const n=U(i.variables,t);F(e,a,r,o,t-1,l,n)}X(e,o,l)}else if("string"===u){for(let t=0;t<l.length;t++){const n=l[t],s=U(i.variables,n,t);F(e,a,r,o,t-1,n,s)}X(e,o,l.length)}else{let t,n;try{const e=[...l];t=!0,n=e.length}catch{}if(t)for(let t=0;t<n;t++){const n=l[t],s=U(i.variables,n,t);F(e,a,r,o,t-1,n,s)}else{const t=Object.keys(l);n=t.length;for(let s=0;s<n;s++){const n=t[s],c=l[n],u=U(i.variables,n,c,s);F(e,a,r,o,s-1,c,u)}}X(e,o,n)}Object.getOwnPropertySymbols(c).length>0&&e.update(c)},destroy:(e,t)=>{if(!e[n])return;if(!t[n])return;const s=t[n];for(const t of s)w(e,t,(()=>{t.remove()}));delete t[n]}},B={name:"html",update:(e,t,{executeExpression:n})=>{const s=t.getElement(),r=n(e,t,t.getValue());s.innerHTML!==r&&(s.innerHTML=r)}},G={name:"if",update:(e,t,{executeExpression:n,transitionIn:r,transitionOut:i})=>{const o=t.getElement();if("TEMPLATE"!==o.tagName)return;if(o.childCount>1)return;const c=n(e,t,t.getValue());let a=o[s];c?a||(a=document.importNode(o.content,!0),$(o,a),o[s]=a=o.nextElementSibling,r(e,a)):a&&i(e,a,(()=>{a.remove()}))},destroy:(e,t,{transitionOut:n})=>{const r=t.getElement(),i=r[s];i&&n(e,i,(()=>{i.remove(),r[s]=void 0}))}};const J=(e,t)=>{if(!t[r])return;const n=e.getElement(),s=e.getLibrary().getOptions().prefix+"-updated";n.removeEventListener(s,t[r].handler),delete t[r]};var Q={name:"initialized",update:(e,t,{executeExpression:n})=>{const s=e.getElement(),i=t.getValue(),o=e.getLibrary().getOptions().prefix+"-updated";if(t[r]){if(t[r].value===i)return;s.removeEventListener(o,t[r].handler),delete t[r]}const c=({detail:r})=>{r.element===s&&(n(e,t.clone(),i,{},{return:!1}),J(e,t))};s.addEventListener(o,c,{once:!0}),t[r]={handler:c,value:i}},destroy:J};const Y=["alt","ctrl","meta","shift"];var Z={name:"on",update:(e,t,{executeExpression:n})=>{let s,r=t.getKeyRaw();if(!r)return;r.startsWith("keydown-")?(s=r.substring(8).toLowerCase(),r="keydown"):r.startsWith("keyup-")&&(s=r.substring(6).toLowerCase(),r="keyup");const i=t.getElement(),c=t.getValue();if(t[o]){if(t[o].value===c)return;t[o].target.removeEventListener(r,t[o].handler),t[o].timeout&&clearTimeout(t[o].timeout),delete t[o]}const a=t.getModifiers(),l={};a.capture&&(l.capture=!0),a.once&&(l.once=!0),a.passive&&(l.passive=!0);let u=0;a.buffer?(u=1,!0===a.buffer&&(a.buffer=5)):a.debounce?(u=2,!0===a.debounce&&(a.debounce=500)):a.throttle&&(u=3,!0===a.throttle&&(a.throttle=500));const d=[];if(s){a.meta=!!a.meta||a.cmd||a.super;for(const e of Y)a[e]&&d.push(e)}const f=l=>{if(a.self&&l.target!==i)return;if(a.outside&&i.contains(l.target))return;if(("keydown"===r||"keyup"===r)&&s){for(const e of d)if(!l[e+"Key"])return;let e=a.code?l.code:l.key;if(" "===e&&(e="space"),e=e.toLowerCase(),s!==e)return}a.prevent&&l.preventDefault(),a.stop&&l.stopPropagation();const f=()=>{n(e,t.clone(),c,{$event:l,$events:t[o].buffer},{return:!1}),t[o].buffer=[]};if(t[o].buffer.push(l),1===u){if(t[o].buffer.length<a.buffer)return;f()}else if(1===u)t[o].timeout&&(clearTimeout(t[o].timeout),t[o].timeout=null),t[o].timeout=setTimeout(f,a.debounce);else if(3===u){const e=window.performance.now();if(t[o].lastExecution&&e-t[o].lastExecution<a.throttle)return;f(),t[o].lastExecution=e}else f()},h=a.outside?document:i;h.addEventListener(r,f,l),t[o]={buffer:[],handler:f,target:h,timeout:t[o]?t[o].timeout:void 0,value:c}},destroy:(e,t)=>{if(!t[o])return;const n=t.getKeyRaw();t[o].target.removeEventListener(n,t[o].handler),t[o].timeout&&clearTimeout(t[o].timeout),delete t[o]}};const ee=(e,t)=>{if(!e[c])return;const n=t.getId();if(!e[c][n])return;const s=e.getLibrary(),r=e.getId(),i=t.getValue().trim();delete e[c][n],delete e[a],0===Object.keys(e[c]).length&&delete e[c],s.update([{id:r,path:"$references."+i}])};var te={name:"reference",update:(e,t)=>{const n=t.getValue().trim();if(!/^[_$a-z]{1}[_\-$a-z0-9]{0,}$/i.test(n))return void ee(e,t);const s=e.getLibrary(),r=e.getId(),i=t.getElement(),o=t.getId();e[c]||(e[c]={}),e[c][o]={element:i,name:n},delete e[a],s.update([{id:r,path:"$references."+n}])},destroy:ee},ne={name:"select",update:(e,t,{executeExpression:n})=>{const s=t.getElement(),r=s.getAttribute("type");if("SELECT"!==s.tagName&&("INPUT"!==s.tagName||"checkbox"!==r&&"radio"!==r))return;const i=n(e,t,t.getValue());if("SELECT"===s.tagName)for(const e of Array.from(s.options)){const t=Array.isArray(i)?i.includes(e.value):i===e.value;e.selected!==t&&(e.selected=t,t?e.setAttribute("selected",""):e.removeAttribute("selected"))}else if("checkbox"===r){const e=i.includes(s.value);s.checked!==e&&(e?s.setAttribute("checked",""):s.removeAttribute("checked"))}else{const e=i===s.value;s.checked!==e&&(e?s.setAttribute("checked",""):s.removeAttribute("checked"))}}},se={name:"show",update:(e,t,{executeExpression:n,transitionIn:s,transitionOut:r})=>{const i=t.getElement();n(e,t,t.getValue())?(i.style.display=null,s(e,i)):r(e,i,(()=>{i.style.display="none"}))}};const re=(e,t,n)=>{if("object"!=typeof e)return;let s=0;for(;s<t.length-1;s++)if("object"!=typeof(e=e[t[s]]))return;e[t[s]]=n},ie=function(e,t,n){const s=(t,n)=>{n[e]&&(n.getElement().removeEventListener("input",n[e]),delete n[e])};return{update:(t,r,{executeExpression:i})=>{const o=r.getElement(),c=!r[e];if(c&&("DIV"!==o.tagName||!o.hasAttribute("contenteditable"))&&"INPUT"!==o.tagName&&"SELECT"!==o.tagName&&"TEXTAREA"!==o.tagName)return;const a=r.getValue();if(!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(a))return void s(0,r);let l=a;if(l.startsWith(n)&&(l=l.substring(n.length)),l=l.split("."),c){const{data:n,id:s,path:c}=((e,t)=>{let n=t.getValue();return n.startsWith("$state.")||(n="$state."+n),{data:e.getState(),id:e.getId(),path:n}})(t,r);let u;switch(o.tagName){case"DIV":u=()=>(re(n,l,o.innerText),!0);break;case"INPUT":u=()=>{if("checkbox"===o.type){const e=i(t,r.clone(),a);if(o.checked){if(!e)return re(n,l,[o.value]),!0;if(!e.includes(o.value))return e.push(o.value),!0}else if(e){const t=e.indexOf(o.value);if(t>=0)return e.splice(t,1),!0}}else{if("radio"!==o.type)return re(n,l,o.value),!0;{const e=i(t,r.clone(),a);if(o.checked){if(e!==o.value)return re(n,l,o.value),!0}else if(e===o.value)return re(n,l,null),!0}}return!1};break;case"TEXTAREA":u=()=>(re(n,l,o.value),!0);break;case"SELECT":u=()=>{if(o.multiple){const e=[];for(const t of o.selectedOptions)e.push(t.value);return re(n,l,e),!0}return re(n,l,o.selectedOptions[0].value),!0}}const d=()=>{u()&&t.getLibrary().update([{id:s,path:c}])};o.addEventListener("input",d),r[e]=d}const u=i(t,r,a);switch(o.tagName){case"DIV":case"TEXTAREA":u!==o.innerText&&(o.innerText=u);break;case"INPUT":if("checkbox"===o.type){const e=u.includes(o.value);o.checked!==e&&(o.checked=e,e?o.setAttribute("checked",""):o.removeAttribute("checked"))}else if("radio"===o.type){const e=u===o.value;o.checked!==e&&(o.checked=e,e?o.setAttribute("checked",""):o.removeAttribute("checked"))}else u!==o.value&&o.setAttribute("value",u);break;case"SELECT":for(const e of Array.from(o.options)){const t=Array.isArray(u)?u.includes(e.value):u===e.value;e.selected!==t&&(e.selected=t,t?e.setAttribute("selected",""):e.removeAttribute("selected"))}}},destroy:s}}(i,0,"$state.");ie.name="sync-state";var oe={name:"text",update:(e,t,{executeExpression:n})=>{const s=t.getElement(),r=t.getModifiers(),i=n(e,t,t.getValue());r.content?s.textContent!==i&&(s.textContent=i):s.innerText!==i&&(s.innerText=i)}},ce={name:"watch",update:(e,t,{executeExpression:n})=>{const s=t.getValue();n(e,t,s,{},{return:!1})}};export default class extends l{constructor(n){super();let{prefix:s,root:r}=n=Object.assign({prefix:"d",root:document.body.firstElementChild},n);if("string"==typeof r&&(n.root=r=document.querySelector(r)),!s)return;if("string"!=typeof s)return;if(!r)return;if("object"!=typeof r)return;const i=Symbol();let o,c,a,l=!1,u=!1;const d=[],f=[S,T,P,I,V,R,z,M,_,D],h=[te,K,H,B,G,oe,q,Q,Z,ne,se,ie,ce];let g,m,b;this.getEnabled=()=>l,this.getId=()=>i,this.getOptions=()=>Object.assign({},n),this.enable=()=>{if(l)return this;u=!1,o=[],a={},this.dispatchEvent("enabling",[this]),l=!0,g=h.map((e=>e.name)),m={};for(const e of h)m[e.name]=e;b=new RegExp("^"+s+"-("+g.join("|")+")(?:[$-_.a-z0-9]{0,})?$","i"),c=new MutationObserver(E.bind(this)),c.observe(r,{attributes:!0,childList:!0,subtree:!0});const e=s+"-state",t=r.querySelectorAll("["+e+"]");return v(r.hasAttribute(e)?r:null,...t),this.dispatchEvent("enabled",[this]),this.dispatchEvent("updated",[this]),this},this.disable=()=>l?(c.disconnect(),c=null,u=o=a=null,this.dispatchEvent("disabling",[this],{reverse:!0}),y(...d),g=m=b=null,l=!1,this.dispatchEvent("disabled",[this],{reverse:!0}),this):this;const v=(...e)=>{const n=[],s=[];for(const r of e){if(!r)continue;if(r[t])continue;const e=new C(this,r);d.push(e),n.push(e),s.push(r)}s.length>0&&this.dispatchEvent("components-added",[this,s]);for(const e of n)e.initialize();for(const e of n)e.updateAttributes(e.getAttributes());return n},y=(...e)=>{const t=[];for(const n of e){const e=d.indexOf(n);e<0||(t.push(n.getElement()),n.destroy(),d.splice(e,1))}return t.length>0&&this.dispatchEvent("components-removed",[this,t]),t};this.getContexts=()=>[...f],this.addContexts=(e,...t)=>{if(l)return;e<0?e=f.length+e%f.length:e>f.length&&(e=f.length);const n=[];for(let s=0;s<t.length;s++){const r=t[s];f.includes(r)||(f.splice(e+s,0,r),n.push(r))}return n.length>0&&this.dispatchEvent("contexts-added",[this,n]),n},this.removeContexts=(...e)=>{if(l)return;const t=[];for(const n of e)f.indexOf(n)<0||t.push(n);return t.length>0&&this.dispatchEvent("contexts-removed",[this,t]),t},this.getDirectives=()=>[...h],this.getDirectivesNames=()=>[...g],this.getDirectivesObject=()=>Object.assign({},m),this.isDirectiveName=e=>b.test(e),this.addDirectives=(e,...t)=>{if(l)return;e<0?e=h.length+e%h.length:e>h.length&&(e=h.length);const n=[];for(let s=0;s<t.length;s++){const r=t[s];h.includes(r)||(h.splice(e+s,0,r),n.push(r))}return n.length>0&&(g=m=b=null,this.dispatchEvent("directives-added",[this,n])),n},this.removeDirectives=(...e)=>{if(l)return;const t=[];for(const n of e)h.indexOf(n)<0||t.push(n);return t.length>0&&(g=m=b=null,this.dispatchEvent("directives-removed",[this,t])),t},this.update=e=>{if(l){if(e)for(const t of e){const{id:e,path:n}=t;e in a?a[e].includes(n)||a[e].push(n):a[e]=[n]}if(!u&&0!==Object.getOwnPropertySymbols(a).length){u=!0,e=a,a={};for(const t of d)t.update(e);u=!1,Object.getOwnPropertySymbols(a).length>0?window.requestAnimationFrame((()=>this.update())):o.length>0?E():this.dispatchEvent("updated",[this])}}};const E=n=>{if(o.push(...n),u)return;if(0===o.length)return;u=!0,n=[...o],o=[];const r=s+"-state",i=[],c=[];for(const s of n)if("childList"===s.type){for(let n of s.removedNodes)if(1===n.nodeType)if(n[t]){c.unshift(n[t]);const e=n.querySelectorAll(r);for(const n of e)n[t]&&c.unshift(n)}else{const s=N(n,(e=>!e[t]||(c.unshift(e[t]),!1)));do{if(n[e])for(const t of n[e])t.getComponent().removeAttribute(t)}while(n=s())}for(const e of s.addedNodes){if(1!==e.nodeType)continue;const t=e.querySelectorAll("["+r+"]");for(const e of t)i.push(e);if(e.hasAttribute(r)){i.push(e);continue}const n=p(e);if(n){const t=n.scanAttributes(e);n.updateAttributes(t)}}}else if("attributes"===s.type){if(s.attributeName===r){if(s.target[t])continue;const n=p(s.target);if(n){let t=s.target;const i=N(t,(e=>e.hasAttribute(r)));do{for(const s of t[e])n.removeAttribute(s)}while(t=i())}v(s.target);continue}if(!b.test(s.attributeName))continue;const n=p(s.target);if(!n)continue;let i=null;for(const t of s.target[e])if(t.getName()===s.attributeName){i=t;break}const o=s.target.getAttribute(s.attributeName);if(!i){o&&n.addAttribute(s.target,s.attributeName,o);continue}i.setValue(o),n.updateAttribute(i)}c.length>0&&y(...c),i.length>0&&v(...i),u=!1,o.length>0?E():Object.getOwnPropertySymbols(a).length>0&&this.update()}}}
