var G=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],V=(r,e)=>{let t=!1,n={};for(let i of G)n[i]=(...o)=>{if(t){console.error("illegal operation attempted on a revoked proxy");return}return i in e?e[i](...o):Reflect[i](...o)};return{proxy:new Proxy(r,n),revoke:()=>{t=!0}}};var g=Symbol("ROUTE_TO"),E=Symbol("ROUTER"),d=Symbol("ROUTE");var w=r=>{if(!!r.parentElement)return r=r.parentElement,r[E]?r[E]:closestRouter(r)};var U={name:"$router",create:(r,e)=>{let t=e.getElement(),n=null,i=V({},{get:(o,a,l)=>{if(n===null&&(t[E]?n=t[E]:n=w(t),n||(n=!1)),e.accessed(n.getId(),""),!!n)return Reflect.get(n,a,l)}});return{value:i.proxy,destroy:()=>{i.revoke()}}}};function J(r){for(var e=[],t=0;t<r.length;){var n=r[t];if(n==="*"||n==="+"||n==="?"){e.push({type:"MODIFIER",index:t,value:r[t++]});continue}if(n==="\\"){e.push({type:"ESCAPED_CHAR",index:t++,value:r[t++]});continue}if(n==="{"){e.push({type:"OPEN",index:t,value:r[t++]});continue}if(n==="}"){e.push({type:"CLOSE",index:t,value:r[t++]});continue}if(n===":"){for(var i="",o=t+1;o<r.length;){var a=r.charCodeAt(o);if(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||a===95){i+=r[o++];continue}break}if(!i)throw new TypeError("Missing parameter name at ".concat(t));e.push({type:"NAME",index:t,value:i}),t=o;continue}if(n==="("){var l=1,c="",o=t+1;if(r[o]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(o));for(;o<r.length;){if(r[o]==="\\"){c+=r[o++]+r[o++];continue}if(r[o]===")"){if(l--,l===0){o++;break}}else if(r[o]==="("&&(l++,r[o+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(o));c+=r[o++]}if(l)throw new TypeError("Unbalanced pattern at ".concat(t));if(!c)throw new TypeError("Missing pattern at ".concat(t));e.push({type:"PATTERN",index:t,value:c}),t=o;continue}e.push({type:"CHAR",index:t,value:r[t++]})}return e.push({type:"END",index:t,value:""}),e}function Q(r,e){e===void 0&&(e={});for(var t=J(r),n=e.prefixes,i=n===void 0?"./":n,o="[^".concat(O(e.delimiter||"/#?"),"]+?"),a=[],l=0,c=0,u="",f=function(m){if(c<t.length&&t[c].type===m)return t[c++].value},p=function(m){var y=f(m);if(y!==void 0)return y;var R=t[c],H=R.type,M=R.index;throw new TypeError("Unexpected ".concat(H," at ").concat(M,", expected ").concat(m))},D=function(){for(var m="",y;y=f("CHAR")||f("ESCAPED_CHAR");)m+=y;return m};c<t.length;){var A=f("CHAR"),N=f("NAME"),T=f("PATTERN");if(N||T){var h=A||"";i.indexOf(h)===-1&&(u+=h,h=""),u&&(a.push(u),u=""),a.push({name:N||l++,prefix:h,suffix:"",pattern:T||o,modifier:f("MODIFIER")||""});continue}var v=A||f("ESCAPED_CHAR");if(v){u+=v;continue}u&&(a.push(u),u="");var P=f("OPEN");if(P){var h=D(),L=f("NAME")||"",s=f("PATTERN")||"",x=D();p("CLOSE"),a.push({name:L||(s?l++:""),pattern:L&&!s?o:s,prefix:h,suffix:x,modifier:f("MODIFIER")||""});continue}p("END")}return a}function O(r){return r.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function W(r){return r&&r.sensitive?"":"i"}function X(r,e){if(!e)return r;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=t.exec(r.source);i;)e.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=t.exec(r.source);return r}function Y(r,e,t){var n=r.map(function(i){return b(i,e,t).source});return new RegExp("(?:".concat(n.join("|"),")"),W(t))}function Z(r,e,t){return k(Q(r,t),e,t)}function k(r,e,t){t===void 0&&(t={});for(var n=t.strict,i=n===void 0?!1:n,o=t.start,a=o===void 0?!0:o,l=t.end,c=l===void 0?!0:l,u=t.encode,f=u===void 0?function(M){return M}:u,p=t.delimiter,D=p===void 0?"/#?":p,A=t.endsWith,N=A===void 0?"":A,T="[".concat(O(N),"]|$"),h="[".concat(O(D),"]"),v=a?"^":"",P=0,L=r;P<L.length;P++){var s=L[P];if(typeof s=="string")v+=O(f(s));else{var x=O(f(s.prefix)),m=O(f(s.suffix));if(s.pattern)if(e&&e.push(s),x||m)if(s.modifier==="+"||s.modifier==="*"){var y=s.modifier==="*"?"?":"";v+="(?:".concat(x,"((?:").concat(s.pattern,")(?:").concat(m).concat(x,"(?:").concat(s.pattern,"))*)").concat(m,")").concat(y)}else v+="(?:".concat(x,"(").concat(s.pattern,")").concat(m,")").concat(s.modifier);else s.modifier==="+"||s.modifier==="*"?v+="((?:".concat(s.pattern,")").concat(s.modifier,")"):v+="(".concat(s.pattern,")").concat(s.modifier);else v+="(?:".concat(x).concat(m,")").concat(s.modifier)}}if(c)i||(v+="".concat(h,"?")),v+=t.endsWith?"(?=".concat(T,")"):"$";else{var R=r[r.length-1],H=typeof R=="string"?h.indexOf(R[R.length-1])>-1:R===void 0;i||(v+="(?:".concat(h,"(?=").concat(T,"))?")),H||(v+="(?=".concat(h,"|").concat(T,")"))}return new RegExp(v,W(t))}function b(r,e,t){return r instanceof RegExp?X(r,e):Array.isArray(r)?Y(r,e,t):Z(r,e,t)}var I=class{constructor(){let e={};this.addEventListener=(t,n,i=null)=>{t in e||(e[t]=[]),e[t].push({callback:n,options:i})},this.removeEventListener=(t,n)=>{if(!Object.keys(e).includes(t))return;let i=e[t],o=-1;for(let a=0;a<i.length;a++)if(i[a].callback===n){o=a;break}o<0||(i.splice(o,1),Object.keys(i).length===0&&delete e[t])},this.removeEventListeners=t=>{!t||delete e[t]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(t,n,i=null)=>{if(!e[t])return;let o=e[t];for(let a=0;a<o.length;a++){let l=i&&i.reverse?o[o.length-(a+1)]:o[a];l.options&&l.options.once&&o.splice(a,1),l.callback(...n)}}}},K=I;var _=class extends K{constructor(e={}){super();let t=Symbol("ID_ROUTER");e=Object.assign({basePath:"",path:null,pathToRegexp:{},updateHistory:!1},e);let n=e.path,i=null,o={},a=()=>{this.setPath(window.location.pathname)};e.updateHistory&&window.addEventListener("popstate",a);let l=(c,u,f)=>{if(n=u,i=f,e.updateHistory){let p=c.includes(e.basePath)?c:e.basePath+c;p!==window.location.pathname&&window.history.pushState(null,window.document.title,p)}this.dispatchEvent("changed",[this,i,n])};this.getId=()=>t,this.getPath=()=>n,this.getRoute=()=>i,this.getRoutes=()=>Object.keys(o),this.destroy=()=>{e.updateHistory&&window.removeEventListener("popstate",a),e=null,n=null,i=null,o=null,this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.addRoute=c=>{if(o[c]=b(c,[],e.pathToRegexp),this.dispatchEvent("added",[this,c]),n){let u=n.replace(e.basePath,"");o[c].test(u)&&l(n,u,c)}},this.removeRoute=c=>{delete o[c],this.dispatchEvent("removed",[this,c]),i===c&&(n=null,i=null,this.dispatchEvent("changed",[this,i,n]))},this.setPath=c=>{let u=c.replace(e.basePath,"");if(n===u)return;let f=null;for(let p in o)if(o[p].test(u)){f=p;break}l(c,u,f)}}},B=_;var q=r=>({name:"router",update:(e,t,{processExpression:n})=>{let i=t.getElement(),o=i[E];if(!o){let a=Object.assign({},r,n(e,t.clone(),t.getValue()));o=i[E]=new B(a)}},destroy:(e,t)=>{let n=t.getElement(),i=n[E];if(!i)return;delete n[E];let o=i.getId();i.destroy(),e.getLibrary().update([{id:o,path:""}])}});var z=(r,e)=>{r.nextSibling?r.parentNode.insertBefore(e,r.nextSibling):r.parentNode.appendChild(e)};var j={name:"route",update:(r,e,{transitionIn:t,transitionOut:n})=>{let i=e.getElement(),o,a=()=>{if(o&&e[d]&&(o.removeEventListener("changed",e[d].handler),o.removeEventListener("destroyed",e[d].setup),delete e[d]),o=w(i),!o){console.warn("DoarsRouter: Router not found for route.");return}e[d]={setup:a};let l=e.getValue();o.addRoute(l);let c=(u,f)=>{if(f!==l)if(i.tagName==="TEMPLATE"){if(e[d]&&e[d].element){let p=e[d].element;n(r,p,()=>{p.remove(),e[d].element=void 0})}}else n(r,i,()=>{i.style.display="none"});else if(i.tagName==="TEMPLATE"){let p=document.importNode(i.content,!0);z(i,p),e[d].element=i.nextSibling,t(r,e[d].element)}else i.style.display=null,t(r,i)};e[d].handler=c,o.addEventListener("changed",c),c(o,o.getRoute()),o.addEventListener("destroyed",a)};a()},destroy:(r,e,{transitionOut:t})=>{let n=e.getElement();if(n.tagName==="TEMPLATE"){if(e[d]&&e[d].element){let o=e[d].element;t(r,o,()=>{o.remove(),e[d].element=void 0})}}else t(r,n,()=>{n.style.display="none"});let i=w(n);!i||e[d]&&(i.removeEventListener("destroyed",e[d].setup),e[d].handler&&i.removeEventListener("change",e[d].handler))}};var F="click",$={name:"route-to",update:(r,e)=>{let t=e.getElement(),n=e.getModifiers(),i=e.getValue();if(e[g]){if(e[g].value===i)return;e[g].target.removeEventListener(F,e[g].handler)}let o=a=>{if(n.self&&a.target!==t)return;n.prevent&&a.preventDefault(),n.stop&&a.stopPropagation();let l=w(t);!l||l.setPath(i)};t.addEventListener(F,o),e[g]={handler:o,value:i}},destroy:(r,e)=>{if(!e[g])return;e.getElement().removeEventListener(F,e[g].handler),delete e[g]}};var C=(r,...e)=>{if(!e.length)return r;let t=e.shift();if(S(r)&&S(t))for(let n in t)S(t[n])?(r[n]||Object.assign(r,{[n]:{}}),C(r[n],t[n])):Array.isArray(t[n])?r[n]=t[n].map(i=>S(i)?C({},i):i):Object.assign(r,{[n]:t[n]});return C(r,...e)};var S=r=>r&&typeof r=="object"&&!Array.isArray(r);function Ne(r,e=null){e=C({},e);let t=!1,n=function(){r.addContexts(0,U),directiveRouter=q(e),r.addDirectives(-1,directiveRouter,j,$)},i=function(){r.removeContexts(U),r.removeDirectives(directiveRouter,j,$),directiveRouter=null};this.disable=function(){!r.getEnabled()&&t&&(t=!1,r.removeEventListener("enabling",n),r.removeEventListener("disabling",i))},this.enable=function(){t||(t=!0,r.addEventListener("enabling",n),r.addEventListener("disabling",i))},this.enable()}export{Ne as default};
//# sourceMappingURL=doars-router.esm.min.js.map
