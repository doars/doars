{"version":3,"file":"doars-router.esm.js","sources":["../../utils/src/polyfills/RevocableProxy.js","../src/symbols.js","../src/utils.js","../src/contexts/router.js","../../../node_modules/path-to-regexp/dist.es2015/index.js","../../utils/src/events/EventDispatcher.js","../src/Router.js","../src/factories/directives/router.js","../../utils/src/ElementUtils.js","../src/directives/route.js","../src/directives/routeTo.js","../../utils/src/ObjectUtils.js","../src/DoarsRouter.js"],"sourcesContent":["// List of methods to revoke access to.\nconst REFLECTION_METHODS = [\n  'apply',\n  'construct',\n  'defineProperty',\n  'deleteProperty',\n  'get',\n  'getOwnPropertyDescriptor',\n  'getPrototypeOf',\n  'isExtensible',\n  'ownKeys',\n  'preventExtensions',\n  'set',\n  'setPrototypeOf',\n]\n\n/**\n * Revocable proxy made using regular a proxy and a simple boolean.\n */\nexport default (target, handler) => {\n  // Keep track of status.\n  let revoked = false\n\n  // Add revocable handlers for each given handlers.\n  const revocableHandler = {}\n  for (const key of REFLECTION_METHODS) {\n    revocableHandler[key] = (...parameters) => {\n      if (revoked) {\n        console.error('illegal operation attempted on a revoked proxy')\n        return\n      }\n\n      if (key in handler) {\n        return handler[key](...parameters)\n      }\n      return Reflect[key](...parameters)\n    }\n  }\n\n  // Return proxy and revoke method.\n  return {\n    proxy: new Proxy(target, revocableHandler),\n    revoke: () => {\n      revoked = true\n    },\n  }\n}\n","export const ROUTE_TO = Symbol('ROUTE_TO')\n\nexport const ROUTER = Symbol('ROUTER')\n\nexport const ROUTE = Symbol('ROUTE')\n","// Import symbols.\nimport { ROUTER } from './symbols.js'\n\n/**\n * Get closest router in hierarchy.\n * @param {HTMLElement} element Element to start searching from.\n * @returns {Router} Closest router.\n */\nexport const closestRouter = (element) => {\n  if (!element.parentElement) {\n    return\n  }\n  element = element.parentElement\n\n  if (element[ROUTER]) {\n    return element[ROUTER]\n  }\n\n  return closestRouter(element)\n}\n\nexport default {\n  closestRouter: closestRouter,\n}\n","// Import polyfill.\nimport RevocableProxy from '@doars/utils/src/polyfills/RevocableProxy.js'\n\n// Import symbol.\nimport { ROUTER } from '../symbols'\n\n// Import utils.\nimport { closestRouter } from '../utils.js'\n\nexport default {\n  name: '$router',\n\n  create: (component, attribute) => {\n    // Deconstruct attribute.\n    const element = attribute.getElement()\n\n    let router = null\n    const revocable = RevocableProxy({}, {\n      get: (target, propertyKey, receiver) => {\n        // Get closest router from hierarchy.\n        if (router === null) {\n          if (element[ROUTER]) {\n            router = element[ROUTER]\n          } else {\n            router = closestRouter(element)\n          }\n\n          // Set router to false so we don't look twice.\n          if (!router) {\n            router = false\n          }\n        }\n\n        // Mark as router accessed.\n        attribute.accessed(router.getId(), '')\n\n        if (!router) {\n          return\n        }\n\n        // Return router property.\n        return Reflect.get(router, propertyKey, receiver)\n      },\n    })\n\n    return {\n      value: revocable.proxy,\n\n      destroy: () => {\n        revocable.revoke()\n      },\n    }\n  },\n}\n","/**\n * Tokenize input string.\n */\nfunction lexer(str) {\n    var tokens = [];\n    var i = 0;\n    while (i < str.length) {\n        var char = str[i];\n        if (char === \"*\" || char === \"+\" || char === \"?\") {\n            tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"\\\\\") {\n            tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n            continue;\n        }\n        if (char === \"{\") {\n            tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"}\") {\n            tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \":\") {\n            var name = \"\";\n            var j = i + 1;\n            while (j < str.length) {\n                var code = str.charCodeAt(j);\n                if (\n                // `0-9`\n                (code >= 48 && code <= 57) ||\n                    // `A-Z`\n                    (code >= 65 && code <= 90) ||\n                    // `a-z`\n                    (code >= 97 && code <= 122) ||\n                    // `_`\n                    code === 95) {\n                    name += str[j++];\n                    continue;\n                }\n                break;\n            }\n            if (!name)\n                throw new TypeError(\"Missing parameter name at \".concat(i));\n            tokens.push({ type: \"NAME\", index: i, value: name });\n            i = j;\n            continue;\n        }\n        if (char === \"(\") {\n            var count = 1;\n            var pattern = \"\";\n            var j = i + 1;\n            if (str[j] === \"?\") {\n                throw new TypeError(\"Pattern cannot start with \\\"?\\\" at \".concat(j));\n            }\n            while (j < str.length) {\n                if (str[j] === \"\\\\\") {\n                    pattern += str[j++] + str[j++];\n                    continue;\n                }\n                if (str[j] === \")\") {\n                    count--;\n                    if (count === 0) {\n                        j++;\n                        break;\n                    }\n                }\n                else if (str[j] === \"(\") {\n                    count++;\n                    if (str[j + 1] !== \"?\") {\n                        throw new TypeError(\"Capturing groups are not allowed at \".concat(j));\n                    }\n                }\n                pattern += str[j++];\n            }\n            if (count)\n                throw new TypeError(\"Unbalanced pattern at \".concat(i));\n            if (!pattern)\n                throw new TypeError(\"Missing pattern at \".concat(i));\n            tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n            i = j;\n            continue;\n        }\n        tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n    }\n    tokens.push({ type: \"END\", index: i, value: \"\" });\n    return tokens;\n}\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str, options) {\n    if (options === void 0) { options = {}; }\n    var tokens = lexer(str);\n    var _a = options.prefixes, prefixes = _a === void 0 ? \"./\" : _a;\n    var defaultPattern = \"[^\".concat(escapeString(options.delimiter || \"/#?\"), \"]+?\");\n    var result = [];\n    var key = 0;\n    var i = 0;\n    var path = \"\";\n    var tryConsume = function (type) {\n        if (i < tokens.length && tokens[i].type === type)\n            return tokens[i++].value;\n    };\n    var mustConsume = function (type) {\n        var value = tryConsume(type);\n        if (value !== undefined)\n            return value;\n        var _a = tokens[i], nextType = _a.type, index = _a.index;\n        throw new TypeError(\"Unexpected \".concat(nextType, \" at \").concat(index, \", expected \").concat(type));\n    };\n    var consumeText = function () {\n        var result = \"\";\n        var value;\n        while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n            result += value;\n        }\n        return result;\n    };\n    while (i < tokens.length) {\n        var char = tryConsume(\"CHAR\");\n        var name = tryConsume(\"NAME\");\n        var pattern = tryConsume(\"PATTERN\");\n        if (name || pattern) {\n            var prefix = char || \"\";\n            if (prefixes.indexOf(prefix) === -1) {\n                path += prefix;\n                prefix = \"\";\n            }\n            if (path) {\n                result.push(path);\n                path = \"\";\n            }\n            result.push({\n                name: name || key++,\n                prefix: prefix,\n                suffix: \"\",\n                pattern: pattern || defaultPattern,\n                modifier: tryConsume(\"MODIFIER\") || \"\",\n            });\n            continue;\n        }\n        var value = char || tryConsume(\"ESCAPED_CHAR\");\n        if (value) {\n            path += value;\n            continue;\n        }\n        if (path) {\n            result.push(path);\n            path = \"\";\n        }\n        var open = tryConsume(\"OPEN\");\n        if (open) {\n            var prefix = consumeText();\n            var name_1 = tryConsume(\"NAME\") || \"\";\n            var pattern_1 = tryConsume(\"PATTERN\") || \"\";\n            var suffix = consumeText();\n            mustConsume(\"CLOSE\");\n            result.push({\n                name: name_1 || (pattern_1 ? key++ : \"\"),\n                pattern: name_1 && !pattern_1 ? defaultPattern : pattern_1,\n                prefix: prefix,\n                suffix: suffix,\n                modifier: tryConsume(\"MODIFIER\") || \"\",\n            });\n            continue;\n        }\n        mustConsume(\"END\");\n    }\n    return result;\n}\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile(str, options) {\n    return tokensToFunction(parse(str, options), options);\n}\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction(tokens, options) {\n    if (options === void 0) { options = {}; }\n    var reFlags = flags(options);\n    var _a = options.encode, encode = _a === void 0 ? function (x) { return x; } : _a, _b = options.validate, validate = _b === void 0 ? true : _b;\n    // Compile all the tokens into regexps.\n    var matches = tokens.map(function (token) {\n        if (typeof token === \"object\") {\n            return new RegExp(\"^(?:\".concat(token.pattern, \")$\"), reFlags);\n        }\n    });\n    return function (data) {\n        var path = \"\";\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            if (typeof token === \"string\") {\n                path += token;\n                continue;\n            }\n            var value = data ? data[token.name] : undefined;\n            var optional = token.modifier === \"?\" || token.modifier === \"*\";\n            var repeat = token.modifier === \"*\" || token.modifier === \"+\";\n            if (Array.isArray(value)) {\n                if (!repeat) {\n                    throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to not repeat, but got an array\"));\n                }\n                if (value.length === 0) {\n                    if (optional)\n                        continue;\n                    throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to not be empty\"));\n                }\n                for (var j = 0; j < value.length; j++) {\n                    var segment = encode(value[j], token);\n                    if (validate && !matches[i].test(segment)) {\n                        throw new TypeError(\"Expected all \\\"\".concat(token.name, \"\\\" to match \\\"\").concat(token.pattern, \"\\\", but got \\\"\").concat(segment, \"\\\"\"));\n                    }\n                    path += token.prefix + segment + token.suffix;\n                }\n                continue;\n            }\n            if (typeof value === \"string\" || typeof value === \"number\") {\n                var segment = encode(String(value), token);\n                if (validate && !matches[i].test(segment)) {\n                    throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to match \\\"\").concat(token.pattern, \"\\\", but got \\\"\").concat(segment, \"\\\"\"));\n                }\n                path += token.prefix + segment + token.suffix;\n                continue;\n            }\n            if (optional)\n                continue;\n            var typeOfMessage = repeat ? \"an array\" : \"a string\";\n            throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to be \").concat(typeOfMessage));\n        }\n        return path;\n    };\n}\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match(str, options) {\n    var keys = [];\n    var re = pathToRegexp(str, keys, options);\n    return regexpToFunction(re, keys, options);\n}\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction(re, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.decode, decode = _a === void 0 ? function (x) { return x; } : _a;\n    return function (pathname) {\n        var m = re.exec(pathname);\n        if (!m)\n            return false;\n        var path = m[0], index = m.index;\n        var params = Object.create(null);\n        var _loop_1 = function (i) {\n            if (m[i] === undefined)\n                return \"continue\";\n            var key = keys[i - 1];\n            if (key.modifier === \"*\" || key.modifier === \"+\") {\n                params[key.name] = m[i].split(key.prefix + key.suffix).map(function (value) {\n                    return decode(value, key);\n                });\n            }\n            else {\n                params[key.name] = decode(m[i], key);\n            }\n        };\n        for (var i = 1; i < m.length; i++) {\n            _loop_1(i);\n        }\n        return { path: path, index: index, params: params };\n    };\n}\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str) {\n    return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options) {\n    return options && options.sensitive ? \"\" : \"i\";\n}\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path, keys) {\n    if (!keys)\n        return path;\n    var groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n    var index = 0;\n    var execResult = groupsRegex.exec(path.source);\n    while (execResult) {\n        keys.push({\n            // Use parenthesized substring match if available, index otherwise\n            name: execResult[1] || index++,\n            prefix: \"\",\n            suffix: \"\",\n            modifier: \"\",\n            pattern: \"\",\n        });\n        execResult = groupsRegex.exec(path.source);\n    }\n    return path;\n}\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(paths, keys, options) {\n    var parts = paths.map(function (path) { return pathToRegexp(path, keys, options).source; });\n    return new RegExp(\"(?:\".concat(parts.join(\"|\"), \")\"), flags(options));\n}\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(path, keys, options) {\n    return tokensToRegexp(parse(path, options), keys, options);\n}\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(tokens, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.strict, strict = _a === void 0 ? false : _a, _b = options.start, start = _b === void 0 ? true : _b, _c = options.end, end = _c === void 0 ? true : _c, _d = options.encode, encode = _d === void 0 ? function (x) { return x; } : _d, _e = options.delimiter, delimiter = _e === void 0 ? \"/#?\" : _e, _f = options.endsWith, endsWith = _f === void 0 ? \"\" : _f;\n    var endsWithRe = \"[\".concat(escapeString(endsWith), \"]|$\");\n    var delimiterRe = \"[\".concat(escapeString(delimiter), \"]\");\n    var route = start ? \"^\" : \"\";\n    // Iterate over the tokens and create our regexp string.\n    for (var _i = 0, tokens_1 = tokens; _i < tokens_1.length; _i++) {\n        var token = tokens_1[_i];\n        if (typeof token === \"string\") {\n            route += escapeString(encode(token));\n        }\n        else {\n            var prefix = escapeString(encode(token.prefix));\n            var suffix = escapeString(encode(token.suffix));\n            if (token.pattern) {\n                if (keys)\n                    keys.push(token);\n                if (prefix || suffix) {\n                    if (token.modifier === \"+\" || token.modifier === \"*\") {\n                        var mod = token.modifier === \"*\" ? \"?\" : \"\";\n                        route += \"(?:\".concat(prefix, \"((?:\").concat(token.pattern, \")(?:\").concat(suffix).concat(prefix, \"(?:\").concat(token.pattern, \"))*)\").concat(suffix, \")\").concat(mod);\n                    }\n                    else {\n                        route += \"(?:\".concat(prefix, \"(\").concat(token.pattern, \")\").concat(suffix, \")\").concat(token.modifier);\n                    }\n                }\n                else {\n                    if (token.modifier === \"+\" || token.modifier === \"*\") {\n                        route += \"((?:\".concat(token.pattern, \")\").concat(token.modifier, \")\");\n                    }\n                    else {\n                        route += \"(\".concat(token.pattern, \")\").concat(token.modifier);\n                    }\n                }\n            }\n            else {\n                route += \"(?:\".concat(prefix).concat(suffix, \")\").concat(token.modifier);\n            }\n        }\n    }\n    if (end) {\n        if (!strict)\n            route += \"\".concat(delimiterRe, \"?\");\n        route += !options.endsWith ? \"$\" : \"(?=\".concat(endsWithRe, \")\");\n    }\n    else {\n        var endToken = tokens[tokens.length - 1];\n        var isEndDelimited = typeof endToken === \"string\"\n            ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n            : endToken === undefined;\n        if (!strict) {\n            route += \"(?:\".concat(delimiterRe, \"(?=\").concat(endsWithRe, \"))?\");\n        }\n        if (!isEndDelimited) {\n            route += \"(?=\".concat(delimiterRe, \"|\").concat(endsWithRe, \")\");\n        }\n    }\n    return new RegExp(route, flags(options));\n}\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(path, keys, options) {\n    if (path instanceof RegExp)\n        return regexpToRegexp(path, keys);\n    if (Array.isArray(path))\n        return arrayToRegexp(path, keys, options);\n    return stringToRegexp(path, keys, options);\n}\n//# sourceMappingURL=index.js.map","class EventDispatcher {\n  /**\n   * Create instance.\n   */\n  constructor() {\n    let events = {}\n\n    /**\n     * Add callback to event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function to call on dispatch.\n     * @param {Object} options Callback options.\n     */\n    this.addEventListener = (name, callback, options = null) => {\n      // Check if event name exits and callback is not already present.\n      if (!(name in events)) {\n        events[name] = []\n      }\n\n      // Add to events.\n      events[name].push({\n        callback: callback,\n        options: options,\n      })\n    }\n\n    /**\n     * Remove callback from event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function that would be called.\n     */\n    this.removeEventListener = (name, callback) => {\n      // Check if event exists.\n      if (!Object.keys(events).includes(name)) {\n        return\n      }\n      const eventData = events[name]\n\n      // Get index of callback in events.\n      let index = -1\n      for (let i = 0; i < eventData.length; i++) {\n        if (eventData[i].callback === callback) {\n          index = i\n          break\n        }\n      }\n      if (index < 0) {\n        return\n      }\n\n      // Remove item from events.\n      eventData.splice(index, 1)\n\n      // Remove event if list is empty.\n      if (Object.keys(eventData).length === 0) {\n        delete events[name]\n      }\n    }\n\n    /**\n     * Remove listeners to an event.\n     * @param {String} name Event name.\n     */\n    this.removeEventListeners = (name) => {\n      if (!name) {\n        return\n      }\n\n      // Remove all handlers with the event name.\n      delete events[name]\n    }\n\n    /**\n     * Remove all listeners.\n     * @param {String} name Event name.\n     */\n    this.removeAllEventListeners = () => {\n      // Remove all listeners.\n      events = {}\n    }\n\n    /**\n     * Trigger event and dispatch data to listeners.\n     * @param {String} name Event name.\n     * @param {Array<Any>} parameters Event parameters to pass through.\n     * @param {Object} options Dispatch options.\n     */\n    this.dispatchEvent = (name, parameters, options = null) => {\n      // Check if event exists.\n      if (!events[name]) {\n        return\n      }\n      // Get events by trigger name.\n      const eventData = events[name]\n\n      // Dispatch a call to each event.\n      for (let i = 0; i < eventData.length; i++) {\n        const event = (options && options.reverse) ? eventData[eventData.length - (i + 1)] : eventData[i]\n\n        // If once is truthy then remove the callback.\n        if (event.options && event.options.once) {\n          eventData.splice(i, 1)\n        }\n\n        // Execute callback.\n        event.callback(...parameters)\n      }\n    }\n  }\n}\n\nexport default EventDispatcher\n","// Import external modules.\nimport { pathToRegexp } from 'path-to-regexp'\n\n// Import event dispatcher.\nimport EventDispatcher from '@doars/utils/src/events/EventDispatcher.js'\n\nclass Router extends EventDispatcher {\n  constructor(options = {}) {\n    super()\n\n    // Create id.\n    const id = Symbol('ID_ROUTER')\n\n    // Overwrite default with given options.\n    options = Object.assign({\n      basePath: '',\n      path: null,\n      pathToRegexp: {},\n      updateHistory: false,\n    }, options)\n\n    let path = options.path\n    let route = null\n    let routes = {}\n\n    // Listen for history state changes.\n    const handleHistory = () => {\n      this.setPath(window.location.pathname)\n    }\n    if (options.updateHistory) {\n      window.addEventListener('popstate', handleHistory)\n    }\n\n    /**\n     * Update route.\n     * @param {String} url URL.\n     * @param {String} _path Path.\n     * @param {String} _route Route.\n     */\n    const updateRoute = (url, newPath, newRoute) => {\n      // Update stored data.\n      path = newPath\n      route = newRoute\n\n      // Update page history if the option is set.\n      if (options.updateHistory) {\n        // Construct url.\n        const _url = url.includes(options.basePath) ? url : options.basePath + url\n        // Check if url is not current url.\n        if (_url !== window.location.pathname) {\n          // Add path to history.\n          window.history.pushState(null, window.document.title, _url)\n        }\n      }\n\n      // Dispatch event on router.\n      this.dispatchEvent('changed', [this, route, path])\n    }\n\n    /**\n     * Get router id.\n     * @returns {Symbol} Unique identifier.\n     */\n    this.getId = () => {\n      return id\n    }\n\n    /**\n     * Get current path.\n     * @returns {String} path.\n     */\n    this.getPath = () => {\n      return path\n    }\n\n    /**\n     * Get current route.\n     * @returns {String} Route.\n     */\n    this.getRoute = () => {\n      return route\n    }\n\n    /**\n     * Get observed routes.\n     * @returns {Array<String>} List of routers.\n     */\n    this.getRoutes = () => {\n      return Object.keys(routes)\n    }\n\n    /**\n     * Destroy router instance.\n     */\n    this.destroy = () => {\n      // Stop listening to state changes.\n      if (options.updateHistory) {\n        window.removeEventListener('popstate', handleHistory)\n      }\n\n      options = null\n      path = null\n      route = null\n      routes = null\n\n      // Dispatch add event.\n      this.dispatchEvent('destroyed', [this])\n\n      // Remove all listeners.\n      this.removeAllEventListeners()\n    }\n\n    /**\n     * Add route.\n     * @param {String} _route Route pattern.\n     */\n    this.addRoute = (_route) => {\n      // Convert path to regexp and store it in routes.\n      routes[_route] = pathToRegexp(_route, [], options.pathToRegexp)\n\n      // Dispatch add event.\n      this.dispatchEvent('added', [this, _route])\n\n      if (path) {\n        // Remove base url, if present.\n        const _path = path.replace(options.basePath, '')\n        // Check if current route is.\n        if (routes[_route].test(_path)) {\n          updateRoute(path, _path, _route)\n        }\n      }\n    }\n\n    /**\n     * Remove route.\n     * @param {String} _route Route pattern.\n     */\n    this.removeRoute = (_route) => {\n      // Delete route.\n      delete routes[_route]\n\n      // Dispatch removed event.\n      this.dispatchEvent('removed', [this, _route])\n\n      if (route === _route) {\n        // Set current route as none.\n        path = null\n        route = null\n\n        // Dispatch changed event.\n        this.dispatchEvent('changed', [this, route, path])\n      }\n    }\n\n    /**\n     * Set current route.\n     * @param {String} url URL path.\n     */\n    this.setPath = (url) => {\n      // Remove base url, if present.\n      const newPath = url.replace(options.basePath, '')\n      if (path === newPath) {\n        return\n      }\n\n      // Find matching routes.\n      let newRoute = null\n      for (const _route in routes) {\n        // Test route.\n        if (routes[_route].test(newPath)) {\n          newRoute = _route\n          break\n        }\n      }\n\n      // Update route.\n      updateRoute(url, newPath, newRoute)\n    }\n  }\n}\n\nexport default Router\n","// Import router.\nimport Router from '../../Router.js'\n\n// Import symbols.\nimport { ROUTER } from '../../symbols.js'\n\nexport default (routerOptions) => {\n  return {\n    name: 'router',\n\n    update: (component, attribute, { processExpression }) => {\n      // Deconstruct attribute.\n      const element = attribute.getElement()\n\n      // Get router.\n      let router = element[ROUTER]\n      if (!router) {\n        // Construct options.\n        const options = Object.assign({}, routerOptions, processExpression(component, attribute.clone(), attribute.getValue()))\n        // Create router\n        router = element[ROUTER] = new Router(options)\n      }\n    },\n\n    destroy: (component, attribute) => {\n      // Deconstruct attribute.\n      const element = attribute.getElement()\n\n      // Get router.\n      const router = element[ROUTER]\n      if (!router) {\n        return\n      }\n\n      // Remove router reference.\n      delete element[ROUTER]\n\n      // Deconstruct router.\n      const id = router.getId()\n\n      // Destroy router.\n      router.destroy()\n\n      // Deconstruct component.\n      const library = component.getLibrary()\n\n      // Trigger update due to changed router.\n      library.update([{ id: id, path: '' }])\n    },\n  }\n}\n","/**\n * Convert string to HTML element.\n * @param {String} string Element contents.\n * @returns {HTMLElement} HTML element part of a document fragment.\n */\nexport const fromString = (string) => {\n  const template = document.createElement('template')\n  template.innerHTML = string\n  return template.content.childNodes[0]\n}\n\n/**\n * Inserts an element after the reference element opposite of insertBefore and more reliable then ChildNode.after()\n * @param {HTMLElement} reference Node to insert after.\n * @param {Node} node Node to insert.\n */\nexport const insertAfter = (reference, node) => {\n  if (reference.nextSibling) {\n    reference.parentNode.insertBefore(node, reference.nextSibling)\n  } else {\n    reference.parentNode.appendChild(node)\n  }\n}\n\n/**\n * Check whether two nodes are the same.\n * @param {HTMElement} a A node.\n * @param {HTMElement} b Another node.\n * @returns {Boolean} Whether the nodes are the same.\n */\nexport const isSame = (a, b) => {\n  if (a.isSameNode) {\n    return a.isSameNode(b)\n  }\n\n  if (a.tagName !== b.tagName) {\n    return false\n  }\n\n  if (a.type === 3) { // Text node.\n    return a.nodeValue === b.nodeValue\n  }\n\n  return false\n}\n\n/**\n * Iterate over all descendants of a given node.\n * @param {HTMLElement} element Element to walk over.\n * @param {Function} filter Filter function, return false to skip element.\n * @returns {Function} Iterator function. Call until a non-truthy value is returned.\n */\nexport const walk = (element, filter) => {\n  let index = -1\n  let iterator = null\n  return () => {\n    // First go over iterator.\n    if (index >= 0 && iterator) {\n      const child = iterator()\n      if (child) {\n        return child\n      }\n    }\n\n    // Get next child that passes the filter.\n    let child = null\n    do {\n      index++\n      if (index >= element.childElementCount) {\n        return null\n      }\n\n      child = element.children[index]\n    } while (!filter(child))\n\n    // Setup iterator for child.\n    if (child.childElementCount) {\n      iterator = walk(child, filter)\n    }\n\n    // Return the child.\n    return child\n  }\n}\n\nexport default {\n  fromString: fromString,\n  insertAfter: insertAfter,\n  isSame: isSame,\n  walk: walk,\n}\n","// Import symbols.\nimport { ROUTE } from '../symbols.js'\n\n// Import utils.\nimport { closestRouter } from '../utils.js'\nimport { insertAfter } from '@doars/utils/src/ElementUtils.js'\n\nexport default {\n  name: 'route',\n\n  update: (component, attribute, { transitionIn, transitionOut }) => {\n    // Deconstruct attribute.\n    const element = attribute.getElement()\n\n    let router\n    const setup = () => {\n      // Stop listening to router and remove it.\n      if (router && attribute[ROUTE]) {\n        router.removeEventListener('changed', attribute[ROUTE].handler)\n        router.removeEventListener('destroyed', attribute[ROUTE].setup)\n\n        delete attribute[ROUTE]\n      }\n\n      // Get closest router in parent nodes.\n      router = closestRouter(element)\n      if (!router) {\n        console.warn('DoarsRouter: Router not found for route.')\n        return\n      }\n\n      // Setup route data.\n      attribute[ROUTE] = {\n        setup: setup,\n      }\n\n      // Deconstruct attribute.\n      const value = attribute.getValue()\n\n      // Add route to router.\n      router.addRoute(value)\n\n      // Handle router changes.\n      const handleChange = (router, route) => {\n        if (route !== value) {\n          if (element.tagName === 'TEMPLATE') {\n            if (attribute[ROUTE] && attribute[ROUTE].element) {\n              // Transition out.\n              const routeElement = attribute[ROUTE].element\n              transitionOut(component, routeElement, () => {\n                // Remove node.\n                routeElement.remove()\n                attribute[ROUTE].element = undefined\n              })\n            }\n          } else {\n            // Transition out and set display none.\n            transitionOut(component, element, () => {\n              element.style.display = 'none'\n            })\n          }\n        } else if (element.tagName === 'TEMPLATE') {\n          // Create new element from template.\n          const templateInstance = document.importNode(element.content, true)\n          // Add element after the template element.\n          insertAfter(element, templateInstance)\n          // Get HTMLElement reference instead of DocumentFragment.\n          attribute[ROUTE].element = element.nextSibling\n\n          // Transition in.\n          transitionIn(component, attribute[ROUTE].element)\n        } else {\n          // Remove display none.\n          element.style.display = null\n\n          // Transition in.\n          transitionIn(component, element)\n        }\n      }\n      attribute[ROUTE].handler = handleChange\n\n      // Listen to router changes and perform initial run.\n      router.addEventListener('changed', handleChange)\n      handleChange(router, router.getRoute())\n\n      // If the router is destroyed look for another\n      router.addEventListener('destroyed', setup)\n    }\n\n    // Perform initial setup.\n    setup()\n  },\n\n  destroy: (component, attribute, { transitionOut }) => {\n    // Deconstruct attribute.\n    const element = attribute.getElement()\n    if (element.tagName === 'TEMPLATE') {\n      if (attribute[ROUTE] && attribute[ROUTE].element) {\n        // Transition out.\n        const routeElement = attribute[ROUTE].element\n        transitionOut(component, routeElement, () => {\n          // Remove node.\n          routeElement.remove()\n          attribute[ROUTE].element = undefined\n        })\n      }\n    } else {\n      // Transition out and set display none.\n      transitionOut(component, element, () => {\n        element.style.display = 'none'\n      })\n    }\n\n    // Get closest router in parent nodes.\n    const router = closestRouter(element)\n    if (!router) {\n      return\n    }\n\n    // Remove router listeners.\n    if (attribute[ROUTE]) {\n      router.removeEventListener('destroyed', attribute[ROUTE].setup)\n      if (attribute[ROUTE].handler) {\n        router.removeEventListener('change', attribute[ROUTE].handler)\n      }\n    }\n  },\n}\n","// Import symbols.\nimport { ROUTE_TO } from '../symbols.js'\n\n// Import utils.\nimport { closestRouter } from '../utils.js'\n\nexport default {\n  name: 'route-to',\n\n  update: (component, attribute) => {\n    const element = attribute.getElement()\n    const modifiers = attribute.getModifiers()\n    const value = attribute.getValue()\n\n    // Check for existing data.\n    if (attribute[ROUTE_TO]) {\n      // Exit early if listener has not changed.\n      if (attribute[ROUTE_TO].value === value) {\n        return\n      }\n\n      // Remove existing listeners so we don't listen twice.\n      attribute[ROUTE_TO].target.removeEventListener('click', attribute[ROUTE_TO].handler)\n    }\n\n    const handler = (event) => {\n      if (modifiers.self && event.target !== element) {\n        return\n      }\n\n      if (modifiers.prevent) {\n        event.preventDefault()\n      }\n      if (modifiers.stop) {\n        event.stopPropagation()\n      }\n\n      const router = closestRouter(element)\n      if (!router) {\n        return\n      }\n\n      router.setPath(value)\n    }\n\n    // Listen to click and keyboard events.\n    element.addEventListener('click', handler)\n\n    // Store listener data on the component.\n    attribute[ROUTE_TO] = {\n      handler: handler,\n      value: value,\n    }\n  },\n\n  destroy: (component, attribute) => {\n    if (!attribute[ROUTE_TO]) {\n      return\n    }\n\n    const element = attribute.getElement()\n\n    element.removeEventListener('click', attribute[ROUTE_TO].handler)\n\n    delete attribute[ROUTE_TO]\n  },\n}\n","/**\n * Deeply assign a series of objects properties together.\n * @param {Object} target Target object to merge to.\n * @param  {...Object} sources Objects to merge into the target.\n */\nexport const deepAssign = (target, ...sources) => {\n  if (!sources.length) {\n    return target\n  }\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, {\n            [key]: {},\n          })\n        }\n        deepAssign(target[key], source[key])\n      } else if (Array.isArray(source[key])) {\n        target[key] = source[key].map((value) => {\n          if (isObject(value)) {\n            return deepAssign({}, value)\n          }\n          return value\n        })\n      } else {\n        Object.assign(target, {\n          [key]: source[key],\n        })\n      }\n    }\n  }\n\n  return deepAssign(target, ...sources)\n}\n\n/**\n * Get value at path on object.\n * @param {Object} object Object to get from.\n * @param  {Array<String>} path Path to value.\n * @returns {Any} value at path.\n */\nexport const get = (object, path) => {\n  let objectTemp = object\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    objectTemp = objectTemp[path[i]]\n  }\n  return objectTemp[path[i]]\n}\n\n/**\n * Check whether the value is an object.\n * @param {Any} value Value of unknown type.\n * @returns Whether the value is an object.\n */\nexport const isObject = (value) => {\n  return (value && typeof value === 'object' && !Array.isArray(value))\n}\n\n/**\n * Set value on path at object.\n * @param {Object} object Object to set on.\n * @param {Array<String>} path Path to value.\n * @param {Any} value Value to set.\n */\nexport const set = (object, path, value) => {\n  // Exit early if not an object.\n  if (typeof (object) !== 'object') {\n    return\n  }\n\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    object = object[path[i]]\n\n    // Exit early if not an object.\n    if (typeof (object) !== 'object') {\n      return\n    }\n  }\n  object[path[i]] = value\n}\n\nexport default {\n  deepAssign: deepAssign,\n  get: get,\n  isObject: isObject,\n  set: set,\n}\n","// Import contexts.\nimport contextRouter from './contexts/router.js'\n\n// Import directives.\nimport createDirectiveRouter from './factories/directives/router.js'\nimport directiveRoute from './directives/route.js'\nimport directiveRouteTo from './directives/routeTo.js'\n\n// Import utils.\nimport { deepAssign } from '@doars/utils/src/ObjectUtils.js'\n\nexport default class DoarsRouter {\n  /**\n   * Create plugin instance.\n   * @param {Doars} library Doars instance to add onto.\n   * @param {Object} options The plugin options.\n   */\n  constructor(library, options = null) {\n    // Clone options.\n    options = deepAssign({}, options)\n\n    // Set private variables.\n    let directiveRouter\n\n    // Enable plugin when library is enabling.\n    library.addEventListener('enabling', () => {\n      // Add contexts and directives.\n      library.addContexts(0, contextRouter)\n      directiveRouter = createDirectiveRouter(options)\n      library.addDirectives(-1, directiveRouter, directiveRoute, directiveRouteTo)\n    })\n\n    // Disable plugin when library is disabling.\n    library.addEventListener('disabling', () => {\n      // Remove contexts and directives.\n      library.removeContexts(contextRouter)\n      library.removeDirectives(directiveRouter, directiveRoute, directiveRouteTo)\n\n      // Remove router.\n      directiveRouter = null\n    })\n  }\n}\n"],"names":["REFLECTION_METHODS","target","handler","revoked","revocableHandler","key","console","error","Reflect","proxy","Proxy","revoke","ROUTE_TO","Symbol","ROUTER","ROUTE","closestRouter","element","parentElement","name","create","component","attribute","getElement","router","revocable","RevocableProxy","get","propertyKey","receiver","accessed","getId","value","destroy","lexer","str","tokens","i","length","char","push","type","index","j","code","charCodeAt","TypeError","count","pattern","parse","options","_a","defaultPattern","escapeString","delimiter","result","path","tryConsume","mustConsume","undefined","nextType","concat","consumeText","prefix","prefixes","indexOf","suffix","modifier","open","name_1","pattern_1","replace","flags","sensitive","regexpToRegexp","keys","groupsRegex","execResult","exec","source","arrayToRegexp","paths","parts","map","RegExp","join","stringToRegexp","tokensToRegexp","_b","start","_c","end","_d","encode","x","_e","_f","endsWith","endsWithRe","delimiterRe","route","_i","token","mod","strict","endToken","isEndDelimited","pathToRegexp","Array","isArray","EventDispatcher","events","addEventListener","callback","removeEventListener","Object","includes","eventData","splice","removeEventListeners","removeAllEventListeners","dispatchEvent","parameters","event","reverse","once","Router","id","assign","basePath","updateHistory","routes","handleHistory","setPath","window","location","pathname","updateRoute","url","newPath","newRoute","_url","history","pushState","document","title","getPath","getRoute","getRoutes","addRoute","_route","_path","test","removeRoute","routerOptions","update","processExpression","clone","getValue","library","getLibrary","insertAfter","reference","node","nextSibling","parentNode","insertBefore","appendChild","transitionIn","transitionOut","setup","warn","handleChange","tagName","routeElement","remove","style","display","templateInstance","importNode","content","modifiers","getModifiers","self","prevent","preventDefault","stop","stopPropagation","deepAssign","sources","shift","isObject","DoarsRouter","directiveRouter","addContexts","contextRouter","createDirectiveRouter","addDirectives","directiveRoute","directiveRouteTo","removeContexts","removeDirectives"],"mappings":"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"}