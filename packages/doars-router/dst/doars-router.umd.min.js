var global,factory;global=this,factory=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return r(e)}function i(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],l=Symbol(),s=Symbol(),c=Symbol(),d=function e(t){if(t.parentElement)return(t=t.parentElement)[s]?t[s]:e(t)},p={name:"$router",create:function(e,t){var n=t.getElement(),r=null,o=function(e,t){var n,r=!1,o={},i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){f=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(f)throw i}}}}(f);try{var u=function(){var e=n.value;o[e]=function(){if(!r)return e in t?t[e].apply(t,arguments):Reflect[e].apply(Reflect,arguments);console.error("illegal operation attempted on a revoked proxy")}};for(i.s();!(n=i.n()).done;)u()}catch(e){i.e(e)}finally{i.f()}return{proxy:new Proxy({},o),revoke:function(){r=!0}}}(0,{get:function(e,o,i){if(null===r&&((r=n[s]?n[s]:d(n))||(r=!1)),t.accessed(r.getId(),""),r)return Reflect.get(r,o,i)}});return{value:o.proxy,destroy:function(){o.revoke()}}}};function v(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function h(e){return e&&e.sensitive?"":"i"}function y(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,o=n.exec(e.source);o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){var r=e.map((function(e){return y(e,t,n).source}));return new RegExp("(?:"+r.join("|")+")",h(n))}(e,t,n):function(e,t,n){return function(e,t,n){void 0===n&&(n={});for(var r=n.strict,o=void 0!==r&&r,i=n.start,a=void 0===i||i,u=n.end,f=void 0===u||u,l=n.encode,s=void 0===l?function(e){return e}:l,c="["+v(n.endsWith||"")+"]|$",d="["+v(n.delimiter||"/#?")+"]",p=a?"^":"",y=0,m=e;y<m.length;y++){var g=m[y];if("string"==typeof g)p+=v(s(g));else{var E=v(s(g.prefix)),b=v(s(g.suffix));if(g.pattern)if(t&&t.push(g),E||b)if("+"===g.modifier||"*"===g.modifier){var w="*"===g.modifier?"?":"";p+="(?:"+E+"((?:"+g.pattern+")(?:"+b+E+"(?:"+g.pattern+"))*)"+b+")"+w}else p+="(?:"+E+"("+g.pattern+")"+b+")"+g.modifier;else p+="("+g.pattern+")"+g.modifier;else p+="(?:"+E+b+")"+g.modifier}}if(f)o||(p+=d+"?"),p+=n.endsWith?"(?="+c+")":"$";else{var x=e[e.length-1],A="string"==typeof x?d.indexOf(x[x.length-1])>-1:void 0===x;o||(p+="(?:"+d+"(?="+c+"))?"),A||(p+="(?="+d+"|"+c+")")}return new RegExp(p,h(n))}(function(e,t){void 0===t&&(t={});for(var n=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var o=1,i="";if("?"===e[u=n+1])throw new TypeError('Pattern cannot start with "?" at '+u);for(;u<e.length;)if("\\"!==e[u]){if(")"===e[u]){if(0==--o){u++;break}}else if("("===e[u]&&(o++,"?"!==e[u+1]))throw new TypeError("Capturing groups are not allowed at "+u);i+=e[u++]}else i+=e[u++]+e[u++];if(o)throw new TypeError("Unbalanced pattern at "+n);if(!i)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:i}),n=u}else{for(var a="",u=n+1;u<e.length;){var f=e.charCodeAt(u);if(!(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||95===f))break;a+=e[u++]}if(!a)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:a}),n=u}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),r=t.prefixes,o=void 0===r?"./":r,i="[^"+v(t.delimiter||"/#?")+"]+?",a=[],u=0,f=0,l="",s=function(e){if(f<n.length&&n[f].type===e)return n[f++].value},c=function(e){var t=s(e);if(void 0!==t)return t;var r=n[f],o=r.type,i=r.index;throw new TypeError("Unexpected "+o+" at "+i+", expected "+e)},d=function(){for(var e,t="";e=s("CHAR")||s("ESCAPED_CHAR");)t+=e;return t};f<n.length;){var p=s("CHAR"),h=s("NAME"),y=s("PATTERN");if(h||y){var m=p||"";-1===o.indexOf(m)&&(l+=m,m=""),l&&(a.push(l),l=""),a.push({name:h||u++,prefix:m,suffix:"",pattern:y||i,modifier:s("MODIFIER")||""})}else{var g=p||s("ESCAPED_CHAR");if(g)l+=g;else if(l&&(a.push(l),l=""),s("OPEN")){m=d();var E=s("NAME")||"",b=s("PATTERN")||"",w=d();c("CLOSE"),a.push({name:E||(b?u++:""),pattern:E&&!b?i:b,prefix:m,suffix:w,modifier:s("MODIFIER")||""})}else c("END")}}return a}(e,n),t,n)}(e,t,n)}var m=function t(){e(this,t);var n={};this.addEventListener=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e in n||(n[e]=[]),n[e].push({callback:t,options:r})},this.removeEventListener=function(e,t){if(Object.keys(n).includes(e)){for(var r=n[e],o=-1,i=0;i<r.length;i++)if(r[i].callback===t){o=i;break}o<0||(r.splice(o,1),0===Object.keys(r).length&&delete n[e])}},this.removeEventListeners=function(e){e&&delete n[e]},this.removeAllEventListeners=function(){n={}},this.dispatchEvent=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n[e])for(var o=n[e],a=0;a<o.length;a++){var u=r&&r.reverse?o[o.length-(a+1)]:o[a];u.options&&u.options.once&&o.splice(a,1),u.callback.apply(u,i(t))}}},g=function(i){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(l,i);var a,u,f=(a=l,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=t(a);if(u){var r=t(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return o(this,e)});function l(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,l),t=f.call(this);var o=Symbol(),i=(n=Object.assign({basePath:"",path:null,pathToRegexp:{},updateHistory:!1},n)).path,a=null,u={},s=function(){t.setPath(window.location.pathname)};n.updateHistory&&window.addEventListener("popstate",s);var c=function(e,t,r){if(i=t,a=r,n.updateHistory){var o=e.includes(n.basePath)?e:n.basePath+e;o!==window.location.pathname&&window.history.pushState(null,window.document.title,o)}this.dispatchEvent("changed",[this,a,i])}.bind(r(t));return t.getId=function(){return o},t.getPath=function(){return i},t.getRoute=function(){return a},t.getRoutes=function(){return Object.keys(u)},t.destroy=function(){n.updateHistory&&window.removeEventListener("popstate",s),n=null,i=null,a=null,u=null,t.dispatchEvent("destroyed",[r(t)]),t.removeAllEventListeners()},t.addRoute=function(e){if(u[e]=y(e,[],n.pathToRegexp),this.dispatchEvent("added",[this,e]),i){var t=i.replace(n.basePath,"");u[e].test(t)&&c(i,t,e)}},t.removeRoute=function(e){delete u[e],this.dispatchEvent("removed",[this,e]),a===e&&(i=null,a=null,this.dispatchEvent("changed",[this,a,i]))},t.setPath=function(e){var t=e.replace(n.basePath,"");if(i!==t){var r=null;for(var o in u)if(u[o].test(t)){r=o;break}c(e,t,r)}},t}return l}(m);function E(e){return{name:"router",update:function(t,n,r){var o=r.executeExpression,i=n.getElement(),a=i[s];if(!a){var u=Object.assign({},e,o(t,n.clone(),n.getValue()));a=i[s]=new g(u)}},destroy:function(e,t){var n=t.getElement(),r=n[s];if(r){delete n[s];var o=r.getId();r.destroy(),e.getLibrary().update([{id:o,path:""}])}}}}var b={name:"route",update:function(e,t,n){var r,o=n.transitionIn,i=n.transitionOut,a=t.getElement();!function n(){if(r&&t[c]&&(r.removeEventListener("changed",t[c].handler),r.removeEventListener("destroyed",t[c].setup),delete t[c]),r=d(a)){t[c]={setup:n};var u=t.getValue();r.addRoute(u);var f=function(n,r){if(r!==u)if("TEMPLATE"===a.tagName){if(t[c]&&t[c].element){var f=t[c].element;i(e,f,(function(){f.remove(),t[c].element=void 0}))}}else i(e,a,(function(){a.style.display="none"}));else"TEMPLATE"===a.tagName?(s=document.importNode(a.content,!0),(l=a).nextSibling?l.parentNode.insertBefore(s,l.nextSibling):l.parentNode.appendChild(s),t[c].element=a.nextSibling,o(e,t[c].element)):(a.style.display=null,o(e,a));var l,s};t[c].handler=f,r.addEventListener("changed",f),f(0,r.getRoute()),r.addEventListener("destroyed",n)}}()},destroy:function(e,t,n){var r=n.transitionOut,o=t.getElement();if("TEMPLATE"===o.tagName){if(t[c]&&t[c].element){var i=t[c].element;r(e,i,(function(){i.remove(),t[c].element=void 0}))}}else r(e,o,(function(){o.style.display="none"}));var a=d(o);a&&t[c]&&(a.removeEventListener("destroyed",t[c].setup),t[c].handler&&a.removeEventListener("change",t[c].handler))}},w={name:"route-to",update:function(e,t){var n=t.getElement(),r=t.getModifiers(),o=t.getValue();if(t[l]){if(t[l].value===o)return;t[l].target.removeEventListener("click",t[l].handler)}var i=function(e){if(!r.self||e.target===n){r.prevent&&e.preventDefault(),r.stop&&e.stopPropagation();var t=d(n);t&&t.setPath(o)}};n.addEventListener("click",i),t[l]={handler:i,value:o}},destroy:function(e,t){t[l]&&(t.getElement().removeEventListener("click",t[l].handler),delete t[l])}},x=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(!r.length)return t;var i=r.shift();if(A(t)&&A(i))for(var a in i)A(i[a])?(t[a]||Object.assign(t,{[a]:{}}),e(t[a],i[a])):Array.isArray(i[a])?t[a]=i[a].map((function(t){return A(t)?e({},t):t})):Object.assign(t,{[a]:i[a]});return e.apply(void 0,[t].concat(r))},A=function(e){return e&&"object"==typeof e&&!Array.isArray(e)};return function t(n){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(this,t),o=x({},o),n.addEventListener("enabling",(function(){n.addContexts(0,p),r=E(o),n.addDirectives(-1,r,b,w)})),n.addEventListener("disabling",(function(){n.removeContexts(p),n.removeDirectives(r,b,w),r=null}))}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).DoarsRouter=factory();
