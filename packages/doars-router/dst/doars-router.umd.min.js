var global,factory;global=this,factory=function(){const e=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],t=Symbol(),n=Symbol(),r=Symbol(),i=function(e){if(e.parentElement)return(e=e.parentElement)[n]?e[n]:i(e)};var o={name:"$router",create:(t,r)=>{const o=r.getElement();let s=null;const a=function(t,n){let r=!1;const i={};for(const t of e)i[t]=(...e)=>{if(!r)return t in n?n[t](...e):Reflect[t](...e);console.error("illegal operation attempted on a revoked proxy")};return{proxy:new Proxy({},i),revoke:()=>{r=!0}}}(0,{get:(e,t,a)=>{if(null===s&&(s=o[n]?o[n]:i(o),s||(s=!1)),r.accessed(s.getId(),""),s)return Reflect.get(s,t,a)}});return{value:a.proxy,destroy:()=>{a.revoke()}}}};function s(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function a(e){return e&&e.sensitive?"":"i"}function l(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=n.exec(e.source);i;)t.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){var r=e.map((function(e){return l(e,t,n).source}));return new RegExp("(?:"+r.join("|")+")",a(n))}(e,t,n):function(e,t,n){return function(e,t,n){void 0===n&&(n={});for(var r=n.strict,i=void 0!==r&&r,o=n.start,l=void 0===o||o,d=n.end,u=void 0===d||d,c=n.encode,f=void 0===c?function(e){return e}:c,p="["+s(n.endsWith||"")+"]|$",h="["+s(n.delimiter||"/#?")+"]",v=l?"^":"",g=0,y=e;g<y.length;g++){var m=y[g];if("string"==typeof m)v+=s(f(m));else{var E=s(f(m.prefix)),x=s(f(m.suffix));if(m.pattern)if(t&&t.push(m),E||x)if("+"===m.modifier||"*"===m.modifier){var b="*"===m.modifier?"?":"";v+="(?:"+E+"((?:"+m.pattern+")(?:"+x+E+"(?:"+m.pattern+"))*)"+x+")"+b}else v+="(?:"+E+"("+m.pattern+")"+x+")"+m.modifier;else v+="("+m.pattern+")"+m.modifier;else v+="(?:"+E+x+")"+m.modifier}}if(u)i||(v+=h+"?"),v+=n.endsWith?"(?="+p+")":"$";else{var w=e[e.length-1],P="string"==typeof w?h.indexOf(w[w.length-1])>-1:void 0===w;i||(v+="(?:"+h+"(?="+p+"))?"),P||(v+="(?="+h+"|"+p+")")}return new RegExp(v,a(n))}(function(e,t){void 0===t&&(t={});for(var n=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var i=1,o="";if("?"===e[a=n+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<e.length;)if("\\"!==e[a]){if(")"===e[a]){if(0==--i){a++;break}}else if("("===e[a]&&(i++,"?"!==e[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);o+=e[a++]}else o+=e[a++]+e[a++];if(i)throw new TypeError("Unbalanced pattern at "+n);if(!o)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:o}),n=a}else{for(var s="",a=n+1;a<e.length;){var l=e.charCodeAt(a);if(!(l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||95===l))break;s+=e[a++]}if(!s)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:s}),n=a}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),r=t.prefixes,i=void 0===r?"./":r,o="[^"+s(t.delimiter||"/#?")+"]+?",a=[],l=0,d=0,u="",c=function(e){if(d<n.length&&n[d].type===e)return n[d++].value},f=function(e){var t=c(e);if(void 0!==t)return t;var r=n[d],i=r.type,o=r.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},p=function(){for(var e,t="";e=c("CHAR")||c("ESCAPED_CHAR");)t+=e;return t};d<n.length;){var h=c("CHAR"),v=c("NAME"),g=c("PATTERN");if(v||g){var y=h||"";-1===i.indexOf(y)&&(u+=y,y=""),u&&(a.push(u),u=""),a.push({name:v||l++,prefix:y,suffix:"",pattern:g||o,modifier:c("MODIFIER")||""})}else{var m=h||c("ESCAPED_CHAR");if(m)u+=m;else if(u&&(a.push(u),u=""),c("OPEN")){y=p();var E=c("NAME")||"",x=c("PATTERN")||"",b=p();f("CLOSE"),a.push({name:E||(x?l++:""),pattern:E&&!x?o:x,prefix:y,suffix:b,modifier:c("MODIFIER")||""})}else f("END")}}return a}(e,n),t,n)}(e,t,n)}class d extends class{constructor(){let e={};this.addEventListener=(t,n,r=null)=>{t in e||(e[t]=[]),e[t].push({callback:n,options:r})},this.removeEventListener=(t,n)=>{if(!Object.keys(e).includes(t))return;const r=e[t];let i=-1;for(let e=0;e<r.length;e++)if(r[e].callback===n){i=e;break}i<0||(r.splice(i,1),0===Object.keys(r).length&&delete e[t])},this.removeEventListeners=t=>{t&&delete e[t]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(t,n,r=null)=>{if(!e[t])return;const i=e[t];for(let e=0;e<i.length;e++){const t=r&&r.reverse?i[i.length-(e+1)]:i[e];t.options&&t.options.once&&i.splice(e,1),t.callback(...n)}}}}{constructor(e={}){super();const t=Symbol();e=Object.assign({basePath:"",updateHistory:!1,pathToRegexp:{}},e);let n=null,r=null,i={};const o=()=>{this.setPath(window.location.pathname)};e.updateHistory&&window.addEventListener("popstate",o);const s=function(t,i,o){if(n=i,r=o,e.updateHistory){const n=t.includes(e.basePath)?t:e.basePath+t;n!==window.location.pathname&&window.history.pushState(null,window.document.title,n)}this.dispatchEvent("changed",[this,r,n])}.bind(this);this.getId=()=>t,this.getPath=()=>n,this.getRoute=()=>r,this.getRoutes=()=>Object.keys(i),this.destroy=()=>{e.updateHistory&&window.removeEventListener("popstate",o),e=null,n=null,r=null,i=null,this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.addRoute=function(t){if(i[t]=l(t,[],e.pathToRegexp),this.dispatchEvent("added",[this,t]),n){const r=t.replace(e.basePath,"");i[t].test(r)&&s(n,r,t)}},this.removeRoute=function(e){delete i[e],this.dispatchEvent("removed",[this,e]),r===e&&(n=null,r=null,this.dispatchEvent("changed",[this,r,n]))},this.setPath=function(t){const r=t.replace(e.basePath,"");if(n===r)return;let o=null;for(const e in i)if(i[e].test(r)){o=e;break}s(t,n,o)}}}var u={name:"route",update:(e,t,{transitionIn:n,transitionOut:o})=>{const s=t.getElement();let a;const l=()=>{if(a&&t[r]&&(a.removeEventListener("changed",t[r].handler),a.removeEventListener("destroyed",t[r].setup),delete t[r]),a=i(s),!a)return;t[r]={setup:l};const d=t.getValue();a.addRoute(d);const u=(i,a)=>{if(a!==d)if("TEMPLATE"===s.tagName){if(t[r]&&t[r].element){const n=t[r].element;o(e,n,(()=>{n.remove(),t[r].element=void 0}))}}else o(e,s,(()=>{s.style.display="none"}));else"TEMPLATE"===s.tagName?(u=document.importNode(s.content,!0),(l=s).nextSibling?l.parentNode.insertBefore(u,l.nextSibling):l.parentNode.appendChild(u),t[r].element=s.nextSibling,n(e,t[r].element)):(s.style.display=null,n(e,s));var l,u};t[r].handler=u,a.addEventListener("changed",u),u(a.getRoute()),a.addEventListener("destroyed",l)};l()},destroy:(e,t,{transitionOut:n})=>{const o=t.getElement();if("TEMPLATE"===o.tagName){if(t[r]&&t[r].element){const i=t[r].element;n(e,i,(()=>{i.remove(),t[r].element=void 0}))}}else n(e,o,(()=>{o.style.display="none"}));const s=i(o);s&&t[r]&&(s.removeEventListener("destroyed",t[r].setup),t[r].handler&&s.removeEventListener("change",t[r].handler))}},c={name:"route-to",update:(e,n)=>{const r=n.getElement(),o=n.getModifiers(),s=n.getValue();if(n[t]){if(n[t].value===s)return;n[t].target.removeEventListener("click",n[t].handler)}const a=e=>{if(o.self&&e.target!==r)return;o.prevent&&e.preventDefault(),o.stop&&e.stopPropagation();const t=i(r);t&&t.setPath(s)};r.addEventListener("click",a),n[t]={handler:a,value:s}},destroy:(e,n)=>{n[t]&&(n.getElement().removeEventListener("click",n[t].handler),delete n[t])}};const f=(e,...t)=>{if(!t.length)return e;const n=t.shift();if(p(e)&&p(n))for(const t in n)p(n[t])?(e[t]||Object.assign(e,{[t]:{}}),f(e[t],n[t])):Array.isArray(n[t])?e[t]=n[t].map((e=>p(e)?f({},e):e)):Object.assign(e,{[t]:n[t]});return f(e,...t)},p=e=>e&&"object"==typeof e&&!Array.isArray(e);return class{constructor(e,t=null){let r;t=f({},t),e.addEventListener("enabling",(()=>{var i;e.addContexts(0,o),i=t,r={name:"router",update:(e,t,{executeExpression:r})=>{const o=t.getElement();let s=o[n];if(!s){const a=Object.assign({},i,r(e,t.clone(),t.getValue()));s=o[n]=new d(a)}},destroy:(e,t)=>{const r=t.getElement(),i=r[n];if(!i)return;delete r[n];const o=i.getId();i.destroy(),e.getLibrary().update([{id:o,path:""}])}},e.addDirectives(-1,r,u,c)})),e.addEventListener("disabling",(()=>{e.removeContexts(o),e.removeDirectives(r,u,c),r=null}))}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).DoarsRouter=factory();
