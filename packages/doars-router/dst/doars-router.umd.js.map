{"version":3,"file":"doars-router.umd.js","sources":["../../doars/src/polyfills/RevocableProxy.js","../src/symbols.js","../src/utils.js","../src/contexts/router.js","../../../node_modules/path-to-regexp/dist.es2015/index.js","../../doars/src/events/EventDispatcher.js","../src/Router.js","../src/factories/directives/router.js","../../doars/src/utils/ElementUtils.js","../src/directives/route.js","../src/directives/routeTo.js","../../doars/src/utils/ObjectUtils.js","../src/DoarsRouter.js"],"sourcesContent":["// List of methods to revoke access to.\nconst REFLECTION_METHODS = [\n  'apply',\n  'construct',\n  'defineProperty',\n  'deleteProperty',\n  'get',\n  'getOwnPropertyDescriptor',\n  'getPrototypeOf',\n  'isExtensible',\n  'ownKeys',\n  'preventExtensions',\n  'set',\n  'setPrototypeOf',\n]\n\n/**\n * Revocable proxy made using regular a proxy and a simple boolean.\n */\nexport default function (target, handler) {\n  // Keep track of status.\n  let revoked = false\n\n  // Add revocable handlers for each given handlers.\n  const revocableHandler = {}\n  for (const key of REFLECTION_METHODS) {\n    revocableHandler[key] = (...parameters) => {\n      if (revoked) {\n        console.error('illegal operation attempted on a revoked proxy')\n        return\n      }\n\n      if (key in handler) {\n        return handler[key](...parameters)\n      }\n      return Reflect[key](...parameters)\n    }\n  }\n\n  // Return proxy and revoke method.\n  return {\n    proxy: new Proxy(target, revocableHandler),\n    revoke: () => {\n      revoked = true\n    },\n  }\n}\n","export const ROUTE_TO = Symbol('ROUTE_TO')\n\nexport const ROUTER = Symbol('ROUTER')\n\nexport const ROUTE = Symbol('ROUTE')\n","// Import symbols.\nimport { ROUTER } from './symbols.js'\n\n/**\n * Get closest router in hierarchy.\n * @param {HTMLElement} element Element to start searching from.\n * @returns {Router} Closest router.\n */\nexport const closestRouter = function (element) {\n  if (!element.parentElement) {\n    return\n  }\n  element = element.parentElement\n\n  if (element[ROUTER]) {\n    return element[ROUTER]\n  }\n\n  return closestRouter(element)\n}\n\nexport default {\n  closestRouter: closestRouter,\n}\n","// Import polyfill.\nimport RevocableProxy from '@doars/doars/src/polyfills/RevocableProxy.js'\n\n// Import symbol.\nimport { ROUTER } from '../symbols'\n\n// Import utils.\nimport { closestRouter } from '../utils.js'\n\nexport default {\n  name: '$router',\n\n  create: (component, attribute) => {\n    // Deconstruct attribute.\n    const element = attribute.getElement()\n\n    let router = null\n    const revocable = RevocableProxy({}, {\n      get: (target, propertyKey, receiver) => {\n        // Get closest router from hierarchy.\n        if (router === null) {\n          if (element[ROUTER]) {\n            router = element[ROUTER]\n          } else {\n            router = closestRouter(element)\n          }\n\n          // Set router to false so we don't look twice.\n          if (!router) {\n            router = false\n          }\n        }\n\n        // Mark as router accessed.\n        attribute.accessed(router.getId(), '')\n\n        if (!router) {\n          return\n        }\n\n        // Return router property.\n        return Reflect.get(router, propertyKey, receiver)\n      },\n    })\n\n    return {\n      value: revocable.proxy,\n\n      destroy: () => {\n        revocable.revoke()\n      },\n    }\n  },\n}\n","/**\n * Tokenize input string.\n */\nfunction lexer(str) {\n    var tokens = [];\n    var i = 0;\n    while (i < str.length) {\n        var char = str[i];\n        if (char === \"*\" || char === \"+\" || char === \"?\") {\n            tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"\\\\\") {\n            tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n            continue;\n        }\n        if (char === \"{\") {\n            tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"}\") {\n            tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \":\") {\n            var name = \"\";\n            var j = i + 1;\n            while (j < str.length) {\n                var code = str.charCodeAt(j);\n                if (\n                // `0-9`\n                (code >= 48 && code <= 57) ||\n                    // `A-Z`\n                    (code >= 65 && code <= 90) ||\n                    // `a-z`\n                    (code >= 97 && code <= 122) ||\n                    // `_`\n                    code === 95) {\n                    name += str[j++];\n                    continue;\n                }\n                break;\n            }\n            if (!name)\n                throw new TypeError(\"Missing parameter name at \" + i);\n            tokens.push({ type: \"NAME\", index: i, value: name });\n            i = j;\n            continue;\n        }\n        if (char === \"(\") {\n            var count = 1;\n            var pattern = \"\";\n            var j = i + 1;\n            if (str[j] === \"?\") {\n                throw new TypeError(\"Pattern cannot start with \\\"?\\\" at \" + j);\n            }\n            while (j < str.length) {\n                if (str[j] === \"\\\\\") {\n                    pattern += str[j++] + str[j++];\n                    continue;\n                }\n                if (str[j] === \")\") {\n                    count--;\n                    if (count === 0) {\n                        j++;\n                        break;\n                    }\n                }\n                else if (str[j] === \"(\") {\n                    count++;\n                    if (str[j + 1] !== \"?\") {\n                        throw new TypeError(\"Capturing groups are not allowed at \" + j);\n                    }\n                }\n                pattern += str[j++];\n            }\n            if (count)\n                throw new TypeError(\"Unbalanced pattern at \" + i);\n            if (!pattern)\n                throw new TypeError(\"Missing pattern at \" + i);\n            tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n            i = j;\n            continue;\n        }\n        tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n    }\n    tokens.push({ type: \"END\", index: i, value: \"\" });\n    return tokens;\n}\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str, options) {\n    if (options === void 0) { options = {}; }\n    var tokens = lexer(str);\n    var _a = options.prefixes, prefixes = _a === void 0 ? \"./\" : _a;\n    var defaultPattern = \"[^\" + escapeString(options.delimiter || \"/#?\") + \"]+?\";\n    var result = [];\n    var key = 0;\n    var i = 0;\n    var path = \"\";\n    var tryConsume = function (type) {\n        if (i < tokens.length && tokens[i].type === type)\n            return tokens[i++].value;\n    };\n    var mustConsume = function (type) {\n        var value = tryConsume(type);\n        if (value !== undefined)\n            return value;\n        var _a = tokens[i], nextType = _a.type, index = _a.index;\n        throw new TypeError(\"Unexpected \" + nextType + \" at \" + index + \", expected \" + type);\n    };\n    var consumeText = function () {\n        var result = \"\";\n        var value;\n        // tslint:disable-next-line\n        while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n            result += value;\n        }\n        return result;\n    };\n    while (i < tokens.length) {\n        var char = tryConsume(\"CHAR\");\n        var name = tryConsume(\"NAME\");\n        var pattern = tryConsume(\"PATTERN\");\n        if (name || pattern) {\n            var prefix = char || \"\";\n            if (prefixes.indexOf(prefix) === -1) {\n                path += prefix;\n                prefix = \"\";\n            }\n            if (path) {\n                result.push(path);\n                path = \"\";\n            }\n            result.push({\n                name: name || key++,\n                prefix: prefix,\n                suffix: \"\",\n                pattern: pattern || defaultPattern,\n                modifier: tryConsume(\"MODIFIER\") || \"\"\n            });\n            continue;\n        }\n        var value = char || tryConsume(\"ESCAPED_CHAR\");\n        if (value) {\n            path += value;\n            continue;\n        }\n        if (path) {\n            result.push(path);\n            path = \"\";\n        }\n        var open = tryConsume(\"OPEN\");\n        if (open) {\n            var prefix = consumeText();\n            var name_1 = tryConsume(\"NAME\") || \"\";\n            var pattern_1 = tryConsume(\"PATTERN\") || \"\";\n            var suffix = consumeText();\n            mustConsume(\"CLOSE\");\n            result.push({\n                name: name_1 || (pattern_1 ? key++ : \"\"),\n                pattern: name_1 && !pattern_1 ? defaultPattern : pattern_1,\n                prefix: prefix,\n                suffix: suffix,\n                modifier: tryConsume(\"MODIFIER\") || \"\"\n            });\n            continue;\n        }\n        mustConsume(\"END\");\n    }\n    return result;\n}\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile(str, options) {\n    return tokensToFunction(parse(str, options), options);\n}\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction(tokens, options) {\n    if (options === void 0) { options = {}; }\n    var reFlags = flags(options);\n    var _a = options.encode, encode = _a === void 0 ? function (x) { return x; } : _a, _b = options.validate, validate = _b === void 0 ? true : _b;\n    // Compile all the tokens into regexps.\n    var matches = tokens.map(function (token) {\n        if (typeof token === \"object\") {\n            return new RegExp(\"^(?:\" + token.pattern + \")$\", reFlags);\n        }\n    });\n    return function (data) {\n        var path = \"\";\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            if (typeof token === \"string\") {\n                path += token;\n                continue;\n            }\n            var value = data ? data[token.name] : undefined;\n            var optional = token.modifier === \"?\" || token.modifier === \"*\";\n            var repeat = token.modifier === \"*\" || token.modifier === \"+\";\n            if (Array.isArray(value)) {\n                if (!repeat) {\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to not repeat, but got an array\");\n                }\n                if (value.length === 0) {\n                    if (optional)\n                        continue;\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to not be empty\");\n                }\n                for (var j = 0; j < value.length; j++) {\n                    var segment = encode(value[j], token);\n                    if (validate && !matches[i].test(segment)) {\n                        throw new TypeError(\"Expected all \\\"\" + token.name + \"\\\" to match \\\"\" + token.pattern + \"\\\", but got \\\"\" + segment + \"\\\"\");\n                    }\n                    path += token.prefix + segment + token.suffix;\n                }\n                continue;\n            }\n            if (typeof value === \"string\" || typeof value === \"number\") {\n                var segment = encode(String(value), token);\n                if (validate && !matches[i].test(segment)) {\n                    throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to match \\\"\" + token.pattern + \"\\\", but got \\\"\" + segment + \"\\\"\");\n                }\n                path += token.prefix + segment + token.suffix;\n                continue;\n            }\n            if (optional)\n                continue;\n            var typeOfMessage = repeat ? \"an array\" : \"a string\";\n            throw new TypeError(\"Expected \\\"\" + token.name + \"\\\" to be \" + typeOfMessage);\n        }\n        return path;\n    };\n}\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match(str, options) {\n    var keys = [];\n    var re = pathToRegexp(str, keys, options);\n    return regexpToFunction(re, keys, options);\n}\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction(re, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.decode, decode = _a === void 0 ? function (x) { return x; } : _a;\n    return function (pathname) {\n        var m = re.exec(pathname);\n        if (!m)\n            return false;\n        var path = m[0], index = m.index;\n        var params = Object.create(null);\n        var _loop_1 = function (i) {\n            // tslint:disable-next-line\n            if (m[i] === undefined)\n                return \"continue\";\n            var key = keys[i - 1];\n            if (key.modifier === \"*\" || key.modifier === \"+\") {\n                params[key.name] = m[i].split(key.prefix + key.suffix).map(function (value) {\n                    return decode(value, key);\n                });\n            }\n            else {\n                params[key.name] = decode(m[i], key);\n            }\n        };\n        for (var i = 1; i < m.length; i++) {\n            _loop_1(i);\n        }\n        return { path: path, index: index, params: params };\n    };\n}\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str) {\n    return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options) {\n    return options && options.sensitive ? \"\" : \"i\";\n}\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path, keys) {\n    if (!keys)\n        return path;\n    var groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n    var index = 0;\n    var execResult = groupsRegex.exec(path.source);\n    while (execResult) {\n        keys.push({\n            // Use parenthesized substring match if available, index otherwise\n            name: execResult[1] || index++,\n            prefix: \"\",\n            suffix: \"\",\n            modifier: \"\",\n            pattern: \"\"\n        });\n        execResult = groupsRegex.exec(path.source);\n    }\n    return path;\n}\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(paths, keys, options) {\n    var parts = paths.map(function (path) { return pathToRegexp(path, keys, options).source; });\n    return new RegExp(\"(?:\" + parts.join(\"|\") + \")\", flags(options));\n}\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(path, keys, options) {\n    return tokensToRegexp(parse(path, options), keys, options);\n}\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(tokens, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.strict, strict = _a === void 0 ? false : _a, _b = options.start, start = _b === void 0 ? true : _b, _c = options.end, end = _c === void 0 ? true : _c, _d = options.encode, encode = _d === void 0 ? function (x) { return x; } : _d;\n    var endsWith = \"[\" + escapeString(options.endsWith || \"\") + \"]|$\";\n    var delimiter = \"[\" + escapeString(options.delimiter || \"/#?\") + \"]\";\n    var route = start ? \"^\" : \"\";\n    // Iterate over the tokens and create our regexp string.\n    for (var _i = 0, tokens_1 = tokens; _i < tokens_1.length; _i++) {\n        var token = tokens_1[_i];\n        if (typeof token === \"string\") {\n            route += escapeString(encode(token));\n        }\n        else {\n            var prefix = escapeString(encode(token.prefix));\n            var suffix = escapeString(encode(token.suffix));\n            if (token.pattern) {\n                if (keys)\n                    keys.push(token);\n                if (prefix || suffix) {\n                    if (token.modifier === \"+\" || token.modifier === \"*\") {\n                        var mod = token.modifier === \"*\" ? \"?\" : \"\";\n                        route += \"(?:\" + prefix + \"((?:\" + token.pattern + \")(?:\" + suffix + prefix + \"(?:\" + token.pattern + \"))*)\" + suffix + \")\" + mod;\n                    }\n                    else {\n                        route += \"(?:\" + prefix + \"(\" + token.pattern + \")\" + suffix + \")\" + token.modifier;\n                    }\n                }\n                else {\n                    route += \"(\" + token.pattern + \")\" + token.modifier;\n                }\n            }\n            else {\n                route += \"(?:\" + prefix + suffix + \")\" + token.modifier;\n            }\n        }\n    }\n    if (end) {\n        if (!strict)\n            route += delimiter + \"?\";\n        route += !options.endsWith ? \"$\" : \"(?=\" + endsWith + \")\";\n    }\n    else {\n        var endToken = tokens[tokens.length - 1];\n        var isEndDelimited = typeof endToken === \"string\"\n            ? delimiter.indexOf(endToken[endToken.length - 1]) > -1\n            : // tslint:disable-next-line\n                endToken === undefined;\n        if (!strict) {\n            route += \"(?:\" + delimiter + \"(?=\" + endsWith + \"))?\";\n        }\n        if (!isEndDelimited) {\n            route += \"(?=\" + delimiter + \"|\" + endsWith + \")\";\n        }\n    }\n    return new RegExp(route, flags(options));\n}\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(path, keys, options) {\n    if (path instanceof RegExp)\n        return regexpToRegexp(path, keys);\n    if (Array.isArray(path))\n        return arrayToRegexp(path, keys, options);\n    return stringToRegexp(path, keys, options);\n}\n//# sourceMappingURL=index.js.map","class EventDispatcher {\n  /**\n   * Create instance.\n   */\n  constructor() {\n    let events = {}\n\n    /**\n     * Add callback to event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function to call on dispatch.\n     * @param {Object} options Callback options.\n     */\n    this.addEventListener = (name, callback, options = null) => {\n      // Check if event name exits and callback is not already present.\n      if (!(name in events)) {\n        events[name] = []\n      }\n\n      // Add to events.\n      events[name].push({\n        callback: callback,\n        options: options,\n      })\n    }\n\n    /**\n     * Remove callback from event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function that would be called.\n     */\n    this.removeEventListener = (name, callback) => {\n      // Check if event exists.\n      if (!Object.keys(events).includes(name)) {\n        return\n      }\n      const eventData = events[name]\n\n      // Get index of callback in events.\n      let index = -1\n      for (let i = 0; i < eventData.length; i++) {\n        if (eventData[i].callback === callback) {\n          index = i\n          break\n        }\n      }\n      if (index < 0) {\n        return\n      }\n\n      // Remove item from events.\n      eventData.splice(index, 1)\n\n      // Remove event if list is empty.\n      if (Object.keys(eventData).length === 0) {\n        delete events[name]\n      }\n    }\n\n    /**\n     * Remove listeners to an event.\n     * @param {String} name Event name.\n     */\n    this.removeEventListeners = (name) => {\n      if (!name) {\n        return\n      }\n\n      // Remove all handlers with the event name.\n      delete events[name]\n    }\n\n    /**\n     * Remove all listeners.\n     * @param {String} name Event name.\n     */\n    this.removeAllEventListeners = () => {\n      // Remove all listeners.\n      events = {}\n    }\n\n    /**\n     * Trigger event and dispatch data to listeners.\n     * @param {String} name Event name.\n     * @param {Array<Any>} parameters Event parameters to pass through.\n     * @param {Object} options Dispatch options.\n     */\n    this.dispatchEvent = (name, parameters, options = null) => {\n      // Check if event exists.\n      if (!events[name]) {\n        return\n      }\n      // Get events by trigger name.\n      const eventData = events[name]\n\n      // Dispatch a call to each event.\n      for (let i = 0; i < eventData.length; i++) {\n        const event = (options && options.reverse) ? eventData[eventData.length - (i + 1)] : eventData[i]\n\n        // If once is truthy then remove the callback.\n        if (event.options && event.options.once) {\n          eventData.splice(i, 1)\n        }\n\n        // Execute callback.\n        event.callback(...parameters)\n      }\n    }\n  }\n}\n\nexport default EventDispatcher\n","// Import external modules.\nimport { pathToRegexp } from 'path-to-regexp'\n\n// Import event dispatcher.\nimport EventDispatcher from '@doars/doars/src/events/EventDispatcher.js'\n\nclass Router extends EventDispatcher {\n  constructor(options = {}) {\n    super()\n\n    // Create id.\n    const id = Symbol('ID_ROUTER')\n\n    // Overwrite default with given options.\n    options = Object.assign({\n      basePath: '',\n      updateHistory: false,\n      pathToRegexp: {},\n    }, options)\n\n    let path = null\n    let route = null\n    let routes = {}\n\n    // Listen for history state changes.\n    const handleHistory = () => {\n      this.setPath(window.location.pathname)\n    }\n    if (options.updateHistory) {\n      window.addEventListener('popstate', handleHistory)\n    }\n\n    /**\n     * Update route.\n     * @param {String} url URL.\n     * @param {String} _path Path.\n     * @param {String} _route Route.\n     */\n    const updateRoute = function (url, _path, _route) {\n      // Update stored data.\n      path = _path\n      route = _route\n\n      // Update page history if the option is set.\n      if (options.updateHistory) {\n        // Construct url.\n        const _url = url.includes(options.basePath) ? url : options.basePath + url\n        // Check if url is not current url.\n        if (_url !== window.location.pathname) {\n          // Add path to history.\n          window.history.pushState(null, window.document.title, _url)\n        }\n      }\n\n      // Dispatch event on router.\n      this.dispatchEvent('changed', [this, route, path])\n    }.bind(this)\n\n    /**\n     * Get router id.\n     * @returns {Symbol} Unique identifier.\n     */\n    this.getId = () => {\n      return id\n    }\n\n    /**\n     * Get current path.\n     * @returns {String} path.\n     */\n    this.getPath = () => {\n      return path\n    }\n\n    /**\n     * Get current route.\n     * @returns {String} Route.\n     */\n    this.getRoute = () => {\n      return route\n    }\n\n    /**\n     * Get observed routes.\n     * @returns {Array<String>} List of routers.\n     */\n    this.getRoutes = () => {\n      return Object.keys(routes)\n    }\n\n    /**\n     * Destroy router instance.\n     */\n    this.destroy = () => {\n      // Stop listening to state changes.\n      if (options.updateHistory) {\n        window.removeEventListener('popstate', handleHistory)\n      }\n\n      options = null\n      path = null\n      route = null\n      routes = null\n\n      // Dispatch add event.\n      this.dispatchEvent('destroyed', [this])\n\n      // Remove all listeners.\n      this.removeAllEventListeners()\n    }\n\n    /**\n     * Add route.\n     * @param {String} _route Route pattern.\n     */\n    this.addRoute = function (_route) {\n      // Convert path to regexp and store it in routes.\n      routes[_route] = pathToRegexp(_route, [], options.pathToRegexp)\n\n      // Dispatch add event.\n      this.dispatchEvent('added', [this, _route])\n\n      if (path) {\n        // Remove base url, if present.\n        const _path = _route.replace(options.basePath, '')\n        // Check if current route is.\n        if (routes[_route].test(_path)) {\n          updateRoute(path, _path, _route)\n        }\n      }\n    }\n\n    /**\n     * Remove route.\n     * @param {String} _route Route pattern.\n     */\n    this.removeRoute = function (_route) {\n      // Delete route.\n      delete routes[_route]\n\n      // Dispatch removed event.\n      this.dispatchEvent('removed', [this, _route])\n\n      if (route === _route) {\n        // Set current route as none.\n        path = null\n        route = null\n\n        // Dispatch changed event.\n        this.dispatchEvent('changed', [this, route, path])\n      }\n    }\n\n    /**\n     * Set current route.\n     * @param {String} url URL path.\n     */\n    this.setPath = function (url) {\n      // Remove base url, if present.\n      const _path = url.replace(options.basePath, '')\n      if (path === _path) {\n        return\n      }\n\n      // Find matching routes.\n      let newRoute = null\n      for (const _route in routes) {\n        // Test route.\n        if (routes[_route].test(_path)) {\n          newRoute = _route\n          break\n        }\n      }\n\n      // Update route.\n      updateRoute(url, path, newRoute)\n    }\n  }\n}\n\nexport default Router\n","// Import router.\nimport Router from '../../Router.js'\n\n// Import symbols.\nimport { ROUTER } from '../../symbols.js'\n\nexport default function (routerOptions) {\n  return {\n    name: 'router',\n\n    update: (component, attribute, { executeExpression }) => {\n      // Deconstruct attribute.\n      const element = attribute.getElement()\n\n      // Get router.\n      let router = element[ROUTER]\n      if (!router) {\n        // Construct options.\n        const options = Object.assign({}, routerOptions, executeExpression(component, attribute.clone(), attribute.getValue()))\n        // Create router\n        router = element[ROUTER] = new Router(options)\n      }\n    },\n\n    destroy: (component, attribute) => {\n      // Deconstruct attribute.\n      const element = attribute.getElement()\n\n      // Get router.\n      const router = element[ROUTER]\n      if (!router) {\n        return\n      }\n\n      // Remove router reference.\n      delete element[ROUTER]\n\n      // Deconstruct router.\n      const id = router.getId()\n\n      // Destroy router.\n      router.destroy()\n\n      // Deconstruct component.\n      const library = component.getLibrary()\n\n      // Trigger update due to changed router.\n      library.update([{ id: id, path: '' }])\n    },\n  }\n}\n","/**\n * Inserts an element after the reference element opposite of insertBefore and more reliable then ChildNode.after()\n * @param {HTMLElement} reference Node to insert after.\n * @param {Node} node Node to insert.\n */\nexport const insertAfter = (reference, node) => {\n  if (reference.nextSibling) {\n    reference.parentNode.insertBefore(node, reference.nextSibling)\n  } else {\n    reference.parentNode.appendChild(node)\n  }\n}\n\n/**\n * Iterate over all descendants of a given node.\n * @param {HTMLElement} element Element to walk over.\n * @param {Function} filter Filter function, return false to skip element.\n * @returns {Function} Iterator function. Call until a non-truthy value is returned.\n */\nexport const walk = (element, filter) => {\n  let index = -1\n  let iterator = null\n  return () => {\n    // First go over iterator.\n    if (index >= 0 && iterator) {\n      const child = iterator()\n      if (child) {\n        return child\n      }\n    }\n\n    // Get next child that passes the filter.\n    let child = null\n    do {\n      index++\n      if (index >= element.childElementCount) {\n        return null\n      }\n\n      child = element.children[index]\n    } while (!filter(child))\n\n    // Setup iterator for child.\n    if (child.childElementCount) {\n      iterator = walk(child, filter)\n    }\n\n    // Return the child.\n    return child\n  }\n}\n\nexport default {\n  insertAfter: insertAfter,\n  walk: walk,\n}\n","// Import symbols.\nimport { ROUTE } from '../symbols.js'\n\n// Import utils.\nimport { closestRouter } from '../utils.js'\nimport { insertAfter } from '@doars/doars/src/utils/ElementUtils.js'\n\nexport default {\n  name: 'route',\n\n  update: (component, attribute, { transitionIn, transitionOut }) => {\n    // Deconstruct attribute.\n    const element = attribute.getElement()\n\n    let router\n    const setup = () => {\n      // Stop listening to router and remove it.\n      if (router && attribute[ROUTE]) {\n        router.removeEventListener('changed', attribute[ROUTE].handler)\n        router.removeEventListener('destroyed', attribute[ROUTE].setup)\n\n        delete attribute[ROUTE]\n      }\n\n      // Get closest router in parent nodes.\n      router = closestRouter(element)\n      if (!router) {\n        console.warn('DoarsRouter: Router not found for route.')\n        return\n      }\n\n      // Setup route data.\n      attribute[ROUTE] = {\n        setup: setup,\n      }\n\n      // Deconstruct attribute.\n      const value = attribute.getValue()\n\n      // Add route to router.\n      router.addRoute(value)\n\n      // Handle router changes.\n      const handleChange = (router, route) => {\n        if (route !== value) {\n          if (element.tagName === 'TEMPLATE') {\n            if (attribute[ROUTE] && attribute[ROUTE].element) {\n              // Transition out.\n              const routeElement = attribute[ROUTE].element\n              transitionOut(component, routeElement, () => {\n                // Remove node.\n                routeElement.remove()\n                attribute[ROUTE].element = undefined\n              })\n            }\n          } else {\n            // Transition out and set display none.\n            transitionOut(component, element, () => {\n              element.style.display = 'none'\n            })\n          }\n        } else if (element.tagName === 'TEMPLATE') {\n          // Create new element from template.\n          const templateInstance = document.importNode(element.content, true)\n          // Add element after the template element.\n          insertAfter(element, templateInstance)\n          // Get HTMLElement reference instead of DocumentFragment.\n          attribute[ROUTE].element = element.nextSibling\n\n          // Transition in.\n          transitionIn(component, attribute[ROUTE].element)\n        } else {\n          // Remove display none.\n          element.style.display = null\n\n          // Transition in.\n          transitionIn(component, element)\n        }\n      }\n      attribute[ROUTE].handler = handleChange\n\n      // Listen to router changes and perform initial run.\n      router.addEventListener('changed', handleChange)\n      handleChange({ route: router.getRoute() })\n\n      // If the router is destroyed look for another\n      router.addEventListener('destroyed', setup)\n    }\n\n    // Perform initial setup.\n    setup()\n  },\n\n  destroy: (component, attribute, { transitionOut }) => {\n    // Deconstruct attribute.\n    const element = attribute.getElement()\n    if (element.tagName === 'TEMPLATE') {\n      if (attribute[ROUTE] && attribute[ROUTE].element) {\n        // Transition out.\n        const routeElement = attribute[ROUTE].element\n        transitionOut(component, routeElement, () => {\n          // Remove node.\n          routeElement.remove()\n          attribute[ROUTE].element = undefined\n        })\n      }\n    } else {\n      // Transition out and set display none.\n      transitionOut(component, element, () => {\n        element.style.display = 'none'\n      })\n    }\n\n    // Get closest router in parent nodes.\n    const router = closestRouter(element)\n    if (!router) {\n      return\n    }\n\n    // Remove router listeners.\n    if (attribute[ROUTE]) {\n      router.removeEventListener('destroyed', attribute[ROUTE].setup)\n      if (attribute[ROUTE].handler) {\n        router.removeEventListener('change', attribute[ROUTE].handler)\n      }\n    }\n  },\n}\n","// Import symbols.\nimport { ROUTE_TO } from '../symbols.js'\n\n// Import utils.\nimport { closestRouter } from '../utils.js'\n\nexport default {\n  name: 'route-to',\n\n  update: (component, attribute) => {\n    const element = attribute.getElement()\n    const modifiers = attribute.getModifiers()\n    const value = attribute.getValue()\n\n    // Check for existing data.\n    if (attribute[ROUTE_TO]) {\n      // Exit early if listener has not changed.\n      if (attribute[ROUTE_TO].value === value) {\n        return\n      }\n\n      // Remove existing listeners so we don't listen twice.\n      attribute[ROUTE_TO].target.removeEventListener('click', attribute[ROUTE_TO].handler)\n    }\n\n    const handler = (event) => {\n      if (modifiers.self && event.target !== element) {\n        return\n      }\n\n      if (modifiers.prevent) {\n        event.preventDefault()\n      }\n      if (modifiers.stop) {\n        event.stopPropagation()\n      }\n\n      const router = closestRouter(element)\n      if (!router) {\n        return\n      }\n\n      router.setPath(value)\n    }\n\n    // Listen to click and keyboard events.\n    element.addEventListener('click', handler)\n\n    // Store listener data on the component.\n    attribute[ROUTE_TO] = {\n      handler: handler,\n      value: value,\n    }\n  },\n\n  destroy: (component, attribute) => {\n    if (!attribute[ROUTE_TO]) {\n      return\n    }\n\n    const element = attribute.getElement()\n\n    element.removeEventListener('click', attribute[ROUTE_TO].handler)\n\n    delete attribute[ROUTE_TO]\n  },\n}\n","/**\n * Deeply assign a series of objects properties together.\n * @param {Object} target Target object to merge to.\n * @param  {...Object} sources Objects to merge into the target.\n */\nexport const deepAssign = (target, ...sources) => {\n  if (!sources.length) {\n    return target\n  }\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, {\n            [key]: {},\n          })\n        }\n        deepAssign(target[key], source[key])\n      } else if (Array.isArray(source[key])) {\n        target[key] = source[key].map((value) => {\n          if (isObject(value)) {\n            return deepAssign({}, value)\n          }\n          return value\n        })\n      } else {\n        Object.assign(target, {\n          [key]: source[key],\n        })\n      }\n    }\n  }\n\n  return deepAssign(target, ...sources)\n}\n\n/**\n * Get value at path on object.\n * @param {Object} object Object to get from.\n * @param  {Array<String>} path Path to value.\n * @returns {Any} value at path.\n */\nexport const get = (object, path) => {\n  let objectTemp = object\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    objectTemp = objectTemp[path[i]]\n  }\n  return objectTemp[path[i]]\n}\n\n/**\n * Check whether the value is an object.\n * @param {Any} value Value of unknown type.\n * @returns Whether the value is an object.\n */\nexport const isObject = (value) => {\n  return (value && typeof value === 'object' && !Array.isArray(value))\n}\n\n/**\n * Set value on path at object.\n * @param {Object} object Object to set on.\n * @param {Array<String>} path Path to value.\n * @param {Any} value Value to set.\n */\nexport const set = (object, path, value) => {\n  // Exit early if not an object.\n  if (typeof (object) !== 'object') {\n    return\n  }\n\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    object = object[path[i]]\n\n    // Exit early if not an object.\n    if (typeof (object) !== 'object') {\n      return\n    }\n  }\n  object[path[i]] = value\n}\n\nexport default {\n  deepAssign: deepAssign,\n  get: get,\n  isObject: isObject,\n  set: set,\n}\n","// Import contexts.\nimport contextRouter from './contexts/router.js'\n\n// Import directives.\nimport createDirectiveRouter from './factories/directives/router.js'\nimport directiveRoute from './directives/route.js'\nimport directiveRouteTo from './directives/routeTo.js'\n\n// Import utils.\nimport { deepAssign } from '@doars/doars/src/utils/ObjectUtils.js'\n\nclass DoarsRouter {\n  /**\n   * Create plugin instance.\n   * @param {Doars} library Doars instance to add onto.\n   * @param {Object} options The plugin options.\n   */\n  constructor(library, options = null) {\n    // Clone options.\n    options = deepAssign({}, options)\n\n    // Set private variables.\n    let directiveRouter\n\n    // Enable plugin when library is enabling.\n    library.addEventListener('enabling', () => {\n      // Add contexts and directives.\n      library.addContexts(0, contextRouter)\n      directiveRouter = createDirectiveRouter(options)\n      library.addDirectives(-1, directiveRouter, directiveRoute, directiveRouteTo)\n    })\n\n    // Disable plugin when library is disabling.\n    library.addEventListener('disabling', () => {\n      // Remove contexts and directives.\n      library.removeContexts(contextRouter)\n      library.removeDirectives(directiveRouter, directiveRoute, directiveRouteTo)\n\n      // Remove router.\n      directiveRouter = null\n    })\n  }\n}\n\nexport default DoarsRouter\n"],"names":["REFLECTION_METHODS","target","handler","revoked","revocableHandler","key","console","error","Reflect","proxy","Proxy","revoke","ROUTE_TO","Symbol","ROUTER","ROUTE","closestRouter","element","parentElement","name","create","component","attribute","getElement","router","revocable","RevocableProxy","get","propertyKey","receiver","accessed","getId","value","destroy","EventDispatcher","events","addEventListener","callback","options","push","removeEventListener","Object","keys","includes","eventData","index","i","length","splice","removeEventListeners","removeAllEventListeners","dispatchEvent","parameters","event","reverse","once","Router","id","assign","basePath","updateHistory","pathToRegexp","path","route","routes","handleHistory","setPath","window","location","pathname","updateRoute","url","_path","_route","_url","history","pushState","document","title","bind","getPath","getRoute","getRoutes","addRoute","replace","test","removeRoute","newRoute","routerOptions","update","executeExpression","clone","getValue","library","getLibrary","insertAfter","reference","node","nextSibling","parentNode","insertBefore","appendChild","transitionIn","transitionOut","setup","warn","handleChange","tagName","routeElement","remove","undefined","style","display","templateInstance","importNode","content","modifiers","getModifiers","self","prevent","preventDefault","stop","stopPropagation","deepAssign","sources","source","shift","isObject","Array","isArray","map","DoarsRouter","directiveRouter","addContexts","contextRouter","createDirectiveRouter","addDirectives","directiveRoute","directiveRouteTo","removeContexts","removeDirectives"],"mappings":"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"}