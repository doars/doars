var pe=(e,r)=>{let t;switch(String.prototype.toLowerCase.call(r)){default:break;case"arraybuffer":t=e.arrayBuffer();break;case"blob":t=e.blob();break;case"formdata":t=e.formData();break;case"json":t=e.json();break;case"element":case"html-partial":case"html":case"svg":case"text":case"xml":t=e.text();break}return t?t.then(n=>{switch(r){case"element":case"html-partial":let s=document.createElement("template");s.innerHTML=n,n=s.content.childNodes[0];break;case"html":n=new DOMParser().parseFromString(n,"text/html");break;case"svg":n=new DOMParser().parseFromString(n,"image/svg+xml");break;case"xml":n=new DOMParser().parseFromString(n,"application/xml");break}return n}):null},he=(e,r=null)=>{let t=e.headers.get("Content-Type");if(t){t=String.prototype.toLowerCase.call(t).split(";")[0];let s=J(t.trim());if(s)return s}let n=e.url.split(".");if(n)switch(n=n[n.length-1],n){case"htm":case"html":return"html";case"json":return"json";case"svg":return"svg";case"txt":return"text";case"xml":return"xml"}if(r){let s=r.headers.Accept;if(s){s=String.prototype.toLowerCase.call(s).split(",");for(let o of s){o=o.split(";")[0].trim();let a=J(o);if(a)return a}}}return null},J=e=>{switch(e){case"text/html":return"html";case"text/html-partial":return"html-partial";case"text/json":case"application/json":case"application/ld+json":case"application/vnd.api+json":return"json";case"image/svg+xml":return"svg";case"text/plain":return"text";case"application/xml":case"text/xml":return"xml"}},H=(e,r,t)=>new Promise((n,s)=>{fetch(e,r).then(o=>{if(o.status<200||o.status>=500){s(o);return}(!t||t==="auto")&&(t=he(o,r));let a=pe(o,t);if(!a)throw new Error("No valid response returned.");a.then(i=>{o.value=i,n(o)})}).catch(o=>{s(o)})});var N=(e,...r)=>{if(!r.length)return e;let t=r.shift();if(R(e)&&R(t))for(let n in t)R(t[n])?(e[n]||Object.assign(e,{[n]:{}}),N(e[n],t[n])):Array.isArray(t[n])?e[n]=t[n].map(s=>R(s)?N({},s):s):Object.assign(e,{[n]:t[n]});return N(e,...r)};var R=e=>e&&typeof e=="object"&&!Array.isArray(e);var Q=({fetchContextName:e,fetchOptions:r})=>({name:e,create:()=>({value:(t,n=null)=>{r&&(n=N({},r,n));let s=n.returnType?n.returnType:null;return delete n.returnType,H(t,n,s).then(o=>{if(o&&o.value)return o.value})}})});var A=e=>{let r=e.substring(0,15).toLowerCase();if(r.startsWith("<!doctype html>")||r.startsWith("<html>")){let n=document.createElement("html");return n.innerHTML=e,n}let t=document.createElement("template");return t.innerHTML=e,t.content.childNodes[0]},q=(e,r)=>e.isSameNode&&e.isSameNode(r)?!0:e.type===3?e.nodeValue===r.nodeValue:e.tagName===r.tagName,T=(e,r,t,n)=>{let s=r.getLibrary().getOptions(),o=t.getElement(),a=t.getDirective(),i=s.prefix+"-"+a+"-"+s.selectFromElementDirectiveName;if(!o.hasAttribute(i))return e;let f=null;if(s.selectFromElementDirectiveEvaluate){if(f=n(r,t,o.getAttribute(i)),typeof f!="string")return null}else f=o.getAttribute(i);if(f){let v=typeof e=="string";if(v&&(e=A(e)),e=e.querySelector(f),v&&e)return e.outerHTML}return e},W=(e,r)=>{let t=-1,n=null;return()=>{if(t>=0&&n){let o=n();if(o)return o}let s=null;do{if(t++,t>=e.childElementCount)return null;s=e.children[t]}while(!r(s));return s.childElementCount&&(n=W(s,r)),s}};var ge={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},be=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var Z=e=>typeof e!="string"?e:e.replaceAll(be,r=>ge[r]);var M=e=>{if(typeof e=="string"&&(e=e.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(e))return;let r={};for(let t of e)switch(t=t.trim(),t[0]){case"#":r.id=t.substring(1);break;case".":t=t.substring(1),r.class||(r.class=[]),r.class.includes(t)||r.class.push(t);break;case"[":let[n,s,o]=t.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);r[s]=o;break}return r};var _=(e,r)=>{for(let t in r){if(t==="class"){for(let n of r.class)e.classList.add(n);continue}e.setAttribute(t,r[t])}},ee=(e,r)=>{let t=e.attributes,n=r.attributes,s=null,o=null,a=null,i=null,f=null;for(let v=n.length-1;v>=0;--v)f=n[v],i=f.name,s=f.namespaceURI,o=f.value,s?(i=f.localName||i,a=e.getAttributeNS(s,i),a!==o&&e.setAttributeNS(s,i,o)):e.hasAttribute(i)?(a=e.getAttribute(i),a!==o&&(o==="null"||o==="undefined"?e.removeAttribute(i):e.setAttribute(i,o))):e.setAttribute(i,o);for(let v=t.length-1;v>=0;--v)f=t[v],f.specified!==!1&&(i=f.name,s=f.namespaceURI,s?(i=f.localName||i,r.hasAttributeNS(s,i)||e.removeAttributeNS(s,i)):r.hasAttributeNS(null,i)||e.removeAttribute(i))},C=(e,r)=>{for(let t in r){if(t==="class"){for(let n of r.class)e.classList.remove(n);continue}r[t]&&e.attributes[t]!==r[t]||e.removeAttribute(t)}};var ve="-transition:",te=(e,r,t,n=null)=>{if(t.nodeType!==1){n&&n();return}let s=r.prefix+ve+e,o=S=>{t.dispatchEvent(new CustomEvent("transition-"+S)),t.dispatchEvent(new CustomEvent("transition-"+e+"-"+S))},a,i,f,v,d=!1,c={};return a=s,i=t.getAttribute(a),i&&(c.during=M(i),_(t,c.during)),a=s+".from",i=t.getAttribute(a),i&&(c.from=M(i),_(t,c.from)),o("start"),v=requestAnimationFrame(()=>{if(v=null,d)return;if(c.from&&(C(t,c.from),c.from=void 0),a=s+".to",i=t.getAttribute(a),i)c.to=M(i),_(t,c.to);else if(!c.during){o("end"),n&&n(),d=!0;return}let S=getComputedStyle(t),l=Number(S.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;l===0&&(l=Number(S.animationDuration.replace("s",""))*1e3),f=setTimeout(()=>{f=null,!d&&(c.during&&(C(t,c.during),c.during=void 0),c.to&&(C(t,c.to),c.to=void 0),o("end"),n&&n(),d=!0)},l)}),()=>{d&&(d=!0,c.during&&(C(t,c.during),c.during=void 0),c.from?(C(t,c.from),c.from=void 0):c.to&&(C(t,c.to),c.to=void 0),v?(cancelAnimationFrame(v),v=null):f&&(clearTimeout(f),f=null),o("end"),n&&n())}},re=(e,r,t)=>te("in",e,r,t),ie=(e,r,t)=>te("out",e,r,t);var V=(e,r)=>{if(!r.indicator||r.indicator.indicatorTransitionOut||!r.indicator.indicatorElement)return;let t=e.getLibrary().getOptions(),n=r.indicator.indicatorElement;r.indicator.indicatorTransitionIn=ie(t,n,()=>{n&&n.remove()})},ne=(e,r,t)=>{let n=e.getLibrary().getOptions(),s=r.getElement(),o=r.getDirective(),a=n.prefix+"-"+o+"-"+n.indicatorDirectiveName;if(!s.hasAttribute(a))return;let i=null;if(n.indicatorDirectiveEvaluate?i=t(e,r,s.getAttribute(a)):i=s.getAttribute(a),!i||typeof i=="string"&&(i=s.querySelector(i),!i)||i.tagName!=="TEMPLATE"||i.childCount>1)return;if(r.indicator){if(r.indicator.indicatorTransitionOut)r.indicator.indicatorTransitionOut(),r.indicator.indicatorTransitionOut=null;else if(r.indicator.indicatorElement)return}let f=document.importNode(i.content,!0).firstElementChild;i.insertAdjacentElement("afterend",f),r.indicator={indicatorElement:f,indicatorTransitionIn:re(n,f)}};var ye=(e,r)=>{let t=r.nodeType,n=r.nodeName;t===1&&ee(e,r),(t===3||t===8)&&e.nodeValue!==r.nodeValue&&(e.nodeValue=r.nodeValue),n==="INPUT"?Ee(e,r):n==="OPTION"?X(e,r,"selected"):n==="TEXTAREA"&&Ae(e,r)},G=(e,r,t)=>{if(typeof e!="object")throw new Error("Existing tree should be an object.");if(typeof r=="string")r=A(r);else if(typeof r!="object")throw new Error("New tree should be an object.");return t&&t.childrenOnly||r.nodeType===11?(oe(e,r),e):z(e,r)},Ee=(e,r)=>{let t=r.value,n=e.value;X(e,r,"checked"),X(e,r,"disabled"),e.indeterminate!==r.indeterminate&&(e.indeterminate=r.indeterminate),e.type!=="file"&&(n!==t&&(e.setAttribute("value",t),e.value=t),t==="null"&&(e.value="",e.removeAttribute("value")),r.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=t):e.removeAttribute("value"))},Ae=(e,r)=>{let t=r.value;e.value!==t&&(e.value=t),e.firstChild&&e.firstChild.nodeValue!==t&&(e.firstChild.nodeValue=t)},X=(e,r,t)=>{e[t]!==r[t]&&(e[t]=r[t],r[t]?e.setAttribute(t,""):e.removeAttribute(t))},z=(e,r)=>e?r?e.isSameNode&&e.isSameNode(r)?e:e.tagName!==r.tagName?r:(ye(e,r),oe(e,r),e):null:r,oe=(e,r)=>{let t,n,s,o,a=0;for(let i=0;t=e.childNodes[i],n=r.childNodes[i-a],!(!t&&!n);i++)if(!n)e.removeChild(t),i--;else if(!t)e.append(n),a++;else if(q(t,n))s=z(t,n),s!==t&&(e.replaceChild(s,t),a++);else{o=null;for(let f=i;f<e.childNodes.length;f++)if(q(e.childNodes[f],n)){o=e.childNodes[f];break}o?(s=z(o,n),s!==o&&a++,e.insertBefore(s,t)):!n.id&&!t.id?(s=z(t,n),s!==t&&(e.replaceChild(s,t),a++)):(e.insertBefore(n,t),a++)}};var Me=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var se=e=>e&&Object.prototype.toString.call(e)==="[object Promise]";var ae=e=>{if(e.tagName!=="SCRIPT"||e.hasAttribute("src"))return!1;let r=document.createElement("script");return r.innerText=e.innerText,e.parentNode.insertBefore(r,e),e.remove(),!0},D=(...e)=>{for(let r of e)if(!ae(r)){let t=W(r),n=null;for(;n=t();)ae(n)}};var le=e=>{let r=document.createElement("xml");return r.append(...e.map((n,s)=>{let o=document.createElement(s);return o.textContent=n,o})),new XMLSerializer().serializeToString(r)};var u=Symbol("FETCH"),x={NONE:0,BUFFER:1,DEBOUNCE:2,THROTTLE:5,DELAY:6},ce=({fetchOptions:e,fetchDirectiveEvaluate:r,fetchDirectiveName:t,intersectionEvent:n,loadedEvent:s},o)=>({name:t,update:(a,i,f)=>{let d=a.getLibrary().getOptions(),c=i.getElement(),S=i.getDirective(),l=i.getModifiers(),k=i.getValue(),L=c.tagName==="FORM",fe=c.tagName==="BUTTON",ue=c.tagName==="INPUT"||c.tagName==="SELECT";if(i[u]){if(i[u].value===k)return;i[u].target.removeEventListener(i[u].eventName,i[u].handler),i[u].timeout&&clearTimeout(i[u].timeout),delete i[u]}let me=l.encoding?l.encoding.toLowerCase():null,Y=l.method?l.method.toUpperCase():null,j=l.position?l.position.toLowerCase():null,F={};l.capture&&(F.capture=!0),l.once&&(F.once=!0),l.passive&&!l.prevent&&(F.passive=!0);let I=x.NONE;l.buffer?(I=x.BUFFER,l.buffer===!0&&(l.buffer=5)):l.debounce?(I=x.DEBOUNCE,l.debounce===!0&&(l.debounce=500)):l.throttle?(I=x.THROTTLE,l.throttle===!0&&(l.throttle=500)):l.delay&&(I=x.DELAY,l.delay===!0&&(l.delay=500)),l.poll===!0&&(l.poll=6e4);let E="click";l.on?E=l.on:L?E="submit":ue?E="change":l.poll&&(E=s);let de={[d.prefix+"-"+d.requestHeaderName]:S,Vary:d.prefix+"-"+d.requestHeaderName},U=(h="",g={})=>{c.dispatchEvent(new CustomEvent(d.prefix+"-"+S+h,{detail:Object.assign({attribute:i,component:a},g)}))},K=h=>{let g={headers:{}};if(Y?g.method=Y:L&&c.hasAttribute("method")?g.method=c.getAttribute("method").toUpperCase():g.method="GET",L){let y=new FormData(c),p=me;switch(!p&&c.hasAttribute("enctype")?p=c.getAttribute("enctype").toLowerCase():p="urlencoded",(g.method==="HEAD"||g.method==="GET")&&(p="parameters"),p){case"json":g.headers["Content-Type"]="application/json; charset=UTF-8",g.body=JSON.stringify(Object.fromEntries(y));break;case"multipart":case"multipart/form-data":g.headers["Content-Type"]="multipart/form-data",g.body=y;break;case"parameters":h=new URL(h,window.location.href);let m=new URLSearchParams(y);for(let[w,b]of m)h.searchParams.set(w,b);h=h.toString();break;case"urlencoded":case"application/x-www-form-urlencoded":g.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",g.body=new URLSearchParams(y).toString();break;case"xml":g.headers["Content-Type"]="application/xml; charset=UTF-8",g.body=le(y);break;default:break}}return U("-started",{url:h}),H(h,Object.assign({},e,g,{headers:Object.assign({},g.headers,de)}),"text").then(y=>{$=!1;let p=y.value;l.decode&&(p=Z(p));let m=null;if(l.document)m=document.documentElement;else{let b=d.prefix+"-"+S+"-"+d.targetDirectiveName;c.getAttribute(b)&&(d.targetDirectiveEvaluate?m=f(a,i,c.getAttribute(b)):m=c.getAttribute(b),m&&typeof m=="string"&&(m=c.querySelector(m))),m||(m=c)}if(j==="append"){let b=T(A(p),a,i,f);m.append(b),(d.allowInlineScript||l.script)&&D(b)}else if(j==="prepend"){let b=T(A(p),a,i,f);m.prepend(b),(d.allowInlineScript||l.script)&&D(b)}else if(j==="after"){let b=T(A(p),a,i,f);m.insertAdjacentElement("afterend",b),(d.allowInlineScript||l.script)&&D(b)}else if(j==="before"){let b=T(A(p),a,i,f);m.insertAdjacentElement("beforebegin",b),(d.allowInlineScript||l.script)&&D(b)}else if(j==="outer")l.morph?G(m,T(A(p),a,i,f)):m.outerHTML!==p&&(m.outerHTML=T(p,a,i,f),(d.allowInlineScript||l.script)&&D(m));else if(l.morph){if(m.children.length===0)m.append(document.createElement("div"));else if(m.children.length>1)for(let B=m.children.length-1;B>=1;B--)m.children[B].remove();let b=G(m.children[0],T(A(p),a,i,f));m.children[0].isSameNode(b)||(m.children[0].remove(),m.append(b))}else m.innerHTML!==p&&(m.innerHTML=T(p,a,i,f),(d.allowInlineScript||l.script)&&D(...m.children));if(d.redirectHeaderName&&y.headers.has(d.prefix+"-"+d.redirectHeaderName)){window.location.href=y.headers.get(d.prefix+"-"+d.redirectHeaderName);return}let w="";d.titleHeaderName&&y.headers.has(d.prefix+"-"+d.titleHeaderName)&&(w=y.headers.get(d.prefix+"-"+d.titleHeaderName)),l.history&&history.pushState({},w,h),w&&document.title!==w&&(document.title=w),V(a,i),U("-succeeded",{url:h})}).catch(()=>{V(a,i),U("-failed",{url:h})})},$=!1,O=h=>new Promise(g=>{if(l.self&&h&&h.target!==c){g();return}if(L&&!c.reportValidity()){U("-invalid"),g();return}(L&&E==="submit"||fe&&c.getAttribute("type","button")&&E==="click"||l.prevent)&&h&&h.preventDefault(),l.stop&&h&&h.stopPropagation();let y=()=>{let p=null;if(k&&r?p=f(a,i,k,{$event:h,$events:i[u].buffer}):L&&c.hasAttribute("action")?p=c.getAttribute("action"):p=window.location.href,i[u].buffer=[],!p){g();return}$=!0,ne(a,i,f),(se(p)?p.then(m=>K(m)):K(p)).finally(()=>g())};if($){g();return}switch(i[u].buffer.push(h),I){case x.BUFFER:if(i[u].buffer.length<l.buffer){g();return}y();return;case x.DEBOUNCE:i[u].timeout&&(clearTimeout(i[u].timeout),i[u].timeout=null),i[u].timeout=setTimeout(y,l.debounce);return;case x.THROTTLE:let p=window.performance.now();if(i[u].lastExecution&&p-i[u].lastExecution<l.throttle){g();return}y(),i[u].lastExecution=p;return;case x.DELAY:i[u].timeout=setTimeout(y,l.delay);return}y()});if(l.poll){let h=O;O=()=>{i[u].timeout=setTimeout(()=>{h(null).finally(()=>{i[u]&&O()})},l.poll)}}if(n&&E===n){let h=O;O=()=>{F.once&&o.remove(c,O),h()},o.add(c,o)}else E===s?O():c.addEventListener(E,O,F);i[u]={buffer:[],eventName:E,handler:O,target:c,timeout:i[u]?i[u].timeout:void 0,value:k}},destroy:(a,i)=>{i[u]&&(i[u].target.removeEventListener(i[u].eventName,i[u].handler),n&&o&&o.remove(i[u].target,i[u].handler),i[u].timeout&&clearTimeout(i[u].timeout),V(a,i),delete i[u])}});var P=class{constructor(r=null){let t=new WeakMap,n=o=>{for(let a of o)for(let i of t.get(a.target))i(a)},s=new window.IntersectionObserver(n,r);this.add=(o,a)=>{t.has(o)||t.set(o,[]),t.get(o).push(a),s.observe(o)},this.remove=(o,a)=>{if(!t.has(o))return;let i=t.get(o),f=i.indexOf(a);f>=0&&i.splice(f,1),i.length===0&&(t.delete(o),s.unobserve(o))}}};function it(e,r=null){r=Object.assign({fetchContextName:"$fetch",fetchDirectiveEvaluate:!0,fetchDirectiveName:"fetch",fetchOptions:{},intersectionEvent:"intersect",intersectionRoot:null,intersectionMargin:"0px",intersectionThreshold:0,loadedEvent:"load"},r),r.defaultInit&&Object.assign(r.fetchOptions,r.defaultInit);let t=!1,n=r.intersectionEvent?new P({root:r.intersectionRoot?r.intersectionRoot:e.getOptions().root,rootMargin:r.intersectionMargin,threshold:r.intersectionThreshold}):null,s=Q(r),o=ce(r,n),a=()=>{e.addContexts(0,s),e.addDirectives(-1,o)},i=()=>{e.removeContexts(s),e.removeDirective(o)};this.disable=()=>{!e.getEnabled()&&t&&(t=!1,e.removeEventListener("enabling",a),e.removeEventListener("disabling",i))},this.enable=()=>{t||(t=!0,e.addEventListener("enabling",a),e.addEventListener("disabling",i))},this.enable()}export{it as default};
//# sourceMappingURL=doars-fetch.esm.min.js.map
