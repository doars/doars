var ue=(e,t)=>{let r;switch(String.prototype.toLowerCase.call(t)){default:break;case"arraybuffer":r=e.arrayBuffer();break;case"blob":r=e.blob();break;case"formdata":r=e.formData();break;case"json":r=e.json();break;case"element":case"html":case"svg":case"text":case"xml":r=e.text();break}return r?r.then(n=>{switch(t){case"element":let i=document.createElement("template");i.innerHTML=n,n=i.content.childNodes[0];break;case"html":n=new DOMParser().parseFromString(n,"text/html");break;case"svg":n=new DOMParser().parseFromString(n,"image/svg+xml");break;case"xml":n=new DOMParser().parseFromString(n,"application/xml");break}return n}):null},me=(e,t=null)=>{let r=e.headers.get("Content-Type");if(r){r=String.prototype.toLowerCase.call(r).split(";")[0];let i=K(r.trim());if(i)return i}let n=e.url.split(".");if(n)switch(n=n[n.length-1],n){case"htm":case"html":return"html";case"json":return"json";case"svg":return"svg";case"txt":return"text";case"xml":return"xml"}if(t){let i=t.headers.Accept;if(i){i=String.prototype.toLowerCase.call(i).split(",");for(let s of i){s=s.split(";")[0].trim();let l=K(s);if(l)return l}}}return null},K=e=>{switch(e){case"text/html":return"html";case"text/json":case"application/json":case"application/ld+json":case"application/vnd.api+json":return"json";case"image/svg+xml":return"svg";case"text/plain":return"text";case"application/xml":case"text/xml":return"xml"}},A={},N=(e,t,r)=>new Promise((n,i)=>{fetch(e,t).then(s=>{if(s.status<200||s.status>=500){let l=A[e.location];delete A[e.location],i(s);for(let o of l)o.reject(s);return}r==="auto"&&(r=me(s,t)),r&&(s=ue(s,r)),s.then(l=>{let o={headers:s.headers,value:l},a=A[e.location];if(delete A[e.location],n(o),a)for(let b of a)b.resolve(o)}).catch(l=>{let o=A[e.location];if(delete A[e.location],i(l),o)for(let a of o)a.reject(l)})}).catch(s=>{let l=A[e.location];if(delete A[e.location],i(s),l)for(let o of l)o.reject(s)})});var j=(e,...t)=>{if(!t.length)return e;let r=t.shift();if(P(e)&&P(r))for(let n in r)P(r[n])?(e[n]||Object.assign(e,{[n]:{}}),j(e[n],r[n])):Array.isArray(r[n])?e[n]=r[n].map(i=>P(i)?j({},i):i):Object.assign(e,{[n]:r[n]});return j(e,...t)};var P=e=>e&&typeof e=="object"&&!Array.isArray(e);var J=({fetchContextName:e,fetchOptions:t})=>({name:e,create:()=>({value:(r,n=null)=>{t&&(n=j({},t,n));let i=n.returnType?n.returnType:null;return delete n.returnType,N(r,n,i).then(s=>{if(s&&s.value)return s.value})}})});var x=e=>{let t=e.substring(0,15).toLowerCase();if(t.startsWith("<!doctype html>")||t.startsWith("<html>")){let i=document.createElement("html");return i.innerHTML=e,i}let n=document.createElement("template");return n.innerHTML=e,n.content.childNodes[0]},k=(e,t)=>{e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},Q=(e,t)=>{e.parentNode.insertBefore(e,t)},B=(e,t)=>e.isSameNode&&e.isSameNode(t)?!0:e.type===3?e.nodeValue===t.nodeValue:e.tagName===t.tagName,z=(e,t)=>{let r=-1,n=null;return()=>{if(r>=0&&n){let s=n();if(s)return s}let i=null;do{if(r++,r>=e.childElementCount)return null;i=e.children[r]}while(!t(i));return i.childElementCount&&(n=z(i,t)),i}};var pe={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},de=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var Y=e=>typeof e!="string"?e:e.replaceAll(de,t=>pe[t]);var H=e=>{if(typeof e=="string"&&(e=e.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(e))return;let t={};for(let r of e)switch(r=r.trim(),r[0]){case"#":t.id=r.substring(1);break;case".":r=r.substring(1),t.class||(t.class=[]),t.class.includes(r)||t.class.push(r);break;case"[":let[n,i,s]=r.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);t[i]=s;break}return t};var U=(e,t)=>{for(let r in t){if(r==="class"){for(let n of t.class)e.classList.add(n);continue}e.setAttribute(r,t[r])}},Z=(e,t)=>{let r=e.attributes,n=t.attributes,i=null,s=null,l=null,o=null,a=null;for(let b=n.length-1;b>=0;--b)a=n[b],o=a.name,i=a.namespaceURI,s=a.value,i?(o=a.localName||o,l=e.getAttributeNS(i,o),l!==s&&e.setAttributeNS(i,o,s)):e.hasAttribute(o)?(l=e.getAttribute(o),l!==s&&(s==="null"||s==="undefined"?e.removeAttribute(o):e.setAttribute(o,s))):e.setAttribute(o,s);for(let b=r.length-1;b>=0;--b)a=r[b],a.specified!==!1&&(o=a.name,i=a.namespaceURI,i?(o=a.localName||o,t.hasAttributeNS(i,o)||e.removeAttributeNS(i,o)):t.hasAttributeNS(null,o)||e.removeAttribute(o))},S=(e,t)=>{for(let r in t){if(r==="class"){for(let n of t.class)e.classList.remove(n);continue}t[r]&&e.attributes[r]!==t[r]||e.removeAttribute(r)}};var he="-transition:",ee=(e,t,r,n=null)=>{if(r.nodeType!==1){n&&n();return}let i=t.prefix+he+e,s=E=>{r.dispatchEvent(new CustomEvent("transition-"+E)),r.dispatchEvent(new CustomEvent("transition-"+e+"-"+E))},l,o,a,b,c=!1,u={};return l=i,o=r.getAttribute(l),o&&(u.during=H(o),U(r,u.during)),l=i+".from",o=r.getAttribute(l),o&&(u.from=H(o),U(r,u.from)),s("start"),b=requestAnimationFrame(()=>{if(b=null,c)return;if(u.from&&(S(r,u.from),u.from=void 0),l=i+".to",o=r.getAttribute(l),o)u.to=H(o),U(r,u.to);else if(!u.during){s("end"),n&&n(),c=!0;return}let E=getComputedStyle(r),T=Number(E.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;T===0&&(T=Number(E.animationDuration.replace("s",""))*1e3),a=setTimeout(()=>{a=null,!c&&(u.during&&(S(r,u.during),u.during=void 0),u.to&&(S(r,u.to),u.to=void 0),s("end"),n&&n(),c=!0)},T)}),()=>{c&&(c=!0,u.during&&(S(r,u.during),u.during=void 0),u.from?(S(r,u.from),u.from=void 0):u.to&&(S(r,u.to),u.to=void 0),b?(cancelAnimationFrame(b),b=null):a&&(clearTimeout(a),a=null),s("end"),n&&n())}},te=(e,t,r)=>ee("in",e,t,r),re=(e,t,r)=>ee("out",e,t,r);var R=(e,t)=>{if(!t.indicator||t.indicator.indicatorTransitionOut||!t.indicator.indicatorElement)return;let r=e.getLibrary().getOptions(),n=t.indicator.indicatorElement;t.indicator.indicatorTransitionIn=re(r,n,()=>{n&&n.remove()})},ie=(e,t,r)=>{let n=e.getLibrary().getOptions(),i=t.getElement(),s=t.getDirective(),l=n.prefix+"-"+s+"-"+n.indicatorDirectiveName;if(!i.hasAttribute(l))return;let o=null;if(n.indicatorDirectiveEvaluate?o=r(e,t,i.getAttribute(l)):o=i.getAttribute(l),!o||typeof o=="string"&&(o=i.querySelector(o),!o)||o.tagName!=="TEMPLATE"||o.childCount>1)return;if(t.indicator){if(t.indicator.indicatorTransitionOut)t.indicator.indicatorTransitionOut(),t.indicator.indicatorTransitionOut=null;else if(t.indicator.indicatorElement)return}let a=document.importNode(o.content,!0);k(o,a),a=o.nextElementSibling,t.indicator={indicatorElement:a,indicatorTransitionIn:te(n,a)}};var be=(e,t)=>{let r=t.nodeType,n=t.nodeName;r===1&&Z(e,t),(r===3||r===8)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),n==="INPUT"?ve(e,t):n==="OPTION"?$(e,t,"selected"):n==="TEXTAREA"&&ge(e,t)},q=(e,t,r)=>{if(typeof e!="object")throw new Error("Existing tree should be an object.");if(typeof t=="string")t=x(t);else if(typeof t!="object")throw new Error("New tree should be an object.");return r&&r.childrenOnly||t.nodeType===11?(ne(e,t),e):_(e,t)},ve=(e,t)=>{let r=t.value,n=e.value;$(e,t,"checked"),$(e,t,"disabled"),e.indeterminate!==t.indeterminate&&(e.indeterminate=t.indeterminate),e.type!=="file"&&(n!==r&&(e.setAttribute("value",r),e.value=r),r==="null"&&(e.value="",e.removeAttribute("value")),t.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=r):e.removeAttribute("value"))},ge=(e,t)=>{let r=t.value;e.value!==r&&(e.value=r),e.firstChild&&e.firstChild.nodeValue!==r&&(e.firstChild.nodeValue=r)},$=(e,t,r)=>{e[r]!==t[r]&&(e[r]=t[r],t[r]?e.setAttribute(r,""):e.removeAttribute(r))},_=(e,t)=>e?t?e.isSameNode&&e.isSameNode(t)?e:e.tagName!==t.tagName?t:(be(e,t),ne(e,t),e):null:t,ne=(e,t)=>{let r,n,i,s,l=0;for(let o=0;r=e.childNodes[o],n=t.childNodes[o-l],!(!r&&!n);o++)if(!n)e.removeChild(r),o--;else if(!r)e.appendChild(n),l++;else if(B(r,n))i=_(r,n),i!==r&&(e.replaceChild(i,r),l++);else{s=null;for(let a=o;a<e.childNodes.length;a++)if(B(e.childNodes[a],n)){s=e.childNodes[a];break}s?(i=_(s,n),i!==s&&l++,e.insertBefore(i,r)):!n.id&&!r.id?(i=_(r,n),i!==r&&(e.replaceChild(i,r),l++)):(e.insertBefore(n,r),l++)}};var Ue=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var oe=e=>e&&Object.prototype.toString.call(e)==="[object Promise]";var se=e=>{if(e.tagName!=="SCRIPT"||e.hasAttribute("src"))return!1;let t=document.createElement("script");return t.innerText=e.innerText,e.parentNode.insertBefore(t,e),e.remove(),!0},O=(...e)=>{for(let t of e)if(!se(t)){let r=z(t),n=null;for(;n=r();)se(n)}};var ae=e=>{let t=document.createElement("xml");return e.forEach((n,i)=>{let s=document.createElement(i);s.textContent=n,t.appendChild(s)}),new XMLSerializer().serializeToString(t)};var m=Symbol("FETCH"),C={NONE:0,BUFFER:1,DEBOUNCE:2,THROTTLE:5},ce=({fetchOptions:e,fetchDirectiveEvaluate:t,fetchDirectiveName:r})=>({name:r,update:(n,i,s)=>{let o=n.getLibrary().getOptions(),a=i.getElement(),b=i.getDirective(),c=i.getModifiers(),u=i.getValue(),E=a.tagName==="FORM",T=a.tagName==="BUTTON";if(i[m]){if(i[m].value===u)return;i[m].target.removeEventListener(i[m].eventName,i[m].handler),i[m].timeout&&clearTimeout(i[m].timeout),delete i[m]}let D=E?"submit":"click";c.on&&(D=c.on);let le=c.encoding?c.encoding.toLowerCase():"urlencoded",W=c.method?c.method.toUpperCase():"GET",w=c.position?c.position.toLowerCase():null,L={};c.capture&&(L.capture=!0),c.once&&(L.once=!0),c.passive&&!c.prevent&&(L.passive=!0);let F=C.NONE;c.buffer?(F=C.BUFFER,c.buffer===!0&&(c.buffer=5)):c.debounce?(F=C.DEBOUNCE,c.debounce===!0&&(c.debounce=500)):c.throttle&&(F=C.THROTTLE,c.throttle===!0&&(c.throttle=500));let fe={[o.prefix+"-"+o.requestHeaderName]:b,Vary:o.prefix+"-"+o.requestHeaderName},I=(g="",d={})=>{a.dispatchEvent(new CustomEvent(o.prefix+"-"+b+g,{detail:Object.assign({attribute:i,component:n},d)}))},X=g=>{let d={headers:{}};if(W?d.method=W:E&&a.hasAttribute("method")&&(d.method=a.getAttribute("method").toUpperCase()),E){let p=new FormData(a),v=le;switch(!v&&a.hasAttribute("enctype")&&(v=a.getAttribute("enctype").toLowerCase()),(d.method==="HEAD"||d.method==="GET")&&(v="parameters"),v){case"json":d.headers["Content-Type"]="application/json; charset=UTF-8",d.body=JSON.stringify(Object.fromEntries(p));break;case"multipart":case"multipart/form-data":d.headers["Content-Type"]="multipart/form-data",d.body=p;break;case"parameters":let f=new URLSearchParams(p).toString();for(let[y,h]of f)g.searchParams.set(y,h);break;case"urlencoded":case"application/x-www-form-urlencoded":d.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",d.body=new URLSearchParams(p).toString();break;case"xml":d.headers["Content-Type"]="application/xml; charset=UTF-8",d.body=ae(p);break;default:break}}I("-started",{url:g}),N(g,Object.assign({},e,d,{headers:Object.assign({},d.headers,fe)})).then(p=>{M=!1;let v=p.value;c.decode&&(v=Y(p.value));let f=null;if(c.document)f=document.documentElement;else{let h=o.prefix+"-"+b+"-"+o.targetDirectiveName;a.getAttribute(h)&&(o.targetDirectiveEvaluate?f=s(n,i,a.getAttribute(h)):f=a.getAttribute(h),f&&typeof f=="string"&&(f=a.querySelector(f))),f||(f=a)}if(w==="append"){let h=x(v);f.appendChild(h),(o.allowInlineScript||c.script)&&O(h)}else if(w==="prepend"){let h=x(v);f.prepend(h),(o.allowInlineScript||c.script)&&O(h)}else if(w==="after"){let h=x(v);k(f,h),(o.allowInlineScript||c.script)&&O(h)}else if(w==="before"){let h=x(v);Q(f,h),(o.allowInlineScript||c.script)&&O(h)}else if(w==="outer")c.morph?q(f,v):f.outerHTML!==v&&(f.outerHTML=v,(o.allowInlineScript||c.script)&&O(f));else if(c.morph){if(f.children.length===0)f.appendChild(document.createElement("div"));else if(f.children.length>1)for(let V=f.children.length-1;V>=1;V--)f.children[V].remove();let h=q(f.children[0],v);f.children[0].isSameNode(h)||(f.children[0].remove(),f.appendChild(h))}else f.innerHTML!==v&&(f.innerHTML=v,(o.allowInlineScript||c.script)&&O(...f.children));if(o.redirectHeaderName&&p.headers.has(o.prefix+"-"+o.titleHeaderName)){window.location.href=p.headers.get(o.prefix+"-"+o.titleHeaderName);return}let y="";o.titleHeaderName&&p.headers.has(o.prefix+"-"+o.titleHeaderName)&&(y=p.headers.get(o.prefix+"-"+o.titleHeaderName)),c.document&&c.history&&history.pushState({},y,g),y&&document.title!==y&&(document.title=y),R(n,i),I("-succeeded",{url:g})}).catch(()=>{R(n,i),I("-failed",{url:g})})},M=!1,G=g=>{if(c.self&&g.target!==a)return;if(E&&!a.reportValidity()){I("-invalid");return}(E&&D==="submit"||T&&a.getAttribute("type","button")&&D==="click"||c.prevent)&&g.preventDefault(),c.stop&&g.stopPropagation();let d=()=>{let p=null;u&&t?p=s(n,i,u,{$event:g,$events:i[m].buffer}):E&&a.hasAttribute("action")&&(p=a.getAttribute("action")),i[m].buffer=[],p&&(M=!0,ie(n,i,s),oe(p)?p.then(v=>X(v)):X(p))};if(!M){switch(i[m].buffer.push(g),F){case C.BUFFER:if(i[m].buffer.length<c.buffer)return;d();return;case C.DEBOUNCE:i[m].timeout&&(clearTimeout(i[m].timeout),i[m].timeout=null),i[m].timeout=setTimeout(d,c.debounce);return;case C.THROTTLE:let p=window.performance.now();if(i[m].lastExecution&&p-i[m].lastExecution<c.throttle)return;d(),i[m].lastExecution=p;return}d()}};a.addEventListener(D,G,L),i[m]={buffer:[],eventName:D,handler:G,target:a,timeout:i[m]?i[m].timeout:void 0,value:u}},destroy:(n,i)=>{i[m]&&(i[m].target.removeEventListener(i[m].eventName,i[m].handler),i[m].timeout&&clearTimeout(i[m].timeout),R(n,i),delete i[m])}});function Ze(e,t=null){t=Object.assign({fetchContextName:"$fetch",fetchDirectiveEvaluate:!0,fetchDirectiveName:"fetch",fetchOptions:{}},t),t.defaultInit&&Object.assign(t.fetchOptions,t.defaultInit);let r=!1,n=J(t),i=ce(t),s=()=>{e.addContexts(0,n),e.addDirectives(-1,i)},l=()=>{e.removeContexts(n),e.removeDirective(i)};this.disable=()=>{!e.getEnabled()&&r&&(r=!1,e.removeEventListener("enabling",s),e.removeEventListener("disabling",l))},this.enable=()=>{r||(r=!0,e.addEventListener("enabling",s),e.addEventListener("disabling",l))},this.enable()}export{Ze as default};
//# sourceMappingURL=doars-fetch.esm.min.js.map
