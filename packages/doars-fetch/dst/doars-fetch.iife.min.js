(()=>{var T=(e,r)=>{let t;switch(String.prototype.toLowerCase.call(r)){default:break;case"arraybuffer":t=e.arrayBuffer();break;case"blob":t=e.blob();break;case"formdata":t=e.formData();break;case"json":t=e.json();break;case"element":case"html":case"svg":case"text":case"xml":t=e.text();break}return t?t.then(n=>{switch(r){case"element":let i=document.createElement("template");i.innerHTML=n,n=i.content.childNodes[0];break;case"html":n=new DOMParser().parseFromString(n,"text/html");break;case"svg":n=new DOMParser().parseFromString(n,"image/svg+xml");break;case"xml":n=new DOMParser().parseFromString(n,"application/xml");break}return n}):null},y=(e,r=null)=>{let t=e.headers.get("Content-Type");if(t){t=String.prototype.toLowerCase.call(t).split(";")[0];let i=ee(t.trim());if(i)return i}let n=e.url.split(".");if(n)switch(n=n[n.length-1],n){case"htm":case"html":return"html";case"json":return"json";case"svg":return"svg";case"txt":return"text";case"xml":return"xml"}if(r){let i=r.headers.Accept;if(i){i=String.prototype.toLowerCase.call(i).split(",");for(let a of i){a=a.split(";")[0].trim();let l=ee(a);if(l)return l}}}return null},ee=e=>{switch(e){case"text/html":return"html";case"text/json":case"application/json":case"application/ld+json":case"application/vnd.api+json":return"json";case"image/svg+xml":return"svg";case"text/plain":return"text";case"application/xml":case"text/xml":return"xml"}};var te="Date",k="Cache-Control",ye=5*60*1e3,xe=["no-cache","must-revalidate","no-store"],re="doars",_=0,q=null,v={},ie=e=>{if(!e.has(te)||!e.has(k))return!1;let r=new Date(e.get(te)),t=new Date;if(r>t)return!1;let n=e.get(k).split(","),i=0;for(let l of n)if(l.trim().startsWith("max-age=")&&(i=parseInt(l.split("=")[1].trim(),10)),l.trim().startsWith("s-maxage=")){i=parseInt(l.split("=")[1].trim(),10);break}return i<=0?!1:new Date(r.getTime()+i*1e3)>=t},U=(e,r,t)=>new Promise((n,i)=>{if(!r.method||String.prototype.toUpperCase.call(r.method)==="GET"){caches.open(re).then(a=>{a.match(e).then(l=>{if(l){if(ie(l.headers)){t==="auto"&&(t=y(l,r)),t&&(l=T(l,t)),l.then(o=>{n({headers:l.headers,value:o})});return}a.delete(e)}if(Object.prototype.hasOwnProperty.call(v,e.location)){v[e.location].push({resolve:n,reject:i});return}else v[e.location]=[];fetch(e,r).then(o=>{if(o.status<200||o.status>=500){let m=v[e.location];delete v[e.location],i(o);for(let c of m)c.reject(o);return}let s=!0;if(o.headers.has(k)){let m=o.headers.get(k).split(","),c=0;for(let f of m){let b=f.trim();if(xe.indexOf(b)>=0){s=!1;break}if(b.startsWith("s-maxage=")&&(c=parseInt(b.split("=")[1].trim(),10),c<=0)){s=!1;break}if(b.startsWith("max-age=")&&c<=0&&(c=parseInt(b.split("=")[1].trim(),10),c<=0)){s=!1;break}}}s?a.put(e,o.clone()):a.delete(e),t==="auto"&&(t=y(o,r)),t&&(o=T(o,t)),o.then(m=>{let c={headers:o.headers,value:m},f=v[e.location];if(delete v[e.location],n(c),f)for(let b of f)b.resolve(c)}).catch(m=>{let c=v[e.location];if(delete v[e.location],i(m),c)for(let f of c)f.reject(m)})}).catch(o=>{let s=v[e.location];if(delete v[e.location],i(o),s)for(let m of s)m.reject(o)})}).catch(i)}).catch(i);return}fetch(e,r).then(a=>{if(a.status<200||a.status>=500){let l=v[e.location];delete v[e.location],i(a);for(let o of l)o.reject(a);return}t==="auto"&&(t=y(a,r)),t&&(a=T(a,t)),a.then(l=>{let o={headers:a.headers,value:l},s=v[e.location];if(delete v[e.location],n(o),s)for(let m of s)m.resolve(o)}).catch(l=>{let o=v[e.location];if(delete v[e.location],i(l),o)for(let s of o)s.reject(l)})}).catch(a=>{let l=v[e.location];if(delete v[e.location],i(a),l)for(let o of l)o.reject(a)})});var ne=()=>{if(_>0){_++;return}q=setInterval(()=>{caches.open(re).then(e=>{e.keys().then(r=>{for(let t of r)e.match(t).then(n=>{ie(n.headers)||e.delete(t)})})})},ye)},oe=()=>{_--,_<=0&&q&&clearInterval(q)};var F=(e,...r)=>{if(!r.length)return e;let t=r.shift();if(P(e)&&P(t))for(let n in t)P(t[n])?(e[n]||Object.assign(e,{[n]:{}}),F(e[n],t[n])):Array.isArray(t[n])?e[n]=t[n].map(i=>P(i)?F({},i):i):Object.assign(e,{[n]:t[n]});return F(e,...r)};var P=e=>e&&typeof e=="object"&&!Array.isArray(e);var ae=({fetchContextName:e,fetchOptions:r})=>({name:e,create:()=>({value:(t,n=null)=>{r&&(n=F({},r,n));let i=n.returnType?n.returnType:null;return delete n.returnType,!n.method||String.prototype.toUpperCase.call(n.method)==="GET"?U(t,n,y).then(a=>{if(a&&a.value)return a.value}):fetch(t,n).then(a=>(i==="auto"&&(i=y(a,n)),i&&(a=T(a,i)),a))}})});var x=e=>{let r=e.substring(0,15).toLowerCase();if(r.startsWith("<!doctype html>")||r.startsWith("<html>")){let i=document.createElement("html");return i.innerHTML=e,i}let n=document.createElement("template");return n.innerHTML=e,n.content.childNodes[0]},M=(e,r)=>{e.nextSibling?e.parentNode.insertBefore(r,e.nextSibling):e.parentNode.appendChild(r)},se=(e,r)=>{e.parentNode.insertBefore(e,r)},G=(e,r)=>e.isSameNode&&e.isSameNode(r)?!0:e.type===3?e.nodeValue===r.nodeValue:e.tagName===r.tagName,X=(e,r)=>{let t=-1,n=null;return()=>{if(t>=0&&n){let a=n();if(a)return a}let i=null;do{if(t++,t>=e.childElementCount)return null;i=e.children[t]}while(!r(i));return i.childElementCount&&(n=X(i,r)),i}};var Se={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},Oe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var ce=e=>typeof e!="string"?e:e.replaceAll(Oe,r=>Se[r]);var R=e=>{if(typeof e=="string"&&(e=e.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(e))return;let r={};for(let t of e)switch(t=t.trim(),t[0]){case"#":r.id=t.substring(1);break;case".":t=t.substring(1),r.class||(r.class=[]),r.class.includes(t)||r.class.push(t);break;case"[":let[n,i,a]=t.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);r[i]=a;break}return r};var V=(e,r)=>{for(let t in r){if(t==="class"){for(let n of r.class)e.classList.add(n);continue}e.setAttribute(t,r[t])}},le=(e,r)=>{let t=e.attributes,n=r.attributes,i=null,a=null,l=null,o=null,s=null;for(let m=n.length-1;m>=0;--m)s=n[m],o=s.name,i=s.namespaceURI,a=s.value,i?(o=s.localName||o,l=e.getAttributeNS(i,o),l!==a&&e.setAttributeNS(i,o,a)):e.hasAttribute(o)?(l=e.getAttribute(o),l!==a&&(a==="null"||a==="undefined"?e.removeAttribute(o):e.setAttribute(o,a))):e.setAttribute(o,a);for(let m=t.length-1;m>=0;--m)s=t[m],s.specified!==!1&&(o=s.name,i=s.namespaceURI,i?(o=s.localName||o,r.hasAttributeNS(i,o)||e.removeAttributeNS(i,o)):r.hasAttributeNS(null,o)||e.removeAttribute(o))},S=(e,r)=>{for(let t in r){if(t==="class"){for(let n of r.class)e.classList.remove(n);continue}r[t]&&e.attributes[t]!==r[t]||e.removeAttribute(t)}};var De="-transition:",fe=(e,r,t,n=null)=>{if(t.nodeType!==1){n&&n();return}let i=r.prefix+De+e,a=b=>{t.dispatchEvent(new CustomEvent("transition-"+b)),t.dispatchEvent(new CustomEvent("transition-"+e+"-"+b))},l,o,s,m,c=!1,f={};return l=i,o=t.getAttribute(l),o&&(f.during=R(o),V(t,f.during)),l=i+".from",o=t.getAttribute(l),o&&(f.from=R(o),V(t,f.from)),a("start"),m=requestAnimationFrame(()=>{if(m=null,c)return;if(f.from&&(S(t,f.from),f.from=void 0),l=i+".to",o=t.getAttribute(l),o)f.to=R(o),V(t,f.to);else if(!f.during){a("end"),n&&n(),c=!0;return}let b=getComputedStyle(t),w=Number(b.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;w===0&&(w=Number(b.animationDuration.replace("s",""))*1e3),s=setTimeout(()=>{s=null,!c&&(f.during&&(S(t,f.during),f.during=void 0),f.to&&(S(t,f.to),f.to=void 0),a("end"),n&&n(),c=!0)},w)}),()=>{c&&(c=!0,f.during&&(S(t,f.during),f.during=void 0),f.from?(S(t,f.from),f.from=void 0):f.to&&(S(t,f.to),f.to=void 0),m?(cancelAnimationFrame(m),m=null):s&&(clearTimeout(s),s=null),a("end"),n&&n())}},ue=(e,r,t)=>fe("in",e,r,t),me=(e,r,t)=>fe("out",e,r,t);var B=(e,r)=>{if(!r.indicator||r.indicator.indicatorTransitionOut||!r.indicator.indicatorElement)return;let t=e.getLibrary().getOptions(),n=r.indicator.indicatorElement;r.indicator.indicatorTransitionIn=me(t,n,()=>{n&&n.remove()})},de=(e,r,t)=>{let n=e.getLibrary().getOptions(),i=r.getElement(),a=r.getDirective(),l=n.prefix+"-"+a+"-"+n.indicatorDirectiveName;if(!i.hasAttribute(l))return;let o=null;if(n.indicatorDirectiveEvaluate?o=t(e,r,i.getAttribute(l)):o=i.getAttribute(l),!o||typeof o=="string"&&(o=i.querySelector(o),!o)||o.tagName!=="TEMPLATE"||o.childCount>1)return;if(r.indicator){if(r.indicator.indicatorTransitionOut)r.indicator.indicatorTransitionOut(),r.indicator.indicatorTransitionOut=null;else if(r.indicator.indicatorElement)return}let s=document.importNode(o.content,!0);M(o,s),s=o.nextElementSibling,r.indicator={indicatorElement:s,indicatorTransitionIn:ue(n,s)}};var Te=(e,r)=>{let t=r.nodeType,n=r.nodeName;t===1&&le(e,r),(t===3||t===8)&&e.nodeValue!==r.nodeValue&&(e.nodeValue=r.nodeValue),n==="INPUT"?we(e,r):n==="OPTION"?K(e,r,"selected"):n==="TEXTAREA"&&Ie(e,r)},J=(e,r,t)=>{if(typeof e!="object")throw new Error("Existing tree should be an object.");if(typeof r=="string")r=x(r);else if(typeof r!="object")throw new Error("New tree should be an object.");return t&&t.childrenOnly||r.nodeType===11?(pe(e,r),e):z(e,r)},we=(e,r)=>{let t=r.value,n=e.value;K(e,r,"checked"),K(e,r,"disabled"),e.indeterminate!==r.indeterminate&&(e.indeterminate=r.indeterminate),e.type!=="file"&&(n!==t&&(e.setAttribute("value",t),e.value=t),t==="null"&&(e.value="",e.removeAttribute("value")),r.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=t):e.removeAttribute("value"))},Ie=(e,r)=>{let t=r.value;e.value!==t&&(e.value=t),e.firstChild&&e.firstChild.nodeValue!==t&&(e.firstChild.nodeValue=t)},K=(e,r,t)=>{e[t]!==r[t]&&(e[t]=r[t],r[t]?e.setAttribute(t,""):e.removeAttribute(t))},z=(e,r)=>e?r?e.isSameNode&&e.isSameNode(r)?e:e.tagName!==r.tagName?r:(Te(e,r),pe(e,r),e):null:r,pe=(e,r)=>{let t,n,i,a,l=0;for(let o=0;t=e.childNodes[o],n=r.childNodes[o-l],!(!t&&!n);o++)if(!n)e.removeChild(t),o--;else if(!t)e.appendChild(n),l++;else if(G(t,n))i=z(t,n),i!==t&&(e.replaceChild(i,t),l++);else{a=null;for(let s=o;s<e.childNodes.length;s++)if(G(e.childNodes[s],n)){a=e.childNodes[s];break}a?(i=z(a,n),i!==a&&l++,e.insertBefore(i,t)):!n.id&&!t.id?(i=z(t,n),i!==t&&(e.replaceChild(i,t),l++)):(e.insertBefore(n,t),l++)}};var Qe=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var he=e=>e&&Object.prototype.toString.call(e)==="[object Promise]";var be=e=>{if(e.tagName!=="SCRIPT"||e.hasAttribute("src"))return!1;let r=document.createElement("script");return r.innerText=e.innerText,e.parentNode.insertBefore(r,e),e.remove(),!0},O=(...e)=>{for(let r of e)if(!be(r)){let t=X(r),n=null;for(;n=t();)be(n)}};var ge=e=>{let r=document.createElement("xml");return e.forEach((n,i)=>{let a=document.createElement(i);a.textContent=n,r.appendChild(a)}),new XMLSerializer().serializeToString(r)};var d=Symbol("FETCH"),D={NONE:0,BUFFER:1,DEBOUNCE:2,THROTTLE:5},ve=({fetchOptions:e,fetchDirectiveEvaluate:r,fetchDirectiveName:t})=>({name:t,update:(n,i,a)=>{let o=n.getLibrary().getOptions(),s=i.getElement(),m=i.getDirective(),c=i.getModifiers(),f=i.getValue(),b=s.tagName==="FORM",w=s.tagName==="BUTTON";if(i[d]){if(i[d].value===f)return;i[d].target.removeEventListener(i[d].eventName,i[d].handler),i[d].timeout&&clearTimeout(i[d].timeout),delete i[d]}let I=b?"submit":"click";c.on&&(I=c.on);let Ae=c.encoding?c.encoding.toLowerCase():"urlencoded",Q=c.method?c.method.toUpperCase():"GET",L=c.position?c.position.toLowerCase():null,N={};c.capture&&(N.capture=!0),c.once&&(N.once=!0),c.passive&&!c.prevent&&(N.passive=!0);let j=D.NONE;c.buffer?(j=D.BUFFER,c.buffer===!0&&(c.buffer=5)):c.debounce?(j=D.DEBOUNCE,c.debounce===!0&&(c.debounce=500)):c.throttle&&(j=D.THROTTLE,c.throttle===!0&&(c.throttle=500));let Ce={[o.prefix+"-"+o.requestHeaderName]:m,Vary:o.prefix+"-"+o.requestHeaderName},H=(A="",h={})=>{s.dispatchEvent(new CustomEvent(o.prefix+"-"+m+A,{detail:Object.assign({attribute:i,component:n},h)}))},Y=A=>{let h={headers:{}};if(Q?h.method=Q:b&&s.hasAttribute("method")&&(h.method=s.getAttribute("method").toUpperCase()),b){let p=new FormData(s),E=Ae;switch(!E&&s.hasAttribute("enctype")&&(E=s.getAttribute("enctype").toLowerCase()),(h.method==="HEAD"||h.method==="GET")&&(E="parameters"),E){case"json":h.headers["Content-Type"]="application/json; charset=UTF-8",h.body=JSON.stringify(Object.fromEntries(p));break;case"multipart":case"multipart/form-data":h.headers["Content-Type"]="multipart/form-data",h.body=p;break;case"parameters":let u=new URLSearchParams(p).toString();for(let[C,g]of u)A.searchParams.set(C,g);break;case"urlencoded":case"application/x-www-form-urlencoded":h.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",h.body=new URLSearchParams(p).toString();break;case"xml":h.headers["Content-Type"]="application/xml; charset=UTF-8",h.body=ge(p);break;default:break}}H("-started",{url:A}),U(A,Object.assign({},e,h,{headers:Object.assign({},h.headers,Ce)})).then(p=>{$=!1;let E=p.value;c.decode&&(E=ce(p.value));let u=null;if(c.document)u=document.documentElement;else{let g=o.prefix+"-"+m+"-"+o.targetDirectiveName;s.getAttribute(g)&&(o.targetDirectiveEvaluate?u=a(n,i,s.getAttribute(g)):u=s.getAttribute(g),u&&typeof u=="string"&&(u=s.querySelector(u))),u||(u=s)}if(L==="append"){let g=x(E);u.appendChild(g),(o.allowInlineScript||c.script)&&O(g)}else if(L==="prepend"){let g=x(E);u.prepend(g),(o.allowInlineScript||c.script)&&O(g)}else if(L==="after"){let g=x(E);M(u,g),(o.allowInlineScript||c.script)&&O(g)}else if(L==="before"){let g=x(E);se(u,g),(o.allowInlineScript||c.script)&&O(g)}else if(L==="outer")c.morph?J(u,E):u.outerHTML!==E&&(u.outerHTML=E,(o.allowInlineScript||c.script)&&O(u));else if(c.morph){if(u.children.length===0)u.appendChild(document.createElement("div"));else if(u.children.length>1)for(let W=u.children.length-1;W>=1;W--)u.children[W].remove();let g=J(u.children[0],E);u.children[0].isSameNode(g)||(u.children[0].remove(),u.appendChild(g))}else u.innerHTML!==E&&(u.innerHTML=E,(o.allowInlineScript||c.script)&&O(...u.children));if(o.redirectHeaderName&&p.headers.has(o.prefix+"-"+o.titleHeaderName)){window.location.href=p.headers.get(o.prefix+"-"+o.titleHeaderName);return}let C="";o.titleHeaderName&&p.headers.has(o.prefix+"-"+o.titleHeaderName)&&(C=p.headers.get(o.prefix+"-"+o.titleHeaderName)),c.document&&c.history&&history.pushState({},C,A),C&&document.title!==C&&(document.title=C),B(n,i),H("-succeeded",{url:A})}).catch(()=>{B(n,i),H("-failed",{url:A})})},$=!1,Z=A=>{if(c.self&&A.target!==s)return;if(b&&!s.reportValidity()){H("-invalid");return}(b&&I==="submit"||w&&s.getAttribute("type","button")&&I==="click"||c.prevent)&&A.preventDefault(),c.stop&&A.stopPropagation();let h=()=>{let p=null;f&&r?p=a(n,i,f,{$event:A,$events:i[d].buffer}):b&&s.hasAttribute("action")&&(p=s.getAttribute("action")),i[d].buffer=[],p&&($=!0,de(n,i,a),he(p)?p.then(E=>Y(E)):Y(p))};if(!$){switch(i[d].buffer.push(A),j){case D.BUFFER:if(i[d].buffer.length<c.buffer)return;h();return;case D.DEBOUNCE:i[d].timeout&&(clearTimeout(i[d].timeout),i[d].timeout=null),i[d].timeout=setTimeout(h,c.debounce);return;case D.THROTTLE:let p=window.performance.now();if(i[d].lastExecution&&p-i[d].lastExecution<c.throttle)return;h(),i[d].lastExecution=p;return}h()}};s.addEventListener(I,Z,N),ne(),i[d]={buffer:[],eventName:I,handler:Z,target:s,timeout:i[d]?i[d].timeout:void 0,value:f}},destroy:(n,i)=>{i[d]&&(oe(),i[d].target.removeEventListener(i[d].eventName,i[d].handler),i[d].timeout&&clearTimeout(i[d].timeout),B(n,i),delete i[d])}});function Ee(e,r=null){r=Object.assign({fetchContextName:"$fetch",fetchDirectiveEvaluate:!0,fetchDirectiveName:"fetch",fetchOptions:{}},r),r.defaultInit&&Object.assign(r.fetchOptions,r.defaultInit);let t=!1,n=ae(r),i=ve(r),a=()=>{e.addContexts(0,n),e.addDirectives(-1,i)},l=()=>{e.removeContexts(n),e.removeDirective(i)};this.disable=()=>{!e.getEnabled()&&t&&(t=!1,e.removeEventListener("enabling",a),e.removeEventListener("disabling",l))},this.enable=()=>{t||(t=!0,e.addEventListener("enabling",a),e.addEventListener("disabling",l))},this.enable()}window.DoarsFetch=Ee;})();
//# sourceMappingURL=doars-fetch.iife.min.js.map
