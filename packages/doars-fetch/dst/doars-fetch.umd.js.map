{"version":3,"file":"doars-fetch.umd.js","sources":["../../utils/src/ObjectUtils.js","../src/utils/FetchUtils.js","../src/factories/contexts/fetch.js","../src/DoarsFetch.js"],"sourcesContent":["/**\n * Deeply assign a series of objects properties together.\n * @param {Object} target Target object to merge to.\n * @param  {...Object} sources Objects to merge into the target.\n */\nexport const deepAssign = (target, ...sources) => {\n  if (!sources.length) {\n    return target\n  }\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, {\n            [key]: {},\n          })\n        }\n        deepAssign(target[key], source[key])\n      } else if (Array.isArray(source[key])) {\n        target[key] = source[key].map((value) => {\n          if (isObject(value)) {\n            return deepAssign({}, value)\n          }\n          return value\n        })\n      } else {\n        Object.assign(target, {\n          [key]: source[key],\n        })\n      }\n    }\n  }\n\n  return deepAssign(target, ...sources)\n}\n\n/**\n * Get value at path on object.\n * @param {Object} object Object to get from.\n * @param  {Array<String>} path Path to value.\n * @returns {Any} value at path.\n */\nexport const get = (object, path) => {\n  let objectTemp = object\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    objectTemp = objectTemp[path[i]]\n  }\n  return objectTemp[path[i]]\n}\n\n/**\n * Check whether the value is an object.\n * @param {Any} value Value of unknown type.\n * @returns Whether the value is an object.\n */\nexport const isObject = (value) => {\n  return (value && typeof value === 'object' && !Array.isArray(value))\n}\n\n/**\n * Set value on path at object.\n * @param {Object} object Object to set on.\n * @param {Array<String>} path Path to value.\n * @param {Any} value Value to set.\n */\nexport const set = (object, path, value) => {\n  // Exit early if not an object.\n  if (typeof (object) !== 'object') {\n    return\n  }\n\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    object = object[path[i]]\n\n    // Exit early if not an object.\n    if (typeof (object) !== 'object') {\n      return\n    }\n  }\n  object[path[i]] = value\n}\n\nexport default {\n  deepAssign: deepAssign,\n  get: get,\n  isObject: isObject,\n  set: set,\n}\n","export const parseResponse = (response, type) => {\n  let promise\n  switch (String.prototype.toLowerCase.call(type)) {\n    default:\n      console.warn('Unknown response type \"' + type + '\" used when using the $fetch context.')\n      break\n\n    case 'arraybuffer':\n      promise = response.arrayBuffer()\n      break\n\n    case 'blob':\n      promise = response.blob()\n      break\n\n    case 'formdata':\n      promise = response.formData()\n      break\n\n    case 'json':\n      promise = response.json()\n      break\n\n    // HTML and xml need to be converted to text before being able to be parsed.\n    case 'element':\n    case 'html':\n    case 'svg':\n    case 'text':\n    case 'xml':\n      promise = response.text()\n      break\n  }\n\n  if (!promise) {\n    return null\n  }\n\n  return promise\n    .then((response) => {\n      switch (type) {\n        // Convert from html to HTMLElement inside a document fragment.\n        case 'element':\n          const template = document.createElement('template')\n          template.innerHTML = response\n          response = template.content.childNodes[0]\n          break\n\n        // Parse some values via the DOM parser.\n        case 'html':\n          response = (new DOMParser()).parseFromString(response, 'text/html')\n          break\n        case 'svg':\n          response = (new DOMParser()).parseFromString(response, 'image/svg+xml')\n          break\n        case 'xml':\n          response = (new DOMParser()).parseFromString(response, 'application/xml')\n          break\n      }\n\n      return response\n    })\n}\n\nexport const responseType = (response) => {\n  switch (String.prototype.toLowerCase(response.headers.get('content-type'))) {\n    case 'text/html':\n      return 'html'\n\n    case 'application/json':\n    case 'application/ld+json':\n    case 'application/vnd.api+json':\n      return 'json'\n\n    case 'image/svg+xml':\n      return 'svg'\n\n    case 'text/plain':\n      return 'text'\n\n    case 'application/xml':\n    case 'text/xml':\n      return 'xml'\n  }\n\n  return null\n}\n","// Import utils.\nimport { deepAssign } from '@doars/utils/src/ObjectUtils.js'\nimport { parseResponse, responseType } from '../../utils/FetchUtils.js'\n\nexport default ({ defaultInit }) => {\n  return {\n    name: '$fetch',\n\n    create: () => {\n      return {\n        value: (url, init = null) => {\n          // Apply default options to init.\n          if (defaultInit) {\n            init = deepAssign({}, defaultInit, init)\n          }\n\n          // Extract optional return type.\n          let returnType = init.returnType ? init.returnType : null\n          delete init.returnType\n\n          // Perform and process fetch request.\n          return fetch(url, init)\n            .then((response) => {\n              // Automatically base return type on header.\n              if (returnType === 'auto' && response.headers.get('content-type')) {\n                returnType = responseType(response)\n              }\n\n              // Parse response based on return type.\n              if (returnType) {\n                response = parseResponse(response, returnType)\n              }\n\n              return response\n            })\n        },\n      }\n    },\n  }\n}\n","// Import contexts.\nimport createFetchContext from './factories/contexts/fetch.js'\n\nexport default class DoarsFetch {\n  /**\n   * Create plugin instance.\n   * @param {Doars} library Doars instance to add onto.\n   * @param {Object} options The plugin options.\n   */\n  constructor(library, options = null) {\n    // Clone options.\n    options = Object.assign({\n      defaultInit: {},\n    }, options)\n\n    // Create contexts.\n    const fetchContext = createFetchContext(options)\n\n    // Enable plugin when library is enabling.\n    library.addEventListener('enabling', () => {\n      library.addContexts(0, fetchContext)\n    })\n\n    // Disable plugin when library is disabling.\n    library.addEventListener('disabling', () => {\n      library.removeContexts(fetchContext)\n    })\n  }\n}\n"],"names":["deepAssign","target","sources","length","source","shift","isObject","key","Object","assign","Array","isArray","map","value","parseResponse","response","type","promise","String","prototype","toLowerCase","call","console","warn","arrayBuffer","blob","formData","json","text","then","template","document","createElement","innerHTML","content","childNodes","DOMParser","parseFromString","responseType","headers","get","defaultInit","name","create","url","init","returnType","fetch","DoarsFetch","library","options","fetchContext","createFetchContext","addEventListener","addContexts","removeContexts"],"mappings":"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"}