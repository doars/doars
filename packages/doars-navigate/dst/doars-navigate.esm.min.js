var Z=(e,r)=>{let t;switch(String.prototype.toLowerCase.call(r)){default:break;case"arraybuffer":t=e.arrayBuffer();break;case"blob":t=e.blob();break;case"formdata":t=e.formData();break;case"json":t=e.json();break;case"element":case"html":case"svg":case"text":case"xml":t=e.text();break}return t?t.then(n=>{switch(r){case"element":let s=document.createElement("template");s.innerHTML=n,n=s.content.childNodes[0];break;case"html":n=new DOMParser().parseFromString(n,"text/html");break;case"svg":n=new DOMParser().parseFromString(n,"image/svg+xml");break;case"xml":n=new DOMParser().parseFromString(n,"application/xml");break}return n}):null},ee=(e,r=null)=>{let t=e.headers.get("Content-Type");if(t){t=String.prototype.toLowerCase.call(t).split(";")[0];let s=q(t.trim());if(s)return s}let n=e.url.split(".");if(n)switch(n=n[n.length-1],n){case"htm":case"html":return"html";case"json":return"json";case"svg":return"svg";case"txt":return"text";case"xml":return"xml"}if(r){let s=r.headers.Accept;if(s){s=String.prototype.toLowerCase.call(s).split(",");for(let i of s){i=i.split(";")[0].trim();let u=q(i);if(u)return u}}}return null},q=e=>{switch(e){case"text/html":return"html";case"text/json":case"application/json":case"application/ld+json":case"application/vnd.api+json":return"json";case"image/svg+xml":return"svg";case"text/plain":return"text";case"application/xml":case"text/xml":return"xml"}},E={},j=(e,r,t="auto")=>new Promise((n,s)=>{fetch(e,r).then(i=>{if(i.status<200||i.status>=500){let o=E[e.location];delete E[e.location],s(i);for(let c of o)c.reject(i);return}let u=i.headers;t==="auto"&&(t=ee(i,r)),t&&(i=Z(i,t)),i.then(o=>{let c=E[e.location];delete E[e.location];let a={headers:u,value:o};if(n(a),c)for(let b of c)b.resolve(a)}).catch(o=>{let c=E[e.location];if(delete E[e.location],s(o),c)for(let a of c)a.reject(o)})}).catch(i=>{let u=E[e.location];if(delete E[e.location],s(i),u)for(let o of u)o.reject(i)})});var w=e=>{let r=e.substring(0,15).toLowerCase();if(r.startsWith("<!doctype html>")||r.startsWith("<html>")){let n=document.createElement("html");return n.innerHTML=e,n}let t=document.createElement("template");return t.innerHTML=e,t.content.childNodes[0]},k=(e,r)=>e.isSameNode&&e.isSameNode(r)?!0:e.type===3?e.nodeValue===r.nodeValue:e.tagName===r.tagName,x=(e,r,t,n)=>{let s=r.getLibrary().getOptions(),i=t.getElement(),u=t.getDirective(),o=s.prefix+"-"+u+"-"+s.selectFromElementDirectiveName;if(!i.hasAttribute(o))return e;let c=null;if(s.selectFromElementDirectiveEvaluate){if(c=n(r,t,i.getAttribute(o)),typeof c!="string")return null}else c=i.getAttribute(o);if(c){let a=typeof e=="string";if(a&&(e=w(e)),e=e.querySelector(c),a&&e)return e.outerHTML}return e},V=(e,r)=>{let t=-1,n=null;return()=>{if(t>=0&&n){let i=n();if(i)return i}let s=null;do{if(t++,t>=e.childElementCount)return null;s=e.children[t]}while(!r(s));return s.childElementCount&&(n=V(s,r)),s}};var te={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},re=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var z=e=>typeof e!="string"?e:e.replaceAll(re,r=>te[r]);var C=e=>{if(typeof e=="string"&&(e=e.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(e))return;let r={};for(let t of e)switch(t=t.trim(),t[0]){case"#":r.id=t.substring(1);break;case".":t=t.substring(1),r.class||(r.class=[]),r.class.includes(t)||r.class.push(t);break;case"[":let[n,s,i]=t.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);r[s]=i;break}return r};var H=(e,r)=>{for(let t in r){if(t==="class"){for(let n of r.class)e.classList.add(n);continue}e.setAttribute(t,r[t])}},W=(e,r)=>{let t=e.attributes,n=r.attributes,s=null,i=null,u=null,o=null,c=null;for(let a=n.length-1;a>=0;--a)c=n[a],o=c.name,s=c.namespaceURI,i=c.value,s?(o=c.localName||o,u=e.getAttributeNS(s,o),u!==i&&e.setAttributeNS(s,o,i)):e.hasAttribute(o)?(u=e.getAttribute(o),u!==i&&(i==="null"||i==="undefined"?e.removeAttribute(o):e.setAttribute(o,i))):e.setAttribute(o,i);for(let a=t.length-1;a>=0;--a)c=t[a],c.specified!==!1&&(o=c.name,s=c.namespaceURI,s?(o=c.localName||o,r.hasAttributeNS(s,o)||e.removeAttributeNS(s,o)):r.hasAttributeNS(null,o)||e.removeAttribute(o))},L=(e,r)=>{for(let t in r){if(t==="class"){for(let n of r.class)e.classList.remove(n);continue}r[t]&&e.attributes[t]!==r[t]||e.removeAttribute(t)}};var ie="-transition:",B=(e,r,t,n=null)=>{if(t.nodeType!==1){n&&n();return}let s=r.prefix+ie+e,i=A=>{t.dispatchEvent(new CustomEvent("transition-"+A)),t.dispatchEvent(new CustomEvent("transition-"+e+"-"+A))},u,o,c,a,b=!1,f={};return u=s,o=t.getAttribute(u),o&&(f.during=C(o),H(t,f.during)),u=s+".from",o=t.getAttribute(u),o&&(f.from=C(o),H(t,f.from)),i("start"),a=requestAnimationFrame(()=>{if(a=null,b)return;if(f.from&&(L(t,f.from),f.from=void 0),u=s+".to",o=t.getAttribute(u),o)f.to=C(o),H(t,f.to);else if(!f.during){i("end"),n&&n(),b=!0;return}let A=getComputedStyle(t),S=Number(A.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;S===0&&(S=Number(A.animationDuration.replace("s",""))*1e3),c=setTimeout(()=>{c=null,!b&&(f.during&&(L(t,f.during),f.during=void 0),f.to&&(L(t,f.to),f.to=void 0),i("end"),n&&n(),b=!0)},S)}),()=>{b&&(b=!0,f.during&&(L(t,f.during),f.during=void 0),f.from?(L(t,f.from),f.from=void 0):f.to&&(L(t,f.to),f.to=void 0),a?(cancelAnimationFrame(a),a=null):c&&(clearTimeout(c),c=null),i("end"),n&&n())}},G=(e,r,t)=>B("in",e,r,t),X=(e,r,t)=>B("out",e,r,t);var I=(e,r)=>{if(!r.indicator||r.indicator.indicatorTransitionOut||!r.indicator.indicatorElement)return;let t=e.getLibrary().getOptions(),n=r.indicator.indicatorElement;r.indicator.indicatorTransitionIn=X(t,n,()=>{n&&n.remove()})},K=(e,r,t)=>{let n=e.getLibrary().getOptions(),s=r.getElement(),i=r.getDirective(),u=n.prefix+"-"+i+"-"+n.indicatorDirectiveName;if(!s.hasAttribute(u))return;let o=null;if(n.indicatorDirectiveEvaluate?o=t(e,r,s.getAttribute(u)):o=s.getAttribute(u),!o||typeof o=="string"&&(o=s.querySelector(o),!o)||o.tagName!=="TEMPLATE"||o.childCount>1)return;if(r.indicator){if(r.indicator.indicatorTransitionOut)r.indicator.indicatorTransitionOut(),r.indicator.indicatorTransitionOut=null;else if(r.indicator.indicatorElement)return}let c=document.importNode(o.content,!0).firstElementChild;o.insertAdjacentElement("afterend",c),r.indicator={indicatorElement:c,indicatorTransitionIn:G(n,c)}};var J=e=>{if(e.tagName!=="SCRIPT"||e.hasAttribute("src"))return!1;let r=document.createElement("script");return r.innerText=e.innerText,e.parentNode.insertBefore(r,e),e.remove(),!0},_=(...e)=>{for(let r of e)if(!J(r)){let t=V(r),n=null;for(;n=t();)J(n)}};var ne=(e,r)=>{let t=r.nodeType,n=r.nodeName;t===1&&W(e,r),(t===3||t===8)&&e.nodeValue!==r.nodeValue&&(e.nodeValue=r.nodeValue),n==="INPUT"?oe(e,r):n==="OPTION"?R(e,r,"selected"):n==="TEXTAREA"&&se(e,r)},U=(e,r,t)=>{if(typeof e!="object")throw new Error("Existing tree should be an object.");if(typeof r=="string")r=w(r);else if(typeof r!="object")throw new Error("New tree should be an object.");return t&&t.childrenOnly||r.nodeType===11?(Q(e,r),e):T(e,r)},oe=(e,r)=>{let t=r.value,n=e.value;R(e,r,"checked"),R(e,r,"disabled"),e.indeterminate!==r.indeterminate&&(e.indeterminate=r.indeterminate),e.type!=="file"&&(n!==t&&(e.setAttribute("value",t),e.value=t),t==="null"&&(e.value="",e.removeAttribute("value")),r.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=t):e.removeAttribute("value"))},se=(e,r)=>{let t=r.value;e.value!==t&&(e.value=t),e.firstChild&&e.firstChild.nodeValue!==t&&(e.firstChild.nodeValue=t)},R=(e,r,t)=>{e[t]!==r[t]&&(e[t]=r[t],r[t]?e.setAttribute(t,""):e.removeAttribute(t))},T=(e,r)=>e?r?e.isSameNode&&e.isSameNode(r)?e:e.tagName!==r.tagName?r:(ne(e,r),Q(e,r),e):null:r,Q=(e,r)=>{let t,n,s,i,u=0;for(let o=0;t=e.childNodes[o],n=r.childNodes[o-u],!(!t&&!n);o++)if(!n)e.removeChild(t),o--;else if(!t)e.append(n),u++;else if(k(t,n))s=T(t,n),s!==t&&(e.replaceChild(s,t),u++);else{i=null;for(let c=o;c<e.childNodes.length;c++)if(k(e.childNodes[c],n)){i=e.childNodes[c];break}i?(s=T(i,n),s!==i&&u++,e.insertBefore(s,t)):!n.id&&!t.id?(s=T(t,n),s!==t&&(e.replaceChild(s,t),u++)):(e.insertBefore(n,t),u++)}};var h=Symbol("NAVIGATE"),Y=({fetchOptions:e,intersectionMargin:r,intersectionThreshold:t,navigateDirectiveName:n})=>({name:n,update:(s,i,u)=>{let o=i.getElement();if(o[h])return;let a=s.getLibrary().getOptions(),b=i.getDirective(),f=i.getModifiers(),A={};f.capture&&(A.capture=!0);let S={[a.prefix+"-"+a.requestHeaderName]:b,Vary:a.prefix+"-"+a.requestHeaderName},O=(m="",g={})=>{o.dispatchEvent(new CustomEvent(a.prefix+"-"+b+m,{detail:Object.assign({attribute:i,component:s},g)}))},F=m=>{i[h].url=m;let g=new Date().toISOString();i[h].identifier=g,K(s,i,u),O("-started",{url:m}),j(m,Object.assign({},e,{headers:Object.assign({},e.headers,S)}),"text").then(v=>{var D;if(!i[h].identifier||i[h].identifier!==g)return;if(!v){I(s,i),delete i[h].url,delete i[h].identifier;return}let d=v.value;f.decode&&(d=z(v.value));let l=null;if(f.document)l=document.documentElement;else{let y=a.prefix+"-"+b+"-"+a.targetDirectiveName;o.getAttribute(y)&&(a.targetDirectiveEvaluate?l=u(s,i,o.getAttribute(y)):l=o.getAttribute(y),l&&typeof l=="string"&&(l=o.querySelector(l))),l||(l=o)}if(f.morph)if(f.outer)U(l,x(w(d),s,i,u));else{if(l.children.length===0)l.append(document.createElement("div"));else if(l.children.length>1)for(let P=l.children.length-1;P>=1;P--)l.children[P].remove();let y=U(l.children[0],x(w(d),s,i,u));l.children[0].isSameNode(y)||(l.children[0].remove(),l.append(y))}else f.outer?l.outerHTML!==d&&(l.outerHTML=x(d,s,i,u).toString(),(a.allowInlineScript||f.script)&&_(l)):l.innerHTML!==d&&(l.innerHTML=x(d,s,i,u),(a.allowInlineScript||f.script)&&_(...l.children));if(a.redirectHeaderName&&v.headers.has(a.prefix+"-"+a.redirectHeaderName)){window.location.href=v.headers.get(a.prefix+"-"+a.redirectHeaderName);return}let p="";if(a.titleHeaderName&&v.headers.has(a.prefix+"-"+a.titleHeaderName))p=v.headers.get(a.prefix+"-"+a.titleHeaderName);else{let y=d;typeof d=="string"&&(y=w(d)),p=(D=y.querySelector("head > title"))!=null?D:"",p&&(p=p.textContent.trim())}f.history&&history.pushState({},"",m),p&&document.title!==p&&(document.title=p),I(s,i),delete i[h].url,delete i[h].identifier,O("-succeeded",{url:m})}).catch(v=>O("-failed",{error:v,url:m}))},$=m=>{let g=m.target.closest("a");if(!g||!g.hasAttribute("href"))return;let v=g.getAttribute("href"),d=new URL(v,window.location);window.location.hostname===d.hostname&&(i[h].url&&i[h].url.href===d.href||(m.preventDefault(),f.stop&&m.stopPropagation(),F(d)))};o.addEventListener("click",$,Object.assign({once:!0},A));let M;f.document&&f.history&&(M=m=>{let g=new URL(m.target.location);i[h].url&&i[h].url.href===g.href||F(g)},window.addEventListener("popstate",M,{passive:!0}));let N;if(f.preload==="interact"){let m=g=>{let v=g.target.closest("a");if(!v||!v.hasAttribute("href"))return;let d=new URL(v.getAttribute("href"),window.location);d.origin===window.location.origin&&(O("-started",{url:d}),j(d,Object.assign({},e,{headers:Object.assign({},e.headers,S)}),"text").catch(l=>O("-failed",{error:l,url:d})))};o.addEventListener("pointerover",m,Object.assign({passive:!0},A)),N=()=>{o.removeEventListener("pointerover",i[h].preloadHandler)}}else if(f.preload==="intersect"){let m=new IntersectionObserver(d=>{for(let l of d)if(l.isIntersecting){let p=new URL(l.target.getAttribute("href"),window.location);if(p.origin!==window.location.origin)return;O("-started",{url:p}),j(p,Object.assign({},e,{headers:Object.assign({},e.headers,S)}),"text").catch(D=>O("-failed",{error:D,url:p}))}},{root:null,rootMargin:r,threshold:t}),g=new MutationObserver(d=>{for(let l of d)if(l.type==="attributes")l.attributeName==="href"&&l.target instanceof HTMLElement&&l.target.tagName==="A"&&(l.target.hasAttribute("href")?m.observe(l.target):m.unobserve(l.target));else if(l.type==="childList"){for(let p of l.addedNodes)p instanceof HTMLElement&&p.tagName==="A"&&p.hasAttribute("href")&&m.observe(p);for(let p of l.removedNodes)p instanceof HTMLElement&&p.tagName==="A"&&p.hasAttribute("href")&&m.unobserve(p)}});N=()=>{g.disconnect(),m.disconnect()};let v=o.querySelectorAll("a[href]");for(let d of v)m.observe(d);g.observe(o,{attributes:!0,childList:!0,subtree:!0})}i[h]={element:o,historyHandler:M,loadHandler:$,destroyPreloader:N}},destroy:(s,i)=>{i[h]&&(i[h].element.removeEventListener("click",i[h].loadHandler),i[h].historyHandler&&window.removeEventListener("popstate",i[h].historyHandler),i[h].destroyPreloader&&i[h].destroyPreloader(),I(s,i),delete i[h])}});var ae=function(e,r=null){r=Object.assign({fetchOptions:{},intersectionMargin:"0px",intersectionThreshold:0,navigateDirectiveName:"navigate"},r);let t=!1,n=Y(r),s=()=>{e.addDirectives(-1,n)},i=()=>{e.removeDirective(n)};this.disable=()=>{!e.getEnabled()&&t&&(t=!1,e.removeEventListener("enabling",s),e.removeEventListener("disabling",i))},this.enable=()=>{t||(t=!0,e.addEventListener("enabling",s),e.addEventListener("disabling",i))},this.enable()},Ie=ae;export{Ie as default};
//# sourceMappingURL=doars-navigate.esm.min.js.map
