var U="interact",k="intersect";var s=Symbol("NAVIGATE");var N=e=>{let t=e.substring(0,15).toLowerCase();if(t.startsWith("<!doctype html>")||t.startsWith("<html>")){let o=document.createElement("html");return o.innerHTML=e,o}let l=document.createElement("template");return l.innerHTML=e,l.content.childNodes[0]},W=(e,t)=>{e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},j=(e,t)=>e.isSameNode&&e.isSameNode(t)?!0:e.type===3?e.nodeValue===t.nodeValue:e.tagName===t.tagName;var z={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},J=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var q=e=>typeof e!="string"?e:e.replaceAll(J,t=>z[t]);var G=(e,t)=>{let n=e.attributes,l=t.attributes,o=null,r=null,u=null,i=null,f=null;for(let c=l.length-1;c>=0;--c)f=l[c],i=f.name,o=f.namespaceURI,r=f.value,o?(i=f.localName||i,u=e.getAttributeNS(o,i),u!==r&&e.setAttributeNS(o,i,r)):e.hasAttribute(i)?(u=e.getAttribute(i),u!==r&&(r==="null"||r==="undefined"?e.removeAttribute(i):e.setAttribute(i,r))):e.setAttribute(i,r);for(let c=n.length-1;c>=0;--c)f=n[c],f.specified!==!1&&(i=f.name,o=f.namespaceURI,o?(i=f.localName||i,t.hasAttributeNS(o,i)||e.removeAttributeNS(o,i)):t.hasAttributeNS(null,i)||e.removeAttribute(i))};var Q=(e,t)=>{let n=t.nodeType,l=t.nodeName;n===1&&G(e,t),(n===3||n===8)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),l==="INPUT"?Y(e,t):l==="OPTION"?H(e,t,"selected"):l==="TEXTAREA"&&Z(e,t)},_=(e,t,n)=>{if(typeof e!="object")throw new Error("Existing tree should be an object.");if(typeof t=="string")t=N(t);else if(typeof t!="object")throw new Error("New tree should be an object.");return n&&n.childrenOnly||t.nodeType===11?(F(e,t),e):D(e,t)},Y=(e,t)=>{let n=t.value,l=e.value;H(e,t,"checked"),H(e,t,"disabled"),e.indeterminate!==t.indeterminate&&(e.indeterminate=t.indeterminate),e.type!=="file"&&(l!==n&&(e.setAttribute("value",n),e.value=n),n==="null"&&(e.value="",e.removeAttribute("value")),t.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=n):e.removeAttribute("value"))},Z=(e,t)=>{let n=t.value;e.value!==n&&(e.value=n),e.firstChild&&e.firstChild.nodeValue!==n&&(e.firstChild.nodeValue=n)},H=(e,t,n)=>{e[n]!==t[n]&&(e[n]=t[n],t[n]?e.setAttribute(n,""):e.removeAttribute(n))},D=(e,t)=>e?t?e.isSameNode&&e.isSameNode(t)?e:e.tagName!==t.tagName?t:(Q(e,t),F(e,t),e):null:t,F=(e,t)=>{let n,l,o,r,u=0;for(let i=0;n=e.childNodes[i],l=t.childNodes[i-u],!(!n&&!l);i++)if(!l)e.removeChild(n),i--;else if(!n)e.appendChild(l),u++;else if(j(n,l))o=D(n,l),o!==n&&(e.replaceChild(o,n),u++);else{r=null;for(let f=i;f<e.childNodes.length;f++)if(j(e.childNodes[f],l)){r=e.childNodes[f];break}r?(o=D(r,l),o!==r&&u++,e.insertBefore(o,n)):!l.id&&!n.id?(o=D(n,l),o!==n&&(e.replaceChild(o,n),u++)):(e.insertBefore(l,n),u++)}};var $="-loader",x="-target",B="Date",I="Cache-Control",ee=["no-cache","must-revalidate","no-store"],te=(e,t,n,l,o)=>{let r=e.getElement(),u=e.getDirective(),i=n.prefix+"-"+u+$;if(!r.hasAttribute(i))return;let f=l(t,e,r.getAttribute(i));if(!f||(typeof f=="string"&&(f=r.querySelector(f)),f.tagName!=="TEMPLATE")||f.childCount>1)return;if(e[s].loaderTransitionOut)e[s].loaderTransitionOut(),e[s].loaderTransitionOut=null;else if(e[s].loaderElement)return;let c=document.importNode(f.content,!0);W(f,c),e[s].loaderElement=c=f.nextElementSibling,e[s].loaderTransitionIn=o(t,c)},M=(e,t,n)=>{if(e[s].loaderTransitionOut||!e[s].loaderElement)return;let l=e[s].loaderElement;e[s].loaderTransitionIn=n(t,l,()=>{l&&l.remove()})},X=(e,t=null)=>{if(!e.has(B)||!e.has(I))return!1;let n=new Date(e.get(B)),l=new Date;if(n>l)return!1;if(t){let i=new Date(n.getTime()+t);if(l>i)return!1}let o=e.get(I).split(","),r=0;for(let i of o)if(i.trim().startsWith("max-age=")&&(r=parseInt(i.split("=")[1].trim(),10)),i.trim().startsWith("s-maxage=")){r=parseInt(i.split("=")[1].trim(),10);break}return r<=0?!1:new Date(n.getTime()+r*1e3)>=l},g=0,P=null,K=e=>{let t={},n=()=>{if(g>0){g++;return}P=setInterval(()=>{for(let o in t)!Object.hasOwnProperty.call(t,o)||!t.headers||X(t.headers,e.cacheMaxAge)||delete t[o]},e.cacheInterval)},l=(o,r)=>new Promise(u=>{if(window.location.hostname!==o.hostname&&u(null),Object.hasOwnProperty.call(t,o.location)){if(t[o.location].headers&&X(t[o.location].headers)){u(t[o.location]);return}t[o.location].listeners?t[o.location].listeners.push(()=>{u(t[o.location])}):t[o.location]={listeners:[]}}else t[o.location]={listeners:[]};r("-started",{url:o}),fetch(o,e.defaultInit).then(i=>{if(i.status<200||i.status>=300){r("-failed",{response:i,url:o}),u(null);return}i.headers.get("Content-Type").toLowerCase().startsWith("text/html");let c=!0;if(i.headers.has(I)){let y=i.headers.get(I).split(","),E=0;for(let b of y){let d=b.trim();if(ee.indexOf(d)>=0){c=!1;break}if(d.startsWith("s-maxage=")&&(E=parseInt(d.split("=")[1].trim(),10),E<=0)){c=!1;break}if(d.startsWith("max-age=")&&E<=0&&(E=parseInt(d.split("=")[1].trim(),10),E<=0)){c=!1;break}}}i.text().then(y=>{let E={headers:i.headers,html:y},b=t[o.location].listeners;if(c?(t[o.location]=E,n()):delete t[o.location],u(E),b)for(let d of b)d()})})});return{name:"navigate",update:(o,r,{processExpression:u,transitionIn:i,transitionOut:f})=>{let c=r.getElement();if(c[s])return;let E=o.getLibrary().getOptions(),b=r.getDirective(),d=r.getModifiers(),O={};d.capture&&(O.capture=!0);let L=(h="",p={})=>{c.dispatchEvent(new CustomEvent(E.prefix+"-"+b+h,{detail:Object.assign({attribute:r,component:o},p)}))},w=h=>{r[s].url=h;let p=new Date().toISOString();r[s].identifier=p,te(r,o,E,u,i),l(h,L).then(v=>{if(!r[s].identifier||r[s].identifier!==p)return;if(!v){M(r,o,f),delete r[s].url,delete r[s].identifier;return}let m=v.html;d.decode&&(m=q(v.html));let a=null;if(d.document)a=document.documentElement;else{let C=E.prefix+"-"+b+x;c.hasAttribute(C)&&(a=u(o,r,c.getAttribute(C)),typeof a=="string"&&(a=c.querySelector(a))),a||(a=c)}if(d.morph)if(d.outer)_(a,m);else{if(a.children.length===0)a.appendChild(document.createElement("div"));else if(a.children.length>1)for(let R=a.children.length-1;R>=1;R--)a.children[R].remove();let C=_(a.children[0],m);a.children[0].isSameNode(C)||(a.children[0].remove(),a.appendChild(C))}else d.outer?a.outerHTML=m:a.innerHTML=m;let A="";e.headerTitle&&v.headers.has(e.headerTitle)&&(A=v.headers.get(e.headerTitle)),d.document&&d.history&&history.pushState({},A,h),A&&document.title!==A&&(document.title=A),M(r,o,f),delete r[s].url,delete r[s].identifier,L("-loaded",{url:h})})},V=h=>{let p=h.target.closest("a");if(!p||!p.hasAttribute("href"))return;let v=p.getAttribute("href"),m=new URL(v,window.location);window.location.hostname===m.hostname&&(r[s].url&&r[s].url.href===m.href||(h.preventDefault(),d.stop&&h.stopPropagation(),w(m)))};c.addEventListener("click",V,O);let T;d.document&&d.history&&(T=h=>{let p=new URL(h.target.location);r[s].url&&r[s].url.href===p.href||w(p)},window.addEventListener("popstate",T,{passive:!0}));let S;if(d.preload===U){let h=p=>{let v=p.target.closest("a");if(!v||!v.hasAttribute("href"))return;let m=v.getAttribute("href");l(new URL(m,window.location),L)};c.addEventListener("focusin",h,Object.assign({passive:!0},O)),c.addEventListener("pointerenter",h,Object.assign({passive:!0},O)),S=()=>{c.removeEventListener("focusin",r[s].preloadHandler),c.removeEventListener("pointerenter",r[s].preloadHandler)}}else if(d.preload===k){let h=new IntersectionObserver(m=>{for(let a of m)a.isIntersecting&&l(new URL(a.target.getAttribute("href"),window.location),L)},{root:null,rootMargin:e.intersectionMargin,threshold:e.intersectionThreshold}),p=new MutationObserver(m=>{for(let a of m)if(a.type==="attributes")a.attributeName==="href"&&a.target instanceof HTMLElement&&a.target.tagName==="A"&&(a.target.hasAttribute("href")?h.observe(a.target):h.unobserve(a.target));else if(a.type==="childList"){for(let A of a.addedNodes)A instanceof HTMLElement&&A.tagName==="A"&&A.hasAttribute("href")&&h.observe(A);for(let A of a.removedNodes)A instanceof HTMLElement&&A.tagName==="A"&&A.hasAttribute("href")&&h.unobserve(A)}});S=()=>{p.disconnect(),h.disconnect()};let v=c.querySelectorAll("a[href]");for(let m of v)h.observe(m);p.observe(c,{attributes:!0,childList:!0,subtree:!0})}r[s]={cache:t,element:c,historyHandler:T,loadHandler:V,destroyPreloader:S}},destroy:(o,r,{transitionOut:u})=>{r[s]&&(g>0&&(g--,g===0&&P&&(clearInterval(P),t={})),r[s].element.removeEventListener("click",r[s].loadHandler),r[s].historyHandler&&window.removeEventListener("popstate",r[s].historyHandler),r[s].destroyPreloader&&r[s].destroyPreloader(),M(r,o,u),delete r[s])}}};var re=function(e,t=null){t=Object.assign({cacheInterval:60*1e3,cacheMaxAge:30*60*1e3,fetchOptions:{},headerTitle:null,intersectionMargin:"0px",intersectionThreshold:0},t);let n=!1,l,o=()=>{l=K(t),e.addDirectives(-1,l)},r=()=>{e.removeDirective(l),l=null};this.disable=()=>{!e.getEnabled()&&n&&(n=!1,e.removeEventListener("enabling",o),e.removeEventListener("disabling",r))},this.enable=()=>{n||(n=!0,e.addEventListener("enabling",o),e.addEventListener("disabling",r))},this.enable()},Ee=re;export{Ee as default};
//# sourceMappingURL=doars-navigate.min.js.map
