var z=Symbol("ATTRIBUTES"),R=Symbol("COMPONENT"),K=Symbol("FOR"),re=Symbol("INITIALIZED"),ne=Symbol("ON"),B=Symbol("REFERENCES"),W=Symbol("REFERENCES_CACHE"),oe=Symbol("SYNC");var G=(e,t)=>{let n=e.attributes,s=t.attributes,o=null,r=null,u=null,i=null,f=null;for(let a=s.length-1;a>=0;--a)f=s[a],i=f.name,o=f.namespaceURI,r=f.value,o?(i=f.localName||i,u=e.getAttributeNS(o,i),u!==r&&e.setAttributeNS(o,i,r)):e.hasAttribute(i)?(u=e.getAttribute(i),u!==r&&(r==="null"||r==="undefined"?e.removeAttribute(i):e.setAttribute(i,r))):e.setAttribute(i,r);for(let a=n.length-1;a>=0;--a)f=n[a],f.specified!==!1&&(i=f.name,o=f.namespaceURI,o?(i=f.localName||i,t.hasAttributeNS(o,i)||e.removeAttributeNS(o,i)):t.hasAttributeNS(null,i)||e.removeAttribute(i))};var X=e=>{let t=e.substring(0,15).toLowerCase();if(t.startsWith("<!doctype html>")||t.startsWith("<html>")){let o=document.createElement("html");return o.innerHTML=e,o}let s=document.createElement("template");return s.innerHTML=e,s.content.childNodes[0]},T=(e,t)=>{e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},P=(e,t)=>e.isSameNode&&e.isSameNode(t)?!0:e.type===3?e.nodeValue===t.nodeValue:e.tagName===t.tagName;var vt=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var ue={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},de=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var j=e=>typeof e!="string"?e:e.replaceAll(de,t=>ue[t]);var Y="interact",Z="intersect";var c=Symbol("NAVIGATE");var pe=(e,t)=>{let n=t.nodeType,s=t.nodeName;n===1&&G(e,t),(n===3||n===8)&&e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue),s==="INPUT"?me(e,t):s==="OPTION"?M(e,t,"selected"):s==="TEXTAREA"&&he(e,t)},H=(e,t,n)=>{if(typeof e!="object")throw new Error("Existing tree should be an object.");if(typeof t=="string")t=X(t);else if(typeof t!="object")throw new Error("New tree should be an object.");return n&&n.childrenOnly||t.nodeType===11?(J(e,t),e):L(e,t)},me=(e,t)=>{let n=t.value,s=e.value;M(e,t,"checked"),M(e,t,"disabled"),e.indeterminate!==t.indeterminate&&(e.indeterminate=t.indeterminate),e.type!=="file"&&(s!==n&&(e.setAttribute("value",n),e.value=n),n==="null"&&(e.value="",e.removeAttribute("value")),t.hasAttributeNS(null,"value")?e.type==="range"&&(e.value=n):e.removeAttribute("value"))},he=(e,t)=>{let n=t.value;e.value!==n&&(e.value=n),e.firstChild&&e.firstChild.nodeValue!==n&&(e.firstChild.nodeValue=n)},M=(e,t,n)=>{e[n]!==t[n]&&(e[n]=t[n],t[n]?e.setAttribute(n,""):e.removeAttribute(n))},L=(e,t)=>e?t?e.isSameNode&&e.isSameNode(t)?e:e.tagName!==t.tagName?t:(pe(e,t),J(e,t),e):null:t,J=(e,t)=>{let n,s,o,r,u=0;for(let i=0;n=e.childNodes[i],s=t.childNodes[i-u],!(!n&&!s);i++)if(!s)e.removeChild(n),i--;else if(!n)e.appendChild(s),u++;else if(P(n,s))o=L(n,s),o!==n&&(e.replaceChild(o,n),u++);else{r=null;for(let f=i;f<e.childNodes.length;f++)if(P(e.childNodes[f],s)){r=e.childNodes[f];break}r?(o=L(r,s),o!==r&&u++,e.insertBefore(o,n)):!s.id&&!n.id?(o=L(n,s),o!==n&&(e.replaceChild(o,n),u++)):(e.insertBefore(s,n),u++)}};var ge="-loader",ve="-target",Q="Date",w="Cache-Control",Ee=["no-cache","must-revalidate","no-store"],ye=(e,t,n,s,o)=>{let{prefix:r}=t.getLibrary().getOptions(),u=e.getElement(),i=e.getDirective(),f=n.prefix+"-"+i+ge;if(!u.hasAttribute(f))return;let a=s(t,e,u.getAttribute(f));if(!a||(typeof a=="string"&&(a=u.querySelector(a)),a.tagName!=="TEMPLATE")||a.childCount>1)return;if(e[c].loaderTransitionOut)e[c].loaderTransitionOut(),e[c].loaderTransitionOut=null;else if(e[c].loaderElement)return;let A=document.importNode(a.content,!0);T(a,A),e[c].loaderElement=A=a.nextElementSibling,e[c].loaderTransitionIn=o(r,A)},V=(e,t,n)=>{if(e[c].loaderTransitionOut||!e[c].loaderElement)return;let s=e[c].loaderElement;e[c].loaderTransitionIn=n(t.getLibrary().getOptions().prefix,s,()=>{s&&s.remove()})},ee=(e,t=null)=>{if(!e.has(Q)||!e.has(w))return!1;let n=new Date(e.get(Q)),s=new Date;if(n>s)return!1;if(t){let i=new Date(n.getTime()+t);if(s>i)return!1}let o=e.get(w).split(","),r=0;for(let i of o)if(i.trim().startsWith("max-age=")&&(r=parseInt(i.split("=")[1].trim(),10)),i.trim().startsWith("s-maxage=")){r=parseInt(i.split("=")[1].trim(),10);break}return r<=0?!1:new Date(n.getTime()+r*1e3)>=s},D=0,$=null,te=e=>{let t={},n=()=>{if(D>0){D++;return}$=setInterval(()=>{for(let o in t)!Object.hasOwnProperty.call(t,o)||!t.headers||ee(t.headers,e.cacheMaxAge)||delete t[o]},e.cacheInterval)},s=(o,r,u)=>new Promise(i=>{if(window.location.hostname!==o.hostname&&i(null),Object.hasOwnProperty.call(t,o.location)){if(t[o.location].headers&&ee(t[o.location].headers)){i(t[o.location]);return}t[o.location].listeners?t[o.location].listeners.push(()=>{i(t[o.location])}):t[o.location]={listeners:[]}}else t[o.location]={listeners:[]};r("-started",{url:o}),fetch(o,Object.assign({},e.fetchOptions,{headers:Object.assign({},u,e.fetchOptions.headers)})).then(f=>{if(f.status<200||f.status>=500){r("-failed",{response:f,url:o}),i(null);return}f.headers.get("Content-Type").toLowerCase().startsWith("text/html");let A=!0;if(f.headers.has(w)){let b=f.headers.get(w).split(","),E=0;for(let p of b){let y=p.trim();if(Ee.indexOf(y)>=0){A=!1;break}if(y.startsWith("s-maxage=")&&(E=parseInt(y.split("=")[1].trim(),10),E<=0)){A=!1;break}if(y.startsWith("max-age=")&&E<=0&&(E=parseInt(y.split("=")[1].trim(),10),E<=0)){A=!1;break}}}f.text().then(b=>{let E={headers:f.headers,html:b},p=t[o.location].listeners;if(A?(t[o.location]=E,n()):delete t[o.location],i(E),p)for(let y of p)y()})})});return{name:"navigate",update:(o,r,{processExpression:u,transitionIn:i,transitionOut:f})=>{let a=r.getElement();if(a[c])return;let b=o.getLibrary().getOptions(),E=r.getDirective(),p=r.getModifiers(),y={};p.capture&&(y.capture=!0);let _=b.prefix+"-request",N={[_]:E,Vary:_},C=(d="",h={})=>{a.dispatchEvent(new CustomEvent(b.prefix+"-"+E+d,{detail:Object.assign({attribute:r,component:o},h)}))},U=d=>{r[c].url=d;let h=new Date().toISOString();r[c].identifier=h,ye(r,o,b,u,i),s(d,C,N).then(v=>{if(!r[c].identifier||r[c].identifier!==h)return;if(!v){V(r,o,f),delete r[c].url,delete r[c].identifier;return}let m=v.html;p.decode&&(m=j(v.html));let l=null;if(p.document)l=document.documentElement;else{let O=b.prefix+"-"+E+ve;a.hasAttribute(O)&&(l=u(o,r,a.getAttribute(O)),typeof l=="string"&&(l=a.querySelector(l))),l||(l=a)}if(p.morph)if(p.outer)H(l,m);else{if(l.children.length===0)l.appendChild(document.createElement("div"));else if(l.children.length>1)for(let k=l.children.length-1;k>=1;k--)l.children[k].remove();let O=H(l.children[0],m);l.children[0].isSameNode(O)||(l.children[0].remove(),l.appendChild(O))}else p.outer?l.outerHTML=m:l.innerHTML=m;let g="";e.headerTitle&&v.headers.has(e.headerTitle)&&(g=v.headers.get(e.headerTitle)),p.document&&p.history&&history.pushState({},g,d),g&&document.title!==g&&(document.title=g),V(r,o,f),delete r[c].url,delete r[c].identifier,C("-loaded",{url:d})})},F=d=>{let h=d.target.closest("a");if(!h||!h.hasAttribute("href"))return;let v=h.getAttribute("href"),m=new URL(v,window.location);window.location.hostname===m.hostname&&(r[c].url&&r[c].url.href===m.href||(d.preventDefault(),p.stop&&d.stopPropagation(),U(m)))};a.addEventListener("click",F,y);let S;p.document&&p.history&&(S=d=>{let h=new URL(d.target.location);r[c].url&&r[c].url.href===h.href||U(h)},window.addEventListener("popstate",S,{passive:!0}));let I;if(p.preload===Y){let d=h=>{let v=h.target.closest("a");if(!v||!v.hasAttribute("href"))return;let m=v.getAttribute("href");s(new URL(m,window.location),C,N)};a.addEventListener("focusin",d,Object.assign({passive:!0},y)),a.addEventListener("pointerenter",d,Object.assign({passive:!0},y)),I=()=>{a.removeEventListener("focusin",r[c].preloadHandler),a.removeEventListener("pointerenter",r[c].preloadHandler)}}else if(p.preload===Z){let d=new IntersectionObserver(m=>{for(let l of m)l.isIntersecting&&s(new URL(l.target.getAttribute("href"),window.location),C,N)},{root:null,rootMargin:e.intersectionMargin,threshold:e.intersectionThreshold}),h=new MutationObserver(m=>{for(let l of m)if(l.type==="attributes")l.attributeName==="href"&&l.target instanceof HTMLElement&&l.target.tagName==="A"&&(l.target.hasAttribute("href")?d.observe(l.target):d.unobserve(l.target));else if(l.type==="childList"){for(let g of l.addedNodes)g instanceof HTMLElement&&g.tagName==="A"&&g.hasAttribute("href")&&d.observe(g);for(let g of l.removedNodes)g instanceof HTMLElement&&g.tagName==="A"&&g.hasAttribute("href")&&d.unobserve(g)}});I=()=>{h.disconnect(),d.disconnect()};let v=a.querySelectorAll("a[href]");for(let m of v)d.observe(m);h.observe(a,{attributes:!0,childList:!0,subtree:!0})}r[c]={cache:t,element:a,historyHandler:S,loadHandler:F,destroyPreloader:I}},destroy:(o,r,{transitionOut:u})=>{r[c]&&(D>0&&(D--,D===0&&$&&(clearInterval($),t={})),r[c].element.removeEventListener("click",r[c].loadHandler),r[c].historyHandler&&window.removeEventListener("popstate",r[c].historyHandler),r[c].destroyPreloader&&r[c].destroyPreloader(),V(r,o,u),delete r[c])}}};var Ae=function(e,t=null){t=Object.assign({cacheInterval:60*1e3,cacheMaxAge:30*60*1e3,fetchOptions:{},headerTitle:null,intersectionMargin:"0px",intersectionThreshold:0},t);let n=!1,s,o=()=>{s=te(t),e.addDirectives(-1,s)},r=()=>{e.removeDirective(s),s=null};this.disable=()=>{!e.getEnabled()&&n&&(n=!1,e.removeEventListener("enabling",o),e.removeEventListener("disabling",r))},this.enable=()=>{n||(n=!0,e.addEventListener("enabling",o),e.addEventListener("disabling",r))},this.enable()},In=Ae;export{In as default};
//# sourceMappingURL=doars-navigate.min.js.map
