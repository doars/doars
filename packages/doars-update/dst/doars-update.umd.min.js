var global,factory;global=this,factory=function(){const e=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"];class t extends class{constructor(){let e={};this.addEventListener=(t,s,n=null)=>{t in e||(e[t]=[]),e[t].push({callback:s,options:n})},this.removeEventListener=(t,s)=>{if(!Object.keys(e).includes(t))return;const n=e[t];let r=-1;for(let e=0;e<n.length;e++)if(n[e].callback===s){r=e;break}r<0||(n.splice(r,1),0===Object.keys(n).length&&delete e[t])},this.removeEventListeners=t=>{t&&delete e[t]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(t,s,n=null)=>{if(!e[t])return;const r=e[t];for(let e=0;e<r.length;e++){const t=n&&n.reverse?r[r.length-(e+1)]:r[e];t.options&&t.options.once&&r.splice(e,1),t.callback(...s)}}}}{constructor(t={}){super(),t=Object.assign({delete:!0,get:!0,set:!0},t);const s=new WeakMap;this.add=(n,r=[])=>{if(s.has(n))return s.get(n);for(const e in n)n[e]&&"object"==typeof n[e]&&(n[e]=this.add(n[e],[...r,e]));const o={};t.delete&&(o.deleteProperty=(e,t)=>{if(!Reflect.has(e,t))return!0;this.remove(e,t);const s=Reflect.deleteProperty(e,t);return s&&this.dispatchEvent("delete",[e,Array.isArray(e)?[...r]:[...r,t]]),s}),t.get&&(o.get=(e,t,s)=>(t!==Symbol.unscopables&&this.dispatchEvent("get",[e,[...r,t],s]),Reflect.get(e,t,s))),t.set&&(o.set=(e,t,s,n)=>(e[t]===s||("object"==typeof s&&(s=this.add(s,[...r,t])),e[t]=s,this.dispatchEvent("set",[e,Array.isArray(e)?[...r]:[...r,t],s,n])),!0));const i=function(t,s){let n=!1;const r={};for(const t of e)r[t]=(...e)=>{if(!n)return t in s?s[t](...e):Reflect[t](...e);console.error("illegal operation attempted on a revoked proxy")};return{proxy:new Proxy(t,r),revoke:()=>{n=!0}}}(n,o);return s.set(i,n),i.proxy},this.remove=e=>{if(!s.has(e))return;const t=s.get(e);s.delete(t);for(const e in t.proxy)"object"==typeof t.proxy[e]&&this.remove(t.proxy[e]);t.revoke()}}}class s{constructor(e,s){e=Object.assign({stepMinimum:0},e);const n=Symbol();let r,o=!1;const i=new t({delete:!1,set:!1}),a=i.add({}),l=function(t){if(!o)return;if(r=window.requestAnimationFrame(l),!a.startMs)return a.currentMs=a.lastMs=a.startMs=t,a.current=a.last=a.start=t/1e3,void(a.delta=a.passed=a.deltaMs=a.passedMs=0);const n=t-a.lastMs;n<=e.stepMinimum||(a.lastMs=a.currentMs,a.last=a.current,a.currentMs=t,a.current=t/1e3,a.deltaMs=n,a.delta=n/1e3,a.passedMs+=n,a.passed=a.passedMs/1e3,s())};this.isEnabled=()=>o,this.getId=()=>n,this.getProxy=()=>i,this.getTime=()=>a,this.enable=()=>{o||(o=!0,r=window.requestAnimationFrame(l))},this.disable=()=>{o&&(o=!1,r&&(cancelAnimationFrame(r),r=null))}}}return class{constructor(e,t=null){let n,r,o;t=Object.assign({},t),e.addEventListener("enabling",(()=>{const[i,a]=function(e){e=Object.assign({defaultOrder:500},e);const t=[],s=[],n={name:"update",update:function(n,r,{executeExpression:o}){this._execute||(this._execute=o);const i=r.getId();if(t.indexOf(i)>=0)return;let{order:a}=r.getModifiers();a||(a=e.defaultOrder);let l=0;for(let e=0;e<s.length;e++)if(s[e].order>=a){l=e;break}s.splice(l,0,{attribute:r,component:n,order:a})},destroy:(e,n)=>{const r=n.getId(),o=t.indexOf(r);if(!(o>=0)){t.splice(o,1);for(let e=0;e<s.length;e++)if(s[e].attribute===n){s.splice(e,1);break}}}};return[n,()=>{for(const e of s)n._execute(e.component,e.attribute.clone(),e.attribute.getValue(),{},{return:!1})}]}(t);r=i,e.addDirectives(-1,r),o=new s(t,(()=>{a(),e.update([{id:o.getId(),path:"current"},{id:o.getId(),path:"delta"},{id:o.getId(),path:"last"},{id:o.getId(),path:"passed"}])})),n=function(e){const t=e.getId(),s=e.getProxy(),n=e.getTime();return{name:"$update",create:(e,r)=>{const o=(e,s)=>r.accessed(t,s.join("."));return s.addEventListener("get",o),{value:n,destroy:()=>{s.removeEventListener("get",o)}}}}}(o),e.addContexts(0,n),o.enable()})),e.addEventListener("disabling",(()=>{e.removeContexts(n),e.removeDirectives(r),o.disable(),n=null,r=null,o=null}))}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).DoarsUpdate=factory();
