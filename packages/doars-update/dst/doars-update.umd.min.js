var global,factory;global=this,factory=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function r(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw i}}}}function l(e){var t=e.getId(),n=e.getProxy(),r=e.getTime();return{name:"$update",create:function(e,o){var i=function(e,n){return o.accessed(t,n.join("."))};return n.addEventListener("get",i),{value:r,destroy:function(){n.removeEventListener("get",i)}}}}}function s(e){e=Object.assign({defaultOrder:500},e);var t=[],n=[],r={name:"update",update:function(r,o,i){var a=i.executeExpression;this._execute||(this._execute=a);var u=o.getId();if(!(t.indexOf(u)>=0)){var c=o.getModifiers().order;c||(c=e.defaultOrder);for(var l=0,s=0;s<n.length;s++)if(n[s].order>=c){l=s;break}n.splice(l,0,{attribute:o,component:r,order:c})}},destroy:function(e,r){var o=r.getId(),i=t.indexOf(o);if(!(i>=0)){t.splice(i,1);for(var a=0;a<n.length;a++)if(n[a].attribute===r){n.splice(a,1);break}}}};return[r,function(){var e,t=c(n);try{for(t.s();!(e=t.n()).done;){var o=e.value;r._execute(o.component,o.attribute.clone(),o.attribute.getValue(),{},{return:!1})}}catch(e){t.e(e)}finally{t.f()}}]}var f=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"];function d(e,t){var n,r=!1,o={},i=c(f);try{var a=function(){var e=n.value;o[e]=function(){if(!r)return e in t?t[e].apply(t,arguments):Reflect[e].apply(Reflect,arguments);console.error("illegal operation attempted on a revoked proxy")}};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return{proxy:new Proxy(e,o),revoke:function(){r=!0}}}var p=function t(){e(this,t);var n={};this.addEventListener=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e in n||(n[e]=[]),n[e].push({callback:t,options:r})},this.removeEventListener=function(e,t){if(Object.keys(n).includes(e)){for(var r=n[e],o=-1,i=0;i<r.length;i++)if(r[i].callback===t){o=i;break}o<0||(r.splice(o,1),0===Object.keys(r).length&&delete n[e])}},this.removeEventListeners=function(e){e&&delete n[e]},this.removeAllEventListeners=function(){n={}},this.dispatchEvent=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n[e])for(var o=n[e],a=0;a<o.length;a++){var u=r&&r.reverse?o[o.length-(a+1)]:o[a];u.options&&u.options.once&&o.splice(a,1),u.callback.apply(u,i(t))}}},y=function(o){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(l,o);var a,u,c=(a=l,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=t(a);if(u){var o=t(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return r(this,e)});function l(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,l),t=c.call(this),n=Object.assign({delete:!0,get:!0,set:!0},n);var r=new WeakMap;return t.add=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(r.has(e))return r.get(e);for(var a in e)e[a]&&"object"==typeof e[a]&&(e[a]=t.add(e[a],[].concat(i(o),[a])));var u={};n.delete&&(u.deleteProperty=function(e,n){if(!Reflect.has(e,n))return!0;t.remove(e,n);var r=Reflect.deleteProperty(e,n);return r&&t.dispatchEvent("delete",[e,Array.isArray(e)?i(o):[].concat(i(o),[n])]),r}),n.get&&(u.get=function(e,n,r){return n!==Symbol.unscopables&&t.dispatchEvent("get",[e,[].concat(i(o),[n]),r]),Reflect.get(e,n,r)}),n.set&&(u.set=function(e,n,r,a){return e[n]===r||("object"==typeof r&&(r=t.add(r,[].concat(i(o),[n]))),e[n]=r,t.dispatchEvent("set",[e,Array.isArray(e)?i(o):[].concat(i(o),[n]),r,a])),!0});var c=d(e,u);return r.set(c,e),c.proxy},t.remove=function(e){if(r.has(e)){var n=r.get(e);for(var o in r.delete(n),n.proxy)"object"==typeof n.proxy[o]&&t.remove(n.proxy[o]);n.revoke()}},t}return l}(p),v=function t(n,r){e(this,t),n=Object.assign({stepMinimum:0},n);var o,i=Symbol(),a=!1,u=new y({delete:!1,set:!1}),c=u.add({}),l=function e(t){if(a){if(o=window.requestAnimationFrame(e),!c.startMs)return c.currentMs=c.lastMs=c.startMs=t,c.current=c.last=c.start=t/1e3,void(c.delta=c.passed=c.deltaMs=c.passedMs=0);var i=t-c.lastMs;i<=n.stepMinimum||(c.lastMs=c.currentMs,c.last=c.current,c.currentMs=t,c.current=t/1e3,c.deltaMs=i,c.delta=i/1e3,c.passedMs+=i,c.passed=c.passedMs/1e3,r())}};this.isEnabled=function(){return a},this.getId=function(){return i},this.getProxy=function(){return u},this.getTime=function(){return c},this.enable=function(){a||(a=!0,o=window.requestAnimationFrame(l))},this.disable=function(){a&&(a=!1,o&&(cancelAnimationFrame(o),o=null))}};return function t(n){var r,i,a,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(this,t),u=Object.assign({},u),n.addEventListener("enabling",(function(){var e=o(s(u),2),t=e[0],c=e[1];i=t,n.addDirectives(-1,i),a=new v(u,(function(){c(),n.update([{id:a.getId(),path:"current"},{id:a.getId(),path:"delta"},{id:a.getId(),path:"last"},{id:a.getId(),path:"passed"}])})),r=l(a),n.addContexts(0,r),a.enable()})),n.addEventListener("disabling",(function(){n.removeContexts(r),n.removeDirectives(i),a.disable(),r=null,i=null,a=null}))}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).DoarsUpdate=factory();
