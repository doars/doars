var v=l=>{let s=l.getId(),r=l.getProxy(),i=l.getTime();return{name:"$update",create:(t,n)=>{let d=(e,o)=>n.accessed(s,o.join("."));return r.addEventListener("get",d),{value:i,destroy:()=>{r.removeEventListener("get",d)}}}}};var m=l=>{l=Object.assign({defaultOrder:500},l);let s=[],r=[],i={name:"update",update:function(t,n,{processExpression:d}){this._execute||(this._execute=d);let e=n.getId();if(s.indexOf(e)>=0)return;let{order:o}=n.getModifiers();o||(o=l.defaultOrder);let c=0;for(let a=0;a<r.length;a++)if(r[a].order>=o){c=a;break}r.splice(c,0,{attribute:n,component:t,order:o})},destroy:(t,n)=>{let d=n.getId(),e=s.indexOf(d);if(!(e>=0)){s.splice(e,1);for(let o=0;o<r.length;o++)if(r[o].attribute===n){r.splice(o,1);break}}}};return[i,()=>{for(let t of r)i._execute(t.component,t.attribute.clone(),t.attribute.getValue(),{},{return:!1})}]};var g=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],h=(l,s)=>{let r=!1,i={};for(let t of g)i[t]=(...n)=>{if(r){console.error("illegal operation attempted on a revoked proxy");return}return t in s?s[t](...n):Reflect[t](...n)};return{proxy:new Proxy(l,i),revoke:()=>{r=!0}}};var u=class{constructor(){let s={};this.addEventListener=(r,i,t=null)=>{r in s||(s[r]=[]),s[r].push({callback:i,options:t})},this.removeEventListener=(r,i)=>{if(!Object.keys(s).includes(r))return;let t=s[r],n=-1;for(let d=0;d<t.length;d++)if(t[d].callback===i){n=d;break}n<0||(t.splice(n,1),Object.keys(t).length===0&&delete s[r])},this.removeEventListeners=r=>{!r||delete s[r]},this.removeAllEventListeners=()=>{s={}},this.dispatchEvent=(r,i,t=null)=>{if(!s[r])return;let n=s[r];for(let d=0;d<n.length;d++){let e=t&&t.reverse?n[n.length-(d+1)]:n[d];e.options&&e.options.once&&n.splice(d,1),e.callback(...i)}}}},x=u;var p=class extends x{constructor(s={}){super(),s=Object.assign({delete:!0,get:!0,set:!0},s);let r=new WeakMap;this.add=(i,t=[])=>{if(r.has(i))return r.get(i);for(let e in i)i[e]&&typeof i[e]=="object"&&(i[e]=this.add(i[e],[...t,e]));let n={};s.delete&&(n.deleteProperty=(e,o)=>{if(!Reflect.has(e,o))return!0;this.remove(e,o);let c=Reflect.deleteProperty(e,o);return c&&this.dispatchEvent("delete",[e,Array.isArray(e)?[...t]:[...t,o]]),c}),s.get&&(n.get=(e,o,c)=>(o!==Symbol.unscopables&&this.dispatchEvent("get",[e,[...t,o],c]),Reflect.get(e,o,c))),s.set&&(n.set=(e,o,c,a)=>(e[o]===c||(c&&typeof c=="object"&&(c=this.add(c,[...t,o])),e[o]=c,this.dispatchEvent("set",[e,Array.isArray(e)?[...t]:[...t,o],c,a])),!0));let d=h(i,n);return r.set(d,i),d.proxy},this.remove=i=>{if(!r.has(i))return;let t=r.get(i);r.delete(t);for(let n in t.proxy)typeof t.proxy[n]=="object"&&this.remove(t.proxy[n]);t.revoke()}}},b=p;var f=class{constructor(s,r){s=Object.assign({stepMinimum:0},s);let i=Symbol("ID_UPDATE"),t=!1,n,d=new b({delete:!1,set:!1}),e=d.add({}),o=c=>{if(!t)return;if(n=window.requestAnimationFrame(o),!e.startMs){e.currentMs=e.lastMs=e.startMs=c,e.current=e.last=e.start=c/1e3,e.delta=e.passed=e.deltaMs=e.passedMs=0;return}let a=c-e.lastMs;a<=s.stepMinimum||(e.lastMs=e.currentMs,e.last=e.current,e.currentMs=c,e.current=c/1e3,e.deltaMs=a,e.delta=a/1e3,e.passedMs+=a,e.passed=e.passedMs/1e3,r())};this.isEnabled=()=>t,this.getId=()=>i,this.getProxy=()=>d,this.getTime=()=>e,this.enable=()=>{t||(t=!0,n=window.requestAnimationFrame(o))},this.disable=()=>{!t||(t=!1,n&&(cancelAnimationFrame(n),n=null))}}};function U(l,s=null){s=Object.assign({},s);let r=!1,i,t,n,d=function(){let[o,c]=m(s);t=o,l.addDirectives(-1,t),n=new f(s,()=>{c(),l.update([{id:n.getId(),path:"current"},{id:n.getId(),path:"delta"},{id:n.getId(),path:"last"},{id:n.getId(),path:"passed"}])}),i=v(n),l.addContexts(0,i),n.enable()},e=function(){l.removeContexts(i),l.removeDirectives(t),n.disable(),i=null,t=null,n=null};this.disable=function(){!l.getEnabled()&&r&&(r=!1,l.removeEventListener("enabling",d),l.removeEventListener("disabling",e))},this.enable=function(){r||(r=!0,l.addEventListener("enabling",d),l.addEventListener("disabling",e))},this.enable()}export{U as default};
//# sourceMappingURL=doars-update.esm.min.js.map
