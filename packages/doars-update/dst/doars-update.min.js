var v=l=>{let i=l.getId(),s=l.getProxy(),n=l.getTime();return{name:"$update",create:(t,r)=>{let d=(e,o)=>r.accessed(i,o.join("."));return s.addEventListener("get",d),{value:n,destroy:()=>{s.removeEventListener("get",d)}}}}};var m=l=>{l=Object.assign({defaultOrder:500},l);let i=[],s=[],n={name:"update",update:(t,r,{processExpression:d})=>{n._execute||(n._execute=d);let e=r.getId();if(i.indexOf(e)>=0)return;let{order:o}=r.getModifiers();o||(o=l.defaultOrder);let c=0;for(let a=0;a<s.length;a++)if(s[a].order>=o){c=a;break}s.splice(c,0,{attribute:r,component:t,order:o})},destroy:(t,r)=>{let d=r.getId(),e=i.indexOf(d);if(!(e>=0)){i.splice(e,1);for(let o=0;o<s.length;o++)if(s[o].attribute===r){s.splice(o,1);break}}}};return[n,()=>{for(let t of s)n._execute(t.component,t.attribute.clone(),t.attribute.getValue(),{},{return:!1})}]};var x=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],h=(l,i)=>{let s=!1,n={};for(let t of x)n[t]=(...r)=>{if(!s)return t in i?i[t](...r):Reflect[t](...r)};return{proxy:new Proxy(l,n),revoke:()=>{s=!0}}};var f=class{constructor(){let i={};this.addEventListener=(s,n,t=null)=>{s in i||(i[s]=[]),i[s].push({callback:n,options:t})},this.removeEventListener=(s,n)=>{if(!Object.keys(i).includes(s))return;let t=i[s],r=-1;for(let d=0;d<t.length;d++)if(t[d].callback===n){r=d;break}r<0||(t.splice(r,1),Object.keys(t).length===0&&delete i[s])},this.removeEventListeners=s=>{s&&delete i[s]},this.removeAllEventListeners=()=>{i={}},this.dispatchEvent=(s,n,t=null)=>{if(!i[s])return;let r=i[s];for(let d=0;d<r.length;d++){let e=t&&t.reverse?r[r.length-(d+1)]:r[d];e.options&&e.options.once&&r.splice(d,1),e.callback(...n)}}}};var u=class extends f{constructor(i={}){super(),i=Object.assign({delete:!0,get:!0,set:!0},i);let s=new WeakMap;this.add=(n,t=[])=>{if(s.has(n))return s.get(n);for(let e in n)n[e]&&typeof n[e]=="object"&&(n[e]=this.add(n[e],[...t,e]));let r={};i.delete&&(r.deleteProperty=(e,o)=>{if(!Reflect.has(e,o))return!0;this.remove(e,o);let c=Reflect.deleteProperty(e,o);return c&&this.dispatchEvent("delete",[e,Array.isArray(e)?[...t]:[...t,o]]),c}),i.get&&(r.get=(e,o,c)=>(o!==Symbol.unscopables&&this.dispatchEvent("get",[e,[...t,o],c]),Reflect.get(e,o,c))),i.set&&(r.set=(e,o,c,a)=>(e[o]===c||(c&&typeof c=="object"&&(c=this.add(c,[...t,o])),e[o]=c,this.dispatchEvent("set",[e,Array.isArray(e)?[...t]:[...t,o],c,a])),!0));let d=h(n,r);return s.set(d,n),d.proxy},this.remove=n=>{if(!s.has(n))return;let t=s.get(n);s.delete(t);for(let r in t.proxy)typeof t.proxy[r]=="object"&&this.remove(t.proxy[r]);t.revoke()}}};var p=class{constructor(i,s){i=Object.assign({stepMinimum:0},i);let n=Symbol("ID_UPDATE"),t=!1,r,d=new u({delete:!1,set:!1}),e=d.add({}),o=c=>{if(!t)return;if(r=window.requestAnimationFrame(o),!e.startMs){e.currentMs=e.lastMs=e.startMs=c,e.current=e.last=e.start=c/1e3,e.delta=e.passed=e.deltaMs=e.passedMs=0;return}let a=c-e.lastMs;a<=i.stepMinimum||(e.lastMs=e.currentMs,e.last=e.current,e.currentMs=c,e.current=c/1e3,e.deltaMs=a,e.delta=a/1e3,e.passedMs+=a,e.passed=e.passedMs/1e3,s())};this.isEnabled=()=>t,this.getId=()=>n,this.getProxy=()=>d,this.getTime=()=>e,this.enable=()=>{t||(t=!0,r=window.requestAnimationFrame(o))},this.disable=()=>{t&&(t=!1,r&&(cancelAnimationFrame(r),r=null))}}};function k(l,i=null){i=Object.assign({},i);let s=!1,n,t,r,d=()=>{let[o,c]=m(i);t=o,l.addDirectives(-1,t),r=new p(i,()=>{c(),l.update([{id:r.getId(),path:"current"},{id:r.getId(),path:"delta"},{id:r.getId(),path:"last"},{id:r.getId(),path:"passed"}])}),n=v(r),l.addContexts(0,n),r.enable()},e=()=>{l.removeContexts(n),l.removeDirectives(t),r.disable(),n=null,t=null,r=null};this.disable=()=>{!l.getEnabled()&&s&&(s=!1,l.removeEventListener("enabling",d),l.removeEventListener("disabling",e))},this.enable=()=>{s||(s=!0,l.addEventListener("enabling",d),l.addEventListener("disabling",e))},this.enable()}export{k as default};
//# sourceMappingURL=doars-update.min.js.map
