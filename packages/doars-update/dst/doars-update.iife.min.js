(()=>{var v=l=>{let n=l.getId(),s=l.getProxy(),i=l.getTime();return{name:"$update",create:(t,r)=>{let d=(e,o)=>r.accessed(n,o.join("."));return s.addEventListener("get",d),{value:i,destroy:()=>{s.removeEventListener("get",d)}}}}};var h=l=>{l=Object.assign({defaultOrder:500},l);let n=[],s=[],i={name:"update",update:function(t,r,{processExpression:d}){this._execute||(this._execute=d);let e=r.getId();if(n.indexOf(e)>=0)return;let{order:o}=r.getModifiers();o||(o=l.defaultOrder);let c=0;for(let a=0;a<s.length;a++)if(s[a].order>=o){c=a;break}s.splice(c,0,{attribute:r,component:t,order:o})},destroy:(t,r)=>{let d=r.getId(),e=n.indexOf(d);if(!(e>=0)){n.splice(e,1);for(let o=0;o<s.length;o++)if(s[o].attribute===r){s.splice(o,1);break}}}};return[i,()=>{for(let t of s)i._execute(t.component,t.attribute.clone(),t.attribute.getValue(),{},{return:!1})}]};var b=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],x=(l,n)=>{let s=!1,i={};for(let t of b)i[t]=(...r)=>{if(s){console.error("illegal operation attempted on a revoked proxy");return}return t in n?n[t](...r):Reflect[t](...r)};return{proxy:new Proxy(l,i),revoke:()=>{s=!0}}};var u=class{constructor(){let n={};this.addEventListener=(s,i,t=null)=>{s in n||(n[s]=[]),n[s].push({callback:i,options:t})},this.removeEventListener=(s,i)=>{if(!Object.keys(n).includes(s))return;let t=n[s],r=-1;for(let d=0;d<t.length;d++)if(t[d].callback===i){r=d;break}r<0||(t.splice(r,1),Object.keys(t).length===0&&delete n[s])},this.removeEventListeners=s=>{!s||delete n[s]},this.removeAllEventListeners=()=>{n={}},this.dispatchEvent=(s,i,t=null)=>{if(!n[s])return;let r=n[s];for(let d=0;d<r.length;d++){let e=t&&t.reverse?r[r.length-(d+1)]:r[d];e.options&&e.options.once&&r.splice(d,1),e.callback(...i)}}}},g=u;var p=class extends g{constructor(n={}){super(),n=Object.assign({delete:!0,get:!0,set:!0},n);let s=new WeakMap;this.add=(i,t=[])=>{if(s.has(i))return s.get(i);for(let e in i)i[e]&&typeof i[e]=="object"&&(i[e]=this.add(i[e],[...t,e]));let r={};n.delete&&(r.deleteProperty=(e,o)=>{if(!Reflect.has(e,o))return!0;this.remove(e,o);let c=Reflect.deleteProperty(e,o);return c&&this.dispatchEvent("delete",[e,Array.isArray(e)?[...t]:[...t,o]]),c}),n.get&&(r.get=(e,o,c)=>(o!==Symbol.unscopables&&this.dispatchEvent("get",[e,[...t,o],c]),Reflect.get(e,o,c))),n.set&&(r.set=(e,o,c,a)=>(e[o]===c||(typeof c=="object"&&(c=this.add(c,[...t,o])),e[o]=c,this.dispatchEvent("set",[e,Array.isArray(e)?[...t]:[...t,o],c,a])),!0));let d=x(i,r);return s.set(d,i),d.proxy},this.remove=i=>{if(!s.has(i))return;let t=s.get(i);s.delete(t);for(let r in t.proxy)typeof t.proxy[r]=="object"&&this.remove(t.proxy[r]);t.revoke()}}},y=p;var f=class{constructor(n,s){n=Object.assign({stepMinimum:0},n);let i=Symbol("ID_UPDATE"),t=!1,r,d=new y({delete:!1,set:!1}),e=d.add({}),o=c=>{if(!t)return;if(r=window.requestAnimationFrame(o),!e.startMs){e.currentMs=e.lastMs=e.startMs=c,e.current=e.last=e.start=c/1e3,e.delta=e.passed=e.deltaMs=e.passedMs=0;return}let a=c-e.lastMs;a<=n.stepMinimum||(e.lastMs=e.currentMs,e.last=e.current,e.currentMs=c,e.current=c/1e3,e.deltaMs=a,e.delta=a/1e3,e.passedMs+=a,e.passed=e.passedMs/1e3,s())};this.isEnabled=()=>t,this.getId=()=>i,this.getProxy=()=>d,this.getTime=()=>e,this.enable=()=>{t||(t=!0,r=window.requestAnimationFrame(o))},this.disable=()=>{!t||(t=!1,r&&(cancelAnimationFrame(r),r=null))}}};var m=class{constructor(n,s=null){s=Object.assign({},s);let i,t,r;n.addEventListener("enabling",()=>{let[d,e]=h(s);t=d,n.addDirectives(-1,t),r=new f(s,()=>{e(),n.update([{id:r.getId(),path:"current"},{id:r.getId(),path:"delta"},{id:r.getId(),path:"last"},{id:r.getId(),path:"passed"}])}),i=v(r),n.addContexts(0,i),r.enable()}),n.addEventListener("disabling",()=>{n.removeContexts(i),n.removeDirectives(t),r.disable(),i=null,t=null,r=null})}};})();
//# sourceMappingURL=doars-update.iife.min.js.map
