(()=>{var m=c=>{let s=c.getId(),n=c.getProxy(),i=c.getTime();return{name:"$update",create:(t,r)=>{let d=(e,o)=>r.accessed(s,o.join("."));return n.addEventListener("get",d),{value:i,destroy:()=>{n.removeEventListener("get",d)}}}}};var v=c=>{c=Object.assign({defaultOrder:500},c);let s=[],n=[],i={name:"update",update:function(t,r,{processExpression:d}){this._execute||(this._execute=d);let e=r.getId();if(s.indexOf(e)>=0)return;let{order:o}=r.getModifiers();o||(o=c.defaultOrder);let l=0;for(let a=0;a<n.length;a++)if(n[a].order>=o){l=a;break}n.splice(l,0,{attribute:r,component:t,order:o})},destroy:(t,r)=>{let d=r.getId(),e=s.indexOf(d);if(!(e>=0)){s.splice(e,1);for(let o=0;o<n.length;o++)if(n[o].attribute===r){n.splice(o,1);break}}}};return[i,()=>{for(let t of n)i._execute(t.component,t.attribute.clone(),t.attribute.getValue(),{},{return:!1})}]};var E=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],h=(c,s)=>{let n=!1,i={};for(let t of E)i[t]=(...r)=>{if(n){console.error("illegal operation attempted on a revoked proxy");return}return t in s?s[t](...r):Reflect[t](...r)};return{proxy:new Proxy(c,i),revoke:()=>{n=!0}}};var u=class{constructor(){let s={};this.addEventListener=(n,i,t=null)=>{n in s||(s[n]=[]),s[n].push({callback:i,options:t})},this.removeEventListener=(n,i)=>{if(!Object.keys(s).includes(n))return;let t=s[n],r=-1;for(let d=0;d<t.length;d++)if(t[d].callback===i){r=d;break}r<0||(t.splice(r,1),Object.keys(t).length===0&&delete s[n])},this.removeEventListeners=n=>{!n||delete s[n]},this.removeAllEventListeners=()=>{s={}},this.dispatchEvent=(n,i,t=null)=>{if(!s[n])return;let r=s[n];for(let d=0;d<r.length;d++){let e=t&&t.reverse?r[r.length-(d+1)]:r[d];e.options&&e.options.once&&r.splice(d,1),e.callback(...i)}}}},x=u;var p=class extends x{constructor(s={}){super(),s=Object.assign({delete:!0,get:!0,set:!0},s);let n=new WeakMap;this.add=(i,t=[])=>{if(n.has(i))return n.get(i);for(let e in i)i[e]&&typeof i[e]=="object"&&(i[e]=this.add(i[e],[...t,e]));let r={};s.delete&&(r.deleteProperty=(e,o)=>{if(!Reflect.has(e,o))return!0;this.remove(e,o);let l=Reflect.deleteProperty(e,o);return l&&this.dispatchEvent("delete",[e,Array.isArray(e)?[...t]:[...t,o]]),l}),s.get&&(r.get=(e,o,l)=>(o!==Symbol.unscopables&&this.dispatchEvent("get",[e,[...t,o],l]),Reflect.get(e,o,l))),s.set&&(r.set=(e,o,l,a)=>(e[o]===l||(typeof l=="object"&&(l=this.add(l,[...t,o])),e[o]=l,this.dispatchEvent("set",[e,Array.isArray(e)?[...t]:[...t,o],l,a])),!0));let d=h(i,r);return n.set(d,i),d.proxy},this.remove=i=>{if(!n.has(i))return;let t=n.get(i);n.delete(t);for(let r in t.proxy)typeof t.proxy[r]=="object"&&this.remove(t.proxy[r]);t.revoke()}}},b=p;var f=class{constructor(s,n){s=Object.assign({stepMinimum:0},s);let i=Symbol("ID_UPDATE"),t=!1,r,d=new b({delete:!1,set:!1}),e=d.add({}),o=l=>{if(!t)return;if(r=window.requestAnimationFrame(o),!e.startMs){e.currentMs=e.lastMs=e.startMs=l,e.current=e.last=e.start=l/1e3,e.delta=e.passed=e.deltaMs=e.passedMs=0;return}let a=l-e.lastMs;a<=s.stepMinimum||(e.lastMs=e.currentMs,e.last=e.current,e.currentMs=l,e.current=l/1e3,e.deltaMs=a,e.delta=a/1e3,e.passedMs+=a,e.passed=e.passedMs/1e3,n())};this.isEnabled=()=>t,this.getId=()=>i,this.getProxy=()=>d,this.getTime=()=>e,this.enable=()=>{t||(t=!0,r=window.requestAnimationFrame(o))},this.disable=()=>{!t||(t=!1,r&&(cancelAnimationFrame(r),r=null))}}};function g(c,s=null){s=Object.assign({},s);let n=!1,i,t,r,d=function(){let[o,l]=v(s);t=o,c.addDirectives(-1,t),r=new f(s,()=>{l(),c.update([{id:r.getId(),path:"current"},{id:r.getId(),path:"delta"},{id:r.getId(),path:"last"},{id:r.getId(),path:"passed"}])}),i=m(r),c.addContexts(0,i),r.enable()},e=function(){c.removeContexts(i),c.removeDirectives(t),r.disable(),i=null,t=null,r=null};this.disable=function(){!c.getEnabled()&&n&&(n=!1,c.removeEventListener("enabling",d),c.removeEventListener("disabling",e))},this.enable=function(){n||(n=!0,c.addEventListener("enabling",d),c.addEventListener("disabling",e))},this.enable()}window.DoarsUpdate=g;})();
//# sourceMappingURL=doars-update.iife.min.js.map
