(()=>{var v=({updateContextName:l},i)=>{let n=i.getId(),r=i.getProxy(),t=i.getTime();return{name:l,create:(s,d)=>{let e=(c,o)=>d.accessed(n,o.join("."));return r.addEventListener("get",e),{value:t,destroy:()=>{r.removeEventListener("get",e)}}}}};var h=({defaultOrder:l,updateDirectiveName:i})=>{let n=[],r=[],t={name:i,update:(s,d,e)=>{t._execute||(t._execute=e);let c=d.getId();if(n.indexOf(c)>=0)return;let{order:o}=d.getModifiers();o||(o=l);let a=0;for(let m=0;m<r.length;m++)if(r[m].order>=o){a=m;break}r.splice(a,0,{attribute:d,component:s,order:o})},destroy:(s,d)=>{let e=d.getId(),c=n.indexOf(e);if(!(c>=0)){n.splice(c,1);for(let o=0;o<r.length;o++)if(r[o].attribute===d){r.splice(o,1);break}}}};return[t,()=>{for(let s of r)t._execute(s.component,s.attribute.clone(),s.attribute.getValue(),{},{return:!1})}]};var g=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","has","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],x=(l,i)=>{let n=!1,r={};for(let t of g)r[t]=(...s)=>{if(!n)return t in i?i[t](...s):Reflect[t](...s)};return{proxy:new Proxy(l,r),revoke:()=>{n=!0}}};var f=class{constructor(){let i={};this.addEventListener=(n,r,t=null)=>{n in i||(i[n]=[]),i[n].push({callback:r,options:t})},this.removeEventListener=(n,r)=>{if(!Object.keys(i).includes(n))return;let t=i[n],s=-1;for(let d=0;d<t.length;d++)if(t[d].callback===r){s=d;break}s<0||(t.splice(s,1),Object.keys(t).length===0&&delete i[n])},this.removeEventListeners=n=>{n&&delete i[n]},this.removeAllEventListeners=()=>{i={}},this.dispatchEvent=(n,r,t=null)=>{if(!i[n])return;let s=i[n];for(let d=0;d<s.length;d++){let e=t&&t.reverse?s[s.length-(d+1)]:s[d];e.options&&e.options.once&&s.splice(d,1),e.callback(...r)}}}};var u=class extends f{constructor(i={}){super(),i=Object.assign({delete:!0,get:!0,set:!0},i);let n=new WeakMap;this.add=(r,t=[])=>{if(n.has(r))return n.get(r);for(let e in r)r[e]&&typeof r[e]=="object"&&(r[e]=this.add(r[e],[...t,e]));let s={};i.delete&&(s.deleteProperty=(e,c)=>{if(!Reflect.has(e,c))return!0;this.remove(e,c);let o=Reflect.deleteProperty(e,c);return o&&this.dispatchEvent("delete",[e,Array.isArray(e)?[...t]:[...t,c]]),o}),i.get&&(s.get=(e,c,o)=>(c!==Symbol.unscopables&&this.dispatchEvent("get",[e,[...t,c],o]),Reflect.get(e,c,o))),i.set&&(s.set=(e,c,o,a)=>(e[c]===o||(o&&typeof o=="object"&&(o=this.add(o,[...t,c])),e[c]=o,this.dispatchEvent("set",[e,Array.isArray(e)?[...t]:[...t,c],o,a])),!0));let d=x(r,s);return n.set(d,r),d.proxy},this.remove=r=>{if(!n.has(r))return;let t=n.get(r);n.delete(t);for(let s in t.proxy)typeof t.proxy[s]=="object"&&this.remove(t.proxy[s]);t.revoke()}}};var p=class{constructor({stepMinimum:i},n){let r=Symbol("ID_UPDATE"),t=!1,s,d=new u({delete:!1,set:!1}),e=d.add({}),c=o=>{if(!t)return;if(s=window.requestAnimationFrame(c),!e.startMs){e.currentMs=e.lastMs=e.startMs=o,e.current=e.last=e.start=o/1e3,e.delta=e.passed=e.deltaMs=e.passedMs=0;return}let a=o-e.lastMs;a<=i||(e.lastMs=e.currentMs,e.last=e.current,e.currentMs=o,e.current=o/1e3,e.deltaMs=a,e.delta=a/1e3,e.passedMs+=a,e.passed=e.passedMs/1e3,n())};this.isEnabled=()=>t,this.getId=()=>r,this.getProxy=()=>d,this.getTime=()=>e,this.enable=()=>{t||(t=!0,s=window.requestAnimationFrame(c))},this.disable=()=>{t&&(t=!1,s&&(cancelAnimationFrame(s),s=null))}}};function b(l,i=null){i=Object.assign({defaultOrder:500,stepMinimum:0,updateContextName:"$update",updateDirectiveName:"update"},i);let n=!1,r=new p(i,()=>{d(),l.update([{id:r.getId(),path:"current"},{id:r.getId(),path:"delta"},{id:r.getId(),path:"last"},{id:r.getId(),path:"passed"}])}),t=v(i,r),[s,d]=h(i),e=()=>{l.addContexts(0,t),l.addDirectives(-1,s),r.enable()},c=()=>{l.removeContexts(t),l.removeDirectives(s),r.disable()};this.disable=()=>{!l.getEnabled()&&n&&(n=!1,l.removeEventListener("enabling",e),l.removeEventListener("disabling",c))},this.enable=()=>{n||(n=!0,l.addEventListener("enabling",e),l.addEventListener("disabling",c))},this.enable()}window.DoarsUpdate=b;})();
//# sourceMappingURL=doars-update.iife.min.js.map
