{"version":3,"file":"doars-store.umd.js","sources":["../src/factories/contexts/store.js","../../utils/src/polyfills/RevocableProxy.js","../../utils/src/events/EventDispatcher.js","../../utils/src/events/ProxyDispatcher.js","../../utils/src/ObjectUtils.js","../src/DoarsStore.js"],"sourcesContent":["export default (options, id, store, proxy) => {\n  return {\n    deconstruct: !!options.deconstruct,\n\n    name: '$store',\n\n    create: (component, attribute, update, { RevocableProxy }) => {\n      // Create event handlers.\n      const onDelete = (target, path) => update(id, path.join('.'))\n      const onGet = (target, path) => attribute.accessed(id, path.join('.'))\n      const onSet = (target, path) => update(id, path.join('.'))\n\n      // Add event listeners.\n      proxy.addEventListener('delete', onDelete)\n      proxy.addEventListener('get', onGet)\n      proxy.addEventListener('set', onSet)\n\n      // Wrap in a revocable proxy.\n      const revocable = RevocableProxy(store, {})\n\n      return {\n        value: revocable.proxy,\n\n        // Remove event listeners.\n        destroy: () => {\n          proxy.removeEventListener('delete', onDelete)\n          proxy.removeEventListener('get', onGet)\n          proxy.removeEventListener('set', onSet)\n\n          // Revoke access to store.\n          revocable.revoke()\n        },\n      }\n    },\n  }\n}\n","// List of methods to revoke access to.\nconst REFLECTION_METHODS = [\n  'apply',\n  'construct',\n  'defineProperty',\n  'deleteProperty',\n  'get',\n  'getOwnPropertyDescriptor',\n  'getPrototypeOf',\n  'isExtensible',\n  'ownKeys',\n  'preventExtensions',\n  'set',\n  'setPrototypeOf',\n]\n\n/**\n * Revocable proxy made using regular a proxy and a simple boolean.\n */\nexport default (target, handler) => {\n  // Keep track of status.\n  let revoked = false\n\n  // Add revocable handlers for each given handlers.\n  const revocableHandler = {}\n  for (const key of REFLECTION_METHODS) {\n    revocableHandler[key] = (...parameters) => {\n      if (revoked) {\n        console.error('illegal operation attempted on a revoked proxy')\n        return\n      }\n\n      if (key in handler) {\n        return handler[key](...parameters)\n      }\n      return Reflect[key](...parameters)\n    }\n  }\n\n  // Return proxy and revoke method.\n  return {\n    proxy: new Proxy(target, revocableHandler),\n    revoke: () => {\n      revoked = true\n    },\n  }\n}\n","class EventDispatcher {\n  /**\n   * Create instance.\n   */\n  constructor() {\n    let events = {}\n\n    /**\n     * Add callback to event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function to call on dispatch.\n     * @param {Object} options Callback options.\n     */\n    this.addEventListener = (name, callback, options = null) => {\n      // Check if event name exits and callback is not already present.\n      if (!(name in events)) {\n        events[name] = []\n      }\n\n      // Add to events.\n      events[name].push({\n        callback: callback,\n        options: options,\n      })\n    }\n\n    /**\n     * Remove callback from event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function that would be called.\n     */\n    this.removeEventListener = (name, callback) => {\n      // Check if event exists.\n      if (!Object.keys(events).includes(name)) {\n        return\n      }\n      const eventData = events[name]\n\n      // Get index of callback in events.\n      let index = -1\n      for (let i = 0; i < eventData.length; i++) {\n        if (eventData[i].callback === callback) {\n          index = i\n          break\n        }\n      }\n      if (index < 0) {\n        return\n      }\n\n      // Remove item from events.\n      eventData.splice(index, 1)\n\n      // Remove event if list is empty.\n      if (Object.keys(eventData).length === 0) {\n        delete events[name]\n      }\n    }\n\n    /**\n     * Remove listeners to an event.\n     * @param {String} name Event name.\n     */\n    this.removeEventListeners = (name) => {\n      if (!name) {\n        return\n      }\n\n      // Remove all handlers with the event name.\n      delete events[name]\n    }\n\n    /**\n     * Remove all listeners.\n     * @param {String} name Event name.\n     */\n    this.removeAllEventListeners = () => {\n      // Remove all listeners.\n      events = {}\n    }\n\n    /**\n     * Trigger event and dispatch data to listeners.\n     * @param {String} name Event name.\n     * @param {Array<Any>} parameters Event parameters to pass through.\n     * @param {Object} options Dispatch options.\n     */\n    this.dispatchEvent = (name, parameters, options = null) => {\n      // Check if event exists.\n      if (!events[name]) {\n        return\n      }\n      // Get events by trigger name.\n      const eventData = events[name]\n\n      // Dispatch a call to each event.\n      for (let i = 0; i < eventData.length; i++) {\n        const event = (options && options.reverse) ? eventData[eventData.length - (i + 1)] : eventData[i]\n\n        // If once is truthy then remove the callback.\n        if (event.options && event.options.once) {\n          eventData.splice(i, 1)\n        }\n\n        // Execute callback.\n        event.callback(...parameters)\n      }\n    }\n  }\n}\n\nexport default EventDispatcher\n","// Import polyfill.\nimport RevocableProxy from '../polyfills/RevocableProxy.js'\n\n// Import event dispatcher.\nimport EventDispatcher from './EventDispatcher.js'\n\nclass ProxyDispatcher extends EventDispatcher {\n  constructor(options = {}) {\n    super()\n\n    options = Object.assign({\n      delete: true,\n      get: true,\n      set: true,\n    }, options)\n\n    // Setup WeakMap for keep track of created proxies.\n    const map = new WeakMap()\n\n    /**\n     * Add object to start keeping track of it.\n     * @param {Object} target Object that is being kept track of.\n     * @param {Array<String>} path Path of object on optional parent object, used for recursion.\n     * @returns {Proxy} Object to access and mutate.\n     */\n    this.add = (target, path = []) => {\n      // Exit early if proxy already exists.\n      if (map.has(target)) {\n        return map.get(target)\n      }\n\n      // Recursively create proxies for each property.\n      for (const key in target) {\n        if (target[key] && typeof (target[key]) === 'object') {\n          target[key] = this.add(target[key], [...path, key])\n        }\n      }\n\n      // Create handler and add the handler for which a callback exits..\n      const handler = {}\n\n      if (options.delete) {\n        handler.deleteProperty = (target, key) => {\n          // Exit early successful if property doesn't exist.\n          if (!Reflect.has(target, key)) {\n            return true\n          }\n\n          // Remove proxy.\n          this.remove(target, key)\n\n          // Delete property.\n          const deleted = Reflect.deleteProperty(target, key)\n\n          // Dispatch delete event.\n          if (deleted) {\n            this.dispatchEvent('delete', [target, Array.isArray(target) ? [...path] : [...path, key]])\n          }\n\n          // Return deleted.\n          return deleted\n        }\n      }\n\n      if (options.get) {\n        handler.get = (target, key, receiver) => {\n          // Dispatch get event.\n          if (key !== Symbol.unscopables) {\n            this.dispatchEvent('get', [target, [...path, key], receiver])\n          }\n\n          // Return value from object.\n          return Reflect.get(target, key, receiver)\n        }\n      }\n\n      if (options.set) {\n        handler.set = (target, key, value, receiver) => {\n          // Exit early if not changed.\n          if (target[key] === value) {\n            return true\n          }\n\n          // Add proxy if value is an object.\n          if (typeof value === 'object') {\n            value = this.add(value, [...path, key])\n          }\n          // Store value.\n          target[key] = value\n\n          // Dispatch set event. If the target is an array and a new item has been pushed then the length has also changed, therefore a more generalizable path will be dispatched.\n          this.dispatchEvent('set', [target, Array.isArray(target) ? [...path] : [...path, key], value, receiver])\n\n          // Return success.\n          return true\n        }\n      }\n\n      // Create proxy.\n      const revocable = RevocableProxy(target, handler)\n\n      // Store target at proxy.\n      map.set(revocable, target)\n\n      // Return proxy.\n      return revocable.proxy\n    }\n\n    /**\n     * Remove object from being kept track of.\n     * @param {Object} target Object that is being kept track of.\n     */\n    this.remove = (target) => {\n      // Remove target from the map.\n      if (!map.has(target)) {\n        return\n      }\n\n      const revocable = map.get(target)\n      map.delete(revocable)\n\n      // Recursively remove properties as well.\n      for (const property in revocable.proxy) {\n        if (typeof (revocable.proxy[property]) === 'object') {\n          this.remove(revocable.proxy[property])\n        }\n      }\n\n      // Revoke proxy.\n      revocable.revoke()\n    }\n  }\n}\n\nexport default ProxyDispatcher\n","/**\n * Deeply assign a series of objects properties together.\n * @param {Object} target Target object to merge to.\n * @param  {...Object} sources Objects to merge into the target.\n */\nexport const deepAssign = (target, ...sources) => {\n  if (!sources.length) {\n    return target\n  }\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, {\n            [key]: {},\n          })\n        }\n        deepAssign(target[key], source[key])\n      } else if (Array.isArray(source[key])) {\n        target[key] = source[key].map((value) => {\n          if (isObject(value)) {\n            return deepAssign({}, value)\n          }\n          return value\n        })\n      } else {\n        Object.assign(target, {\n          [key]: source[key],\n        })\n      }\n    }\n  }\n\n  return deepAssign(target, ...sources)\n}\n\n/**\n * Get value at path on object.\n * @param {Object} object Object to get from.\n * @param  {Array<String>} path Path to value.\n * @returns {Any} value at path.\n */\nexport const get = (object, path) => {\n  let objectTemp = object\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    objectTemp = objectTemp[path[i]]\n  }\n  return objectTemp[path[i]]\n}\n\n/**\n * Check whether the value is an object.\n * @param {Any} value Value of unknown type.\n * @returns Whether the value is an object.\n */\nexport const isObject = (value) => {\n  return (value && typeof value === 'object' && !Array.isArray(value))\n}\n\n/**\n * Set value on path at object.\n * @param {Object} object Object to set on.\n * @param {Array<String>} path Path to value.\n * @param {Any} value Value to set.\n */\nexport const set = (object, path, value) => {\n  // Exit early if not an object.\n  if (typeof (object) !== 'object') {\n    return\n  }\n\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    object = object[path[i]]\n\n    // Exit early if not an object.\n    if (typeof (object) !== 'object') {\n      return\n    }\n  }\n  object[path[i]] = value\n}\n\nexport default {\n  deepAssign: deepAssign,\n  get: get,\n  isObject: isObject,\n  set: set,\n}\n","// Import contexts.\nimport createContextStore from './factories/contexts/store.js'\n\n// Import proxy dispatcher.\nimport ProxyDispatcher from '@doars/utils/src/events/ProxyDispatcher.js'\n\n// Import utils.\nimport { deepAssign } from '@doars/utils/src/ObjectUtils.js'\n\nexport default class DoarsStore {\n  /**\n   * Create plugin instance.\n   * @param {Doars} library Doars instance to add onto.\n   * @param {Object} options The plugin options.\n   * @param {Object} dataStore Initial store data.\n   */\n  constructor(library, options = null, dataStore = {}) {\n    // Clone options.\n    options = Object.assign({\n      deconstruct: false,\n    }, options)\n\n    // Set private variables.\n    let contextStore, dataStoreCopy, proxy, store\n\n    // Enable plugin when library is enabling.\n    library.addEventListener('enabling', () => {\n      // Create proxy.\n      dataStoreCopy = deepAssign({}, dataStore)\n      proxy = new ProxyDispatcher()\n      store = proxy.add(dataStoreCopy)\n\n      // Create store id.\n      const id = Symbol('ID_STORE')\n\n      // Create contexts.\n      contextStore = createContextStore(options, id, store, proxy)\n      // Get index of state and insert the context directly before it.\n      const existingContexts = library.getContexts()\n      let stateIndex = 0\n      for (let i = existingContexts.length - 1; i >= 0; i--) {\n        const context = existingContexts[i]\n        if (context.name === '$state') {\n          stateIndex = i\n          break\n        }\n      }\n      library.addContexts(stateIndex, contextStore)\n    })\n\n    // Disable plugin when library is disabling.\n    library.addEventListener('disabling', () => {\n      // Remove contexts.\n      library.removeContexts(contextStore)\n\n      // Reset references.\n      store = null\n      proxy.remove(dataStoreCopy)\n      proxy = null\n      dataStoreCopy = null\n      directiveSyncStore = null\n      contextStore = null\n    })\n  }\n}\n"],"names":["options","id","store","proxy","deconstruct","name","create","component","attribute","update","RevocableProxy","onDelete","target","path","join","onGet","accessed","onSet","addEventListener","revocable","value","destroy","removeEventListener","revoke","REFLECTION_METHODS","handler","revoked","revocableHandler","key","console","error","Reflect","Proxy","EventDispatcher","events","callback","push","Object","keys","includes","eventData","index","i","length","splice","removeEventListeners","removeAllEventListeners","dispatchEvent","parameters","event","reverse","once","ProxyDispatcher","assign","delete","get","set","map","WeakMap","add","has","deleteProperty","remove","deleted","Array","isArray","receiver","Symbol","unscopables","property","deepAssign","sources","source","shift","isObject","DoarsStore","library","dataStore","contextStore","dataStoreCopy","createContextStore","existingContexts","getContexts","stateIndex","context","addContexts","removeContexts","directiveSyncStore"],"mappings":"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"}