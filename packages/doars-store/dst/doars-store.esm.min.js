function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function n(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){u=!0,i=e},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw i}}}}function u(e,t,r,n){return{deconstruct:!!e.deconstruct,name:"$store",create:function(e,o,a,i){var c=i.RevocableProxy,u=function(e,r){return a(t,r.join("."))},l=function(e,r){return o.accessed(t,r.join("."))},s=function(e,r){return a(t,r.join("."))};n.addEventListener("delete",u),n.addEventListener("get",l),n.addEventListener("set",s);var f=c(r,{});return{value:f.proxy,destroy:function(){n.removeEventListener("delete",u),n.removeEventListener("get",l),n.removeEventListener("set",s),f.revoke()}}}}}var l=Symbol(),s=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];if(!n.length)return t;var a=n.shift();if(f(t)&&f(a))for(var i in a)f(a[i])?(t[i]||Object.assign(t,{[i]:{}}),e(t[i],a[i])):Array.isArray(a[i])?t[i]=a[i].map((function(t){return f(t)?e({},t):t})):Object.assign(t,{[i]:a[i]});return e.apply(void 0,[t].concat(n))},f=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},v=function(e,t,r){if("object"==typeof e){for(var n=0;n<t.length-1;n++)if("object"!=typeof(e=e[t[n]]))return;e[t[n]]=r}};function d(e,t){var r,n,o,a,i=(r=l,n=function(r,n){var o=n.getValue();return o.startsWith("$store.")&&(o=o.substring("$store.".length)),{data:t,id:e,path:o}},o="$store.",{update:function(e,t,i){var u=i.executeExpression,l=t.getElement(),s=!t[r];if(!s||"DIV"===l.tagName&&l.hasAttribute("contenteditable")||"INPUT"===l.tagName||"SELECT"===l.tagName||"TEXTAREA"===l.tagName){var f=t.getValue();if(!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(f))return a(0,t),void console.warn("Doars: `sync` directive's value not a valid variable name: \""+f+'".');var d=f;if(d.startsWith(o)&&(d=d.substring(o.length)),d=d.split("."),s){var p,y=n(0,t),h=y.data,b=y.id,g=y.path;switch(l.tagName){case"DIV":p=function(){return v(h,d,l.innerText),!0};break;case"INPUT":p=function(){if("checkbox"===l.type){var r=u(e,t.clone(),f);if(l.checked){if(!r)return v(h,d,[l.value]),!0;if(!r.includes(l.value))return r.push(l.value),!0}else if(r){var n=r.indexOf(l.value);if(n>=0)return r.splice(n,1),!0}}else{if("radio"!==l.type)return v(h,d,l.value),!0;var o=u(e,t.clone(),f);if(l.checked){if(o!==l.value)return v(h,d,l.value),!0}else if(o===l.value)return v(h,d,null),!0}return!1};break;case"TEXTAREA":p=function(){return v(h,d,l.value),!0};break;case"SELECT":p=function(){if(l.multiple){var e,t=[],r=c(l.selectedOptions);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.value)}}catch(e){r.e(e)}finally{r.f()}return v(h,d,t),!0}return v(h,d,l.selectedOptions[0].value),!0}}var m=function(){p()&&e.getLibrary().update([{id:b,path:g}])};l.addEventListener("input",m),t[r]=m}var E=u(e,t,f);switch(l.tagName){case"DIV":case"TEXTAREA":E!==l.innerText&&(l.innerText=E);break;case"INPUT":if("checkbox"===l.type){var A=E.includes(l.value);l.checked!==A&&(l.checked=A,A?l.setAttribute("checked",""):l.removeAttribute("checked"))}else if("radio"===l.type){var k=E===l.value;l.checked!==k&&(l.checked=k,k?l.setAttribute("checked",""):l.removeAttribute("checked"))}else E!==l.value&&l.setAttribute("value",E);break;case"SELECT":for(var x=0,j=Array.from(l.options);x<j.length;x++){var w=j[x],O=Array.isArray(E)?E.includes(w.value):E===w.value;w.selected!==O&&(w.selected=O,O?w.setAttribute("selected",""):w.removeAttribute("selected"))}}}else console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.")},destroy:a=function(e,t){t[r]&&(t.getElement().removeEventListener("input",t[r]),delete t[r])}});return i.name="sync-store",i}var p=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"];function y(e,t){var r,n=!1,o={},a=c(p);try{var i=function(){var e=r.value;o[e]=function(){if(!n)return e in t?t[e].apply(t,arguments):Reflect[e].apply(Reflect,arguments);console.error("illegal operation attempted on a revoked proxy")}};for(a.s();!(r=a.n()).done;)i()}catch(e){a.e(e)}finally{a.f()}return{proxy:new Proxy(e,o),revoke:function(){n=!0}}}var h=function t(){e(this,t);var r={};this.addEventListener=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e in r||(r[e]=[]),r[e].push({callback:t,options:n})},this.removeEventListener=function(e,t){if(Object.keys(r).includes(e)){for(var n=r[e],o=-1,a=0;a<n.length;a++)if(n[a].callback===t){o=a;break}o<0||(n.splice(o,1),0===Object.keys(n).length&&delete r[e])}},this.removeEventListeners=function(e){e&&delete r[e]},this.removeAllEventListeners=function(){r={}},this.dispatchEvent=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r[e])for(var a=r[e],i=0;i<a.length;i++){var c=n&&n.reverse?a[a.length-(i+1)]:a[i];c.options&&c.options.once&&a.splice(i,1),c.callback.apply(c,o(t))}}},b=function(a){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(l,h);var i,c,u=(i=l,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=t(i);if(c){var o=t(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return n(this,e)});function l(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,l),t=u.call(this),r=Object.assign({delete:!0,get:!0,set:!0},r);var n=new WeakMap;return t.add=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n.has(e))return n.get(e);for(var i in e)e[i]&&"object"==typeof e[i]&&(e[i]=t.add(e[i],[].concat(o(a),[i])));var c={};r.delete&&(c.deleteProperty=function(e,r){if(!Reflect.has(e,r))return!0;t.remove(e,r);var n=Reflect.deleteProperty(e,r);return n&&t.dispatchEvent("delete",[e,Array.isArray(e)?o(a):[].concat(o(a),[r])]),n}),r.get&&(c.get=function(e,r,n){return r!==Symbol.unscopables&&t.dispatchEvent("get",[e,[].concat(o(a),[r]),n]),Reflect.get(e,r,n)}),r.set&&(c.set=function(e,r,n,i){return e[r]===n||("object"==typeof n&&(n=t.add(n,[].concat(o(a),[r]))),e[r]=n,t.dispatchEvent("set",[e,Array.isArray(e)?o(a):[].concat(o(a),[r]),n,i])),!0});var u=y(e,c);return n.set(u,e),u.proxy},t.remove=function(e){if(n.has(e)){var r=n.get(e);for(var o in n.delete(r),r.proxy)"object"==typeof r.proxy[o]&&t.remove(r.proxy[o]);r.revoke()}},t}return l}(),g=function t(r){var n,o,a,i,c,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,t),l=Object.assign({deconstruct:!1},l),r.addEventListener("enabling",(function(){o=s({},f),i=new b,c=i.add(o);var e=Symbol();n=u(l,e,c,i);for(var t=r.getContexts(),v=0,p=t.length-1;p>=0;p--)if("$state"===t[p].name){v=p;break}r.addContexts(v,n),a=d(e,c),r.addDirectives(-1,a)})),r.addEventListener("disabling",(function(){r.removeContexts(n),r.removeDirective(a),c=null,i.remove(o),i=null,o=null,a=null,n=null}))};export{g as default};
