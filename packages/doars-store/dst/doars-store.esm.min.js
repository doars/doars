var m=(s,r,n,e)=>({deconstruct:!!s.deconstruct,name:"$store",create:(t,i,c,{RevocableProxy:o})=>{let l=(v,d)=>c(r,d.join(".")),f=(v,d)=>i.accessed(r,d.join(".")),u=(v,d)=>c(r,d.join("."));e.addEventListener("delete",l),e.addEventListener("get",f),e.addEventListener("set",u);let p=o(n,{});return{value:p.proxy,destroy:()=>{e.removeEventListener("delete",l),e.removeEventListener("get",f),e.removeEventListener("set",u),p.revoke()}}}});var g=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],y=(s,r)=>{let n=!1,e={};for(let t of g)e[t]=(...i)=>{if(n){console.error("illegal operation attempted on a revoked proxy");return}return t in r?r[t](...i):Reflect[t](...i)};return{proxy:new Proxy(s,e),revoke:()=>{n=!0}}};var b=class{constructor(){let r={};this.addEventListener=(n,e,t=null)=>{n in r||(r[n]=[]),r[n].push({callback:e,options:t})},this.removeEventListener=(n,e)=>{if(!Object.keys(r).includes(n))return;let t=r[n],i=-1;for(let c=0;c<t.length;c++)if(t[c].callback===e){i=c;break}i<0||(t.splice(i,1),Object.keys(t).length===0&&delete r[n])},this.removeEventListeners=n=>{!n||delete r[n]},this.removeAllEventListeners=()=>{r={}},this.dispatchEvent=(n,e,t=null)=>{if(!r[n])return;let i=r[n];for(let c=0;c<i.length;c++){let o=t&&t.reverse?i[i.length-(c+1)]:i[c];o.options&&o.options.once&&i.splice(c,1),o.callback(...e)}}}},h=b;var E=class extends h{constructor(r={}){super(),r=Object.assign({delete:!0,get:!0,set:!0},r);let n=new WeakMap;this.add=(e,t=[])=>{if(n.has(e))return n.get(e);for(let o in e)e[o]&&typeof e[o]=="object"&&(e[o]=this.add(e[o],[...t,o]));let i={};r.delete&&(i.deleteProperty=(o,l)=>{if(!Reflect.has(o,l))return!0;this.remove(o,l);let f=Reflect.deleteProperty(o,l);return f&&this.dispatchEvent("delete",[o,Array.isArray(o)?[...t]:[...t,l]]),f}),r.get&&(i.get=(o,l,f)=>(l!==Symbol.unscopables&&this.dispatchEvent("get",[o,[...t,l],f]),Reflect.get(o,l,f))),r.set&&(i.set=(o,l,f,u)=>(o[l]===f||(f&&typeof f=="object"&&(f=this.add(f,[...t,l])),o[l]=f,this.dispatchEvent("set",[o,Array.isArray(o)?[...t]:[...t,l],f,u])),!0));let c=y(e,i);return n.set(c,e),c.proxy},this.remove=e=>{if(!n.has(e))return;let t=n.get(e);n.delete(t);for(let i in t.proxy)typeof t.proxy[i]=="object"&&this.remove(t.proxy[i]);t.revoke()}}},L=E;var a=(s,...r)=>{if(!r.length)return s;let n=r.shift();if(x(s)&&x(n))for(let e in n)x(n[e])?(s[e]||Object.assign(s,{[e]:{}}),a(s[e],n[e])):Array.isArray(n[e])?s[e]=n[e].map(t=>x(t)?a({},t):t):Object.assign(s,{[e]:n[e]});return a(s,...r)};var x=s=>s&&typeof s=="object"&&!Array.isArray(s);function I(s,r=null,n={}){r=Object.assign({deconstruct:!1},r);let e=!1,t,i,c,o,l=function(){i=a({},n),c=new L,o=c.add(i);let u=Symbol("ID_STORE");t=m(r,u,o,c);let p=s.getContexts(),v=0;for(let d=p.length-1;d>=0;d--)if(p[d].name==="$state"){v=d;break}s.addContexts(v,t)},f=function(){s.removeContexts(t),o=null,c.remove(i),c=null,i=null,t=null};this.disable=function(){!s.getEnabled()&&e&&(e=!1,s.removeEventListener("enabling",l),s.removeEventListener("disabling",f))},this.enable=function(){e||(e=!0,s.addEventListener("enabling",l),s.addEventListener("disabling",f))},this.enable()}export{I as default};
//# sourceMappingURL=doars-store.esm.min.js.map
