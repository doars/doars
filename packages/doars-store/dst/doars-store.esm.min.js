var E=(c,r,n,e)=>({deconstruct:!!c.deconstruct,name:"$store",create:(t,s,i,{RevocableProxy:o})=>{let l=(x,p)=>i(r,p.join(".")),f=(x,p)=>s.accessed(r,p.join(".")),d=(x,p)=>i(r,p.join("."));e.addEventListener("delete",l),e.addEventListener("get",f),e.addEventListener("set",d);let u=o(n,{});return{value:u.proxy,destroy:()=>{e.removeEventListener("delete",l),e.removeEventListener("get",f),e.removeEventListener("set",d),u.revoke()}}}});var g=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],h=(c,r)=>{let n=!1,e={};for(let t of g)e[t]=(...s)=>{if(n){console.error("illegal operation attempted on a revoked proxy");return}return t in r?r[t](...s):Reflect[t](...s)};return{proxy:new Proxy(c,e),revoke:()=>{n=!0}}};var a=class{constructor(){let r={};this.addEventListener=(n,e,t=null)=>{n in r||(r[n]=[]),r[n].push({callback:e,options:t})},this.removeEventListener=(n,e)=>{if(!Object.keys(r).includes(n))return;let t=r[n],s=-1;for(let i=0;i<t.length;i++)if(t[i].callback===e){s=i;break}s<0||(t.splice(s,1),Object.keys(t).length===0&&delete r[n])},this.removeEventListeners=n=>{!n||delete r[n]},this.removeAllEventListeners=()=>{r={}},this.dispatchEvent=(n,e,t=null)=>{if(!r[n])return;let s=r[n];for(let i=0;i<s.length;i++){let o=t&&t.reverse?s[s.length-(i+1)]:s[i];o.options&&o.options.once&&s.splice(i,1),o.callback(...e)}}}},j=a;var b=class extends j{constructor(r={}){super(),r=Object.assign({delete:!0,get:!0,set:!0},r);let n=new WeakMap;this.add=(e,t=[])=>{if(n.has(e))return n.get(e);for(let o in e)e[o]&&typeof e[o]=="object"&&(e[o]=this.add(e[o],[...t,o]));let s={};r.delete&&(s.deleteProperty=(o,l)=>{if(!Reflect.has(o,l))return!0;this.remove(o,l);let f=Reflect.deleteProperty(o,l);return f&&this.dispatchEvent("delete",[o,Array.isArray(o)?[...t]:[...t,l]]),f}),r.get&&(s.get=(o,l,f)=>(l!==Symbol.unscopables&&this.dispatchEvent("get",[o,[...t,l],f]),Reflect.get(o,l,f))),r.set&&(s.set=(o,l,f,d)=>(o[l]===f||(typeof f=="object"&&(f=this.add(f,[...t,l])),o[l]=f,this.dispatchEvent("set",[o,Array.isArray(o)?[...t]:[...t,l],f,d])),!0));let i=h(e,s);return n.set(i,e),i.proxy},this.remove=e=>{if(!n.has(e))return;let t=n.get(e);n.delete(t);for(let s in t.proxy)typeof t.proxy[s]=="object"&&this.remove(t.proxy[s]);t.revoke()}}},O=b;var v=(c,...r)=>{if(!r.length)return c;let n=r.shift();if(y(c)&&y(n))for(let e in n)y(n[e])?(c[e]||Object.assign(c,{[e]:{}}),v(c[e],n[e])):Array.isArray(n[e])?c[e]=n[e].map(t=>y(t)?v({},t):t):Object.assign(c,{[e]:n[e]});return v(c,...r)};var y=c=>c&&typeof c=="object"&&!Array.isArray(c);var m=class{constructor(r,n=null,e={}){n=Object.assign({deconstruct:!1},n);let t,s,i,o;r.addEventListener("enabling",()=>{s=v({},e),i=new O,o=i.add(s);let l=Symbol("ID_STORE");t=E(n,l,o,i);let f=r.getContexts(),d=0;for(let u=f.length-1;u>=0;u--)if(f[u].name==="$state"){d=u;break}r.addContexts(d,t)}),r.addEventListener("disabling",()=>{r.removeContexts(t),o=null,i.remove(s),i=null,s=null,directiveSyncStore=null,t=null})}};export{m as default};
//# sourceMappingURL=doars-store.esm.min.js.map
