var global,factory;global=this,factory=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function i(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=c(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}var s=function(e,t,r,n){return{deconstruct:!!e.deconstruct,name:"$store",create:function(e,o,a,i){var c=i.RevocableProxy,u=function(e,r){return a(t,r.join("."))},l=function(e,r){return o.accessed(t,r.join("."))},s=function(e,r){return a(t,r.join("."))};n.addEventListener("delete",u),n.addEventListener("get",l),n.addEventListener("set",s);var f=c(r,{});return{value:f.proxy,destroy:function(){n.removeEventListener("delete",u),n.removeEventListener("get",l),n.removeEventListener("set",s),f.revoke()}}}}},f=Symbol(),v=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];if(!n.length)return t;var a=n.shift();if(d(t)&&d(a))for(var i in a)d(a[i])?(t[i]||Object.assign(t,{[i]:{}}),e(t[i],a[i])):Array.isArray(a[i])?t[i]=a[i].map((function(t){return d(t)?e({},t):t})):Object.assign(t,{[i]:a[i]});return e.apply(void 0,[t].concat(n))},d=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},p=function(e,t,r){if("object"==typeof e){for(var n=0;n<t.length-1;n++)if("object"!=typeof(e=e[t[n]]))return;e[t[n]]=r}},y="$store.",b=function(e,t){var r,n,o,a,i=(r=f,n=function(r,n){var o=n.getValue();return o.startsWith(y)&&(o=o.substring(y.length)),{data:t,id:e,path:o}},o=y,{update:function(e,t,i){var c=i.executeExpression,u=t.getElement(),s=!t[r];if(!s||"DIV"===u.tagName&&u.hasAttribute("contenteditable")||"INPUT"===u.tagName||"SELECT"===u.tagName||"TEXTAREA"===u.tagName){var f=t.getValue();if(!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(f))return a(0,t),void console.warn("Doars: `sync` directive's value not a valid variable name: \""+f+'".');var v=f;if(v.startsWith(o)&&(v=v.substring(o.length)),v=v.split("."),s){var d,y=n(0,t),b=y.data,h=y.id,g=y.path;switch(u.tagName){case"DIV":d=function(){return p(b,v,u.innerText),!0};break;case"INPUT":d=function(){if("checkbox"===u.type){var r=c(e,t.clone(),f);if(u.checked){if(!r)return p(b,v,[u.value]),!0;if(!r.includes(u.value))return r.push(u.value),!0}else if(r){var n=r.indexOf(u.value);if(n>=0)return r.splice(n,1),!0}}else{if("radio"!==u.type)return p(b,v,u.value),!0;var o=c(e,t.clone(),f);if(u.checked){if(o!==u.value)return p(b,v,u.value),!0}else if(o===u.value)return p(b,v,null),!0}return!1};break;case"TEXTAREA":d=function(){return p(b,v,u.value),!0};break;case"SELECT":d=function(){if(u.multiple){var e,t=[],r=l(u.selectedOptions);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.value)}}catch(e){r.e(e)}finally{r.f()}return p(b,v,t),!0}return p(b,v,u.selectedOptions[0].value),!0}}var m=function(){d()&&e.getLibrary().update([{id:h,path:g}])};u.addEventListener("input",m),t[r]=m}var E=c(e,t,f);switch(u.tagName){case"DIV":case"TEXTAREA":E!==u.innerText&&(u.innerText=E);break;case"INPUT":if("checkbox"===u.type){var A=E.includes(u.value);u.checked!==A&&(u.checked=A,A?u.setAttribute("checked",""):u.removeAttribute("checked"))}else if("radio"===u.type){var j=E===u.value;u.checked!==j&&(u.checked=j,j?u.setAttribute("checked",""):u.removeAttribute("checked"))}else E!==u.value&&u.setAttribute("value",E);break;case"SELECT":for(var k=0,w=Array.from(u.options);k<w.length;k++){var x=w[k],O=Array.isArray(E)?E.includes(x.value):E===x.value;x.selected!==O&&(x.selected=O,O?x.setAttribute("selected",""):x.removeAttribute("selected"))}}}else console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.")},destroy:a=function(e,t){t[r]&&(t.getElement().removeEventListener("input",t[r]),delete t[r])}});return i.name="sync-store",i},h=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],g=function(e,t){var r,n=!1,o={},a=l(h);try{var i=function(){var e=r.value;o[e]=function(){if(!n)return e in t?t[e].apply(t,arguments):Reflect[e].apply(Reflect,arguments);console.error("illegal operation attempted on a revoked proxy")}};for(a.s();!(r=a.n()).done;)i()}catch(e){a.e(e)}finally{a.f()}return{proxy:new Proxy(e,o),revoke:function(){n=!0}}},m=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(s,t);var c,u,l=(c=s,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=n(c);if(u){var r=n(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return a(this,e)});function s(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,s),t=l.call(this),r=Object.assign({delete:!0,get:!0,set:!0},r);var n=new WeakMap;return t.add=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n.has(e))return n.get(e);for(var a in e)e[a]&&"object"==typeof e[a]&&(e[a]=t.add(e[a],[].concat(i(o),[a])));var c={};r.delete&&(c.deleteProperty=function(e,r){if(!Reflect.has(e,r))return!0;t.remove(e,r);var n=Reflect.deleteProperty(e,r);return n&&t.dispatchEvent("delete",[e,Array.isArray(e)?i(o):[].concat(i(o),[r])]),n}),r.get&&(c.get=function(e,r,n){return r!==Symbol.unscopables&&t.dispatchEvent("get",[e,[].concat(i(o),[r]),n]),Reflect.get(e,r,n)}),r.set&&(c.set=function(e,r,n,a){return e[r]===n||("object"==typeof n&&(n=t.add(n,[].concat(i(o),[r]))),e[r]=n,t.dispatchEvent("set",[e,Array.isArray(e)?i(o):[].concat(i(o),[r]),n,a])),!0});var u=g(e,c);return n.set(u,e),u.proxy},t.remove=function(e){if(n.has(e)){var r=n.get(e);for(var o in n.delete(r),r.proxy)"object"==typeof r.proxy[o]&&t.remove(r.proxy[o]);r.revoke()}},t}return r(s)}(r((function t(){e(this,t);var r={};this.addEventListener=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e in r||(r[e]=[]),r[e].push({callback:t,options:n})},this.removeEventListener=function(e,t){if(Object.keys(r).includes(e)){for(var n=r[e],o=-1,a=0;a<n.length;a++)if(n[a].callback===t){o=a;break}o<0||(n.splice(o,1),0===Object.keys(n).length&&delete r[e])}},this.removeEventListeners=function(e){e&&delete r[e]},this.removeAllEventListeners=function(){r={}},this.dispatchEvent=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r[e])for(var o=r[e],a=0;a<o.length;a++){var c=n&&n.reverse?o[o.length-(a+1)]:o[a];c.options&&c.options.once&&o.splice(a,1),c.callback.apply(c,i(t))}}})));return r((function t(r){var n,o,a,i,c,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,t),u=Object.assign({deconstruct:!1},u),r.addEventListener("enabling",(function(){o=v({},l),i=new m,c=i.add(o);var e=Symbol();n=s(u,e,c,i);for(var t=r.getContexts(),f=0,d=t.length-1;d>=0;d--)if("$state"===t[d].name){f=d;break}r.addContexts(f,n),a=b(e,c),r.addDirectives(-1,a)})),r.addEventListener("disabling",(function(){r.removeContexts(n),r.removeDirective(a),c=null,i.remove(o),i=null,o=null,a=null,n=null}))}))},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).DoarsStore=factory();
