{"version":3,"file":"doars-store.esm.js","sources":["../src/factories/contexts/store.js","../src/symbols.js","../../doars/src/utils/ObjectUtils.js","../../doars/src/factories/directives/sync.js","../src/factories/directives/syncStore.js","../../doars/src/polyfills/RevocableProxy.js","../../doars/src/events/EventDispatcher.js","../../doars/src/events/ProxyDispatcher.js","../src/DoarsStore.js"],"sourcesContent":["export default function (options, id, store, proxy) {\n  return {\n    deconstruct: !!options.deconstruct,\n\n    name: '$store',\n\n    create: (component, attribute, update, { RevocableProxy }) => {\n      // Create event handlers.\n      const onDelete = (target, path) => update(id, path.join('.'))\n      const onGet = (target, path) => attribute.accessed(id, path.join('.'))\n      const onSet = (target, path) => update(id, path.join('.'))\n\n      // Add event listeners.\n      proxy.addEventListener('delete', onDelete)\n      proxy.addEventListener('get', onGet)\n      proxy.addEventListener('set', onSet)\n\n      // Wrap in a revocable proxy.\n      const revocable = RevocableProxy(store, {})\n\n      return {\n        value: revocable.proxy,\n\n        // Remove event listeners.\n        destroy: () => {\n          proxy.removeEventListener('delete', onDelete)\n          proxy.removeEventListener('get', onGet)\n          proxy.removeEventListener('set', onSet)\n\n          // Revoke access to store.\n          revocable.revoke()\n        },\n      }\n    },\n  }\n}\n","export const SYNC_STORE = Symbol('SYNC_STORE')\n","/**\n * Deeply assign a series of objects properties together.\n * @param {Object} target Target object to merge to.\n * @param  {...Object} sources Objects to merge into the target.\n */\nexport const deepAssign = (target, ...sources) => {\n  if (!sources.length) {\n    return target\n  }\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, {\n            [key]: {},\n          })\n        }\n        deepAssign(target[key], source[key])\n      } else if (Array.isArray(source[key])) {\n        target[key] = source[key].map((value) => {\n          if (isObject(value)) {\n            return deepAssign({}, value)\n          }\n          return value\n        })\n      } else {\n        Object.assign(target, {\n          [key]: source[key],\n        })\n      }\n    }\n  }\n\n  return deepAssign(target, ...sources)\n}\n\n/**\n * Get value at path on object.\n * @param {Object} object Object to get from.\n * @param  {Array<String>} path Path to value.\n * @returns {Any} value at path.\n */\nexport const get = (object, path) => {\n  let objectTemp = object\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    objectTemp = objectTemp[path[i]]\n  }\n  return objectTemp[path[i]]\n}\n\n/**\n * Check whether the value is an object.\n * @param {Any} value Value of unknown type.\n * @returns Whether the value is an object.\n */\nexport const isObject = (value) => {\n  return (value && typeof value === 'object' && !Array.isArray(value))\n}\n\n/**\n * Set value on path at object.\n * @param {Object} object Object to set on.\n * @param {Array<String>} path Path to value.\n * @param {Any} value Value to set.\n */\nexport const set = (object, path, value) => {\n  // Exit early if not an object.\n  if (typeof (object) !== 'object') {\n    return\n  }\n\n  let i = 0\n  for (; i < path.length - 1; i++) {\n    object = object[path[i]]\n\n    // Exit early if not an object.\n    if (typeof (object) !== 'object') {\n      return\n    }\n  }\n  object[path[i]] = value\n}\n\nexport default {\n  deepAssign: deepAssign,\n  get: get,\n  isObject: isObject,\n  set: set,\n}\n","// Import utils.\nimport { set } from '../../utils/ObjectUtils.js'\n\nexport default function (symbol, getData, contextPrefix) {\n  const destroy = (component, attribute) => {\n    // Exit early if nothing to destroy.\n    if (!attribute[symbol]) {\n      return\n    }\n\n    // Deconstruct attribute.\n    const element = attribute.getElement()\n\n    // Remove existing event listeners.\n    element.removeEventListener('input', attribute[symbol])\n\n    // Remove data from attribute.\n    delete attribute[symbol]\n  }\n\n  return {\n    update: (component, attribute, { executeExpression }) => {\n      // Deconstruct attribute.\n      const element = attribute.getElement()\n\n      // Store whether this call is an update.\n      const isNew = !attribute[symbol]\n\n      if (isNew) {\n        // Check if placed on a correct tag.\n        if (!(element.tagName === 'DIV' && element.hasAttribute('contenteditable')) && element.tagName !== 'INPUT' && element.tagName !== 'SELECT' && element.tagName !== 'TEXTAREA') {\n          console.warn('Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.')\n          return\n        }\n      }\n\n      // Deconstruct attribute.\n      const value = attribute.getValue()\n\n      // Check if value is a valid variable name.\n      if (!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(value)) {\n        destroy(component, attribute)\n        console.warn('Doars: `sync` directive\\'s value not a valid variable name: \"' + value + '\".')\n        return\n      }\n\n      // Remove context prefix.\n      let pathSplit = value\n      if (pathSplit.startsWith(contextPrefix)) {\n        pathSplit = pathSplit.substring(contextPrefix.length)\n      }\n      // Split value into path segments.\n      pathSplit = pathSplit.split('.')\n\n      if (isNew) {\n        // Get data for syncing.\n        const { data, id, path } = getData(component, attribute)\n\n        // Set handler that updates data based of node tag.\n        let handler\n        switch (element.tagName) {\n          case 'DIV':\n            handler = () => {\n              set(data, pathSplit, element.innerText)\n              return true\n            }\n            break\n\n          case 'INPUT':\n            handler = () => {\n              if (element.type === 'checkbox') {\n                const dataValue = executeExpression(component, attribute.clone(), value)\n                if (element.checked) {\n                  if (!dataValue) {\n                    set(data, pathSplit, [element.value])\n                    return true\n                  } if (!dataValue.includes(element.value)) {\n                    dataValue.push(element.value)\n                    return true\n                  }\n                } else if (dataValue) {\n                  const index = dataValue.indexOf(element.value)\n                  if (index >= 0) {\n                    dataValue.splice(index, 1)\n                    return true\n                  }\n                }\n              } else if (element.type === 'radio') {\n                const dataValue = executeExpression(component, attribute.clone(), value)\n                if (element.checked) {\n                  if (dataValue !== element.value) {\n                    set(data, pathSplit, element.value)\n                    return true\n                  }\n                } else if (dataValue === element.value) {\n                  set(data, pathSplit, null)\n                  return true\n                }\n              } else {\n                set(data, pathSplit, element.value)\n                return true\n              }\n              return false\n            }\n            break\n\n          case 'TEXTAREA':\n            handler = () => {\n              set(data, pathSplit, element.value)\n              return true\n            }\n            break\n\n          case 'SELECT':\n            handler = () => {\n              if (element.multiple) {\n                const values = []\n                for (const option of element.selectedOptions) {\n                  values.push(option.value)\n                }\n                set(data, pathSplit, values)\n                return true\n              }\n\n              set(data, pathSplit, element.selectedOptions[0].value)\n              return true\n            }\n            break\n        }\n\n        // Wrap handler so an update is triggered.\n        const handlerWrapper = () => {\n          // Call handler.\n          if (handler()) {\n            // Dispatch update trigger.\n            component.getLibrary().update([{\n              id: id,\n              path: path,\n            }])\n          }\n        }\n\n        // Add event listener.\n        element.addEventListener('input', handlerWrapper)\n\n        // Store handler wrapper.\n        attribute[symbol] = handlerWrapper\n      }\n\n      const dataValue = executeExpression(component, attribute, value)\n      switch (element.tagName) {\n        case 'DIV':\n        case 'TEXTAREA':\n          // Check if current value is different than attribute value.\n          if (dataValue !== element.innerText) {\n            // Update current value.\n            element.innerText = dataValue\n          }\n          break\n\n        case 'INPUT':\n          if (element.type === 'checkbox') {\n            // Update option if the checked value has changed.\n            const checked = dataValue.includes(element.value)\n            if (element.checked !== checked) {\n              // Update checked value.\n              element.checked = checked\n\n              // Update checked attribute.\n              if (checked) {\n                element.setAttribute('checked', '')\n              } else {\n                element.removeAttribute('checked')\n              }\n            }\n          } else if (element.type === 'radio') {\n            // Update option if the checked value has changed.\n            const checked = dataValue === element.value\n            if (element.checked !== checked) {\n              // Update checked value.\n              element.checked = checked\n\n              // Update checked attribute.\n              if (checked) {\n                element.setAttribute('checked', '')\n              } else {\n                element.removeAttribute('checked')\n              }\n            }\n          } else if (dataValue !== element.value) { // Check if current value is different than attribute value.\n            // Update current value.\n            element.setAttribute('value', dataValue)\n          }\n          break\n\n        case 'SELECT':\n          // Iterate over the select options.\n          for (const option of Array.from(element.options)) {\n            // Update option if the selected value has changed.\n            const select = Array.isArray(dataValue) ? dataValue.includes(option.value) : dataValue === option.value\n            if (option.selected !== select) {\n              // Update option status.\n              option.selected = select\n\n              // Update option attribute.\n              if (select) {\n                option.setAttribute('selected', '')\n              } else {\n                option.removeAttribute('selected')\n              }\n            }\n          }\n          break\n      }\n    },\n\n    destroy: destroy,\n  }\n}\n","// Import symbols.\nimport { SYNC_STORE } from '../../symbols.js'\n\n// Import generator.\nimport createDirectiveSync from '@doars/doars/src/factories/directives/sync.js'\n\nconst STORE_PREFIX = '$store.'\n\nexport default function (id, store) {\n  const directive = createDirectiveSync(SYNC_STORE, (component, attribute) => {\n    // Remove prefix from value.\n    let value = attribute.getValue()\n    if (value.startsWith(STORE_PREFIX)) {\n      value = value.substring(STORE_PREFIX.length)\n    }\n\n    // Return directive data.\n    return {\n      data: store,\n      id: id,\n      path: value,\n    }\n  }, STORE_PREFIX)\n\n  directive.name = 'sync-store'\n\n  return directive\n}\n","// List of methods to revoke access to.\nconst REFLECTION_METHODS = [\n  'apply',\n  'construct',\n  'defineProperty',\n  'deleteProperty',\n  'get',\n  'getOwnPropertyDescriptor',\n  'getPrototypeOf',\n  'isExtensible',\n  'ownKeys',\n  'preventExtensions',\n  'set',\n  'setPrototypeOf',\n]\n\n/**\n * Revocable proxy made using regular a proxy and a simple boolean.\n */\nexport default function (target, handler) {\n  // Keep track of status.\n  let revoked = false\n\n  // Add revocable handlers for each given handlers.\n  const revocableHandler = {}\n  for (const key of REFLECTION_METHODS) {\n    revocableHandler[key] = (...parameters) => {\n      if (revoked) {\n        console.error('illegal operation attempted on a revoked proxy')\n        return\n      }\n\n      if (key in handler) {\n        return handler[key](...parameters)\n      }\n      return Reflect[key](...parameters)\n    }\n  }\n\n  // Return proxy and revoke method.\n  return {\n    proxy: new Proxy(target, revocableHandler),\n    revoke: () => {\n      revoked = true\n    },\n  }\n}\n","class EventDispatcher {\n  /**\n   * Create instance.\n   */\n  constructor() {\n    let events = {}\n\n    /**\n     * Add callback to event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function to call on dispatch.\n     * @param {Object} options Callback options.\n     */\n    this.addEventListener = (name, callback, options = null) => {\n      // Check if event name exits and callback is not already present.\n      if (!(name in events)) {\n        events[name] = []\n      }\n\n      // Add to events.\n      events[name].push({\n        callback: callback,\n        options: options,\n      })\n    }\n\n    /**\n     * Remove callback from event.\n     * @param {String} name Event name.\n     * @param {Function} callback Function that would be called.\n     */\n    this.removeEventListener = (name, callback) => {\n      // Check if event exists.\n      if (!Object.keys(events).includes(name)) {\n        return\n      }\n      const eventData = events[name]\n\n      // Get index of callback in events.\n      let index = -1\n      for (let i = 0; i < eventData.length; i++) {\n        if (eventData[i].callback === callback) {\n          index = i\n          break\n        }\n      }\n      if (index < 0) {\n        return\n      }\n\n      // Remove item from events.\n      eventData.splice(index, 1)\n\n      // Remove event if list is empty.\n      if (Object.keys(eventData).length === 0) {\n        delete events[name]\n      }\n    }\n\n    /**\n     * Remove listeners to an event.\n     * @param {String} name Event name.\n     */\n    this.removeEventListeners = (name) => {\n      if (!name) {\n        return\n      }\n\n      // Remove all handlers with the event name.\n      delete events[name]\n    }\n\n    /**\n     * Remove all listeners.\n     * @param {String} name Event name.\n     */\n    this.removeAllEventListeners = () => {\n      // Remove all listeners.\n      events = {}\n    }\n\n    /**\n     * Trigger event and dispatch data to listeners.\n     * @param {String} name Event name.\n     * @param {Array<Any>} parameters Event parameters to pass through.\n     * @param {Object} options Dispatch options.\n     */\n    this.dispatchEvent = (name, parameters, options = null) => {\n      // Check if event exists.\n      if (!events[name]) {\n        return\n      }\n      // Get events by trigger name.\n      const eventData = events[name]\n\n      // Dispatch a call to each event.\n      for (let i = 0; i < eventData.length; i++) {\n        const event = (options && options.reverse) ? eventData[eventData.length - (i + 1)] : eventData[i]\n\n        // If once is truthy then remove the callback.\n        if (event.options && event.options.once) {\n          eventData.splice(i, 1)\n        }\n\n        // Execute callback.\n        event.callback(...parameters)\n      }\n    }\n  }\n}\n\nexport default EventDispatcher\n","// Import polyfill.\nimport RevocableProxy from '../polyfills/RevocableProxy.js'\n\n// Import event dispatcher.\nimport EventDispatcher from './EventDispatcher.js'\n\nclass ProxyDispatcher extends EventDispatcher {\n  constructor(options = {}) {\n    super()\n\n    options = Object.assign({\n      delete: true,\n      get: true,\n      set: true,\n    }, options)\n\n    // Setup WeakMap for keep track of created proxies.\n    const map = new WeakMap()\n\n    /**\n     * Add object to start keeping track of it.\n     * @param {Object} target Object that is being kept track of.\n     * @param {Array<String>} path Path of object on optional parent object, used for recursion.\n     * @returns {Proxy} Object to access and mutate.\n     */\n    this.add = (target, path = []) => {\n      // Exit early if proxy already exists.\n      if (map.has(target)) {\n        return map.get(target)\n      }\n\n      // Recursively create proxies for each property.\n      for (const key in target) {\n        if (target[key] && typeof (target[key]) === 'object') {\n          target[key] = this.add(target[key], [...path, key])\n        }\n      }\n\n      // Create handler and add the handler for which a callback exits..\n      const handler = {}\n\n      if (options.delete) {\n        handler.deleteProperty = (target, key) => {\n          // Exit early successful if property doesn't exist.\n          if (!Reflect.has(target, key)) {\n            return true\n          }\n\n          // Remove proxy.\n          this.remove(target, key)\n\n          // Delete property.\n          const deleted = Reflect.deleteProperty(target, key)\n\n          // Dispatch delete event.\n          if (deleted) {\n            this.dispatchEvent('delete', [target, Array.isArray(target) ? [...path] : [...path, key]])\n          }\n\n          // Return deleted.\n          return deleted\n        }\n      }\n\n      if (options.get) {\n        handler.get = (target, key, receiver) => {\n          // Dispatch get event.\n          if (key !== Symbol.unscopables) {\n            this.dispatchEvent('get', [target, [...path, key], receiver])\n          }\n\n          // Return value from object.\n          return Reflect.get(target, key, receiver)\n        }\n      }\n\n      if (options.set) {\n        handler.set = (target, key, value, receiver) => {\n          // Exit early if not changed.\n          if (target[key] === value) {\n            return true\n          }\n\n          // Add proxy if value is an object.\n          if (typeof value === 'object') {\n            value = this.add(value, [...path, key])\n          }\n          // Store value.\n          target[key] = value\n\n          // Dispatch set event. If the target is an array and a new item has been pushed then the length has also changed, therefore a more generalizable path will be dispatched.\n          this.dispatchEvent('set', [target, Array.isArray(target) ? [...path] : [...path, key], value, receiver])\n\n          // Return success.\n          return true\n        }\n      }\n\n      // Create proxy.\n      const revocable = RevocableProxy(target, handler)\n\n      // Store target at proxy.\n      map.set(revocable, target)\n\n      // Return proxy.\n      return revocable.proxy\n    }\n\n    /**\n     * Remove object from being kept track of.\n     * @param {Object} target Object that is being kept track of.\n     */\n    this.remove = (target) => {\n      // Remove target from the map.\n      if (!map.has(target)) {\n        return\n      }\n\n      const revocable = map.get(target)\n      map.delete(revocable)\n\n      // Recursively remove properties as well.\n      for (const property in revocable.proxy) {\n        if (typeof (revocable.proxy[property]) === 'object') {\n          this.remove(revocable.proxy[property])\n        }\n      }\n\n      // Revoke proxy.\n      revocable.revoke()\n    }\n  }\n}\n\nexport default ProxyDispatcher\n","// Import contexts.\nimport createContextStore from './factories/contexts/store.js'\n\n// Import directive.\nimport createDirectiveSyncStore from './factories/directives/syncStore.js'\n\n// Import proxy dispatcher.\nimport ProxyDispatcher from '@doars/doars/src/events/ProxyDispatcher.js'\n\n// Import utils.\nimport { deepAssign } from '@doars/doars/src/utils/ObjectUtils.js'\n\nexport default class DoarsStore {\n  /**\n   * Create plugin instance.\n   * @param {Doars} library Doars instance to add onto.\n   * @param {Object} options The plugin options.\n   * @param {Object} datastore Initial datastore's data.\n   */\n  constructor(library, options = null, datastore = {}) {\n    // Clone options.\n    options = Object.assign({\n      deconstruct: false,\n    }, options)\n\n    // Set private variables.\n    let contextStore, datastoreCopy, directiveSyncStore, proxy, store\n\n    // Enable plugin when library is enabling.\n    library.addEventListener('enabling', () => {\n      // Create proxy.\n      datastoreCopy = deepAssign({}, datastore)\n      proxy = new ProxyDispatcher()\n      store = proxy.add(datastoreCopy)\n\n      // Create store id.\n      const id = Symbol('ID_STORE')\n\n      // Create contexts.\n      contextStore = createContextStore(options, id, store, proxy)\n      // Get index of state and insert the context directly before it.\n      const existingContexts = library.getContexts()\n      let stateIndex = 0\n      for (let i = existingContexts.length - 1; i >= 0; i--) {\n        const context = existingContexts[i]\n        if (context.name === '$state') {\n          stateIndex = i\n          break\n        }\n      }\n      library.addContexts(stateIndex, contextStore)\n\n      // Create and add directive.\n      directiveSyncStore = createDirectiveSyncStore(id, store)\n      library.addDirectives(-1, directiveSyncStore)\n    })\n\n    // Disable plugin when library is disabling.\n    library.addEventListener('disabling', () => {\n      // Remove contexts.\n      library.removeContexts(contextStore)\n\n      // Remove directive.\n      library.removeDirective(directiveSyncStore)\n\n      // Reset references.\n      store = null\n      proxy.remove(datastoreCopy)\n      proxy = null\n      datastoreCopy = null\n      directiveSyncStore = null\n      contextStore = null\n    })\n  }\n}\n"],"names":["options","id","store","proxy","deconstruct","name","create","component","attribute","update","RevocableProxy","onDelete","target","path","join","onGet","accessed","onSet","addEventListener","revocable","value","destroy","removeEventListener","revoke","SYNC_STORE","Symbol","deepAssign","sources","length","source","shift","isObject","key","Object","assign","Array","isArray","map","set","object","i","symbol","getData","contextPrefix","element","getElement","executeExpression","isNew","tagName","hasAttribute","console","warn","getValue","test","pathSplit","startsWith","substring","split","data","handler","innerText","type","dataValue","clone","checked","includes","push","index","indexOf","splice","multiple","values","selectedOptions","option","handlerWrapper","getLibrary","setAttribute","removeAttribute","from","select","selected","STORE_PREFIX","directive","createDirectiveSync","REFLECTION_METHODS","revoked","revocableHandler","error","Reflect","Proxy","EventDispatcher","events","callback","keys","eventData","removeEventListeners","removeAllEventListeners","dispatchEvent","parameters","event","reverse","once","ProxyDispatcher","delete","get","WeakMap","add","has","deleteProperty","remove","deleted","receiver","unscopables","property","DoarsStore","library","datastore","contextStore","datastoreCopy","directiveSyncStore","createContextStore","existingContexts","getContexts","stateIndex","context","addContexts","createDirectiveSyncStore","addDirectives","removeContexts","removeDirective"],"mappings":"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"}