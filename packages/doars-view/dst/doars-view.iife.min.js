(()=>{var o=Symbol("VIEW");var t={NONE:0,BUFFER:1,DEBOUNCE:2,THROTTLE:3},T=u=>({name:"view",update:(i,e,{processExpression:c})=>{let f=e.getElement(),s=e.getKey(),r=e.getValue();if(e[o]){if(e[o].value===r)return;u.remove(f,e[o].handler),e[o].timeout&&clearTimeout(e[o].timeout),delete e[o]}let n=e.getModifiers(),l=t.NONE;n.buffer?(l=t.BUFFER,n.buffer===!0&&(n.buffer=5)):n.debounce?(l=t.DEBOUNCE,n.debounce===!0&&(n.debounce=500)):n.throttle&&(l=t.THROTTLE,n.throttle===!0&&(n.throttle=500));let h=d=>{if(!(e[o].isIntersecting!==d.isIntersecting))return;if(e[o].isIntersecting=d.isIntersecting,s==="enter"&&!d.isIntersecting||s==="leave"&&d.isIntersecting){e[o].timeout&&(clearTimeout(e[o].timeout),e[o].timeout=null);return}let E=()=>{c(i,e.clone(),r,{$event:d},{return:!1}),e[o].buffer=[]};if(e[o].buffer.push(d),l===t.BUFFER){if(e[o].buffer.length<n.buffer)return;E()}else if(l===t.BUFFER)e[o].timeout&&(clearTimeout(e[o].timeout),e[o].timeout=null),e[o].timeout=setTimeout(E,n.debounce);else if(l===t.THROTTLE){let O=window.performance.now();if(e[o].lastExecution&&O-e[o].lastExecution<n.throttle)return;E(),e[o].lastExecution=O}else E()};u.add(f,h),e[o]={buffer:[],handler:h,isIntersecting:!1,timeout:e[o]?e[o].timeout:null,value:r}},destroy:(i,e)=>{if(!e[o])return;let c=e.getElement();u.remove(c,e[o].handler),e[o].timeout&&clearTimeout(e[o].timeout),delete e[o]}});var m=class{constructor(i=null){i=Object.assign({root:null,rootMargin:"0px",threshold:0},i);let e=new WeakMap,c=s=>{for(let r of s)for(let n of e.get(r.target))n(r)},f=new IntersectionObserver(c,i);this.add=(s,r)=>{e.has(s)||e.set(s,[]),e.get(s).push(r),f.observe(s)},this.remove=(s,r)=>{if(!e.has(s))return;let n=e.get(s),l=n.indexOf(r);l>=0&&n.splice(l,1),n.length===0&&(e.delete(s),f.unobserve(s))}}};var g=class{constructor(i,e=null){e=Object.assign({},e);let c,f;i.addEventListener("enabling",()=>{let s=Object.assign({},e);s.root||(s.root=i.getOptions().root),f=new m(e),c=T(f),i.addDirectives(-1,c)}),i.addEventListener("disabling",()=>{i.removeDirectives(c),c=null,f=null})}};window.DoarsView=g;})();
//# sourceMappingURL=doars-view.iife.min.js.map
