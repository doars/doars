var global,factory;global=this,factory=function(){const e=Symbol();class t{constructor(e=null){e=Object.assign({root:null,rootMargin:"0px",threshold:0},e);const t=new WeakMap,n=new IntersectionObserver((function(e){for(const n of e)for(const e of t.get(n.target))e(n)}),e);this.add=function(e,o){t.has(e)||t.set(e,[]),t.get(e).push(o),n.observe(e)},this.remove=function(e,o){if(!t.has(e))return;const r=t.get(e),i=r.indexOf(o);i>=0&&r.splice(i,1),0===r.length&&(t.delete(e),n.unobserve(e))}}}return class{constructor(n,o=null){let r,i;o=Object.assign({},o),n.addEventListener("enabling",(()=>{const s=Object.assign({},o);s.root||(s.root=n.getOptions().root),i=new t(o),r=function(t){return{name:"view",update:(n,o,{executeExpression:r})=>{const i=o.getElement(),s=o.getKey(),u=o.getValue();if(o[e]){if(o[e].value===u)return;t.remove(i,o[e].handler),o[e].timeout&&clearTimeout(o[e].timeout),delete o[e]}const l=o.getModifiers();let c=0;l.buffer?(c=1,!0===l.buffer&&(l.buffer=5)):l.debounce?(c=2,!0===l.debounce&&(l.debounce=500)):l.throttle&&(c=3,!0===l.throttle&&(l.throttle=500));const f=t=>{if(o[e].isIntersecting===t.isIntersecting)return;if(o[e].isIntersecting=t.isIntersecting,"enter"===s&&!t.isIntersecting||"leave"===s&&t.isIntersecting)return void(o[e].timeout&&(clearTimeout(o[e].timeout),o[e].timeout=null));const i=()=>{r(n,o.clone(),u,{$event:t},{return:!1}),o[e].buffer=[]};if(o[e].buffer.push(t),1===c){if(o[e].buffer.length<l.buffer)return;i()}else if(1===c)o[e].timeout&&(clearTimeout(o[e].timeout),o[e].timeout=null),o[e].timeout=setTimeout(i,l.debounce);else if(3===c){const t=window.performance.now();if(o[e].lastExecution&&t-o[e].lastExecution<l.throttle)return;i(),o[e].lastExecution=t}else i()};t.add(i,f),o[e]={buffer:[],handler:f,isIntersecting:!1,timeout:o[e]?o[e].timeout:null,value:u}},destroy:(n,o)=>{if(!o[e])return;const r=o.getElement();t.remove(r,o[e].handler),o[e].timeout&&clearTimeout(o[e].timeout),delete o[e]}}}(i),n.addDirectives(-1,r)})),n.addEventListener("disabling",(()=>{n.removeDirectives(r),r=null,i=null}))}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).DoarsView=factory();
