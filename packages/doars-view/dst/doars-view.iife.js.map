{"version":3,"file":"doars-view.iife.js","sources":["../src/symbols.js","../src/factories/directives/view.js","../src/ViewObserver.js","../src/DoarsView.js"],"sourcesContent":["export const VIEW = Symbol('VIEW')\n","// Import symbols.\nimport { VIEW } from '../../symbols.js'\n\n// Declare constants.\nconst EXECUTION_MODIFIERS = {\n  NONE: 0,\n  BUFFER: 1,\n  DEBOUNCE: 2,\n  THROTTLE: 3,\n}\n\nexport default (observer) => {\n  return {\n    name: 'view',\n\n    update: (component, attribute, { processExpression }) => {\n      // Deconstruct attribute.\n      const element = attribute.getElement()\n      const key = attribute.getKey()\n      const value = attribute.getValue()\n\n      // Check if existing handler exists.\n      if (attribute[VIEW]) {\n        // Exit early if value has not changed.\n        if (attribute[VIEW].value === value) {\n          return\n        }\n\n        // Stop observing the element.\n        observer.remove(element, attribute[VIEW].handler)\n        // Clear any ongoing timeouts.\n        if (attribute[VIEW].timeout) {\n          clearTimeout(attribute[VIEW].timeout)\n        }\n        // Delete directive data.\n        delete attribute[VIEW]\n      }\n\n      // Deconstruct attribute.\n      const modifiers = attribute.getModifiers()\n\n      // Process execution modifiers.\n      let executionModifier = EXECUTION_MODIFIERS.NONE\n      if (modifiers.buffer) {\n        executionModifier = EXECUTION_MODIFIERS.BUFFER\n        if (modifiers.buffer === true) {\n          modifiers.buffer = 5\n        }\n      } else if (modifiers.debounce) {\n        executionModifier = EXECUTION_MODIFIERS.DEBOUNCE\n        if (modifiers.debounce === true) {\n          modifiers.debounce = 500\n        }\n      } else if (modifiers.throttle) {\n        executionModifier = EXECUTION_MODIFIERS.THROTTLE\n        if (modifiers.throttle === true) {\n          modifiers.throttle = 500\n        }\n      }\n\n      // Create intersection handler.\n      const handler = (event) => {\n        // Check if intersection has changed.\n        const isChanged = attribute[VIEW].isIntersecting !== event.isIntersecting\n        if (!isChanged) {\n          return\n        }\n\n        // Update state in attribute data.\n        attribute[VIEW].isIntersecting = event.isIntersecting\n\n        // Exit early if expression should not be executed.\n        if ((key === 'enter' && !event.isIntersecting) || (key === 'leave' && event.isIntersecting)) {\n          // Clear existing timeout.\n          if (attribute[VIEW].timeout) {\n            clearTimeout(attribute[VIEW].timeout)\n            attribute[VIEW].timeout = null\n          }\n          return\n        }\n\n        const execute = () => {\n          // Execute value using a copy of the attribute since this attribute should not update based on what contexts will be accessed.\n          processExpression(component, attribute.clone(), value, {\n            $event: event,\n          }, { return: false })\n\n          // Reset the buffer.\n          attribute[VIEW].buffer = []\n        }\n\n        // Store event in buffer.\n        attribute[VIEW].buffer.push(event)\n\n        // Check if we need to apply an execution modifier.\n        if (executionModifier === EXECUTION_MODIFIERS.BUFFER) {\n          // Exit early if buffer is not full.\n          if (attribute[VIEW].buffer.length < modifiers.buffer) {\n            return\n          }\n\n          execute()\n        } else if (executionModifier === EXECUTION_MODIFIERS.BUFFER) {\n          // Clear existing timeout.\n          if (attribute[VIEW].timeout) {\n            clearTimeout(attribute[VIEW].timeout)\n            attribute[VIEW].timeout = null\n          }\n\n          // Setup timeout and execute expression when it finishes.\n          attribute[VIEW].timeout = setTimeout(execute, modifiers.debounce)\n        } else if (executionModifier === EXECUTION_MODIFIERS.THROTTLE) {\n          // Get current time in milliseconds.\n          const now = window.performance.now()\n\n          // Exit early if throttle time has not passed.\n          if (attribute[VIEW].lastExecution && now - attribute[VIEW].lastExecution < modifiers.throttle) {\n            return\n          }\n\n          execute()\n\n          // Store new latest execution time.\n          attribute[VIEW].lastExecution = now\n        } else {\n          // Execute expression.\n          execute()\n        }\n      }\n\n      // Start observing the element.\n      observer.add(element, handler)\n\n      // Store handler.\n      attribute[VIEW] = {\n        buffer: [],\n        handler: handler,\n        isIntersecting: false,\n        timeout: attribute[VIEW] ? attribute[VIEW].timeout : null,\n        value: value,\n      }\n    },\n\n    destroy: (component, attribute) => {\n      // Check if a handler exists.\n      if (!attribute[VIEW]) {\n        return\n      }\n\n      // Deconstruct attribute.\n      const element = attribute.getElement()\n\n      // Stop observing the element.\n      observer.remove(element, attribute[VIEW].handler)\n      // Clear any ongoing timeouts.\n      if (attribute[VIEW].timeout) {\n        clearTimeout(attribute[VIEW].timeout)\n      }\n      // Delete directive data.\n      delete attribute[VIEW]\n    },\n  }\n}\n","export default class ViewObserver {\n  /**\n   * Create observer instance.\n   * @param {Object} options Intersection observer options.\n   */\n  constructor(options = null) {\n    // Overwrite default options.\n    options = Object.assign({\n      root: null,\n      rootMargin: '0px',\n      threshold: 0,\n    }, options)\n\n    // Store data per element.\n    const items = new WeakMap()\n\n    /**\n     * Intersection observer handler.\n     * @param {Array<IntersectionObserverEntry>} entries Intersection observer entries.\n     */\n    const intersect = (entries) => {\n      // Invoke callbacks of each entry.\n      for (const entry of entries) {\n        for (const callback of items.get(entry.target)) {\n          callback(entry)\n        }\n      }\n    }\n\n    // Create intersection observer.\n    const intersectionObserver = new IntersectionObserver(intersect, options)\n\n    /**\n     * Add element to observe.\n     * @param {HTMLElement} element Element to observer.\n     * @param {Function} callback Callback to call on intersection change.\n     */\n    this.add = (element, callback) => {\n      // Add callback to list.\n      if (!items.has(element)) {\n        items.set(element, [])\n      }\n      items.get(element).push(callback)\n\n      // Start observing element.\n      intersectionObserver.observe(element)\n    }\n\n    /**\n     * Remove element from observing.\n     * @param {HTMLElement} element Element that is observed.\n     * @param {Function} callback Callback that is called on intersection change.\n     */\n    this.remove = (element, callback) => {\n      // Remove callback from list.\n      if (!items.has(element)) {\n        return\n      }\n      const list = items.get(element)\n      const index = list.indexOf(callback)\n      if (index >= 0) {\n        list.splice(index, 1)\n      }\n\n      // Check if there are no more callbacks.\n      if (list.length === 0) {\n        // Remove element from callbacks list.\n        items.delete(element)\n\n        // Stop observing element.\n        intersectionObserver.unobserve(element)\n      }\n    }\n  }\n}\n","// Import directives.\nimport createDirectiveView from './factories/directives/view.js'\n\n// Import observer.\nimport ViewObserver from './ViewObserver.js'\n\nexport default class DoarsView {\n  /**\n   * Create plugin instance.\n   * @param {Doars} library Doars instance to add onto.\n   * @param {Object} options The plugin options.\n   */\n  constructor(library, options = null) {\n    // Store options.\n    options = Object.assign({}, options)\n\n    // Set private variables.\n    let directiveView, observer\n\n    // Enable plugin when library is enabling.\n    library.addEventListener('enabling', () => {\n      // Overwrite default options.\n      const _options = Object.assign({}, options)\n      if (!_options.root) {\n        _options.root = library.getOptions().root\n      }\n\n      // Setup observer.\n      observer = new ViewObserver(options)\n\n      // Create and add directive.\n      directiveView = createDirectiveView(observer)\n      library.addDirectives(-1, directiveView)\n    })\n\n    // Disable plugin when library is disabling.\n    library.addEventListener('disabling', () => {\n      // Remove directive.\n      library.removeDirectives(directiveView)\n      directiveView = null\n\n      // Remove observer.\n      observer = null\n    })\n  }\n}\n"],"names":["VIEW","Symbol","EXECUTION_MODIFIERS","NONE","BUFFER","DEBOUNCE","THROTTLE","observer","name","update","component","attribute","processExpression","element","getElement","key","getKey","value","getValue","remove","handler","timeout","clearTimeout","modifiers","getModifiers","executionModifier","buffer","debounce","throttle","event","isChanged","isIntersecting","execute","clone","$event","return","push","length","setTimeout","now","window","performance","lastExecution","add","destroy","ViewObserver","options","Object","assign","root","rootMargin","threshold","items","WeakMap","intersect","entries","entry","get","target","callback","intersectionObserver","IntersectionObserver","has","set","observe","list","index","indexOf","splice","delete","unobserve","DoarsView","library","directiveView","addEventListener","_options","getOptions","createDirectiveView","addDirectives","removeDirectives"],"mappings":"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"}