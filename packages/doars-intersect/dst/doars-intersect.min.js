var n=Symbol("VIEW");var d={NONE:0,BUFFER:1,DEBOUNCE:2,THROTTLE:3},T=i=>({name:"intersect",update:(c,e,{processExpression:l})=>{let f=e.getElement(),s=e.getKey(),t=e.getValue();if(e[n]){if(e[n].value===t)return;i.remove(f,e[n].handler),e[n].timeout&&clearTimeout(e[n].timeout),delete e[n]}let o=e.getModifiers(),r=d.NONE;o.buffer?(r=d.BUFFER,o.buffer===!0&&(o.buffer=5)):o.debounce?(r=d.DEBOUNCE,o.debounce===!0&&(o.debounce=500)):o.throttle&&(r=d.THROTTLE,o.throttle===!0&&(o.throttle=500));let g=m=>{if(!(e[n].isIntersecting!==m.isIntersecting))return;if(e[n].isIntersecting=m.isIntersecting,s==="enter"&&!m.isIntersecting||s==="leave"&&m.isIntersecting){e[n].timeout&&(clearTimeout(e[n].timeout),e[n].timeout=null);return}let E=()=>{l(c,e.clone(),t,{$event:m},{return:!1}),e[n].buffer=[]};if(e[n].buffer.push(m),r===d.BUFFER){if(e[n].buffer.length<o.buffer)return;E()}else if(r===d.BUFFER)e[n].timeout&&(clearTimeout(e[n].timeout),e[n].timeout=null),e[n].timeout=setTimeout(E,o.debounce);else if(r===d.THROTTLE){let h=window.performance.now();if(e[n].lastExecution&&h-e[n].lastExecution<o.throttle)return;E(),e[n].lastExecution=h}else E()};i.add(f,g),e[n]={buffer:[],handler:g,isIntersecting:!1,timeout:e[n]?e[n].timeout:null,value:t}},destroy:(c,e)=>{if(!e[n])return;let l=e.getElement();i.remove(l,e[n].handler),e[n].timeout&&clearTimeout(e[n].timeout),delete e[n]}});var u=class i{constructor(c=null){c=Object.assign({root:null,rootMargin:"0px",threshold:0},c);let e=new WeakMap,l=s=>{for(let t of s)for(let o of e.get(t.target))o(t)},f=new i(l,c);this.add=(s,t)=>{e.has(s)||e.set(s,[]),e.get(s).push(t),f.observe(s)},this.remove=(s,t)=>{if(!e.has(s))return;let o=e.get(s),r=o.indexOf(t);r>=0&&o.splice(r,1),o.length===0&&(e.delete(s),f.unobserve(s))}}};function F(i,c=null){c=Object.assign({},c);let e=!1,l,f,s=()=>{let o=Object.assign({},c);o.root||(o.root=i.getOptions().root),f=new u(c),l=T(f),i.addDirectives(-1,l)},t=()=>{i.removeDirectives(l),l=null,f=null};this.disable=()=>{!i.getEnabled()&&e&&(e=!1,i.removeEventListener("enabling",s),i.removeEventListener("disabling",t))},this.enable=()=>{e||(e=!0,i.addEventListener("enabling",s),i.addEventListener("disabling",t))},this.enable()}export{F as default};
//# sourceMappingURL=doars-intersect.min.js.map
