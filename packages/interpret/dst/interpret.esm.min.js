var et=Math.pow;var ht=[9,10,13,32],W=40,M=41,Q=44,N=46,rt=58,X=63,Z=91,$=93,at=125,ot=["=","||=","&&=","??=","*=","**=","/=","%=","+=","-="],G={"=":1,"||=":1,"&&=":1,"??=":1,"*=":1,"**=":1,"/=":1,"%=":1,"+=":1,"-=":1,"||":2,"&&":3,"??":4,"==":8,"!=":8,"===":8,"!==":8,"<":9,">":9,"<=":9,">=":9,"*":11,"/":11,"%":11,"+":11,"-":11},pt=["-","!","+"],J="--",v="++",ct={true:!0,false:!1,null:null,undefined:void 0},y=t=>t>=48&&t<=57,x=t=>d(t)||y(t),d=t=>t===36||t>=48&&t<=57||t===95||t>=65&&t<=90||t>=97&&t<=122,q=t=>{let e=0,A=()=>(e++,{type:5,elements:h($)}),h=r=>{let a=[],o=!1,c=0;for(;e<t.length;){u();let s=t.charCodeAt(e);if(s===r){if(o=!0,e++,r===M&&c&&c>=a.length)throw new Error("Unexpected token "+String.fromCharCode(r));break}else if(s===Q){if(e++,c++,c!==a.length){if(r===M)throw new Error("Unexpected token ,");if(r===$)for(let i=a.length;i<c;i++)a.push(null)}}else{if(a.length!==c&&c!==0)throw new Error("Expected comma");{let i=C();if(!i)throw new Error("Expected comma");a.push(i)}}}if(!o)throw new Error("Expected "+String.fromCharCode(r));return a},l=()=>{let r=Y();if(!r)return r;let a=p();if(!a)return r;let o={value:a,precedence:G[a]||0},c=Y();if(!c)throw new Error("Expected expression after "+a);let s=[r,o,c],i;for(;a=p();){let z=G[a]||0;if(z===0){e-=a.length;break}o={value:a,precedence:z};let Et=a;for(;s.length>2&&s[s.length-2]>z;)c=s.pop(),a=s.pop().value,r=s.pop(),i={type:ot.indexOf(a)>=0?6:7,operator:a,left:r,right:c},s.push(i);if(i=Y(),!i)throw new Error("Expected expression after "+Et);s.push(o,i)}let B=s.length-1;for(i=s[B];B>1;)a=s[B-1].value,i={type:ot.indexOf(a)>=0?6:7,operator:a,left:s[B-2],right:i},B-=2;return i},p=()=>{u();let r=t.substring(e,e+3),a=r.length;for(;a>0;){if(Object.prototype.hasOwnProperty.call(G,r)&&(!d(t.charCodeAt(e))||e+r.length<t.length&&!x(t.charCodeAt(e+r.length))))return e+=a,r;r=r.substring(0,--a)}return!1},C=()=>{let r=l();return u(),r=st(r),r},I=r=>{let a=[];for(;e<t.length;){let o=t.charCodeAt(e);if(o===59||o===Q)e++;else{let c=C();if(c)a.push(c);else if(e<t.length){if(o===r)break;throw new Error('Unexpected "'+t.charAt(e)+'"')}}}return a},w=()=>{let r=t.charCodeAt(e),a=e;if(d(r))e++;else throw new Error("Unexpected "+t.charAt(e));for(;e<t.length&&(r=t.charCodeAt(e),x(r));)e++;return{type:2,name:t.slice(a,e)}},F=()=>{let r="";for(;y(t.charCodeAt(e));)r+=t.charAt(e++);if(t.charCodeAt(e)===N)for(r+=t.charAt(e++);y(t.charCodeAt(e));)r+=t.charAt(e++);let a=t.charAt(e);if(a==="e"||a==="E"){for(r+=t.charAt(e++),a=t.charAt(e),(a==="+"||a==="-")&&(r+=t.charAt(e++));y(t.charCodeAt(e));)r+=t.charAt(e++);if(!y(t.charCodeAt(e-1)))throw new Error("Expected exponent ("+r+t.charAt(e)+")")}let o=t.charCodeAt(e);if(d(o))throw new Error("Variable names cannot start with a number ("+r+t.charAt(e)+")");if(o===N||r.length===1&&r.charCodeAt(0)===N)throw new Error("Unexpected period");return{type:3,value:parseFloat(r)}},_=()=>{if(t.charCodeAt(e)!==123)return;e++;let r=[];for(;!isNaN(t.charCodeAt(e));){if(u(),t.charCodeAt(e)===at)return e++,V({type:11,properties:r});let a=Y();if(!a)throw new Error("Missing }");if(u(),a.type===2&&(t.charCodeAt(e)===Q||t.charCodeAt(e)===at))r.push({type:4,computed:!1,key:a,value:a,shorthand:!0});else if(t.charCodeAt(e)===rt){e++,u();let o=C();if(!o)throw new Error("Unexpected object property");let c=a.type===5;r.push({computed:c,key:c?a.elements[0]:a,shorthand:!1,type:4,value:o}),u()}else a&&r.push(a);t.charCodeAt(e)===Q&&e++}throw new Error("Missing }")},k=()=>{e++;let r=I(M);if(t.charCodeAt(e)===M)return e++,r.length===1?r[0]:r.length?{type:12,expressions:r}:!1;throw new Error("Unclosed (")},u=()=>{for(;ht.indexOf(t.charCodeAt(e))>=0;)e++},n=()=>{let r="",a=t.charAt(e++),o=!1;for(;e<t.length;){let c=t.charAt(e++);if(c===a){o=!0;break}if(c==="\\")switch(c=t.charAt(e++),c){case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="	";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:r+=c}else r+=c}if(!o)throw new Error('Unclosed quote after "'+r+'"');return{type:3,value:r}},st=r=>{if(!r||t.charCodeAt(e)!==X)return r;e++;let a=C();if(!a)throw new Error("Expected expression");if(u(),!t.charCodeAt(e)===rt)throw new Error("Expected :");e++;let o=C();if(!o)throw new Error("Expected expression");let c={type:9,condition:r,consequent:a,alternate:o};if(r.operator&&G[r.operator]<=1){let s=r;for(;s.right.operator&&G[s.right.operator]<=1;)s=s.right;c.condition=s.right,s.right=c,c=r}return c},Y=()=>{let r=_()||lt();if(r)return H(r);u();let a=t.charCodeAt(e);if(y(a)||a===N)return F();if(a===34||a===39)r=n();else if(a===Z)r=A();else{let o=t.substring(e,e+1),c=o.length;for(;c>0;){if(pt.indexOf(o)>=0&&(!d(t.charCodeAt(e))||e+o.length<t.length&&!x(t.charCodeAt(e+o.length)))){e+=c;let s=Y();if(!s)throw new Error("Missing unary operation parameter");return H({type:13,operator:o,parameter:s})}o=o.substr(0,--c)}d(a)?(r=w(),Object.prototype.hasOwnProperty.call(ct,r.name)&&(r={type:3,value:ct[r.name]})):a===W&&(r=k())}return H(V(r))},V=r=>{u();let a=t.charCodeAt(e);for(;a===N||a===Z||a===W||a===X;){let o;if(a===X){if(t.charCodeAt(e+1)!==N)break;o=!0,e+=2,u(),a=t.charCodeAt(e)}if(e++,a===Z){if(r={type:10,computed:!0,object:r,property:C()},u(),a=t.charCodeAt(e),a!==$)throw new Error("Unclosed [");e++}else a===W?r={type:8,parameters:h(M),callee:r}:(a===N||o)&&(o&&e--,u(),r={type:10,computed:!1,object:r,property:w()});o&&(r.optional=!0),u(),a=t.charCodeAt(e)}return r},lt=()=>{if(e+1>=t.length)return;let r=t.substring(e,e+2),a=null;if(r===J)a=J;else if(r===v)a=v;else return;e+=2;let o={type:14,operator:a,parameter:V(w()),prefix:!0};if(!o.parameter||o.parameter.type!==2&&o.parameter.type!==10)throw new Error("Unexpected "+o.operator);return o},H=r=>{if(!r||e+1>=t.length)return r;let a=t.substring(e,e+2),o=null;if(a===J)o=J;else if(a===v)o=v;else return r;return e+=2,r={type:14,operator:o,parameter:r,prefix:!1},r},tt=I();return tt.length===0?void 0:tt};var nt=(t,e,A={})=>{switch(t.type){case 2:return A[t.name]=e,e;case 10:let h=E(t.object,A),l=t.computed||t.property.type!==2?E(t.property,A):t.property.name;return typeof e=="function"?e.bind(h):(h[l]=e,e)}throw new Error("Unsupported assignment method.")},E=(t,e={})=>{if(t){if(Array.isArray(t))return t.map(A=>E(A,e));switch(t.type){case 2:return e[t.name];case 3:return t.value;case 5:let A=[];for(let n of t.elements)A.push(E(n,e));return A;case 6:let h=E(t.right,e);if(t.operator!=="="){let n=E(t.left,e);switch(t.operator){case"||=":if(n)return n;break;case"&&=":if(!n)return n;break;case"??=":if(n!=null)return n;break;case"*=":h=n*h;break;case"**=":h=et(n,h);break;case"/=":h=n/h;break;case"%=":h=n%h;break;case"+=":h=n+h;break;case"-=":h=n-h;break}}return nt(t.left,h,e);case 7:let l=E(t.left,e),p=E(t.right,e);switch(t.operator){case"||":return l||p;case"&&":return l&&p;case"??":return l!=null?l:p;case"==":return l==p;case"!=":return l!=p;case"===":return l===p;case"!==":return l!==p;case"<":return l<p;case">":return l>p;case"<=":return l<=p;case">=":return l>=p;case"-":return l-p;case"+":return l+p;case"*":return l*p;case"/":return l/p;case"%":return l%p}throw new Error("Unsupported operator: "+t.operator);case 8:let C=[];for(let n of t.parameters)C.push(E(n,e));return E(t.callee,e)(...C);case 9:return E(t.condition,e)?E(t.consequent,e):E(t.alternate,e);case 10:let I=E(t.object,e),w=t.computed||t.property.type!==2?E(t.property,e):t.property.name;return typeof I[w]=="function"?I[w].bind(I):I[w];case 11:let F={};for(let n of t.properties)F[n.computed||n.key.type!==2?E(n.key,e):n.key.name]=E(n.value,e);return F;case 12:return t.expressions.map(n=>E(n,e));case 13:let _=E(t.parameter,e);switch(t.operator){case"!":return!_;case"-":return-_;case"+":return+_}throw new Error("Unsupported operator: "+t.operator);case 14:let k=E(t.parameter,e),u=t.operator==="--"?-1:1;return nt(t.parameter,k+u,e),t.prefix?k+u:k}throw new Error('Unexpected node type "'+t.type+'".')}},K=E;var ut=(t,e)=>K(q(t),e),gt=q,Tt=K,mt=5,yt=6,dt=7,St=8,Pt=9,Ut=2,Lt=3,Dt=10,_t=11,kt=4,Yt=12,Bt=13,Mt=14,Gt={interpret:ut,parse:q,run:K,ARRAY:5,ASSIGN:6,BINARY:7,CALL:8,CONDITION:9,IDENTIFIER:2,LITERAL:3,MEMBER:10,OBJECT:11,PROPERTY:4,SEQUENCE:12,UNARY:13,UPDATE:14};export{mt as ARRAY,yt as ASSIGN,dt as BINARY,St as CALL,Pt as CONDITION,Ut as IDENTIFIER,Lt as LITERAL,Dt as MEMBER,_t as OBJECT,kt as PROPERTY,Yt as SEQUENCE,Bt as UNARY,Mt as UPDATE,Gt as default,ut as interpret,gt as parse,Tt as run};
//# sourceMappingURL=interpret.esm.min.js.map
