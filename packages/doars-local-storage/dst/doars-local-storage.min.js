var b=(l,o,e,t,n)=>({deconstruct:n,name:l,create:(s,i,r,{RevocableProxy:d})=>{let c=(u,p)=>r(o,l+"."+p.join(".")),v=(u,p)=>i.accessed(o,l+"."+p.join(".")),a=(u,p)=>r(o,l+"."+p.join("."));t.addEventListener("delete",c),t.addEventListener("get",v),t.addEventListener("set",a);let f=d(e,{});return{value:f.proxy,destroy:()=>{t.removeEventListener("delete",c),t.removeEventListener("get",v),t.removeEventListener("set",a),f.revoke()}}}});var g=(l,o,e,t)=>b("$localStorage",l,o,e,t);var L=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],x=(l,o)=>{let e=!1,t={};for(let n of L)t[n]=(...s)=>{if(!e)return n in o?o[n](...s):Reflect[n](...s)};return{proxy:new Proxy(l,t),revoke:()=>{e=!0}}};var E=class{constructor(){let o={};this.addEventListener=(e,t,n=null)=>{e in o||(o[e]=[]),o[e].push({callback:t,options:n})},this.removeEventListener=(e,t)=>{if(!Object.keys(o).includes(e))return;let n=o[e],s=-1;for(let i=0;i<n.length;i++)if(n[i].callback===t){s=i;break}s<0||(n.splice(s,1),Object.keys(n).length===0&&delete o[e])},this.removeEventListeners=e=>{e&&delete o[e]},this.removeAllEventListeners=()=>{o={}},this.dispatchEvent=(e,t,n=null)=>{if(!o[e])return;let s=o[e];for(let i=0;i<s.length;i++){let r=n&&n.reverse?s[s.length-(i+1)]:s[i];r.options&&r.options.once&&s.splice(i,1),r.callback(...t)}}}};var m=class extends E{constructor(o={}){super(),o=Object.assign({delete:!0,get:!0,set:!0},o);let e=new WeakMap;this.add=(t,n=[])=>{if(e.has(t))return e.get(t);for(let r in t)t[r]&&typeof t[r]=="object"&&(t[r]=this.add(t[r],[...n,r]));let s={};o.delete&&(s.deleteProperty=(r,d)=>{if(!Reflect.has(r,d))return!0;this.remove(r,d);let c=Reflect.deleteProperty(r,d);return c&&this.dispatchEvent("delete",[r,Array.isArray(r)?[...n]:[...n,d]]),c}),o.get&&(s.get=(r,d,c)=>(d!==Symbol.unscopables&&this.dispatchEvent("get",[r,[...n,d],c]),Reflect.get(r,d,c))),o.set&&(s.set=(r,d,c,v)=>(r[d]===c||(c&&typeof c=="object"&&(c=this.add(c,[...n,d])),r[d]=c,this.dispatchEvent("set",[r,Array.isArray(r)?[...n]:[...n,d],c,v])),!0));let i=x(t,s);return e.set(i,t),i.proxy},this.remove=t=>{if(!e.has(t))return;let n=e.get(t);e.delete(n);for(let s in n.proxy)typeof n.proxy[s]=="object"&&this.remove(n.proxy[s]);n.revoke()}}};var h=()=>{let l={},o=Object.keys(localStorage);for(let e=o.length-1;e>=0;e--)l[o[e]]=localStorage.getItem(o[e]);return l};var y=Symbol("ID_LOCAL_STORAGE");function T(l,o=null){o=Object.assign({deconstruct:!1},o);let e=!1,t,n,s,i,r=(a,f)=>{f.length>1,localStorage.removeItem(f[0])},d=(a,f)=>{f.length>1,localStorage.setItem(f[0],a[f[0]])},c=()=>{n=h(),s=new m,i=s.add(n),s.addEventListener("delete",r),s.addEventListener("set",d),t=g(y,i,s,!!o.deconstruct);let a=l.getContexts(),f=0;for(let u=a.length-1;u>=0;u--)if(a[u].name==="$state"){f=u;break}l.addContexts(f,t)},v=()=>{l.removeContexts(t),s.removeEventListener("delete",r),s.removeEventListener("set",d),i=null,s.remove(n),s=null,n=null,t=null};this.disable=()=>{!l.getEnabled()&&e&&(e=!1,l.removeEventListener("enabling",c),l.removeEventListener("disabling",v))},this.enable=()=>{e||(e=!0,l.addEventListener("enabling",c),l.addEventListener("disabling",v))},this.enable()}export{T as default};
//# sourceMappingURL=doars-local-storage.min.js.map
