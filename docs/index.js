(()=>{var R=Symbol("ATTRIBUTES"),N=Symbol("COMPONENT"),_=Symbol("FOR"),vt=Symbol("IGNORE"),P=Symbol("INITIALIZED"),O=Symbol("ON"),k=Symbol("REFERENCES"),z=Symbol("REFERENCES_CACHE"),Et=Symbol("SYNC"),ye=Symbol("SYNC_STATE");var ne=class{constructor(){let e={};this.addEventListener=(r,n,o=null)=>{r in e||(e[r]=[]),e[r].push({callback:n,options:o})},this.removeEventListener=(r,n)=>{if(!Object.keys(e).includes(r))return;let o=e[r],i=-1;for(let l=0;l<o.length;l++)if(o[l].callback===n){i=l;break}i<0||(o.splice(i,1),Object.keys(o).length===0&&delete e[r])},this.removeEventListeners=r=>{!r||delete e[r]},this.removeAllEventListeners=()=>{e={}},this.dispatchEvent=(r,n,o=null)=>{if(!e[r])return;let i=e[r];for(let l=0;l<i.length;l++){let s=o&&o.reverse?i[i.length-(l+1)]:i[l];s.options&&s.options.once&&i.splice(l,1),s.callback(...n)}}}},B=ne;var ct=t=>t.replace(/-(\w)/g,(e,r)=>r.toUpperCase()),be=t=>{let e={};for(let r of t){let n=r.indexOf("-");if(n<0){e[r]=!0;continue}if(n===0){e[r.substring(1)]=!1;continue}let o=r.substring(0,n),i=r.substring(n+1),l=i,s;if(i.endsWith("ms")?l=i.substring(-2):i.endsWith("s")?(s="s",l=i.substring(-1)):i.endsWith("m")?(s="m",l=i.substring(-1)):i.endsWith("h")&&(s="h",l=i.substring(-1)),l=Number.parseInt(l),!isNaN(l))switch(i=l,s){case"h":i*=60;case"m":i*=60;case"s":i*=1e3;break}e[o]=i}return e},Ae=(t,e)=>{if(e=e.match(new RegExp("^"+t+"-([a-z][0-9a-z-]{1,}):?([a-z][0-9a-z-]*)?(\\..*]*)?$","i")),!e)return;let[r,n,o,i]=e;o=o!==""?o:null;let l=o?ct(o):null;return i=i?i.substring(1).split("."):[],[n,o,l,i]},xe=t=>{let e=t.match(/^([$_a-z0-9,(){}\s]{1,}?)\s+(?:in|of)\s+([\s\S]{1,})$/i);if(!e)return;let r=e[1].replace(/^[\s({]*|[)}\s]*$/g,"");if(r=r.match(/^([$_a-z0-9]{1,})?(?:,\s+?)?([$_a-z0-9]{1,})?(?:,\s+)?([$_a-z0-9]{1,})?$/i),!!r)return r.shift(),{iterable:e[2].trim(),variables:[...r]}},H=t=>{if(typeof t=="string"&&(t=t.split(/(?=\.)|(?=#)|(?=\[)/)),!Array.isArray(t)){console.error("Doars: parseSelector expects Array of string or a single string.");return}let e={};for(let r of t)switch(r=r.trim(),r[0]){case"#":e.id=r.substring(1);break;case".":r=r.substring(1),e.class||(e.class=[]),e.class.includes(r)||e.class.push(r);break;case"[":let[n,o,i]=r.match(/^(?:\[)?([-$_.a-z0-9]{1,})(?:[$*^])?(?:=)?([\s\S]{0,})(?:\])$/i);e[o]=i;break}return e};var V=class extends B{constructor(e,r,n,o,i=!1){super();let l=Symbol("ID_ATTRIBUTE");i||(r[R]||(r[R]=[]),r[R].push(this));let s={},c=null,a,u,p,f,E;if(n){let[d,m,y,h]=Ae(e.getLibrary().getOptions().prefix,n);a=d,u=y,p=m,f=h,h&&(E=be(h))}this.getComponent=()=>e,this.getElement=()=>r,this.getId=()=>l,this.getDirective=()=>a,this.getKey=()=>u,this.getKeyRaw=()=>p,this.getModifiers=()=>Object.assign({},E),this.getModifiersRaw=()=>f,this.getName=()=>n,this.getValue=()=>o,this.setValue=d=>{o=d,this.dispatchEvent("changed",[this])},this.clearData=()=>{c=null},this.hasData=()=>c!==null,this.getData=()=>c,this.setData=d=>{c=d},this.destroy=()=>{this.setData(null),this.clearAccessed();let d=r[R].indexOf(this);d>=0&&r[R].splice(d,1),this.dispatchEvent("destroyed",[this]),this.removeAllEventListeners()},this.accessed=(d,m)=>{if(!s[d])s[d]=[];else if(s[d].includes(m))return;s[d].push(m),this.dispatchEvent("accessed",[this,d,m])},this.clearAccessed=()=>{s={}},this.hasAccessed=(d,m)=>{if(!(d in s))return!1;let y=s[d];for(let h of m)if(y.includes(h))return!0;return!1},this.clone=()=>new V(e,r,n,o,!0)}};var lt=["apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","isExtensible","ownKeys","preventExtensions","set","setPrototypeOf"],W=(t,e)=>{let r=!1,n={};for(let o of lt)n[o]=(...i)=>{if(r){console.error("illegal operation attempted on a revoked proxy");return}return o in e?e[o](...i):Reflect[o](...i)};return{proxy:new Proxy(t,n),revoke:()=>{r=!0}}};var oe=class extends B{constructor(e={}){super(),e=Object.assign({delete:!0,get:!0,set:!0},e);let r=new WeakMap;this.add=(n,o=[])=>{if(r.has(n))return r.get(n);for(let s in n)n[s]&&typeof n[s]=="object"&&(n[s]=this.add(n[s],[...o,s]));let i={};e.delete&&(i.deleteProperty=(s,c)=>{if(!Reflect.has(s,c))return!0;this.remove(s,c);let a=Reflect.deleteProperty(s,c);return a&&this.dispatchEvent("delete",[s,Array.isArray(s)?[...o]:[...o,c]]),a}),e.get&&(i.get=(s,c,a)=>(c!==Symbol.unscopables&&this.dispatchEvent("get",[s,[...o,c],a]),Reflect.get(s,c,a))),e.set&&(i.set=(s,c,a,u)=>(s[c]===a||(typeof a=="object"&&(a=this.add(a,[...o,c])),s[c]=a,this.dispatchEvent("set",[s,Array.isArray(s)?[...o]:[...o,c],a,u])),!0));let l=W(n,i);return r.set(l,n),l.proxy},this.remove=n=>{if(!r.has(n))return;let o=r.get(n);r.delete(o);for(let i in o.proxy)typeof o.proxy[i]=="object"&&this.remove(o.proxy[i]);o.revoke()}}},Oe=oe;var Z=(t,e)=>{for(let r in e){if(r==="class"){for(let n of e.class)t.classList.add(n);continue}t.setAttribute(r,e[r])}},Se=(t,e)=>{let r=t.attributes,n=e.attributes,o=null,i=null,l=null,s=null,c=null;for(let a=n.length-1;a>=0;--a)c=n[a],s=c.name,o=c.namespaceURI,i=c.value,o?(s=c.localName||s,l=t.getAttributeNS(o,s),l!==i&&t.setAttributeNS(o,s,i)):t.hasAttribute(s)?(l=t.getAttribute(s),l!==i&&(i==="null"||i==="undefined"?t.removeAttribute(s):t.setAttribute(s,i))):t.setAttribute(s,i);for(let a=r.length-1;a>=0;--a)c=r[a],c.specified!==!1&&(s=c.name,o=c.namespaceURI,o?(s=c.localName||s,e.hasAttributeNS(o,s)||t.removeAttributeNS(o,s)):e.hasAttributeNS(null,s)||t.removeAttribute(s))},$=(t,e)=>{for(let r in e){if(r==="class"){for(let n of e.class)t.classList.remove(n);continue}e[r]&&t.attributes[r]!==e[r]||t.removeAttribute(r)}},ie=(t,e,r)=>{if(e==="value"&&t.tagName==="INPUT"){if(r||(r=""),t.getAttribute(e)===r)return;t.setAttribute(e,r);return}if(e==="checked"&&(t.type==="checkbox"||t.type==="radio")){t.checked=!!r;return}e==="class"&&(Array.isArray(r)?r=r.join(" "):typeof r=="object"&&(r=Object.entries(r).filter(([n,o])=>o).map(([n])=>n).join(" "))),e==="style"&&(Array.isArray(r)?r=r.join(" "):typeof r=="object"&&(r=Object.entries(r).map(([n,o])=>n+":"+o).join(";"))),r===!1||r===null||r===void 0?t.removeAttribute(e):t.setAttribute(e,r)},ce=(t,e)=>{for(let r in e)ie(t,r,e[r])};var De=t=>{let e=document.createElement("template");return e.innerHTML=t,e.content.childNodes[0]},q=(t,e)=>{t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)},le=(t,e)=>t.isSameNode?t.isSameNode(e):t.tagName!==e.tagName?!1:t.type===3?t.nodeValue===e.nodeValue:!1,K=(t,e)=>{let r=-1,n=null;return()=>{if(r>=0&&n){let i=n();if(i)return i}let o=null;do{if(r++,r>=t.childElementCount)return null;o=t.children[r]}while(!e(o));return o.childElementCount&&(n=K(o,e)),o}};var fe=(t,e)=>{let r=e.nodeType,n=e.nodeName;r===1&&Se(t,e),(r===3||r===8)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),n==="INPUT"?at(t,e):n==="OPTION"?ae(t,e,"selected"):n==="TEXTAREA"&&ft(t,e)},Ce=(t,e,r)=>{if(typeof t!="object")throw new Error("Existing tree should be an object.");if(typeof e=="string")e=De(e);else if(typeof e!="object")throw new Error("New tree should be an object.");return r&&r.childrenOnly||e.nodeType===11?(Ie(t,e),t):J(t,e)},at=(t,e)=>{let r=e.value,n=t.value;ae(t,e,"checked"),ae(t,e,"disabled"),t.indeterminate!==e.indeterminate&&(t.indeterminate=e.indeterminate),t.type!=="file"&&(n!==r&&(t.setAttribute("value",r),t.value=r),r==="null"&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?t.type==="range"&&(t.value=r):t.removeAttribute("value"))},ft=(t,e)=>{let r=e.value;if(t.value!==r&&(t.value=r),t.firstChild&&t.firstChild.nodeValue!==r){if(t.firstChild.nodeValue===t.placeholder&&r==="")return;t.firstChild.nodeValue=r}},ae=(t,e,r)=>{t[r]!==e[r]&&(t[r]=e[r],e[r]?t.setAttribute(r,""):t.removeAttribute(r))},J=(t,e)=>t?e?t.isSameNode&&t.isSameNode(e)?t:t.tagName!==e.tagName?e:(fe(t,e),Ie(t,e),t):null:e,Ie=(t,e)=>{let r,n,o,i,l=0;for(let s=0;r=t.childNodes[s],n=e.childNodes[s-l],!(!r&&!n);s++)if(!n)t.removeChild(r),s--;else if(!r)t.appendChild(n),l++;else if(le(r,n))o=J(r,n),o!==r&&(t.replaceChild(o,r),l++);else{i=null;for(let c=s;c<t.childNodes.length;c++)if(le(t.childNodes[c],n)){i=t.childNodes[c];break}i?(o=J(i,n),o!==i&&l++,t.insertBefore(o,r)):!n.id&&!r.id?(o=J(r,n),o!==r&&(t.replaceChild(o,r),l++)):(t.insertBefore(n,r),l++)}};var F=t=>{if(!!t.parentElement)return t=t.parentElement,t[N]?t[N]:F(t)};var Ne=()=>({createContexts:ue,createContextsProxy:ut,RevocableProxy:W}),ue=(t,e,r,n=null)=>{let o={},i=[],l="",s="",c=t.getLibrary().getContexts();for(let a of c){if(!a||!a.name)continue;let u=a.create(t,e,r,Ne());!u||!u.value||(u.destroy&&typeof u.destroy=="function"&&i.push(u.destroy),a.deconstruct&&typeof u.value=="object"&&(s+="with("+a.name+") { ",l+=" }"),o[a.name]=u.value)}if(typeof n=="object")for(let a in n)o[a]=n[a];return{after:l,before:s,destroy:()=>{for(let a of i)a(Ne())},contexts:o}},ut=(t,e,r,n=null)=>{let o=null,i=W({},{get:(l,s)=>{if(o||(o=ue(t,e,r,n)),s in o.contexts)return e.accessed(t.getId(),s),o.contexts[s];if(o.contexts.$state&&s in o.contexts.$state)return e.accessed(t.getId(),"$state"),o.contexts.$state[s]}});return{contexts:i.proxy,destroy:()=>{o&&o.destroy&&o.destroy(t,e),i.revoke()}}},de=(t,e,r,n=null,o=null)=>{o=Object.assign({return:!0},o);let i=[],l=(f,E)=>{i.push({id:f,path:E})},{after:s,before:c,contexts:a,destroy:u}=ue(t,e,l,n);o.return&&(c+="return ");let p;try{p=new Function(...Object.keys(a),c+r+s)(...Object.values(a))}catch(f){console.error(f,"Error encountered when executing the following expression: ",r),p=null}return u(),i.length>0&&t.getLibrary().update(i),p};var dt="-transition:",Q=(t,e,r,n=null)=>{if(r.nodeType!==1){n&&n();return}let{prefix:o}=e.getLibrary().getOptions(),i=o+dt+t,l=E=>{r.dispatchEvent(new CustomEvent("transition-"+E)),r.dispatchEvent(new CustomEvent("transition-"+t+"-"+E))},s,c,a,u,p=!1,f={};return s=i,c=r.getAttribute(s),c&&(f.during=H(c),Z(r,f.during)),s=i+".from",c=r.getAttribute(s),c&&(f.from=H(c),Z(r,f.from)),l("start"),u=requestAnimationFrame(()=>{if(u=null,p)return;if(f.from&&($(r,f.from),f.from=void 0),s=i+".to",c=r.getAttribute(s),c)f.to=H(c),Z(r,f.to);else if(!f.during){l("end"),n&&n(),p=!0;return}let E=getComputedStyle(r),d=Number(E.transitionDuration.replace(/,.*/,"").replace("s",""))*1e3;d===0&&(d=Number(E.animationDuration.replace("s",""))*1e3),a=setTimeout(()=>{a=null,!p&&(f.during&&($(r,f.during),f.during=void 0),f.to&&($(r,f.to),f.to=void 0),l("end"),n&&n(),p=!0)},d)}),()=>{!p||(p=!0,f.during&&($(r,f.during),f.during=void 0),f.from?($(r,f.from),f.from=void 0):f.to&&($(r,f.to),f.to=void 0),u?(cancelAnimationFrame(u),u=null):a&&(clearTimeout(a),a=null),l("end"),n&&n())}},ee=(t,e,r)=>Q("in",t,e,r),X=(t,e,r)=>Q("out",t,e,r);var pe=Object.freeze({executeExpression:de,morphNode:fe,morphTree:Ce,transition:Q,transitionIn:ee,transitionOut:X}),Y=class{constructor(e,r){let n=Symbol("ID_COMPONENT"),{prefix:o}=e.getOptions(),i=[],l=!1,s=!1,c,a,u;if(!r.attributes[o+"-state"]){console.error("Doars: element given to component does not contain a state attribute!");return}r[N]=this;let p=[],f=F(r);f&&(f.getChildren().includes(this)||(f.getChildren().push(this),e.update([{id:f.getId(),path:"children"}]))),this.getAttributes=()=>i,this.getChildren=()=>p,this.getElement=()=>r,this.getId=()=>n,this.getLibrary=()=>e,this.getParent=()=>f,this.getProxy=()=>a,this.getState=()=>u,this.setParent=d=>{f=d},this.initialize=()=>{if(s)return;s=!0;let d=o+"-state",m=r.attributes[d].value;if(c=de(this,new V(this,r,null,m),m)??{},Array.isArray(c)||typeof c!="object"){console.error("Doars: component tag must return an object!");return}a=new Oe,u=a.add(c),this.scanAttributes(r)},this.destroy=()=>{if(!s)return;if(i.length>0){let m=e.getDirectivesObject();for(let y in m)m[y].destroy||(m[y]=void 0);for(let y of i){let h=m[y.getKey()];h&&h.destroy(this,y,pe),y.destroy()}}delete r[N],i=[],s=!1,a.remove(c),u=null,a=null,c=null;let d=[];if(p.length>0){for(let m of p)m.setParent(f),d.push({id:m.getId(),path:"parent"});d.push({id:n,path:"children"})}f&&(p.length>0&&(f.getChildren().push(...p),d.push({id:f.getId(),path:"children"})),d.push({id:n,path:"parent"})),d.length>0&&e.update(d),E("destroyed",{element:r,id:n})},this.addAttribute=(d,m,y)=>{let h=e.getDirectivesNames(),S=new V(this,d,m,y),g=S.length,b=h.indexOf(S.getDirective());for(let A=i.length-1;A>=0;A--)if(h.indexOf(i[A].getDirective())<=b){g=A+1;break}return i.splice(g,0,S),S},this.removeAttribute=d=>{let m=i.indexOf(d);if(m<0)return;let h=e.getDirectivesObject[d.getKey()];h&&h.destroy&&h.destroy(this,d,pe),i.splice(m,1),d.destroy()},this.scanAttributes=d=>{let m=o+"-state",y=o+"-ignore",h=[],S=K(d,g=>!g.hasAttribute(m)&&!g.hasAttribute(y));do for(let{name:g,value:b}of d.attributes)e.isDirectiveName(g)&&h.push(this.addAttribute(d,g,b));while(d=S());return h},this.updateAttribute=d=>{if(!d.getElement()||d.getValue()===null||d.getValue()===void 0){this.removeAttribute(d);return}let m=e.getDirectivesObject();d.clearAccessed();let y=m[d.getDirective()];y&&y.update(this,d,pe)},this.updateAttributes=d=>{if(!s||d.length<=0){l||(l=!0,E("updated",{attributes:d,element:r,id:n}));return}for(let m of d)this.updateAttribute(m);l=!0,E("updated",{attributes:d,element:r,id:n})},this.update=d=>{if(!s)return;let m=Object.getOwnPropertySymbols(d),y=[];for(let h of i)for(let S of m)h.hasAccessed(S,d[S])&&(this.updateAttribute(h),y.push(h));(!l||y.length>0)&&(l=!0,E("updated",{attributes:y,element:r,id:n}))};let E=(d,m)=>{r.dispatchEvent(new CustomEvent(o+"-"+d,{detail:m,bubbles:!0}))}}};var Te={name:"$children",create:(t,e,r,{createContextsProxy:n,RevocableProxy:o})=>{let i,l=o(t.getChildren(),{get:(s,c,a)=>{if(i||(i=s.map(p=>n(p,e,r)),e.accessed(t.getId(),"children")),isNaN(c))return Reflect.get(i,c,a);let u=Reflect.get(i,c,a);if(u)return u.contexts}});return{value:l.proxy,destroy:()=>{i&&i.forEach(s=>s.destroy()),l.revoke()}}}};var ke={name:"$component",create:t=>({value:t.getElement()})};var Re={name:"$element",create:(t,e)=>({value:e.getElement()})};var Pe={name:"$dispatch",create:t=>({value:(e,r={})=>{t.getElement().dispatchEvent(new CustomEvent(e,{detail:r,bubbles:!0}))}})};var Le={deconstruct:!0,name:"$for",create:(t,e,r,{RevocableProxy:n})=>{if(t!==e.getComponent())return;let o=e.getElement(),i=t.getElement(),l=[],s={};for(;o&&!o.isSameNode(i);){let a=o[_];if(a){l.push(a);for(let u in a.variables)s[u]=a.variables[u]}o=o.parentNode}if(l.length===0)return;let c=n(s,{get:(a,u)=>{for(let p of l)if(u in p.variables)return e.accessed(p.id,"$for"),p.variables[u]}});return{value:c.proxy,destroy:()=>{c.revoke()}}}};var we={name:"$inContext",create:(t,e,r,{createContexts:n})=>({value:o=>{let i=[],l=(u,p)=>{i.push({id:u,path:p})},{contexts:s,destroy:c}=n(t,e,l,{}),a=o(s);return c(),i.length>0&&t.getLibrary().update(i),a}})};var je={name:"$nextTick",create:(t,e,r,{createContexts:n})=>{let o,i=!1,l=()=>{if(i)return;i=!0;let s=t.getLibrary();o=[];let c=()=>{a();let{contexts:u,destroy:p}=n(t,e,r,{});for(let f of o)f(u);p()},a=()=>{s.removeEventListener("updated",c),e.removeEventListener("changed",a),e.removeEventListener("destroyed",a)};s.addEventListener("updated",c),e.addEventListener("changed",a),e.addEventListener("destroyed",a)};return{value:s=>{l(),o.push(s)}}}};var Ve={name:"$parent",create:(t,e,r,{createContextsProxy:n})=>{let o=t.getParent();if(!o)return{key:"$parent",value:null};let{contexts:i,destroy:l}=n(o,e,r);return{value:i,destroy:l}}};var $e={name:"$references",create:(t,e,r,{RevocableProxy:n})=>{if(!t[k])return{key:"$references",value:[]};let o=t[z];if(!o){let l=t[k],s=Object.getOwnPropertySymbols(l);o={};for(let c of s){let{element:a,name:u}=l[c];o[u]=a}t[z]=o}let i=n(o,{get:(l,s,c)=>(e.accessed(t.getId(),"$references."+s),Reflect.get(l,s,c))});return{value:i.proxy,destroy:()=>{i.revoke()}}}};var Fe={deconstruct:!0,name:"$state",create:(t,e,r,{RevocableProxy:n})=>{let o=t.getProxy(),i=t.getState();if(!o||!i)return;let l=(u,p)=>r(t.getId(),"$state."+p.join(".")),s=(u,p)=>e.accessed(t.getId(),"$state."+p.join(".")),c=(u,p)=>r(t.getId(),"$state."+p.join("."));o.addEventListener("delete",l),o.addEventListener("get",s),o.addEventListener("set",c);let a=n(i,{});return{value:a.proxy,destroy:()=>{o.removeEventListener("delete",l),o.removeEventListener("get",s),o.removeEventListener("set",c),a.revoke()}}}};var ar=Function.prototype.toString.call(Function).replace("Function","Promise").replace(/\(.*\)/,"()");var T=t=>t&&Object.prototype.toString.call(t)==="[object Promise]";var Ue={name:"attribute",update:(t,e,{executeExpression:r})=>{let n=e.getElement(),o=e.getModifiers(),i=s=>{if(o.selector){if(typeof s!="string"){console.error("Doars: Value returned to attribute directive must be a string if the selector modifier is set.");return}s=H(s),ce(n,s);return}let c=e.getKeyRaw();if(!c){typeof s=="object"&&!Array.isArray(s)?ce(n,s):console.error("Doars: Value returned to attribute directive of invalid type.");return}ie(n,c,s)},l=r(t,e,e.getValue());e.setData(l),T(l)?Promise.resolve(l).then(s=>{e.getData()===l&&i(s)}):i(l)}};var Me={name:"cloak",update:function(t,e,{transitionIn:r}){let n=e.getElement();n.removeAttribute(t.getLibrary().getOptions().prefix+"-"+this.name),r(t,n)}};var te=(t,...e)=>{let r={};for(let n=0;n<e.length&&!(n>=t.length);n++)r[t[n]]=e[n];return r},_e=(t,e,r=-1)=>(r++,r>=t.length?-1:t[r][_].value===e?r:_e(t,e,r)),re=(t,e,r,n,o,i,l)=>{let s=_e(n,i,o);if(s>=0){if(s===o+1)return;let u=n[s];q(n[o]??r,u),e(u[_].id);return}let c=document.importNode(r.content,!0),a=o===-1?r:n[o];q(a,c),c=a.nextElementSibling,ee(t,c),c[_]={id:Symbol("ID_FOR"),value:i,variables:l},n.splice(o+1,0,c)},me=(t,e,r)=>{if(!(e.length<r))for(let n=e.length-1;n>=r;n--){let o=e[n];e.splice(n,1),X(t,o,()=>{o.remove()})}},ze={name:"for",update:(t,e,{executeExpression:r})=>{let n=e.getElement();if(n.tagName!=="TEMPLATE"){console.warn("Doars: `for` directive must be placed on a `<template>` tag.");return}let o=xe(e.getValue());if(!o){console.error("Doars: Error in `for` expression: ",e.getValue());return}let i={},l=u=>{i[u]||(i[u]=["$for"])},s=u=>{let p=e.getData(),f=p.elements??[],E=typeof u;if(E==="number"){for(let d=0;d<u;d++){let m=te(o.variables,d);re(t,l,n,f,d-1,u,m)}me(t,f,u)}else if(E==="string"){for(let d=0;d<u.length;d++){let m=u[d],y=te(o.variables,m,d);re(t,l,n,f,d-1,m,y)}me(t,f,u.length)}else{let d,m;try{let y=[...u];d=!0,m=y.length}catch{}if(d)for(let y=0;y<m;y++){let h=u[y],S=te(o.variables,h,y);re(t,l,n,f,y-1,h,S)}else{let y=Object.keys(u);m=y.length;for(let h=0;h<m;h++){let S=y[h],g=u[S],b=te(o.variables,S,g,h);re(t,l,n,f,h-1,g,b)}}me(t,f,m)}Object.getOwnPropertySymbols(i).length>0&&t.update(i),e.setData(Object.assign({},p,{elements:f}))},c;isNaN(o.iterable)?c=r(t,e,o.iterable):c=Number(o.iterable);let a=e.getData();e.setData(Object.assign({},a,{result:c})),T(c)?Promise.resolve(c).then(u=>{e.getData().result===c&&s(u)}):s(c)},destroy:(t,e)=>{let r=e.getData();if(r.elements)for(let n of r.elements)X(t,n,()=>{n.remove()})}};var pt={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"'},mt=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34);/g;var Be=t=>typeof t!="string"?t:t.replaceAll(mt,e=>pt[e]);var He={name:"html",update:(t,e,{executeExpression:r,morphTree:n})=>{let o=e.getElement(),i=e.getModifiers(),l=c=>{if(i.decode&&typeof c=="string"&&(c=Be(c)),i.morph){if(o.children.length===0)o.appendChild(document.createElement("div"));else if(o.children.length>1)for(let u=o.children.length-1;u>=1;u--)o.children[u].remove();let a=n(o.children[0],c);o.children[0].isSameNode(a)||(o.children[0].remove(),o.appendChild(a));return}if(c instanceof HTMLElement){for(let a of o.children)a.remove();o.appendChild(c.cloneNode(!0));return}if(typeof c=="string"){o.innerHTML!==c&&(o.innerHTML=c);return}console.error("Doars/directives/html: Unknown type returned to directive!")},s=r(t,e,e.getValue());e.setData(s),T(s)?Promise.resolve(s).then(c=>{e.getData()===s&&l(c)}):l(s)}};var Ke={name:"if",update:(t,e,{executeExpression:r,transitionIn:n,transitionOut:o})=>{let i=e.getElement();if(i.tagName!=="TEMPLATE"){console.warn("Doars: `if` directive must be placed on a `<template>` tag.");return}if(i.childCount>1){console.warn("Doars: `if` directive must have a single child node.");return}let l=a=>{let u=e.getData(),p=u.element,f=u.transition;a?p||(f&&f(),p=document.importNode(i.content,!0),q(i,p),p=i.nextElementSibling,f=n(t,p)):p&&(f&&f(),f=o(t,p,()=>{p.remove()})),e.setData(Object.assign({},u,{element:p,transition:f}))},s=r(t,e,e.getValue()),c=e.getData();e.setData(Object.assign({},c,{result:s})),T(s)?Promise.resolve(s).then(a=>{e.getData().result===a&&l(a)}):l(s)},destroy:(t,e,{transitionOut:r})=>{let n=e.getData();n.element&&r(t,n.element,()=>{n.element.remove()})}};var We=(t,e)=>{if(!e[P])return;let r=t.getElement(),n=t.getLibrary().getOptions().prefix+"-updated";r.removeEventListener(n,e[P].handler),delete e[P]},qe={name:"initialized",update:(t,e,{executeExpression:r})=>{let n=t.getElement(),o=e.getValue(),i=t.getLibrary().getOptions().prefix+"-updated";if(e[P]){if(e[P].value===o)return;n.removeEventListener(i,e[P].handler),delete e[P]}let l=({detail:s})=>{s.element===n&&(r(t,e.clone(),o,{},{return:!1}),We(t,e))};n.addEventListener(i,l,{once:!0}),e[P]={handler:l,value:o}},destroy:We};var U={NONE:0,BUFFER:1,DEBOUNCE:2,THROTTLE:3},ht=["alt","ctrl","meta","shift"],Xe={name:"on",update:(t,e,{executeExpression:r})=>{let n=e.getKeyRaw();if(!n){console.warn("Doars: `on` directive must have a key.");return}let o;n.startsWith("keydown-")?(o=n.substring(8).toLowerCase(),n="keydown"):n.startsWith("keyup-")&&(o=n.substring(6).toLowerCase(),n="keyup");let i=e.getElement(),l=e.getValue();if(e[O]){if(e[O].value===l)return;e[O].target.removeEventListener(n,e[O].handler),e[O].timeout&&clearTimeout(e[O].timeout),delete e[O]}let s=e.getModifiers(),c={};s.capture&&(c.capture=!0),s.once&&(c.once=!0),s.passive&&(c.passive=!0);let a=U.NONE;s.buffer?(a=U.BUFFER,s.buffer===!0&&(s.buffer=5)):s.debounce?(a=U.DEBOUNCE,s.debounce===!0&&(s.debounce=500)):s.throttle&&(a=U.THROTTLE,s.throttle===!0&&(s.throttle=500));let u=[];if(o){s.meta=s.meta?!0:s.cmd||s.super;for(let E of ht)s[E]&&u.push(E)}let p=E=>{if(s.self&&E.target!==i||s.outside&&i.contains(E.target))return;if((n==="keydown"||n==="keyup")&&o){for(let y of u)if(!E[y+"Key"])return;let m=s.code?E.code:E.key;if(m===" "&&(m="space"),m=m.toLowerCase(),o!==m)return}s.prevent&&E.preventDefault(),s.stop&&E.stopPropagation();let d=()=>{r(t,e.clone(),l,{$event:E,$events:e[O].buffer},{return:!1}),e[O].buffer=[]};if(e[O].buffer.push(E),a===U.BUFFER){if(e[O].buffer.length<s.buffer)return;d()}else if(a===U.DEBOUNCE)e[O].timeout&&(clearTimeout(e[O].timeout),e[O].timeout=null),e[O].timeout=setTimeout(d,s.debounce);else if(a===U.THROTTLE){let m=window.performance.now();if(e[O].lastExecution&&m-e[O].lastExecution<s.throttle)return;d(),e[O].lastExecution=m}else d()},f=s.outside?document:i;f.addEventListener(n,p,c),e[O]={buffer:[],handler:p,target:f,timeout:e[O]?e[O].timeout:void 0,value:l}},destroy:(t,e)=>{if(!e[O])return;let r=e.getKeyRaw();e[O].target.removeEventListener(r,e[O].handler),e[O].timeout&&clearTimeout(e[O].timeout),delete e[O]}};var Ye=(t,e)=>{if(!t[k])return;let r=e.getId();if(!t[k][r])return;let n=t.getLibrary(),o=t.getId(),i=e.getValue().trim();delete t[k][r],delete t[z],Object.keys(t[k]).length===0&&delete t[k],n.update([{id:o,path:"$references."+i}])},Ge={name:"reference",update:(t,e)=>{let r=e.getValue().trim();if(!/^[_$a-z]{1}[_\-$a-z0-9]{0,}$/i.test(r)){Ye(t,e),console.warn("Doars: `reference` directive's value not a valid variable name: \""+r+'".');return}let n=t.getLibrary(),o=t.getId(),i=e.getElement(),l=e.getId();t[k]||(t[k]={}),t[k][l]={element:i,name:r},delete t[z],n.update([{id:o,path:"$references."+r}])},destroy:Ye};var Ze={name:"select",update:(t,e,{executeExpression:r})=>{let n=e.getElement(),o=n.getAttribute("type");if(n.tagName!=="SELECT"&&!(n.tagName==="INPUT"&&(o==="checkbox"||o==="radio"))){console.warn("Doars: `select` directive must be placed on a `select` tag or `input` of type checkbox or radio.");return}let i=s=>{if(n.tagName==="SELECT")for(let c of Array.from(n.options)){let a=Array.isArray(s)?s.includes(c.value):s===c.value;c.selected!==a&&(c.selected=a,a?c.setAttribute("selected",""):c.removeAttribute("selected"))}else if(o==="checkbox"){let c=s.includes(n.value);n.checked!==c&&(c?n.setAttribute("checked",""):n.removeAttribute("checked"))}else{let c=s===n.value;n.checked!==c&&(c?n.setAttribute("checked",""):n.removeAttribute("checked"))}},l=r(t,e,e.getValue());e.setData(l),T(l)?Promise.resolve(l).then(s=>{e.getData()===l&&i(s)}):i(l)}};var Je={name:"show",update:(t,e,{executeExpression:r,transitionIn:n,transitionOut:o})=>{let i=e.getElement(),l=()=>{let a=e.getData();a.transition&&a.transition();let u;a.result?(i.style.display=null,u=n(t,i)):u=o(t,i,()=>{i.style.display="none"}),e.setData(Object.assign({},a,{transition:u}))},s=r(t,e,e.getValue()),c=e.getData();T(s)?(e.setData(Object.assign({},c,{result:s})),Promise.resolve(s).then(a=>{e.getData().result===s&&l(a)})):(!c||c.result!==s)&&(e.setData(Object.assign({},c,{result:s})),l())}};var L=(t,e,r)=>{if(typeof t!="object")return;let n=0;for(;n<e.length-1;n++)if(t=t[e[n]],typeof t!="object")return;t[e[n]]=r};var Qe=(t,e,r)=>{let n=(o,i)=>{if(!i[t])return;i.getElement().removeEventListener("input",i[t]),delete i[t]};return{update:(o,i,{executeExpression:l})=>{let s=i.getElement(),c=!i[t];if(c&&!(s.tagName==="DIV"&&s.hasAttribute("contenteditable"))&&s.tagName!=="INPUT"&&s.tagName!=="SELECT"&&s.tagName!=="TEXTAREA"){console.warn("Doars: `sync` directive must be placed on an `<input>`, `<select>`, `<textarea>` tag, or a content editable `div`.");return}let a=i.getValue();if(!/^[_$a-z]{1}[._$a-z0-9]{0,}$/i.test(a)){n(o,i),console.warn("Doars: `sync` directive's value not a valid variable name: \""+a+'".');return}let u=a;if(u.startsWith(r)&&(u=u.substring(r.length)),u=u.split("."),c){let{data:f,id:E,path:d}=e(o,i),m;switch(s.tagName){case"DIV":m=()=>(L(f,u,s.innerText),!0);break;case"INPUT":m=()=>{if(s.type==="checkbox"){let h=l(o,i.clone(),a);if(s.checked){if(!h)return L(f,u,[s.value]),!0;if(!h.includes(s.value))return h.push(s.value),!0}else if(h){let S=h.indexOf(s.value);if(S>=0)return h.splice(S,1),!0}}else if(s.type==="radio"){let h=l(o,i.clone(),a);if(s.checked){if(h!==s.value)return L(f,u,s.value),!0}else if(h===s.value)return L(f,u,null),!0}else return L(f,u,s.value),!0;return!1};break;case"TEXTAREA":m=()=>(L(f,u,s.value),!0);break;case"SELECT":m=()=>{if(s.multiple){let h=[];for(let S of s.selectedOptions)h.push(S.value);return L(f,u,h),!0}return L(f,u,s.selectedOptions[0].value),!0};break}let y=()=>{m()&&o.getLibrary().update([{id:E,path:d}])};s.addEventListener("input",y),i[t]=y}let p=l(o,i,a);switch(s.tagName){case"DIV":case"TEXTAREA":p!==s.innerText&&(s.innerText=p);break;case"INPUT":if(s.type==="checkbox"){let f=p.includes(s.value);s.checked!==f&&(s.checked=f,f?s.setAttribute("checked",""):s.removeAttribute("checked"))}else if(s.type==="radio"){let f=p===s.value;s.checked!==f&&(s.checked=f,f?s.setAttribute("checked",""):s.removeAttribute("checked"))}else p!==s.value&&s.setAttribute("value",p);break;case"SELECT":for(let f of Array.from(s.options)){let E=Array.isArray(p)?p.includes(f.value):p===f.value;f.selected!==E&&(f.selected=E,E?f.setAttribute("selected",""):f.removeAttribute("selected"))}break}},destroy:n}};var he="$state.",et=Qe(ye,(t,e)=>{let r=e.getValue();return r.startsWith(he)||(r=he+r),{data:t.getState(),id:t.getId(),path:r}},he);et.name="sync-state";var tt=et;var rt={name:"text",update:(t,e,{executeExpression:r})=>{let n=e.getElement(),o=e.getModifiers(),i=s=>{o.content?n.textContent!==s&&(n.textContent=s):n.innerText!==s&&(n.innerText=s)},l=r(t,e,e.getValue());e.setData(l),T(l)?Promise.resolve(l).then(s=>{e.getData()===l&&i(s)}):i(l)}};var st={name:"watch",update:(t,e,{executeExpression:r})=>{let n=e.getValue();r(t,e,n,{},{return:!1})}};var G=class extends B{constructor(e){super();let{prefix:r,root:n}=e=Object.assign({prefix:"d",root:document.body.firstElementChild},e);typeof n=="string"&&(e.root=n=document.querySelector(n));let o=Symbol("ID_DOARS"),i=!1,l=!1,s,c,a,u=[],p=[Te,ke,Re,Pe,we,je,Ve,$e,Fe,Le],f=[Ge,Ue,ze,He,Ke,rt,Me,qe,Xe,Ze,Je,tt,st],E,d,m;this.getEnabled=()=>i,this.getId=()=>o,this.getOptions=()=>Object.assign({},e),this.enable=()=>{if(i)return this;l=!1,s=[],a={},this.dispatchEvent("enabling",[this]),i=!0,E=f.map(v=>v.name),d={};for(let v of f)d[v.name]=v;m=new RegExp("^"+r+"-("+E.join("|")+")(?:[$-_.a-z0-9]{0,})?$","i"),c=new MutationObserver(S.bind(this)),c.observe(n,{attributes:!0,childList:!0,subtree:!0});let g=r+"-state",b=r+"-ignore",A=[...n.querySelectorAll("["+g+"]")];for(let v=A.length-1;v>=0;v--)A[v].closest("["+b+"]")&&A.splice(v,1);return y(n.hasAttribute(g)&&!n.hasAttribute(b)?n:null,...A),this.dispatchEvent("enabled",[this]),this.dispatchEvent("updated",[this]),this},this.disable=()=>i?(c.disconnect(),c=null,l=s=a=null,this.dispatchEvent("disabling",[this],{reverse:!0}),h(...u),E=d=m=null,i=!1,this.dispatchEvent("disabled",[this],{reverse:!0}),this):this;let y=(...g)=>{let b=[],A=[];for(let v of g){if(!v||v[N])continue;let C=new Y(this,v);u.push(C),b.push(C),A.push(v)}A.length>0&&this.dispatchEvent("components-added",[this,A]);for(let v of b)v.initialize();for(let v of b)v.updateAttributes(v.getAttributes());return b},h=(...g)=>{let b=[];for(let A of g){let v=u.indexOf(A);v<0||(b.push(A.getElement()),A.destroy(),u.splice(v,1))}return b.length>0&&this.dispatchEvent("components-removed",[this,b]),b};this.getContexts=()=>[...p],this.addContexts=(g,...b)=>{if(i){console.warn("Doars: Unable to add contexts after being enabled!");return}g<0?g=p.length+g%p.length:g>p.length&&(g=p.length);let A=[];for(let v=0;v<b.length;v++){let C=b[v];p.includes(C)||(p.splice(g+v,0,C),A.push(C))}return A.length>0&&this.dispatchEvent("contexts-added",[this,A]),A},this.removeContexts=(...g)=>{if(i){console.warn("Doars: Unable to remove contexts after being enabled!");return}let b=[];for(let A of g){let v=p.indexOf(A);v<0||(p.slice(v,1),b.push(A))}return b.length>0&&this.dispatchEvent("contexts-removed",[this,b]),b},this.getDirectives=()=>[...f],this.getDirectivesNames=()=>[...E],this.getDirectivesObject=()=>Object.assign({},d),this.isDirectiveName=g=>m.test(g),this.addDirectives=(g,...b)=>{if(i){console.warn("Doars: Unable to add directives after being enabled!");return}g<0?g=f.length+g%f.length:g>f.length&&(g=f.length);let A=[];for(let v=0;v<b.length;v++){let C=b[v];f.includes(C)||(f.splice(g+v,0,C),A.push(C))}return A.length>0&&(E=d=m=null,this.dispatchEvent("directives-added",[this,A])),A},this.removeDirectives=(...g)=>{if(i){console.warn("Doars: Unable to remove directives after being enabled!");return}let b=[];for(let A of g){let v=f.indexOf(A);v<0||(f.slice(v,1),b.push(A))}return b.length>0&&(E=d=m=null,this.dispatchEvent("directives-removed",[this,b])),b},this.update=g=>{if(!!i){if(g)for(let b of g){let{id:A,path:v}=b;if(!(A in a)){a[A]=[v];continue}a[A].includes(v)||a[A].push(v)}if(!l&&Object.getOwnPropertySymbols(a).length!==0){l=!0,g=a,a={};for(let b of u)b.update(g);if(l=!1,Object.getOwnPropertySymbols(a).length>0){console.warn("Doars: during an update another update has been triggered. Normally this should not happen unless an expression in one of the directives is modifying a state which could cause a infinite loop!"),window.requestAnimationFrame(()=>this.update());return}if(s.length>0){S();return}this.dispatchEvent("updated",[this])}}};let S=g=>{if(s.push(...g),l||s.length===0)return;l=!0,g=[...s],s=[];let b=r+"-state",A=r+"-ignore",v=[],C=[],ge=x=>{if(x.nodeType===1)if(x[N]){C.unshift(x[N]);let D=x.querySelectorAll(b);for(let I of D)I[N]&&C.unshift(I)}else{let D=K(x,I=>I[N]?(C.unshift(I[N]),!1):!0);do if(!!x[R])for(let I of x[R])I.getComponent().removeAttribute(I);while(x=D())}},ve=x=>{if(x.nodeType!==1||x.closest("["+A+"]"))return;let I=x.querySelectorAll("["+b+"]");for(let j of I)j.closest("["+A+"]")||v.push(j);if(x.hasAttribute(b)){v.push(x);return}let w=F(x);if(w){let j=w.scanAttributes(x);w.updateAttributes(j)}};for(let x of g)if(x.type==="childList"){for(let D of x.removedNodes)ge(D);for(let D of x.addedNodes)ve(D)}else if(x.type==="attributes"){let D=x.target;if(x.attributeName===b){if(D[N])continue;let M=F(D);if(M){let Ee=D,it=K(D,se=>se.hasAttribute(b));do for(let se of Ee[R])M.removeAttribute(se);while(Ee=it())}y(D);continue}else if(x.attributeName===A){if(D.hasAttribute(A)){ge(D);continue}ve(D);continue}if(!m.test(x.attributeName))continue;let I=F(D);if(!I)continue;let w=null;for(let M of D[R])if(M.getName()===x.attributeName){w=M;break}let j=D.getAttribute(x.attributeName);if(!w){j&&I.addAttribute(D,x.attributeName,j);continue}w.setValue(j),I.updateAttribute(w)}if(C.length>0&&h(...C),v.length>0&&y(...v),l=!1,s.length>0){S();return}Object.getOwnPropertySymbols(a).length>0&&this.update()}}};var nt=function(){new G().enable()};document.readyState==="complete"||document.readyState==="interactive"?nt():document.addEventListener("DOMContentLoaded",nt,{once:!0,passive:!0});window.copyToClipboard=t=>{let e=document.createElement("textarea");e.value=t,document.body.append(e),e.select(),e.setSelectionRange(0,999999),document.execCommand("copy"),e.remove()};var ot=0,gt=document.getElementById("counter-text");window.increment=()=>{ot++,gt.setAttribute("d-text",ot)};})();
//# sourceMappingURL=index.js.map
